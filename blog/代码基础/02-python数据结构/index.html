<!doctype html><html lang=zh-cn class=h-full><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-XXXXXXX")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XXXXXXXXXX")</script><title>代码基础第2讲：Python数据结构 | 烧烤量化</title>
<meta name=description content="深入学习Python核心数据结构，包含列表、字典、集合、元组等在量化交易中的应用，掌握金融数据处理的基础工具"><meta name=author content="Ryan"><meta name=robots content="index, follow"><meta property="og:title" content="代码基础第2讲：Python数据结构 | 烧烤量化"><meta property="og:description" content="深入学习Python核心数据结构，包含列表、字典、集合、元组等在量化交易中的应用，掌握金融数据处理的基础工具"><meta property="og:type" content="article"><meta property="og:url" content="https://sk-quant.github.io/blog/%E4%BB%A3%E7%A0%81%E5%9F%BA%E7%A1%80/02-python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"><meta property="og:site_name" content="烧烤量化"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="代码基础第2讲：Python数据结构 | 烧烤量化"><meta name=twitter:description content="深入学习Python核心数据结构，包含列表、字典、集合、元组等在量化交易中的应用，掌握金融数据处理的基础工具"><link rel=icon type=image/x-icon href=/images/favicon.ico><link rel=canonical href=https://sk-quant.github.io/blog/%E4%BB%A3%E7%A0%81%E5%9F%BA%E7%A1%80/02-python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@600;700;800&display=swap" rel=stylesheet><link rel=stylesheet href="/css/main.min.1255c60f0805e580d846a005c9da456febfe5426dbcd39f66ba0ae2958126a2d.css"></head><body class="min-h-screen flex flex-col"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-XXXXXXX" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><div class="fixed top-0 left-0 right-0 z-50"><div class=mobile-menu-wrapper><input type=checkbox id=nav-toggle class=nav-toggle><header class="fixed w-full top-0 z-50 bg-white/80 backdrop-blur-sm border-b border-gray-100"><div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl"><nav class="flex items-center justify-between h-20"><a href=https://sk-quant.github.io/ class="flex items-center space-x-4"><img src=/images/logo.svg alt=烧烤量化 class=h-12>
<span class="text-3xl font-semibold text-gray-800">烧烤量化</span></a><div class="hidden md:flex items-center space-x-8"><a href=/path class="text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">学习路线</a><div class="relative group"><button class="flex items-center text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">
量化基础<svg class="ml-2 w-4 h-4" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></button><div class="absolute left-0 mt-2 w-72 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 ease-in-out"><div class="py-6 bg-white border border-gray-100 shadow-xl rounded-lg"><a href=/categories/%e6%8a%95%e8%b5%84%e7%90%86%e8%ae%ba/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">投资理论</a>
<a href=/categories/%e4%bb%a3%e7%a0%81%e5%9f%ba%e7%a1%80/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">代码基础</a>
<a href=/categories/%e6%8a%80%e6%9c%af%e6%8c%87%e6%a0%87/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">技术指标</a>
<a href=/categories/%e5%9b%9e%e6%b5%8b%e5%b9%b3%e5%8f%b0/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">回测平台</a></div></div></div><div class="relative group"><button class="flex items-center text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">
量化进阶<svg class="ml-2 w-4 h-4" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></button><div class="absolute left-0 mt-2 w-72 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 ease-in-out"><div class="py-6 bg-white border border-gray-100 shadow-xl rounded-lg"><a href=/categories/%e7%ad%96%e7%95%a5%e5%88%86%e4%ba%ab/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">策略分享</a>
<a href=/categories/%e5%ae%9e%e7%9b%98%e5%b7%a5%e5%85%b7/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">实盘工具</a>
<a href=/categories/%e7%83%ad%e7%82%b9%e9%a3%8e%e5%8f%a3/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">热点风口</a>
<a href=/categories/%e7%bb%bc%e5%90%88%e5%ae%9e%e6%88%98/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">综合实战</a></div></div></div><div class="relative group"><button class="flex items-center text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">
量化高手<svg class="ml-2 w-4 h-4" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></button><div class="absolute left-0 mt-2 w-72 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 ease-in-out"><div class="py-6 bg-white border border-gray-100 shadow-xl rounded-lg"><a href=/categories/%e5%8f%af%e8%bd%ac%e5%80%ba/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">可转债</a>
<a href=/categories/%e8%9e%8d%e8%b5%84%e8%9e%8d%e5%88%b8/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">融资融券</a>
<a href=/categories/%e8%82%a1%e7%a5%a8%e6%9c%9f%e6%9d%83/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">股票期权</a>
<a href=/categories/%e8%82%a1%e6%8c%87%e6%9c%9f%e8%b4%a7/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">股指期货</a></div></div></div><a href=/pricing class="text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">服务套餐</a></div><div class="hidden md:flex items-center space-x-4"><a href=/contact class="inline-flex items-center justify-center px-6 py-3 rounded-lg font-bold transition duration-200 ease-in-out bg-primary-600 text-white hover:bg-primary-700 hover:scale-105">现在加入</a></div><div class=md:hidden><label for=nav-toggle class="p-2 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:ring-offset-2 transition-colors cursor-pointer"><svg class="w-6 h-6" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></label></div></nav></div><div class="nav-content md:hidden w-full fixed left-0 right-0 top-20 bg-white border-t border-gray-100 shadow-lg"><div class="w-full px-6 py-4"><a href=/path class="block text-xl text-gray-900 hover:text-primary-600 font-bold transition duration-200 py-2">学习路线</a><div class=py-2><div class="text-xl text-gray-900 font-bold mb-2">量化基础</div><div class=pl-4><a href=/categories/%e6%8a%95%e8%b5%84%e7%90%86%e8%ae%ba/ class="block text-gray-700 hover:text-primary-600 py-2">投资理论</a>
<a href=/categories/%e4%bb%a3%e7%a0%81%e5%9f%ba%e7%a1%80/ class="block text-gray-700 hover:text-primary-600 py-2">代码基础</a>
<a href=/categories/%e6%8a%80%e6%9c%af%e6%8c%87%e6%a0%87/ class="block text-gray-700 hover:text-primary-600 py-2">技术指标</a>
<a href=/categories/%e5%9b%9e%e6%b5%8b%e5%b9%b3%e5%8f%b0/ class="block text-gray-700 hover:text-primary-600 py-2">回测平台</a></div></div><div class=py-2><div class="text-xl text-gray-900 font-bold mb-2">量化进阶</div><div class=pl-4><a href=/categories/%e7%ad%96%e7%95%a5%e5%88%86%e4%ba%ab/ class="block text-gray-700 hover:text-primary-600 py-2">策略分享</a>
<a href=/categories/%e5%ae%9e%e7%9b%98%e5%b7%a5%e5%85%b7/ class="block text-gray-700 hover:text-primary-600 py-2">实盘工具</a>
<a href=/categories/%e7%83%ad%e7%82%b9%e9%a3%8e%e5%8f%a3/ class="block text-gray-700 hover:text-primary-600 py-2">热点风口</a>
<a href=/categories/%e7%bb%bc%e5%90%88%e5%ae%9e%e6%88%98/ class="block text-gray-700 hover:text-primary-600 py-2">综合实战</a></div></div><div class=py-2><div class="text-xl text-gray-900 font-bold mb-2">量化高手</div><div class=pl-4><a href=/categories/%e5%8f%af%e8%bd%ac%e5%80%ba/ class="block text-gray-700 hover:text-primary-600 py-2">可转债</a>
<a href=/categories/%e8%9e%8d%e8%b5%84%e8%9e%8d%e5%88%b8/ class="block text-gray-700 hover:text-primary-600 py-2">融资融券</a>
<a href=/categories/%e8%82%a1%e7%a5%a8%e6%9c%9f%e6%9d%83/ class="block text-gray-700 hover:text-primary-600 py-2">股票期权</a>
<a href=/categories/%e8%82%a1%e6%8c%87%e6%9c%9f%e8%b4%a7/ class="block text-gray-700 hover:text-primary-600 py-2">股指期货</a></div></div><a href=/pricing class="block text-xl text-gray-900 hover:text-primary-600 font-bold transition duration-200 py-2">服务套餐</a><div class="pt-4 space-y-4"><a href=/contact class="block text-center px-6 py-3 rounded-lg font-bold transition duration-200 ease-in-out bg-primary-600 text-white hover:bg-primary-700 hover:scale-105">现在加入</a></div></div></div></header><style>.mobile-menu-wrapper{position:relative}.nav-toggle{display:none}.nav-content{display:none}.nav-toggle:checked~header .nav-content{display:block}</style></div></div><div class=pt-20><div class="container mx-auto px-4 py-12"><div class="flex flex-col lg:flex-row gap-8 mb-12"><article class=flex-1><header class=mb-8><div class=mb-4><a href=/categories/%E4%BB%A3%E7%A0%81%E5%9F%BA%E7%A1%80 class="inline-block px-3 py-1 text-sm font-medium text-primary-600 bg-primary-50 rounded-full hover:bg-primary-100 mr-2">代码基础</a></div><h1 class="text-4xl font-bold mb-4">代码基础第2讲：Python数据结构</h1><div class="flex flex-col space-y-4"><div class="flex items-center justify-between text-sm text-gray-500"><div class="flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7A4 4 0 118 7a4 4 0 018 0zm-4 7a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
<span>Ryan</span></div><div class="flex items-center space-x-6"><div class="flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747.0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746.0-3.332.477-4.5 1.253"/></svg>
<span>30 分钟</span></div><div class="flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5A2 2 0 003 7v12a2 2 0 002 2z"/></svg>
<time datetime=2025-09-02>September 2, 2025</time></div></div></div><div class="flex items-center flex-wrap gap-2"><a href=/tags/2025 class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 transition-colors duration-200">#2025</a></div></div></header><div class=mb-8><img src=/images/blog/%e4%bb%a3%e7%a0%81%e5%9f%ba%e7%a1%80.jpg alt=代码基础第2讲：Python数据结构 class="w-full h-auto rounded-lg" loading=lazy></div><div class="prose prose-lg max-w-none"><div class="bg-gray-50 p-6 rounded-lg mb-8"><h2 class="text-xl font-semibold mb-4">目录</h2><nav id=TableOfContents><ul><li><a href=#数据结构在量化交易中的重要性>数据结构在量化交易中的重要性</a></li><li><a href=#列表list有序数据的基础容器>列表（List）：有序数据的基础容器</a><ul><li><a href=#列表基础操作>列表基础操作</a></li><li><a href=#列表推导式量化数据的高效处理>列表推导式：量化数据的高效处理</a></li><li><a href=#列表排序与量化应用>列表排序与量化应用</a></li></ul></li><li><a href=#字典dictionary键值映射的高效工具>字典（Dictionary）：键值映射的高效工具</a><ul><li><a href=#字典基础操作>字典基础操作</a></li><li><a href=#字典推导式高效构建映射关系>字典推导式：高效构建映射关系</a></li><li><a href=#字典的量化应用实例>字典的量化应用实例</a></li></ul></li><li><a href=#集合set去重与集合运算的利器>集合（Set）：去重与集合运算的利器</a><ul><li><a href=#集合基础操作>集合基础操作</a></li><li><a href=#集合的量化应用>集合的量化应用</a></li></ul></li><li><a href=#元组tuple不可变数据的安全容器>元组（Tuple）：不可变数据的安全容器</a><ul><li><a href=#元组基础操作>元组基础操作</a></li><li><a href=#元组的量化应用>元组的量化应用</a></li></ul></li><li><a href=#嵌套数据结构复杂数据的组织方式>嵌套数据结构：复杂数据的组织方式</a><ul><li><a href=#嵌套列表与字典>嵌套列表与字典</a></li><li><a href=#时间序列数据结构>时间序列数据结构</a></li></ul></li><li><a href=#实践练习综合数据结构应用>实践练习：综合数据结构应用</a><ul><li><a href=#练习1股票筛选器>练习1：股票筛选器</a></li><li><a href=#练习2投资组合管理器>练习2：投资组合管理器</a></li></ul></li><li><a href=#性能优化与最佳实践>性能优化与最佳实践</a><ul><li><a href=#数据结构选择指南>数据结构选择指南</a></li><li><a href=#内存优化技巧>内存优化技巧</a></li></ul></li><li><a href=#本讲总结>本讲总结</a></li><li><a href=#课后练习>课后练习</a></li></ul></nav></div><h2 id=数据结构在量化交易中的重要性>数据结构在量化交易中的重要性</h2><p>在A股量化交易中，数据结构是处理和分析金融数据的基础工具。股票价格、交易量、财务指标、新闻资讯等各种类型的数据都需要合适的数据结构来存储和操作。掌握Python的核心数据结构，能够帮助我们高效地处理时间序列数据、构建技术指标、管理投资组合，以及实现复杂的交易策略。</p><p>量化交易中的数据处理通常涉及大量的时间序列数据、多维数组和复杂的关联关系。不同的数据结构有着各自的适用场景：列表适合存储有序的价格序列，字典适合存储股票代码到数据的映射关系，集合适合处理股票池的去重和集合运算，元组适合存储不可变的交易记录。合理选择和使用数据结构，不仅能提高代码的可读性和可维护性，更能显著提升程序的执行效率。</p><p>本讲将系统介绍Python的核心数据结构，并通过丰富的量化交易实例，展示如何在实际应用中灵活运用这些数据结构来解决金融数据分析问题。</p><h2 id=列表list有序数据的基础容器>列表（List）：有序数据的基础容器</h2><h3 id=列表基础操作>列表基础操作</h3><p>列表是Python中最常用的数据结构之一，特别适合存储有序的金融数据序列，如股票价格、交易量等时间序列数据。</p><p><strong>创建和访问列表：</strong></p><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 股票价格列表</span>
</span></span><span class=line><span class=cl><span class=n>ping_an_prices</span> <span class=o>=</span> <span class=p>[</span><span class=mf>45.20</span><span class=p>,</span> <span class=mf>45.50</span><span class=p>,</span> <span class=mf>45.80</span><span class=p>,</span> <span class=mf>46.10</span><span class=p>,</span> <span class=mf>46.40</span><span class=p>,</span> <span class=mf>46.25</span><span class=p>,</span> <span class=mf>46.80</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>volumes</span> <span class=o>=</span> <span class=p>[</span><span class=mi>125000</span><span class=p>,</span> <span class=mi>156000</span><span class=p>,</span> <span class=mi>189000</span><span class=p>,</span> <span class=mi>201000</span><span class=p>,</span> <span class=mi>178000</span><span class=p>,</span> <span class=mi>165000</span><span class=p>,</span> <span class=mi>192000</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 混合数据列表（不常用，但展示可能性）</span>
</span></span><span class=line><span class=cl><span class=n>stock_data</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;000001.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;平安银行&#34;</span><span class=p>,</span> <span class=mf>46.80</span><span class=p>,</span> <span class=mi>192000</span><span class=p>,</span> <span class=kc>True</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 访问列表元素</span>
</span></span><span class=line><span class=cl><span class=n>current_price</span> <span class=o>=</span> <span class=n>ping_an_prices</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>  <span class=c1># 最新价格：46.80</span>
</span></span><span class=line><span class=cl><span class=n>first_volume</span> <span class=o>=</span> <span class=n>volumes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>           <span class=c1># 首日交易量：125000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 列表切片</span>
</span></span><span class=line><span class=cl><span class=n>recent_3_days</span> <span class=o>=</span> <span class=n>ping_an_prices</span><span class=p>[</span><span class=o>-</span><span class=mi>3</span><span class=p>:]</span>  <span class=c1># 最近3天价格：[46.40, 46.25, 46.80]</span>
</span></span><span class=line><span class=cl><span class=n>first_week</span> <span class=o>=</span> <span class=n>ping_an_prices</span><span class=p>[:</span><span class=mi>5</span><span class=p>]</span>      <span class=c1># 第1周价格：[45.20, 45.50, 45.80, 46.10, 46.40]</span>
</span></span></code></pre></td></tr></table></div></div></div></div><p><strong>修改列表：</strong></p><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 修改价格数据</span>
</span></span><span class=line><span class=cl><span class=n>ping_an_prices</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mf>45.25</span>  <span class=c1># 修正第1天价格</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 添加新数据</span>
</span></span><span class=line><span class=cl><span class=n>ping_an_prices</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=mf>47.20</span><span class=p>)</span>  <span class=c1># 添加新一天的价格</span>
</span></span><span class=line><span class=cl><span class=n>volumes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=mi>210000</span><span class=p>)</span>        <span class=c1># 添加新一天的交易量</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 批量添加数据</span>
</span></span><span class=line><span class=cl><span class=n>new_prices</span> <span class=o>=</span> <span class=p>[</span><span class=mf>47.50</span><span class=p>,</span> <span class=mf>47.80</span><span class=p>,</span> <span class=mf>47.60</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>ping_an_prices</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>new_prices</span><span class=p>)</span>  <span class=c1># 批量添加3天价格</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 插入数据到指定位置</span>
</span></span><span class=line><span class=cl><span class=n>ping_an_prices</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mf>45.15</span><span class=p>)</span>  <span class=c1># 在第1个位置插入新价格</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 删除数据</span>
</span></span><span class=line><span class=cl><span class=k>del</span> <span class=n>ping_an_prices</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>           <span class=c1># 删除第1个价格数据</span>
</span></span><span class=line><span class=cl><span class=n>removed_price</span> <span class=o>=</span> <span class=n>ping_an_prices</span><span class=o>.</span><span class=n>pop</span><span class=p>()</span>  <span class=c1># 删除并返回最后一个价格</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=列表推导式量化数据的高效处理>列表推导式：量化数据的高效处理</h3><p>列表推导式是Python的强大特性，能够以简洁的方式处理金融数据：</p><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 原始价格数据</span>
</span></span><span class=line><span class=cl><span class=n>prices</span> <span class=o>=</span> <span class=p>[</span><span class=mf>45.20</span><span class=p>,</span> <span class=mf>45.50</span><span class=p>,</span> <span class=mf>45.80</span><span class=p>,</span> <span class=mf>46.10</span><span class=p>,</span> <span class=mf>46.40</span><span class=p>,</span> <span class=mf>46.25</span><span class=p>,</span> <span class=mf>46.80</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 计算日收益率</span>
</span></span><span class=line><span class=cl><span class=n>returns</span> <span class=o>=</span> <span class=p>[(</span><span class=n>prices</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=n>prices</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span> <span class=o>/</span> <span class=n>prices</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>*</span> <span class=mi>100</span> 
</span></span><span class=line><span class=cl>           <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>prices</span><span class=p>))]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;日收益率: </span><span class=si>{</span><span class=n>returns</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 输出: [0.66, 0.66, 0.65, 0.65, -0.32, 1.19]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 筛选涨幅超过0.5%的交易日</span>
</span></span><span class=line><span class=cl><span class=n>strong_days</span> <span class=o>=</span> <span class=p>[</span><span class=n>i</span> <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>r</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>returns</span><span class=p>)</span> <span class=k>if</span> <span class=n>r</span> <span class=o>&gt;</span> <span class=mf>0.5</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;强势交易日索引: </span><span class=si>{</span><span class=n>strong_days</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 计算5日移动平均（简化版）</span>
</span></span><span class=line><span class=cl><span class=n>ma5_prices</span> <span class=o>=</span> <span class=p>[</span><span class=nb>sum</span><span class=p>(</span><span class=n>prices</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>4</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>])</span> <span class=o>/</span> <span class=mi>5</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>prices</span><span class=p>))]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;5日移动平均: </span><span class=si>{</span><span class=n>ma5_prices</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 价格标准化（转换为相对于第1天的涨跌幅）</span>
</span></span><span class=line><span class=cl><span class=n>normalized_prices</span> <span class=o>=</span> <span class=p>[(</span><span class=n>price</span> <span class=o>/</span> <span class=n>prices</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=mi>100</span> <span class=k>for</span> <span class=n>price</span> <span class=ow>in</span> <span class=n>prices</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;标准化价格: </span><span class=si>{</span><span class=n>normalized_prices</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=列表排序与量化应用>列表排序与量化应用</h3><p>排序在量化分析中非常重要，比如找出表现最好的股票、识别价格极值等：</p><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 多只股票的价格数据</span>
</span></span><span class=line><span class=cl><span class=n>stock_prices</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;000001.SZ&#34;</span><span class=p>:</span> <span class=mf>15.68</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;000002.SZ&#34;</span><span class=p>:</span> <span class=mf>23.45</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;600000.SH&#34;</span><span class=p>:</span> <span class=mf>18.92</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;600036.SH&#34;</span><span class=p>:</span> <span class=mf>42.15</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;000858.SZ&#34;</span><span class=p>:</span> <span class=mf>156.80</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 按价格排序（从高到低）</span>
</span></span><span class=line><span class=cl><span class=n>sorted_stocks</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>stock_prices</span><span class=o>.</span><span class=n>items</span><span class=p>(),</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>reverse</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;价格从高到低排序:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>code</span><span class=p>,</span> <span class=n>price</span> <span class=ow>in</span> <span class=n>sorted_stocks</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>code</span><span class=si>}</span><span class=s2>: ¥</span><span class=si>{</span><span class=n>price</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 收益率排序示例</span>
</span></span><span class=line><span class=cl><span class=n>stock_returns</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;000001.SZ&#34;</span><span class=p>:</span> <span class=mf>2.35</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;000002.SZ&#34;</span><span class=p>:</span> <span class=o>-</span><span class=mf>1.28</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;600000.SH&#34;</span><span class=p>:</span> <span class=mf>5.67</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;600036.SH&#34;</span><span class=p>:</span> <span class=o>-</span><span class=mf>0.89</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;000858.SZ&#34;</span><span class=p>:</span> <span class=mf>8.42</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 找出表现最好和最差的股票</span>
</span></span><span class=line><span class=cl><span class=n>best_performer</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>stock_returns</span><span class=o>.</span><span class=n>items</span><span class=p>(),</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>worst_performer</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>stock_returns</span><span class=o>.</span><span class=n>items</span><span class=p>(),</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;最佳表现: </span><span class=si>{</span><span class=n>best_performer</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2> (</span><span class=si>{</span><span class=n>best_performer</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;最差表现: </span><span class=si>{</span><span class=n>worst_performer</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2> (</span><span class=si>{</span><span class=n>worst_performer</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%)&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=字典dictionary键值映射的高效工具>字典（Dictionary）：键值映射的高效工具</h2><h3 id=字典基础操作>字典基础操作</h3><p>字典是量化交易中最常用的数据结构之一，特别适合存储股票代码到相关数据的映射关系。</p><p><strong>创建和访问字典：</strong></p><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 股票基本信息字典</span>
</span></span><span class=line><span class=cl><span class=n>stock_info</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;code&#34;</span><span class=p>:</span> <span class=s2>&#34;000001.SZ&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;平安银行&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;industry&#34;</span><span class=p>:</span> <span class=s2>&#34;银行&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mf>15.68</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;volume&#34;</span><span class=p>:</span> <span class=mi>125000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;market_cap&#34;</span><span class=p>:</span> <span class=mf>3000.5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;pe_ratio&#34;</span><span class=p>:</span> <span class=mf>8.5</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 访问字典数据</span>
</span></span><span class=line><span class=cl><span class=n>stock_code</span> <span class=o>=</span> <span class=n>stock_info</span><span class=p>[</span><span class=s2>&#34;code&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>stock_name</span> <span class=o>=</span> <span class=n>stock_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;name&#34;</span><span class=p>,</span> <span class=s2>&#34;未知股票&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>current_price</span> <span class=o>=</span> <span class=n>stock_info</span><span class=p>[</span><span class=s2>&#34;price&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 修改字典数据</span>
</span></span><span class=line><span class=cl><span class=n>stock_info</span><span class=p>[</span><span class=s2>&#34;price&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=mf>15.89</span>  <span class=c1># 更新价格</span>
</span></span><span class=line><span class=cl><span class=n>stock_info</span><span class=p>[</span><span class=s2>&#34;high&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=mf>16.20</span>   <span class=c1># 添加新字段</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 安全的字典访问</span>
</span></span><span class=line><span class=cl><span class=n>pb_ratio</span> <span class=o>=</span> <span class=n>stock_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;pb_ratio&#34;</span><span class=p>,</span> <span class=s2>&#34;N/A&#34;</span><span class=p>)</span>  <span class=c1># 如果不存在pb_ratio，返回&#34;N/A&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;市净率: </span><span class=si>{</span><span class=n>pb_ratio</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><p><strong>多股票数据管理：</strong></p><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 股票池字典</span>
</span></span><span class=line><span class=cl><span class=n>stock_pool</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;000001.SZ&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;平安银行&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mf>15.68</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;volume&#34;</span><span class=p>:</span> <span class=mi>125000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;industry&#34;</span><span class=p>:</span> <span class=s2>&#34;银行&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;000002.SZ&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;万科A&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mf>23.45</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;volume&#34;</span><span class=p>:</span> <span class=mi>89000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;industry&#34;</span><span class=p>:</span> <span class=s2>&#34;房地产&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;600000.SH&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;浦发银行&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mf>18.92</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;volume&#34;</span><span class=p>:</span> <span class=mi>156000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;industry&#34;</span><span class=p>:</span> <span class=s2>&#34;银行&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 访问特定股票数据</span>
</span></span><span class=line><span class=cl><span class=n>ping_an_data</span> <span class=o>=</span> <span class=n>stock_pool</span><span class=p>[</span><span class=s2>&#34;000001.SZ&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;平安银行价格: </span><span class=si>{</span><span class=n>ping_an_data</span><span class=p>[</span><span class=s1>&#39;price&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 遍历股票池</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>code</span><span class=p>,</span> <span class=n>data</span> <span class=ow>in</span> <span class=n>stock_pool</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>code</span><span class=si>}</span><span class=s2> - </span><span class=si>{</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>: ¥</span><span class=si>{</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;price&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=字典推导式高效构建映射关系>字典推导式：高效构建映射关系</h3><p>字典推导式能够快速构建股票数据映射，提高代码效率：</p><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 从价格列表构建股票代码到价格的映射</span>
</span></span><span class=line><span class=cl><span class=n>stock_codes</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;000001.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;000002.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;600000.SH&#34;</span><span class=p>,</span> <span class=s2>&#34;600036.SH&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>prices</span> <span class=o>=</span> <span class=p>[</span><span class=mf>15.68</span><span class=p>,</span> <span class=mf>23.45</span><span class=p>,</span> <span class=mf>18.92</span><span class=p>,</span> <span class=mf>42.15</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 构建价格字典</span>
</span></span><span class=line><span class=cl><span class=n>price_dict</span> <span class=o>=</span> <span class=p>{</span><span class=n>code</span><span class=p>:</span> <span class=n>price</span> <span class=k>for</span> <span class=n>code</span><span class=p>,</span> <span class=n>price</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>stock_codes</span><span class=p>,</span> <span class=n>prices</span><span class=p>)}</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;价格字典: </span><span class=si>{</span><span class=n>price_dict</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 筛选特定条件的股票</span>
</span></span><span class=line><span class=cl><span class=c1># 假设我们有收益率数据</span>
</span></span><span class=line><span class=cl><span class=n>returns</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;000001.SZ&#34;</span><span class=p>:</span> <span class=mf>2.5</span><span class=p>,</span> <span class=s2>&#34;000002.SZ&#34;</span><span class=p>:</span> <span class=o>-</span><span class=mf>1.2</span><span class=p>,</span> <span class=s2>&#34;600000.SH&#34;</span><span class=p>:</span> <span class=mf>3.8</span><span class=p>,</span> <span class=s2>&#34;600036.SH&#34;</span><span class=p>:</span> <span class=o>-</span><span class=mf>0.5</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 筛选正收益的股票</span>
</span></span><span class=line><span class=cl><span class=n>positive_returns</span> <span class=o>=</span> <span class=p>{</span><span class=n>code</span><span class=p>:</span> <span class=n>ret</span> <span class=k>for</span> <span class=n>code</span><span class=p>,</span> <span class=n>ret</span> <span class=ow>in</span> <span class=n>returns</span><span class=o>.</span><span class=n>items</span><span class=p>()</span> <span class=k>if</span> <span class=n>ret</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;正收益股票: </span><span class=si>{</span><span class=n>positive_returns</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 构建行业分类字典</span>
</span></span><span class=line><span class=cl><span class=n>industry_stocks</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;银行&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;000001.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;600000.SH&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;房地产&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;000002.SZ&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;白酒&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;000858.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;600519.SH&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 转换为股票代码到行业的映射</span>
</span></span><span class=line><span class=cl><span class=n>stock_to_industry</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>industry</span><span class=p>,</span> <span class=n>stocks</span> <span class=ow>in</span> <span class=n>industry_stocks</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>stock</span> <span class=ow>in</span> <span class=n>stocks</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>stock_to_industry</span><span class=p>[</span><span class=n>stock</span><span class=p>]</span> <span class=o>=</span> <span class=n>industry</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;股票行业映射: </span><span class=si>{</span><span class=n>stock_to_industry</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=字典的量化应用实例>字典的量化应用实例</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 技术指标字典</span>
</span></span><span class=line><span class=cl><span class=n>technical_indicators</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;MA5&#34;</span><span class=p>:</span> <span class=mf>15.68</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;MA10&#34;</span><span class=p>:</span> <span class=mf>15.45</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;MA20&#34;</span><span class=p>:</span> <span class=mf>15.32</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;RSI&#34;</span><span class=p>:</span> <span class=mf>65.4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;MACD&#34;</span><span class=p>:</span> <span class=mf>0.25</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;KDJ_K&#34;</span><span class=p>:</span> <span class=mf>78.5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;KDJ_D&#34;</span><span class=p>:</span> <span class=mf>72.3</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 交易信号字典</span>
</span></span><span class=line><span class=cl><span class=n>trading_signals</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;buy_signal&#34;</span><span class=p>:</span> <span class=n>technical_indicators</span><span class=p>[</span><span class=s2>&#34;MA5&#34;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>technical_indicators</span><span class=p>[</span><span class=s2>&#34;MA10&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;overbought&#34;</span><span class=p>:</span> <span class=n>technical_indicators</span><span class=p>[</span><span class=s2>&#34;RSI&#34;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>70</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;oversold&#34;</span><span class=p>:</span> <span class=n>technical_indicators</span><span class=p>[</span><span class=s2>&#34;RSI&#34;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mi>30</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;golden_cross&#34;</span><span class=p>:</span> <span class=n>technical_indicators</span><span class=p>[</span><span class=s2>&#34;MACD&#34;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 投资组合字典</span>
</span></span><span class=line><span class=cl><span class=n>portfolio</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;000001.SZ&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>1000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;avg_price&#34;</span><span class=p>:</span> <span class=mf>15.20</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;current_price&#34;</span><span class=p>:</span> <span class=mf>15.68</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;market_value&#34;</span><span class=p>:</span> <span class=mi>15680</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;profit&#34;</span><span class=p>:</span> <span class=mi>480</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;profit_rate&#34;</span><span class=p>:</span> <span class=mf>3.16</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;000002.SZ&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;avg_price&#34;</span><span class=p>:</span> <span class=mf>23.00</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;current_price&#34;</span><span class=p>:</span> <span class=mf>23.45</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;market_value&#34;</span><span class=p>:</span> <span class=mi>11725</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;profit&#34;</span><span class=p>:</span> <span class=mi>225</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;profit_rate&#34;</span><span class=p>:</span> <span class=mf>1.96</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 计算组合总价值</span>
</span></span><span class=line><span class=cl><span class=n>total_value</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>stock</span><span class=p>[</span><span class=s2>&#34;market_value&#34;</span><span class=p>]</span> <span class=k>for</span> <span class=n>stock</span> <span class=ow>in</span> <span class=n>portfolio</span><span class=o>.</span><span class=n>values</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>total_profit</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>stock</span><span class=p>[</span><span class=s2>&#34;profit&#34;</span><span class=p>]</span> <span class=k>for</span> <span class=n>stock</span> <span class=ow>in</span> <span class=n>portfolio</span><span class=o>.</span><span class=n>values</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;组合总价值: ¥</span><span class=si>{</span><span class=n>total_value</span><span class=si>:</span><span class=s2>,.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;总盈亏: ¥</span><span class=si>{</span><span class=n>total_profit</span><span class=si>:</span><span class=s2>,.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=集合set去重与集合运算的利器>集合（Set）：去重与集合运算的利器</h2><h3 id=集合基础操作>集合基础操作</h3><p>集合在量化交易中主要用于股票池管理、去重操作和集合运算：</p><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建股票代码集合</span>
</span></span><span class=line><span class=cl><span class=n>watch_list</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;000001.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;000002.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;600000.SH&#34;</span><span class=p>,</span> <span class=s2>&#34;600036.SH&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>portfolio</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;000001.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;000002.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;000858.SZ&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>index_components</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;000001.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;000002.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;600000.SH&#34;</span><span class=p>,</span> <span class=s2>&#34;600036.SH&#34;</span><span class=p>,</span> <span class=s2>&#34;000858.SZ&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 集合运算</span>
</span></span><span class=line><span class=cl><span class=c1># 交集：同时在关注列表和投资组合中的股票</span>
</span></span><span class=line><span class=cl><span class=n>common_stocks</span> <span class=o>=</span> <span class=n>watch_list</span> <span class=o>&amp;</span> <span class=n>portfolio</span>  <span class=c1># 或者 watch_list.intersection(portfolio)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;共同关注: </span><span class=si>{</span><span class=n>common_stocks</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 并集：所有关注的股票</span>
</span></span><span class=line><span class=cl><span class=n>all_stocks</span> <span class=o>=</span> <span class=n>watch_list</span> <span class=o>|</span> <span class=n>portfolio</span>  <span class=c1># 或者 watch_list.union(portfolio)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;所有关注: </span><span class=si>{</span><span class=n>all_stocks</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 差集：在关注列表但不在投资组合中的股票</span>
</span></span><span class=line><span class=cl><span class=n>potential_buy</span> <span class=o>=</span> <span class=n>watch_list</span> <span class=o>-</span> <span class=n>portfolio</span>  <span class=c1># 或者 watch_list.difference(portfolio)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;潜在买入: </span><span class=si>{</span><span class=n>potential_buy</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 对称差集：只在其中一个集合中的股票</span>
</span></span><span class=line><span class=cl><span class=n>either_or</span> <span class=o>=</span> <span class=n>watch_list</span> <span class=o>^</span> <span class=n>portfolio</span>  <span class=c1># 或者 watch_list.symmetric_difference(portfolio)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;非共同持有: </span><span class=si>{</span><span class=n>either_or</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=集合的量化应用>集合的量化应用</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 行业股票池</span>
</span></span><span class=line><span class=cl><span class=n>bank_stocks</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;000001.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;600000.SH&#34;</span><span class=p>,</span> <span class=s2>&#34;600036.SH&#34;</span><span class=p>,</span> <span class=s2>&#34;601318.SH&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>real_estate_stocks</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;000002.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;600048.SH&#34;</span><span class=p>,</span> <span class=s2>&#34;600383.SH&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>tech_stocks</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;000858.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;002415.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;300750.SZ&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建不同策略的股票池</span>
</span></span><span class=line><span class=cl><span class=n>value_stocks</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;000001.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;600000.SH&#34;</span><span class=p>,</span> <span class=s2>&#34;000002.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;600048.SH&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>growth_stocks</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;300750.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;002415.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;000858.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;600036.SH&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 策略组合分析</span>
</span></span><span class=line><span class=cl><span class=n>value_bank_stocks</span> <span class=o>=</span> <span class=n>value_stocks</span> <span class=o>&amp;</span> <span class=n>bank_stocks</span>  <span class=c1># 价值投资的银行股</span>
</span></span><span class=line><span class=cl><span class=n>growth_tech_stocks</span> <span class=o>=</span> <span class=n>growth_stocks</span> <span class=o>&amp;</span> <span class=n>tech_stocks</span>  <span class=c1># 成长投资的科技股</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;价值投资银行股: </span><span class=si>{</span><span class=n>value_bank_stocks</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;成长投资科技股: </span><span class=si>{</span><span class=n>growth_tech_stocks</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 动态股票池管理</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>update_watch_list</span><span class=p>(</span><span class=n>current_list</span><span class=p>,</span> <span class=n>add_stocks</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>remove_stocks</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;更新关注列表&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>updated_list</span> <span class=o>=</span> <span class=n>current_list</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>  <span class=c1># 创建副本避免修改原集合</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>add_stocks</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>updated_list</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>add_stocks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>remove_stocks</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>updated_list</span><span class=o>.</span><span class=n>difference_update</span><span class=p>(</span><span class=n>remove_stocks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>updated_list</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用示例</span>
</span></span><span class=line><span class=cl><span class=n>current_watch</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;000001.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;000002.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;600000.SH&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>new_watch</span> <span class=o>=</span> <span class=n>update_watch_list</span><span class=p>(</span><span class=n>current_watch</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                             <span class=n>add_stocks</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;600036.SH&#34;</span><span class=p>,</span> <span class=s2>&#34;000858.SZ&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>                             <span class=n>remove_stocks</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;600000.SH&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;更新后的关注列表: </span><span class=si>{</span><span class=n>new_watch</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=元组tuple不可变数据的安全容器>元组（Tuple）：不可变数据的安全容器</h2><h3 id=元组基础操作>元组基础操作</h3><p>元组在量化交易中主要用于存储不可变的数据记录，如交易记录、K线数据等：</p><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建元组</span>
</span></span><span class=line><span class=cl><span class=n>k_line_data</span> <span class=o>=</span> <span class=p>(</span><span class=s2>&#34;2025-09-01&#34;</span><span class=p>,</span> <span class=mf>15.68</span><span class=p>,</span> <span class=mf>15.89</span><span class=p>,</span> <span class=mf>15.45</span><span class=p>,</span> <span class=mf>15.78</span><span class=p>,</span> <span class=mi>125000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>trade_record</span> <span class=o>=</span> <span class=p>(</span><span class=s2>&#34;000001.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;buy&#34;</span><span class=p>,</span> <span class=mi>1000</span><span class=p>,</span> <span class=mf>15.68</span><span class=p>,</span> <span class=s2>&#34;2025-09-01 10:30:00&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 访问元组元素</span>
</span></span><span class=line><span class=cl><span class=n>date</span> <span class=o>=</span> <span class=n>k_line_data</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>open_price</span> <span class=o>=</span> <span class=n>k_line_data</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>close_price</span> <span class=o>=</span> <span class=n>k_line_data</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>volume</span> <span class=o>=</span> <span class=n>k_line_data</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 元组解包</span>
</span></span><span class=line><span class=cl><span class=n>date</span><span class=p>,</span> <span class=n>open_p</span><span class=p>,</span> <span class=n>high_p</span><span class=p>,</span> <span class=n>low_p</span><span class=p>,</span> <span class=n>close_p</span><span class=p>,</span> <span class=n>vol</span> <span class=o>=</span> <span class=n>k_line_data</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>date</span><span class=si>}</span><span class=s2>: 开盘</span><span class=si>{</span><span class=n>open_p</span><span class=si>}</span><span class=s2>, 收盘</span><span class=si>{</span><span class=n>close_p</span><span class=si>}</span><span class=s2>, 交易量</span><span class=si>{</span><span class=n>vol</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用命名元组提高可读性</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>collections</span> <span class=kn>import</span> <span class=n>namedtuple</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 定义K线数据类型</span>
</span></span><span class=line><span class=cl><span class=n>KLineData</span> <span class=o>=</span> <span class=n>namedtuple</span><span class=p>(</span><span class=s1>&#39;KLineData&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;date&#39;</span><span class=p>,</span> <span class=s1>&#39;open&#39;</span><span class=p>,</span> <span class=s1>&#39;high&#39;</span><span class=p>,</span> <span class=s1>&#39;low&#39;</span><span class=p>,</span> <span class=s1>&#39;close&#39;</span><span class=p>,</span> <span class=s1>&#39;volume&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建命名元组实例</span>
</span></span><span class=line><span class=cl><span class=n>k_line</span> <span class=o>=</span> <span class=n>KLineData</span><span class=p>(</span><span class=s2>&#34;2025-09-01&#34;</span><span class=p>,</span> <span class=mf>15.68</span><span class=p>,</span> <span class=mf>15.89</span><span class=p>,</span> <span class=mf>15.45</span><span class=p>,</span> <span class=mf>15.78</span><span class=p>,</span> <span class=mi>125000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;K线数据: </span><span class=si>{</span><span class=n>k_line</span><span class=o>.</span><span class=n>date</span><span class=si>}</span><span class=s2> 收盘</span><span class=si>{</span><span class=n>k_line</span><span class=o>.</span><span class=n>close</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=元组的量化应用>元组的量化应用</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 交易记录管理</span>
</span></span><span class=line><span class=cl><span class=n>TradeRecord</span> <span class=o>=</span> <span class=n>namedtuple</span><span class=p>(</span><span class=s1>&#39;TradeRecord&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;stock_code&#39;</span><span class=p>,</span> <span class=s1>&#39;trade_type&#39;</span><span class=p>,</span> <span class=s1>&#39;quantity&#39;</span><span class=p>,</span> <span class=s1>&#39;price&#39;</span><span class=p>,</span> <span class=s1>&#39;timestamp&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_trade_record</span><span class=p>(</span><span class=n>stock_code</span><span class=p>,</span> <span class=n>trade_type</span><span class=p>,</span> <span class=n>quantity</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;创建交易记录&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>TradeRecord</span><span class=p>(</span><span class=n>stock_code</span><span class=p>,</span> <span class=n>trade_type</span><span class=p>,</span> <span class=n>quantity</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建交易记录</span>
</span></span><span class=line><span class=cl><span class=n>trades</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=n>create_trade_record</span><span class=p>(</span><span class=s2>&#34;000001.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;buy&#34;</span><span class=p>,</span> <span class=mi>1000</span><span class=p>,</span> <span class=mf>15.68</span><span class=p>,</span> <span class=s2>&#34;2025-09-01 10:30:00&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>create_trade_record</span><span class=p>(</span><span class=s2>&#34;000001.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;sell&#34;</span><span class=p>,</span> <span class=mi>500</span><span class=p>,</span> <span class=mf>16.20</span><span class=p>,</span> <span class=s2>&#34;2025-09-01 14:15:00&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>create_trade_record</span><span class=p>(</span><span class=s2>&#34;000002.SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;buy&#34;</span><span class=p>,</span> <span class=mi>800</span><span class=p>,</span> <span class=mf>23.45</span><span class=p>,</span> <span class=s2>&#34;2025-09-02 09:45:00&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 分析交易记录</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_trades</span><span class=p>(</span><span class=n>trades</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;分析交易记录&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>total_trades</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>trades</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>buy_trades</span> <span class=o>=</span> <span class=p>[</span><span class=n>t</span> <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>trades</span> <span class=k>if</span> <span class=n>t</span><span class=o>.</span><span class=n>trade_type</span> <span class=o>==</span> <span class=s2>&#34;buy&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>sell_trades</span> <span class=o>=</span> <span class=p>[</span><span class=n>t</span> <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>trades</span> <span class=k>if</span> <span class=n>t</span><span class=o>.</span><span class=n>trade_type</span> <span class=o>==</span> <span class=s2>&#34;sell&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>total_buy_quantity</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>t</span><span class=o>.</span><span class=n>quantity</span> <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>buy_trades</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>total_sell_quantity</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>t</span><span class=o>.</span><span class=n>quantity</span> <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>sell_trades</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total_trades&#34;</span><span class=p>:</span> <span class=n>total_trades</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;buy_trades&#34;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>buy_trades</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sell_trades&#34;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>sell_trades</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total_buy_quantity&#34;</span><span class=p>:</span> <span class=n>total_buy_quantity</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total_sell_quantity&#34;</span><span class=p>:</span> <span class=n>total_sell_quantity</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>trade_analysis</span> <span class=o>=</span> <span class=n>analyze_trades</span><span class=p>(</span><span class=n>trades</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;交易分析: </span><span class=si>{</span><span class=n>trade_analysis</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=嵌套数据结构复杂数据的组织方式>嵌套数据结构：复杂数据的组织方式</h2><h3 id=嵌套列表与字典>嵌套列表与字典</h3><p>在实际量化分析中，我们经常需要处理复杂的嵌套数据结构：</p><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 多股票多天的价格数据</span>
</span></span><span class=line><span class=cl><span class=n>multi_stock_prices</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;000001.SZ&#34;</span><span class=p>:</span> <span class=p>[</span><span class=mf>45.20</span><span class=p>,</span> <span class=mf>45.50</span><span class=p>,</span> <span class=mf>45.80</span><span class=p>,</span> <span class=mf>46.10</span><span class=p>,</span> <span class=mf>46.40</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;000002.SZ&#34;</span><span class=p>:</span> <span class=p>[</span><span class=mf>23.10</span><span class=p>,</span> <span class=mf>23.45</span><span class=p>,</span> <span class=mf>23.20</span><span class=p>,</span> <span class=mf>23.80</span><span class=p>,</span> <span class=mf>24.10</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;600000.SH&#34;</span><span class=p>:</span> <span class=p>[</span><span class=mf>18.50</span><span class=p>,</span> <span class=mf>18.92</span><span class=p>,</span> <span class=mf>18.75</span><span class=p>,</span> <span class=mf>19.20</span><span class=p>,</span> <span class=mf>19.45</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 访问嵌套数据</span>
</span></span><span class=line><span class=cl><span class=n>ping_an_day3</span> <span class=o>=</span> <span class=n>multi_stock_prices</span><span class=p>[</span><span class=s2>&#34;000001.SZ&#34;</span><span class=p>][</span><span class=mi>2</span><span class=p>]</span>  <span class=c1># 平安银行第3天价格</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;平安银行第3天价格: </span><span class=si>{</span><span class=n>ping_an_day3</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 复杂的股票信息结构</span>
</span></span><span class=line><span class=cl><span class=n>complex_stock_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;000001.SZ&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;basic_info&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;平安银行&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;industry&#34;</span><span class=p>:</span> <span class=s2>&#34;银行&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;market&#34;</span><span class=p>:</span> <span class=s2>&#34;深交所&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;price_data&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;daily_prices&#34;</span><span class=p>:</span> <span class=p>[</span><span class=mf>45.20</span><span class=p>,</span> <span class=mf>45.50</span><span class=p>,</span> <span class=mf>45.80</span><span class=p>,</span> <span class=mf>46.10</span><span class=p>,</span> <span class=mf>46.40</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;volumes&#34;</span><span class=p>:</span> <span class=p>[</span><span class=mi>125000</span><span class=p>,</span> <span class=mi>156000</span><span class=p>,</span> <span class=mi>189000</span><span class=p>,</span> <span class=mi>201000</span><span class=p>,</span> <span class=mi>178000</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;dates&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;2025-09-01&#34;</span><span class=p>,</span> <span class=s2>&#34;2025-09-02&#34;</span><span class=p>,</span> <span class=s2>&#34;2025-09-03&#34;</span><span class=p>,</span> <span class=s2>&#34;2025-09-04&#34;</span><span class=p>,</span> <span class=s2>&#34;2025-09-05&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;technical_indicators&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;MA5&#34;</span><span class=p>:</span> <span class=mf>45.80</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;MA10&#34;</span><span class=p>:</span> <span class=mf>45.45</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;RSI&#34;</span><span class=p>:</span> <span class=mf>65.2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;MACD&#34;</span><span class=p>:</span> <span class=mf>0.35</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 访问复杂嵌套数据</span>
</span></span><span class=line><span class=cl><span class=n>current_rsi</span> <span class=o>=</span> <span class=n>complex_stock_data</span><span class=p>[</span><span class=s2>&#34;000001.SZ&#34;</span><span class=p>][</span><span class=s2>&#34;technical_indicators&#34;</span><span class=p>][</span><span class=s2>&#34;RSI&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;平安银行RSI指标: </span><span class=si>{</span><span class=n>current_rsi</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=时间序列数据结构>时间序列数据结构</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 时间序列数据组织</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span><span class=p>,</span> <span class=n>timedelta</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_time_series_data</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;创建时间序列数据&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>base_date</span> <span class=o>=</span> <span class=n>datetime</span><span class=p>(</span><span class=mi>2025</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 生成5天的日期</span>
</span></span><span class=line><span class=cl>    <span class=n>dates</span> <span class=o>=</span> <span class=p>[</span><span class=n>base_date</span> <span class=o>+</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>date_strings</span> <span class=o>=</span> <span class=p>[</span><span class=n>d</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&#34;%Y-%m-</span><span class=si>%d</span><span class=s2>&#34;</span><span class=p>)</span> <span class=k>for</span> <span class=n>d</span> <span class=ow>in</span> <span class=n>dates</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 时间序列数据</span>
</span></span><span class=line><span class=cl>    <span class=n>time_series_data</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>date</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>date_strings</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>daily_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;date&#34;</span><span class=p>:</span> <span class=n>date</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;open&#34;</span><span class=p>:</span> <span class=mf>45.20</span> <span class=o>+</span> <span class=n>i</span> <span class=o>*</span> <span class=mf>0.3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;high&#34;</span><span class=p>:</span> <span class=mf>45.50</span> <span class=o>+</span> <span class=n>i</span> <span class=o>*</span> <span class=mf>0.3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;low&#34;</span><span class=p>:</span> <span class=mf>45.00</span> <span class=o>+</span> <span class=n>i</span> <span class=o>*</span> <span class=mf>0.3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;close&#34;</span><span class=p>:</span> <span class=mf>45.30</span> <span class=o>+</span> <span class=n>i</span> <span class=o>*</span> <span class=mf>0.3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;volume&#34;</span><span class=p>:</span> <span class=mi>125000</span> <span class=o>+</span> <span class=n>i</span> <span class=o>*</span> <span class=mi>10000</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>time_series_data</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>daily_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>time_series_data</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建时间序列数据</span>
</span></span><span class=line><span class=cl><span class=n>ts_data</span> <span class=o>=</span> <span class=n>create_time_series_data</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 访问时间序列数据</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>day_data</span> <span class=ow>in</span> <span class=n>ts_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>day_data</span><span class=p>[</span><span class=s1>&#39;date&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>: 收盘</span><span class=si>{</span><span class=n>day_data</span><span class=p>[</span><span class=s1>&#39;close&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>, 交易量</span><span class=si>{</span><span class=n>day_data</span><span class=p>[</span><span class=s1>&#39;volume&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 计算时间序列统计量</span>
</span></span><span class=line><span class=cl><span class=n>closes</span> <span class=o>=</span> <span class=p>[</span><span class=n>day</span><span class=p>[</span><span class=s2>&#34;close&#34;</span><span class=p>]</span> <span class=k>for</span> <span class=n>day</span> <span class=ow>in</span> <span class=n>ts_data</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>volumes</span> <span class=o>=</span> <span class=p>[</span><span class=n>day</span><span class=p>[</span><span class=s2>&#34;volume&#34;</span><span class=p>]</span> <span class=k>for</span> <span class=n>day</span> <span class=ow>in</span> <span class=n>ts_data</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>avg_close</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>closes</span><span class=p>)</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>closes</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>avg_volume</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>volumes</span><span class=p>)</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>volumes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;平均收盘价: </span><span class=si>{</span><span class=n>avg_close</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;平均交易量: </span><span class=si>{</span><span class=n>avg_volume</span><span class=si>:</span><span class=s2>,.0f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=实践练习综合数据结构应用>实践练习：综合数据结构应用</h2><h3 id=练习1股票筛选器>练习1：股票筛选器</h3><p>创建一个综合的股票筛选器，使用多种数据结构：</p><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># stock_screener.py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>StockScreener</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;股票筛选器&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>stock_data</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># 主股票数据字典</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>watch_lists</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># 关注列表字典</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>add_stock</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stock_code</span><span class=p>,</span> <span class=n>stock_info</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;添加股票数据&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>stock_data</span><span class=p>[</span><span class=n>stock_code</span><span class=p>]</span> <span class=o>=</span> <span class=n>stock_info</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_watch_list</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>criteria</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;创建关注列表&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>criteria</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>watch_lists</span><span class=p>[</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>filtered_stocks</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>apply_criteria</span><span class=p>(</span><span class=n>criteria</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>watch_lists</span><span class=p>[</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=n>filtered_stocks</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>apply_criteria</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>criteria</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;应用筛选条件&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>filtered_stocks</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>stock_code</span><span class=p>,</span> <span class=n>data</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>stock_data</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=n>meets_criteria</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>condition</span> <span class=ow>in</span> <span class=n>criteria</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=ow>not</span> <span class=n>condition</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=n>key</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>                        <span class=n>meets_criteria</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>meets_criteria</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>filtered_stocks</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>stock_code</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>filtered_stocks</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_stock_by_industry</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>industry</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;按行业获取股票&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=n>code</span><span class=p>:</span> <span class=n>data</span> <span class=k>for</span> <span class=n>code</span><span class=p>,</span> <span class=n>data</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>stock_data</span><span class=o>.</span><span class=n>items</span><span class=p>()</span> 
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;industry&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=n>industry</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_top_performers</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>n</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>sort_by</span><span class=o>=</span><span class=s2>&#34;return_rate&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;获取表现最佳的股票&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>sorted_stocks</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>stock_data</span><span class=o>.</span><span class=n>items</span><span class=p>(),</span> 
</span></span><span class=line><span class=cl>                              <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>sort_by</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span> 
</span></span><span class=line><span class=cl>                              <span class=n>reverse</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>sorted_stocks</span><span class=p>[:</span><span class=n>n</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用示例</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;主函数演示&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>screener</span> <span class=o>=</span> <span class=n>StockScreener</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 添加股票数据</span>
</span></span><span class=line><span class=cl>    <span class=n>stocks_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;000001.SZ&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;平安银行&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;industry&#34;</span><span class=p>:</span> <span class=s2>&#34;银行&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mf>15.68</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;volume&#34;</span><span class=p>:</span> <span class=mi>125000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;return_rate&#34;</span><span class=p>:</span> <span class=mf>2.5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;pe_ratio&#34;</span><span class=p>:</span> <span class=mf>8.5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;market_cap&#34;</span><span class=p>:</span> <span class=mi>3000</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;000002.SZ&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;万科A&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;industry&#34;</span><span class=p>:</span> <span class=s2>&#34;房地产&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mf>23.45</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;volume&#34;</span><span class=p>:</span> <span class=mi>89000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;return_rate&#34;</span><span class=p>:</span> <span class=o>-</span><span class=mf>1.2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;pe_ratio&#34;</span><span class=p>:</span> <span class=mf>12.3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;market_cap&#34;</span><span class=p>:</span> <span class=mi>2800</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;600000.SH&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;浦发银行&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;industry&#34;</span><span class=p>:</span> <span class=s2>&#34;银行&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mf>18.92</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;volume&#34;</span><span class=p>:</span> <span class=mi>156000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;return_rate&#34;</span><span class=p>:</span> <span class=mf>3.8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;pe_ratio&#34;</span><span class=p>:</span> <span class=mf>7.8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;market_cap&#34;</span><span class=p>:</span> <span class=mi>3500</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>code</span><span class=p>,</span> <span class=n>data</span> <span class=ow>in</span> <span class=n>stocks_data</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>screener</span><span class=o>.</span><span class=n>add_stock</span><span class=p>(</span><span class=n>code</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 创建筛选条件</span>
</span></span><span class=line><span class=cl>    <span class=n>value_criteria</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;pe_ratio&#34;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;return_rate&#34;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span> <span class=o>&gt;</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 应用筛选</span>
</span></span><span class=line><span class=cl>    <span class=n>screener</span><span class=o>.</span><span class=n>create_watch_list</span><span class=p>(</span><span class=s2>&#34;价值投资&#34;</span><span class=p>,</span> <span class=n>value_criteria</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 获取结果</span>
</span></span><span class=line><span class=cl>    <span class=n>value_stocks</span> <span class=o>=</span> <span class=n>screener</span><span class=o>.</span><span class=n>watch_lists</span><span class=p>[</span><span class=s2>&#34;价值投资&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;价值投资股票池: </span><span class=si>{</span><span class=n>value_stocks</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 获取表现最佳股票</span>
</span></span><span class=line><span class=cl>    <span class=n>top_performers</span> <span class=o>=</span> <span class=n>screener</span><span class=o>.</span><span class=n>get_top_performers</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;表现最佳股票:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>code</span><span class=p>,</span> <span class=n>data</span> <span class=ow>in</span> <span class=n>top_performers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>code</span><span class=si>}</span><span class=s2> - </span><span class=si>{</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;return_rate&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=练习2投资组合管理器>练习2：投资组合管理器</h3><p>创建一个完整的投资组合管理器：</p><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># portfolio_manager.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>collections</span> <span class=kn>import</span> <span class=n>defaultdict</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PortfolioManager</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;投资组合管理器&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>initial_capital</span><span class=o>=</span><span class=mf>100000.0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>initial_capital</span> <span class=o>=</span> <span class=n>initial_capital</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>cash</span> <span class=o>=</span> <span class=n>initial_capital</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>positions</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># {stock_code: {quantity, avg_price}}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>transactions</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># 交易记录列表</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>performance_history</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># 绩效历史</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>buy_stock</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stock_code</span><span class=p>,</span> <span class=n>quantity</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>timestamp</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;买入股票&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>timestamp</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>timestamp</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&#34;%Y-%m-</span><span class=si>%d</span><span class=s2> %H:%M:%S&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>total_cost</span> <span class=o>=</span> <span class=n>quantity</span> <span class=o>*</span> <span class=n>price</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>total_cost</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>cash</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;资金不足: 需要</span><span class=si>{</span><span class=n>total_cost</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>，可用</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>cash</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 更新现金</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>cash</span> <span class=o>-=</span> <span class=n>total_cost</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 更新持仓</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>stock_code</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>positions</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>current_qty</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>positions</span><span class=p>[</span><span class=n>stock_code</span><span class=p>][</span><span class=s2>&#34;quantity&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>current_avg</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>positions</span><span class=p>[</span><span class=n>stock_code</span><span class=p>][</span><span class=s2>&#34;avg_price&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>new_qty</span> <span class=o>=</span> <span class=n>current_qty</span> <span class=o>+</span> <span class=n>quantity</span>
</span></span><span class=line><span class=cl>            <span class=n>new_avg</span> <span class=o>=</span> <span class=p>(</span><span class=n>current_qty</span> <span class=o>*</span> <span class=n>current_avg</span> <span class=o>+</span> <span class=n>quantity</span> <span class=o>*</span> <span class=n>price</span><span class=p>)</span> <span class=o>/</span> <span class=n>new_qty</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>positions</span><span class=p>[</span><span class=n>stock_code</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=n>new_qty</span><span class=p>,</span> <span class=s2>&#34;avg_price&#34;</span><span class=p>:</span> <span class=n>new_avg</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>positions</span><span class=p>[</span><span class=n>stock_code</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=n>quantity</span><span class=p>,</span> <span class=s2>&#34;avg_price&#34;</span><span class=p>:</span> <span class=n>price</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 记录交易</span>
</span></span><span class=line><span class=cl>        <span class=n>transaction</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>timestamp</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;stock_code&#34;</span><span class=p>:</span> <span class=n>stock_code</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;buy&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=n>quantity</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=n>price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;amount&#34;</span><span class=p>:</span> <span class=n>total_cost</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>transactions</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>transaction</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;买入成功: </span><span class=si>{</span><span class=n>stock_code</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>quantity</span><span class=si>}</span><span class=s2>股 @ </span><span class=si>{</span><span class=n>price</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>元&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>sell_stock</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stock_code</span><span class=p>,</span> <span class=n>quantity</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>timestamp</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;卖出股票&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>timestamp</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>timestamp</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&#34;%Y-%m-</span><span class=si>%d</span><span class=s2> %H:%M:%S&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>stock_code</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>positions</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;未持有</span><span class=si>{</span><span class=n>stock_code</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>current_qty</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>positions</span><span class=p>[</span><span class=n>stock_code</span><span class=p>][</span><span class=s2>&#34;quantity&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>quantity</span> <span class=o>&gt;</span> <span class=n>current_qty</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;持仓不足: 持有</span><span class=si>{</span><span class=n>current_qty</span><span class=si>}</span><span class=s2>股，尝试卖出</span><span class=si>{</span><span class=n>quantity</span><span class=si>}</span><span class=s2>股&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 计算收入</span>
</span></span><span class=line><span class=cl>        <span class=n>total_revenue</span> <span class=o>=</span> <span class=n>quantity</span> <span class=o>*</span> <span class=n>price</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 更新现金</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>cash</span> <span class=o>+=</span> <span class=n>total_revenue</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 更新持仓</span>
</span></span><span class=line><span class=cl>        <span class=n>new_qty</span> <span class=o>=</span> <span class=n>current_qty</span> <span class=o>-</span> <span class=n>quantity</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>new_qty</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>del</span> <span class=bp>self</span><span class=o>.</span><span class=n>positions</span><span class=p>[</span><span class=n>stock_code</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>positions</span><span class=p>[</span><span class=n>stock_code</span><span class=p>][</span><span class=s2>&#34;quantity&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>new_qty</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 记录交易</span>
</span></span><span class=line><span class=cl>        <span class=n>transaction</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>timestamp</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;stock_code&#34;</span><span class=p>:</span> <span class=n>stock_code</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;sell&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=n>quantity</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=n>price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;amount&#34;</span><span class=p>:</span> <span class=n>total_revenue</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>transactions</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>transaction</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;卖出成功: </span><span class=si>{</span><span class=n>stock_code</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>quantity</span><span class=si>}</span><span class=s2>股 @ </span><span class=si>{</span><span class=n>price</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>元&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_portfolio_value</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>current_prices</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;计算组合市值&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>stock_value</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>stock_code</span><span class=p>,</span> <span class=n>position</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>positions</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>stock_code</span> <span class=ow>in</span> <span class=n>current_prices</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>stock_value</span> <span class=o>+=</span> <span class=n>position</span><span class=p>[</span><span class=s2>&#34;quantity&#34;</span><span class=p>]</span> <span class=o>*</span> <span class=n>current_prices</span><span class=p>[</span><span class=n>stock_code</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>total_value</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>cash</span> <span class=o>+</span> <span class=n>stock_value</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;total_value&#34;</span><span class=p>:</span> <span class=n>total_value</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;cash&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>cash</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;stock_value&#34;</span><span class=p>:</span> <span class=n>stock_value</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;total_profit&#34;</span><span class=p>:</span> <span class=n>total_value</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>initial_capital</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;profit_rate&#34;</span><span class=p>:</span> <span class=p>(</span><span class=n>total_value</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>initial_capital</span><span class=p>)</span> <span class=o>/</span> <span class=bp>self</span><span class=o>.</span><span class=n>initial_capital</span> <span class=o>*</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_portfolio_summary</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>current_prices</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;获取组合摘要&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>portfolio_value</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_portfolio_value</span><span class=p>(</span><span class=n>current_prices</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>summary</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;portfolio_value&#34;</span><span class=p>:</span> <span class=n>portfolio_value</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;positions&#34;</span><span class=p>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;recent_transactions&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>transactions</span><span class=p>[</span><span class=o>-</span><span class=mi>5</span><span class=p>:]</span>  <span class=c1># 最近5笔交易</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 计算每个持仓的盈亏</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>stock_code</span><span class=p>,</span> <span class=n>position</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>positions</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>stock_code</span> <span class=ow>in</span> <span class=n>current_prices</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>current_price</span> <span class=o>=</span> <span class=n>current_prices</span><span class=p>[</span><span class=n>stock_code</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>quantity</span> <span class=o>=</span> <span class=n>position</span><span class=p>[</span><span class=s2>&#34;quantity&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>avg_price</span> <span class=o>=</span> <span class=n>position</span><span class=p>[</span><span class=s2>&#34;avg_price&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>market_value</span> <span class=o>=</span> <span class=n>quantity</span> <span class=o>*</span> <span class=n>current_price</span>
</span></span><span class=line><span class=cl>                <span class=n>profit</span> <span class=o>=</span> <span class=p>(</span><span class=n>current_price</span> <span class=o>-</span> <span class=n>avg_price</span><span class=p>)</span> <span class=o>*</span> <span class=n>quantity</span>
</span></span><span class=line><span class=cl>                <span class=n>profit_rate</span> <span class=o>=</span> <span class=p>(</span><span class=n>current_price</span> <span class=o>-</span> <span class=n>avg_price</span><span class=p>)</span> <span class=o>/</span> <span class=n>avg_price</span> <span class=o>*</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>summary</span><span class=p>[</span><span class=s2>&#34;positions&#34;</span><span class=p>][</span><span class=n>stock_code</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=n>quantity</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;avg_price&#34;</span><span class=p>:</span> <span class=n>avg_price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;current_price&#34;</span><span class=p>:</span> <span class=n>current_price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;market_value&#34;</span><span class=p>:</span> <span class=n>market_value</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;profit&#34;</span><span class=p>:</span> <span class=n>profit</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;profit_rate&#34;</span><span class=p>:</span> <span class=n>profit_rate</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;weight&#34;</span><span class=p>:</span> <span class=n>market_value</span> <span class=o>/</span> <span class=n>portfolio_value</span><span class=p>[</span><span class=s2>&#34;stock_value&#34;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>100</span> <span class=k>if</span> <span class=n>portfolio_value</span><span class=p>[</span><span class=s2>&#34;stock_value&#34;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>summary</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_transaction_history</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stock_code</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>trade_type</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;获取交易历史&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>filtered_transactions</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>transactions</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>stock_code</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>filtered_transactions</span> <span class=o>=</span> <span class=p>[</span><span class=n>t</span> <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>filtered_transactions</span> <span class=k>if</span> <span class=n>t</span><span class=p>[</span><span class=s2>&#34;stock_code&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=n>stock_code</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>trade_type</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>filtered_transactions</span> <span class=o>=</span> <span class=p>[</span><span class=n>t</span> <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>filtered_transactions</span> <span class=k>if</span> <span class=n>t</span><span class=p>[</span><span class=s2>&#34;type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=n>trade_type</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>filtered_transactions</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用示例</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;投资组合管理器演示&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 创建投资组合</span>
</span></span><span class=line><span class=cl>    <span class=n>portfolio</span> <span class=o>=</span> <span class=n>PortfolioManager</span><span class=p>(</span><span class=n>initial_capital</span><span class=o>=</span><span class=mf>100000.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 模拟交易</span>
</span></span><span class=line><span class=cl>    <span class=n>portfolio</span><span class=o>.</span><span class=n>buy_stock</span><span class=p>(</span><span class=s2>&#34;000001.SZ&#34;</span><span class=p>,</span> <span class=mi>1000</span><span class=p>,</span> <span class=mf>15.68</span><span class=p>,</span> <span class=s2>&#34;2025-09-01 10:30:00&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>portfolio</span><span class=o>.</span><span class=n>buy_stock</span><span class=p>(</span><span class=s2>&#34;000002.SZ&#34;</span><span class=p>,</span> <span class=mi>500</span><span class=p>,</span> <span class=mf>23.45</span><span class=p>,</span> <span class=s2>&#34;2025-09-01 11:15:00&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>portfolio</span><span class=o>.</span><span class=n>sell_stock</span><span class=p>(</span><span class=s2>&#34;000001.SZ&#34;</span><span class=p>,</span> <span class=mi>300</span><span class=p>,</span> <span class=mf>16.20</span><span class=p>,</span> <span class=s2>&#34;2025-09-02 14:20:00&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>portfolio</span><span class=o>.</span><span class=n>buy_stock</span><span class=p>(</span><span class=s2>&#34;600000.SH&#34;</span><span class=p>,</span> <span class=mi>800</span><span class=p>,</span> <span class=mf>18.92</span><span class=p>,</span> <span class=s2>&#34;2025-09-03 09:45:00&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 当前价格</span>
</span></span><span class=line><span class=cl>    <span class=n>current_prices</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;000001.SZ&#34;</span><span class=p>:</span> <span class=mf>16.50</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;000002.SZ&#34;</span><span class=p>:</span> <span class=mf>24.10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;600000.SH&#34;</span><span class=p>:</span> <span class=mf>19.30</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 获取组合摘要</span>
</span></span><span class=line><span class=cl>    <span class=n>summary</span> <span class=o>=</span> <span class=n>portfolio</span><span class=o>.</span><span class=n>get_portfolio_summary</span><span class=p>(</span><span class=n>current_prices</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 打印结果</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=== 投资组合摘要 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>portfolio_value</span> <span class=o>=</span> <span class=n>summary</span><span class=p>[</span><span class=s2>&#34;portfolio_value&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;总市值: ¥</span><span class=si>{</span><span class=n>portfolio_value</span><span class=p>[</span><span class=s1>&#39;total_value&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>,.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;现金: ¥</span><span class=si>{</span><span class=n>portfolio_value</span><span class=p>[</span><span class=s1>&#39;cash&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>,.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;股票市值: ¥</span><span class=si>{</span><span class=n>portfolio_value</span><span class=p>[</span><span class=s1>&#39;stock_value&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>,.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;总盈亏: ¥</span><span class=si>{</span><span class=n>portfolio_value</span><span class=p>[</span><span class=s1>&#39;total_profit&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>,.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;收益率: </span><span class=si>{</span><span class=n>portfolio_value</span><span class=p>[</span><span class=s1>&#39;profit_rate&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 持仓明细 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>stock_code</span><span class=p>,</span> <span class=n>position</span> <span class=ow>in</span> <span class=n>summary</span><span class=p>[</span><span class=s2>&#34;positions&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>stock_code</span><span class=si>}</span><span class=s2>:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  数量: </span><span class=si>{</span><span class=n>position</span><span class=p>[</span><span class=s1>&#39;quantity&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>股&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  均价: ¥</span><span class=si>{</span><span class=n>position</span><span class=p>[</span><span class=s1>&#39;avg_price&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  现价: ¥</span><span class=si>{</span><span class=n>position</span><span class=p>[</span><span class=s1>&#39;current_price&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  市值: ¥</span><span class=si>{</span><span class=n>position</span><span class=p>[</span><span class=s1>&#39;market_value&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>,.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  盈亏: ¥</span><span class=si>{</span><span class=n>position</span><span class=p>[</span><span class=s1>&#39;profit&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>,.2f</span><span class=si>}</span><span class=s2> (</span><span class=si>{</span><span class=n>position</span><span class=p>[</span><span class=s1>&#39;profit_rate&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  权重: </span><span class=si>{</span><span class=n>position</span><span class=p>[</span><span class=s1>&#39;weight&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=== 最近交易 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>transaction</span> <span class=ow>in</span> <span class=n>summary</span><span class=p>[</span><span class=s2>&#34;recent_transactions&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>transaction</span><span class=p>[</span><span class=s1>&#39;timestamp&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>transaction</span><span class=p>[</span><span class=s1>&#39;type&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>transaction</span><span class=p>[</span><span class=s1>&#39;stock_code&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> &#34;</span>
</span></span><span class=line><span class=cl>              <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>transaction</span><span class=p>[</span><span class=s1>&#39;quantity&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>股 @ ¥</span><span class=si>{</span><span class=n>transaction</span><span class=p>[</span><span class=s1>&#39;price&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=性能优化与最佳实践>性能优化与最佳实践</h2><h3 id=数据结构选择指南>数据结构选择指南</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 性能对比示例</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>performance_comparison</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;性能对比测试&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 测试数据</span>
</span></span><span class=line><span class=cl>    <span class=n>data_size</span> <span class=o>=</span> <span class=mi>10000</span>
</span></span><span class=line><span class=cl>    <span class=n>stock_list</span> <span class=o>=</span> <span class=p>[</span><span class=sa>f</span><span class=s2>&#34;stock_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>data_size</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 列表查找性能测试</span>
</span></span><span class=line><span class=cl>    <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>found</span> <span class=o>=</span> <span class=s2>&#34;stock_5000&#34;</span> <span class=ow>in</span> <span class=n>stock_list</span>
</span></span><span class=line><span class=cl>    <span class=n>list_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 集合查找性能测试</span>
</span></span><span class=line><span class=cl>    <span class=n>stock_set</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span><span class=n>stock_list</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>found</span> <span class=o>=</span> <span class=s2>&#34;stock_5000&#34;</span> <span class=ow>in</span> <span class=n>stock_set</span>
</span></span><span class=line><span class=cl>    <span class=n>set_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;列表查找时间: </span><span class=si>{</span><span class=n>list_time</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2>秒&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;集合查找时间: </span><span class=si>{</span><span class=n>set_time</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2>秒&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;集合性能提升: </span><span class=si>{</span><span class=n>list_time</span><span class=o>/</span><span class=n>set_time</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>倍&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 数据结构选择建议</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>data_structure_guide</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;数据结构选择指南&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>guide</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;列表 (List)&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;适用场景&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;有序数据序列&#34;</span><span class=p>,</span> <span class=s2>&#34;需要索引访问&#34;</span><span class=p>,</span> <span class=s2>&#34;数据量较小&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;量化应用&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;价格序列&#34;</span><span class=p>,</span> <span class=s2>&#34;交易量序列&#34;</span><span class=p>,</span> <span class=s2>&#34;时间序列&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;时间复杂度&#34;</span><span class=p>:</span> <span class=s2>&#34;O(1)访问, O(n)查找&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;字典 (Dict)&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;适用场景&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;键值映射&#34;</span><span class=p>,</span> <span class=s2>&#34;快速查找&#34;</span><span class=p>,</span> <span class=s2>&#34;数据关联&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;量化应用&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;股票信息&#34;</span><span class=p>,</span> <span class=s2>&#34;技术指标&#34;</span><span class=p>,</span> <span class=s2>&#34;配置参数&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;时间复杂度&#34;</span><span class=p>:</span> <span class=s2>&#34;O(1)访问和查找&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;集合 (Set)&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;适用场景&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;去重操作&#34;</span><span class=p>,</span> <span class=s2>&#34;集合运算&#34;</span><span class=p>,</span> <span class=s2>&#34;成员测试&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;量化应用&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;股票池管理&#34;</span><span class=p>,</span> <span class=s2>&#34;交集并集&#34;</span><span class=p>,</span> <span class=s2>&#34;快速存在性检查&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;时间复杂度&#34;</span><span class=p>:</span> <span class=s2>&#34;O(1)成员测试&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;元组 (Tuple)&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;适用场景&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;不可变数据&#34;</span><span class=p>,</span> <span class=s2>&#34;函数返回值&#34;</span><span class=p>,</span> <span class=s2>&#34;字典键&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;量化应用&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;交易记录&#34;</span><span class=p>,</span> <span class=s2>&#34;K线数据&#34;</span><span class=p>,</span> <span class=s2>&#34;配置项&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;时间复杂度&#34;</span><span class=p>:</span> <span class=s2>&#34;O(1)访问&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>guide</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=内存优化技巧>内存优化技巧</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 内存优化示例</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>memory_optimization</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;内存优化技巧&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 使用生成器表达式代替列表推导式</span>
</span></span><span class=line><span class=cl>    <span class=n>large_data</span> <span class=o>=</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1000000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 列表推导式（占用内存）</span>
</span></span><span class=line><span class=cl>    <span class=n>list_result</span> <span class=o>=</span> <span class=p>[</span><span class=n>x</span> <span class=o>*</span> <span class=mi>2</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>large_data</span> <span class=k>if</span> <span class=n>x</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>==</span> <span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>list_size</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>getsizeof</span><span class=p>(</span><span class=n>list_result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 生成器表达式（节省内存）</span>
</span></span><span class=line><span class=cl>    <span class=n>gen_result</span> <span class=o>=</span> <span class=p>(</span><span class=n>x</span> <span class=o>*</span> <span class=mi>2</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>large_data</span> <span class=k>if</span> <span class=n>x</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>gen_size</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>getsizeof</span><span class=p>(</span><span class=n>gen_result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;列表结果内存: </span><span class=si>{</span><span class=n>list_size</span><span class=si>}</span><span class=s2>字节&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;生成器结果内存: </span><span class=si>{</span><span class=n>gen_size</span><span class=si>}</span><span class=s2>字节&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;内存节省: </span><span class=si>{</span><span class=n>list_size</span><span class=o>/</span><span class=n>gen_size</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>倍&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 使用__slots__优化类内存</span>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>StockData</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=vm>__slots__</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;code&#39;</span><span class=p>,</span> <span class=s1>&#39;price&#39;</span><span class=p>,</span> <span class=s1>&#39;volume&#39;</span><span class=p>]</span>  <span class=c1># 限制属性，节省内存</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>code</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>volume</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>code</span> <span class=o>=</span> <span class=n>code</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>price</span> <span class=o>=</span> <span class=n>price</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>volume</span> <span class=o>=</span> <span class=n>volume</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 对比普通类</span>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>StockDataNormal</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>code</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>volume</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>code</span> <span class=o>=</span> <span class=n>code</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>price</span> <span class=o>=</span> <span class=n>price</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>volume</span> <span class=o>=</span> <span class=n>volume</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 创建大量实例对比内存</span>
</span></span><span class=line><span class=cl>    <span class=n>stocks_optimized</span> <span class=o>=</span> <span class=p>[</span><span class=n>StockData</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;stock_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>i</span><span class=o>*</span><span class=mi>10</span><span class=p>,</span> <span class=n>i</span><span class=o>*</span><span class=mi>100</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1000</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>stocks_normal</span> <span class=o>=</span> <span class=p>[</span><span class=n>StockDataNormal</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;stock_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>i</span><span class=o>*</span><span class=mi>10</span><span class=p>,</span> <span class=n>i</span><span class=o>*</span><span class=mi>100</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1000</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>optimized_size</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>getsizeof</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=k>for</span> <span class=n>s</span> <span class=ow>in</span> <span class=n>stocks_optimized</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>normal_size</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>getsizeof</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=k>for</span> <span class=n>s</span> <span class=ow>in</span> <span class=n>stocks_normal</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;优化类总内存: </span><span class=si>{</span><span class=n>optimized_size</span><span class=si>}</span><span class=s2>字节&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;普通类总内存: </span><span class=si>{</span><span class=n>normal_size</span><span class=si>}</span><span class=s2>字节&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;内存节省: </span><span class=si>{</span><span class=n>normal_size</span><span class=o>/</span><span class=n>optimized_size</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>倍&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=本讲总结>本讲总结</h2><p>本讲我们深入学习了Python的核心数据结构，并通过丰富的量化交易实例展示了它们的实际应用：</p><ol><li><p><strong>列表（List）</strong>：掌握了有序数据的存储和操作，学会了使用列表推导式进行高效的数据处理，能够计算收益率、移动平均等量化指标。</p></li><li><p><strong>字典（Dictionary）</strong>：理解了键值映射的重要性，学会了管理多股票数据、构建技术指标字典、处理投资组合等复杂数据结构。</p></li><li><p><strong>集合（Set）</strong>：学会了使用集合进行股票池管理、去重操作和高效的集合运算，显著提升了数据处理的性能。</p></li><li><p><strong>元组（Tuple）</strong>：掌握了不可变数据的安全存储，学会了使用命名元组提高代码可读性，能够安全地处理交易记录等敏感数据。</p></li><li><p><strong>嵌套数据结构</strong>：学会了组织复杂的多维数据，能够处理时间序列数据、构建层次化的金融数据结构。</p></li><li><p><strong>性能优化</strong>：理解了不同数据结构的时间复杂度，学会了选择合适的结构来优化程序性能，掌握了内存优化的技巧。</p></li></ol><p>这些数据结构是量化交易编程的基础工具，熟练掌握它们将为你后续学习NumPy、Pandas等高级数据分析库奠定坚实基础。在实际应用中，要根据具体需求选择合适的数据结构，既要考虑代码的可读性，也要考虑执行效率。</p><h2 id=课后练习>课后练习</h2><ol><li><p><strong>数据结构转换练习</strong>：编写一个程序，能够将股票价格列表转换为字典格式，包含价格、交易量、日期等信息，并能够实现反向转换。</p></li><li><p><strong>股票筛选器扩展</strong>：扩展本讲中的股票筛选器，增加更多的筛选条件（如技术指标、财务指标），并支持多条件的组合筛选。</p></li><li><p><strong>时间序列数据处理</strong>：创建一个函数，能够处理多只股票的时间序列数据，计算各种技术指标（移动平均、波动率、相对强弱指数等）。</p></li><li><p><strong>性能优化实践</strong>：对比列表、字典、集合在不同操作（查找、插入、删除）下的性能差异，编写性能测试报告。</p></li><li><p><strong>投资组合优化器</strong>：基于本讲的投资组合管理器，增加更多的功能，如自动再平衡、风险指标计算、收益归因分析等。</p></li></ol><p>完成这些练习后，你将能够熟练运用Python的数据结构来解决复杂的量化交易问题，为学习更高级的数据分析技术做好准备。记住，数据结构的选择和优化是编写高效量化程序的关键，需要在实践中不断积累经验。</p></div></article><aside class="lg:w-80 xl:w-96"><div class=space-y-8></div></aside></div><nav class="border-t border-gray-200 mt-12 pt-8"><div class="flex justify-between items-center"><a href=/blog/%E6%8A%95%E8%B5%84%E7%90%86%E8%AE%BA/%E5%AE%8F%E8%A7%82%E5%88%86%E6%9E%90/02-%E6%94%BF%E7%AD%96%E5%AF%B9%E8%82%A1%E5%B8%82%E7%9A%84%E5%BD%B1%E5%93%8D/ class="group flex items-center"><svg class="w-5 h-5 mr-2 text-gray-600 group-hover:text-primary-600" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0 7-7m-7 7h18"/></svg><div><div class="text-sm text-gray-600">上一篇</div><div class="font-medium group-hover:text-primary-600">宏观分析第2讲：政策对股市的影响</div></div></a><a href=/blog/%E6%8A%95%E8%B5%84%E7%90%86%E8%AE%BA/%E5%AE%8F%E8%A7%82%E5%88%86%E6%9E%90/03-%E7%89%A9%E4%BB%B7%E5%AF%B9%E8%82%A1%E5%B8%82%E7%9A%84%E5%BD%B1%E5%93%8D/ class="group flex items-center text-right"><div><div class="text-sm text-gray-600">Next Post</div><div class="font-medium group-hover:text-primary-600">宏观分析第3讲：物价对股市的影响</div></div><svg class="w-5 h-5 ml-2 text-gray-600 group-hover:text-primary-600" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0-7 7m7-7H3"/></svg></a></div></nav></div></div><footer class="bg-gray-50 py-12 border-t border-gray-200"><div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl"><div class="flex flex-col md:flex-row justify-between space-y-4 md:space-y-0"><div class=flex-1><div class="flex items-center space-x-3 mb-4"><a href=https://sk-quant.github.io/ class=inline-block><img src=/images/logo.svg alt=烧烤量化 class=h-6>
</a><span class="text-xl font-bold text-gray-900">烧烤量化</span></div><div class="flex space-x-3 p-2"><a href=https://linkedin.com/in/yourusername class="text-gray-600 hover:text-gray-900" target=_blank rel="noopener noreferrer"><span class=sr-only>LinkedIn</span>
<img src=/images/social/linkedin.svg alt=LinkedIn class="h-5 w-5">
</a><a href=https://bsky.app/profile/yourblueskyhandle class="text-gray-600 hover:text-gray-900" target=_blank rel="noopener noreferrer"><span class=sr-only>Bluesky</span>
<img src=/images/social/bluesky.svg alt=Bluesky class="h-5 w-5">
</a><a href=https://twitter.com/yourusername class="text-gray-600 hover:text-gray-900" target=_blank rel="noopener noreferrer"><span class=sr-only>Twitter (X)</span>
<img src=/images/social/twitter.svg alt=Twitter class="h-5 w-5">
</a><a href=https://github.com/yourusername class="text-gray-600 hover:text-gray-900" target=_blank rel="noopener noreferrer"><span class=sr-only>GitHub</span>
<img src=/images/social/github.svg alt=GitHub class="h-5 w-5"></a></div></div><div class=flex-1><h3 class="text-sm font-semibold uppercase tracking-wider text-gray-900 mb-4"></h3><ul class=space-y-2></ul></div><div class=flex-1><h3 class="text-sm font-semibold uppercase tracking-wider text-gray-900 mb-4"></h3><ul class=space-y-2></ul></div><div class=flex-1><h3 class="text-sm font-semibold uppercase tracking-wider text-gray-900 mb-4"></h3><ul class=space-y-2></ul></div></div><div class="mt-12 pt-8 border-t border-gray-200"><div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0"><p class="text-gray-600 text-sm">© 2025 烧烤量化. All rights reserved.</p><a href=https://chaoming.li class="text-sm text-gray-600 hover:text-primary-600" target=_blank rel="noopener noreferrer">Powered by sk-quant</a></div></div></div></footer><script>const mobileMenuButton=document.getElementById("mobile-menu-button");mobileMenuButton&&mobileMenuButton.addEventListener("click",function(){const e=document.getElementById("mobile-menu");e&&e.classList.toggle("hidden")})</script></body></html>