<!doctype html><html lang=zh-cn class=h-full><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-XXXXXXX")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XXXXXXXXXX")</script><title>代码基础第6讲：Pandas数据分析 | 烧烤量化</title>
<meta name=description content="深入学习Pandas在量化交易中的应用，包含DataFrame操作、时间序列处理、数据清洗、分组分析等核心功能，为高效的数据分析奠定基础"><meta name=author content="Ryan"><meta name=robots content="index, follow"><meta property="og:title" content="代码基础第6讲：Pandas数据分析 | 烧烤量化"><meta property="og:description" content="深入学习Pandas在量化交易中的应用，包含DataFrame操作、时间序列处理、数据清洗、分组分析等核心功能，为高效的数据分析奠定基础"><meta property="og:type" content="article"><meta property="og:url" content="https://sk-quant.github.io/blog/%E4%BB%A3%E7%A0%81%E5%9F%BA%E7%A1%80/06-pandas%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/"><meta property="og:site_name" content="烧烤量化"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="代码基础第6讲：Pandas数据分析 | 烧烤量化"><meta name=twitter:description content="深入学习Pandas在量化交易中的应用，包含DataFrame操作、时间序列处理、数据清洗、分组分析等核心功能，为高效的数据分析奠定基础"><link rel=icon type=image/x-icon href=/images/favicon.ico><link rel=canonical href=https://sk-quant.github.io/blog/%E4%BB%A3%E7%A0%81%E5%9F%BA%E7%A1%80/06-pandas%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@600;700;800&display=swap" rel=stylesheet><link rel=stylesheet href="/css/main.min.1255c60f0805e580d846a005c9da456febfe5426dbcd39f66ba0ae2958126a2d.css"></head><body class="min-h-screen flex flex-col"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-XXXXXXX" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><div class="fixed top-0 left-0 right-0 z-50"><div class=mobile-menu-wrapper><input type=checkbox id=nav-toggle class=nav-toggle><header class="fixed w-full top-0 z-50 bg-white/80 backdrop-blur-sm border-b border-gray-100"><div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl"><nav class="flex items-center justify-between h-20"><a href=https://sk-quant.github.io/ class="flex items-center space-x-4"><img src=/images/logo.svg alt=烧烤量化 class=h-12>
<span class="text-3xl font-semibold text-gray-800">烧烤量化</span></a><div class="hidden md:flex items-center space-x-8"><a href=/path class="text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">学习路线</a><div class="relative group"><button class="flex items-center text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">
量化基础<svg class="ml-2 w-4 h-4" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></button><div class="absolute left-0 mt-2 w-72 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 ease-in-out"><div class="py-6 bg-white border border-gray-100 shadow-xl rounded-lg"><a href=/categories/%e6%8a%95%e8%b5%84%e7%90%86%e8%ae%ba/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">投资理论</a>
<a href=/categories/%e4%bb%a3%e7%a0%81%e5%9f%ba%e7%a1%80/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">代码基础</a>
<a href=/categories/%e6%8a%80%e6%9c%af%e6%8c%87%e6%a0%87/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">技术指标</a>
<a href=/categories/%e5%9b%9e%e6%b5%8b%e5%b9%b3%e5%8f%b0/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">回测平台</a></div></div></div><div class="relative group"><button class="flex items-center text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">
量化进阶<svg class="ml-2 w-4 h-4" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></button><div class="absolute left-0 mt-2 w-72 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 ease-in-out"><div class="py-6 bg-white border border-gray-100 shadow-xl rounded-lg"><a href=/categories/%e7%ad%96%e7%95%a5%e5%88%86%e4%ba%ab/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">策略分享</a>
<a href=/categories/%e5%ae%9e%e7%9b%98%e5%b7%a5%e5%85%b7/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">实盘工具</a>
<a href=/categories/%e7%83%ad%e7%82%b9%e9%a3%8e%e5%8f%a3/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">热点风口</a>
<a href=/categories/%e7%bb%bc%e5%90%88%e5%ae%9e%e6%88%98/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">综合实战</a></div></div></div><div class="relative group"><button class="flex items-center text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">
量化高手<svg class="ml-2 w-4 h-4" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></button><div class="absolute left-0 mt-2 w-72 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 ease-in-out"><div class="py-6 bg-white border border-gray-100 shadow-xl rounded-lg"><a href=/categories/%e5%8f%af%e8%bd%ac%e5%80%ba/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">可转债</a>
<a href=/categories/%e8%9e%8d%e8%b5%84%e8%9e%8d%e5%88%b8/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">融资融券</a>
<a href=/categories/%e8%82%a1%e7%a5%a8%e6%9c%9f%e6%9d%83/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">股票期权</a>
<a href=/categories/%e8%82%a1%e6%8c%87%e6%9c%9f%e8%b4%a7/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">股指期货</a></div></div></div><a href=/pricing class="text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">服务套餐</a></div><div class="hidden md:flex items-center space-x-4"><a href=/contact class="inline-flex items-center justify-center px-6 py-3 rounded-lg font-bold transition duration-200 ease-in-out bg-primary-600 text-white hover:bg-primary-700 hover:scale-105">现在加入</a></div><div class=md:hidden><label for=nav-toggle class="p-2 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:ring-offset-2 transition-colors cursor-pointer"><svg class="w-6 h-6" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></label></div></nav></div><div class="nav-content md:hidden w-full fixed left-0 right-0 top-20 bg-white border-t border-gray-100 shadow-lg"><div class="w-full px-6 py-4"><a href=/path class="block text-xl text-gray-900 hover:text-primary-600 font-bold transition duration-200 py-2">学习路线</a><div class=py-2><div class="text-xl text-gray-900 font-bold mb-2">量化基础</div><div class=pl-4><a href=/categories/%e6%8a%95%e8%b5%84%e7%90%86%e8%ae%ba/ class="block text-gray-700 hover:text-primary-600 py-2">投资理论</a>
<a href=/categories/%e4%bb%a3%e7%a0%81%e5%9f%ba%e7%a1%80/ class="block text-gray-700 hover:text-primary-600 py-2">代码基础</a>
<a href=/categories/%e6%8a%80%e6%9c%af%e6%8c%87%e6%a0%87/ class="block text-gray-700 hover:text-primary-600 py-2">技术指标</a>
<a href=/categories/%e5%9b%9e%e6%b5%8b%e5%b9%b3%e5%8f%b0/ class="block text-gray-700 hover:text-primary-600 py-2">回测平台</a></div></div><div class=py-2><div class="text-xl text-gray-900 font-bold mb-2">量化进阶</div><div class=pl-4><a href=/categories/%e7%ad%96%e7%95%a5%e5%88%86%e4%ba%ab/ class="block text-gray-700 hover:text-primary-600 py-2">策略分享</a>
<a href=/categories/%e5%ae%9e%e7%9b%98%e5%b7%a5%e5%85%b7/ class="block text-gray-700 hover:text-primary-600 py-2">实盘工具</a>
<a href=/categories/%e7%83%ad%e7%82%b9%e9%a3%8e%e5%8f%a3/ class="block text-gray-700 hover:text-primary-600 py-2">热点风口</a>
<a href=/categories/%e7%bb%bc%e5%90%88%e5%ae%9e%e6%88%98/ class="block text-gray-700 hover:text-primary-600 py-2">综合实战</a></div></div><div class=py-2><div class="text-xl text-gray-900 font-bold mb-2">量化高手</div><div class=pl-4><a href=/categories/%e5%8f%af%e8%bd%ac%e5%80%ba/ class="block text-gray-700 hover:text-primary-600 py-2">可转债</a>
<a href=/categories/%e8%9e%8d%e8%b5%84%e8%9e%8d%e5%88%b8/ class="block text-gray-700 hover:text-primary-600 py-2">融资融券</a>
<a href=/categories/%e8%82%a1%e7%a5%a8%e6%9c%9f%e6%9d%83/ class="block text-gray-700 hover:text-primary-600 py-2">股票期权</a>
<a href=/categories/%e8%82%a1%e6%8c%87%e6%9c%9f%e8%b4%a7/ class="block text-gray-700 hover:text-primary-600 py-2">股指期货</a></div></div><a href=/pricing class="block text-xl text-gray-900 hover:text-primary-600 font-bold transition duration-200 py-2">服务套餐</a><div class="pt-4 space-y-4"><a href=/contact class="block text-center px-6 py-3 rounded-lg font-bold transition duration-200 ease-in-out bg-primary-600 text-white hover:bg-primary-700 hover:scale-105">现在加入</a></div></div></div></header><style>.mobile-menu-wrapper{position:relative}.nav-toggle{display:none}.nav-content{display:none}.nav-toggle:checked~header .nav-content{display:block}</style></div></div><div class=pt-20><div class="container mx-auto px-4 py-12"><div class="flex flex-col lg:flex-row gap-8 mb-12"><article class=flex-1><header class=mb-8><div class=mb-4><a href=/categories/%E4%BB%A3%E7%A0%81%E5%9F%BA%E7%A1%80 class="inline-block px-3 py-1 text-sm font-medium text-primary-600 bg-primary-50 rounded-full hover:bg-primary-100 mr-2">代码基础</a></div><h1 class="text-4xl font-bold mb-4">代码基础第6讲：Pandas数据分析</h1><div class="flex flex-col space-y-4"><div class="flex items-center justify-between text-sm text-gray-500"><div class="flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7A4 4 0 118 7a4 4 0 018 0zm-4 7a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
<span>Ryan</span></div><div class="flex items-center space-x-6"><div class="flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747.0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746.0-3.332.477-4.5 1.253"/></svg>
<span>35 分钟</span></div><div class="flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5A2 2 0 003 7v12a2 2 0 002 2z"/></svg>
<time datetime=2025-09-06>September 6, 2025</time></div></div></div><div class="flex items-center flex-wrap gap-2"><a href=/tags/2025 class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 transition-colors duration-200">#2025</a></div></div></header><div class=mb-8><img src=/images/blog/%e4%bb%a3%e7%a0%81%e5%9f%ba%e7%a1%80.jpg alt=代码基础第6讲：Pandas数据分析 class="w-full h-auto rounded-lg" loading=lazy></div><div class="prose prose-lg max-w-none"><div class="bg-gray-50 p-6 rounded-lg mb-8"><h2 class="text-xl font-semibold mb-4">目录</h2><nav id=TableOfContents><ul><li><a href=#pandas在量化交易中的重要性>Pandas在量化交易中的重要性</a></li><li><a href=#pandas基础数据结构>Pandas基础数据结构</a><ul><li><a href=#series和dataframe>Series和DataFrame</a></li><li><a href=#数据类型和索引操作>数据类型和索引操作</a></li></ul></li><li><a href=#数据读取与写入>数据读取与写入</a><ul><li><a href=#读取csv文件>读取CSV文件</a></li><li><a href=#读取excel文件>读取Excel文件</a></li></ul></li><li><a href=#数据清洗与预处理>数据清洗与预处理</a><ul><li><a href=#处理缺失值>处理缺失值</a></li><li><a href=#数据类型转换和格式化>数据类型转换和格式化</a></li></ul></li><li><a href=#时间序列分析>时间序列分析</a><ul><li><a href=#日期时间处理>日期时间处理</a></li><li><a href=#移动窗口计算>移动窗口计算</a></li></ul></li><li><a href=#数据分组与聚合>数据分组与聚合</a><ul><li><a href=#groupby操作>GroupBy操作</a></li><li><a href=#数据透视表>数据透视表</a></li></ul></li><li><a href=#数据合并与连接>数据合并与连接</a><ul><li><a href=#不同类型的数据连接>不同类型的数据连接</a></li></ul></li></ul></nav></div><h2 id=pandas在量化交易中的重要性>Pandas在量化交易中的重要性</h2><p>Pandas是Python中最重要的数据分析库之一，专门为处理结构化数据和时间序列数据而设计。在A股量化交易中，Pandas扮演着核心角色，它能够高效地处理股票价格数据、财务报表、宏观经济指标等各种金融数据。</p><p>从简单的价格数据读取和清洗，到复杂的多因子模型构建和回测分析，Pandas提供了丰富的数据结构和分析工具。掌握Pandas的使用技巧，能够显著提升量化策略开发的效率和质量。</p><h2 id=pandas基础数据结构>Pandas基础数据结构</h2><h3 id=series和dataframe>Series和DataFrame</h3><p>Pandas的两个核心数据结构是Series（一维数据）和DataFrame（二维数据）：</p><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span><span class=p>,</span> <span class=n>timedelta</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建时间序列数据</span>
</span></span><span class=line><span class=cl><span class=n>start_date</span> <span class=o>=</span> <span class=n>datetime</span><span class=p>(</span><span class=mi>2025</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>dates</span> <span class=o>=</span> <span class=p>[</span><span class=n>start_date</span> <span class=o>+</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建Series（股票价格序列）</span>
</span></span><span class=line><span class=cl><span class=n>stock_prices</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mf>45.2</span><span class=p>,</span> <span class=mf>46.8</span><span class=p>,</span> <span class=mf>47.5</span><span class=p>,</span> <span class=mf>48.1</span><span class=p>,</span> <span class=mf>47.9</span><span class=p>,</span> <span class=mf>48.5</span><span class=p>,</span> <span class=mf>49.2</span><span class=p>,</span> <span class=mf>48.8</span><span class=p>,</span> <span class=mf>49.5</span><span class=p>,</span> <span class=mf>50.1</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>index</span><span class=o>=</span><span class=n>dates</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=o>=</span><span class=s1>&#39;平安银行&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;股票价格Series:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>stock_prices</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>Series类型: </span><span class=si>{</span><span class=nb>type</span><span class=p>(</span><span class=n>stock_prices</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Series形状: </span><span class=si>{</span><span class=n>stock_prices</span><span class=o>.</span><span class=n>shape</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Series索引: </span><span class=si>{</span><span class=n>stock_prices</span><span class=o>.</span><span class=n>index</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建DataFrame（多只股票数据）</span>
</span></span><span class=line><span class=cl><span class=n>stock_data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;平安银行&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>45.2</span><span class=p>,</span> <span class=mf>46.8</span><span class=p>,</span> <span class=mf>47.5</span><span class=p>,</span> <span class=mf>48.1</span><span class=p>,</span> <span class=mf>47.9</span><span class=p>,</span> <span class=mf>48.5</span><span class=p>,</span> <span class=mf>49.2</span><span class=p>,</span> <span class=mf>48.8</span><span class=p>,</span> <span class=mf>49.5</span><span class=p>,</span> <span class=mf>50.1</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;万科A&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>23.5</span><span class=p>,</span> <span class=mf>24.1</span><span class=p>,</span> <span class=mf>23.8</span><span class=p>,</span> <span class=mf>24.5</span><span class=p>,</span> <span class=mf>24.3</span><span class=p>,</span> <span class=mf>24.8</span><span class=p>,</span> <span class=mf>25.1</span><span class=p>,</span> <span class=mf>24.9</span><span class=p>,</span> <span class=mf>25.3</span><span class=p>,</span> <span class=mf>25.7</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;贵州茅台&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>156.8</span><span class=p>,</span> <span class=mf>158.2</span><span class=p>,</span> <span class=mf>157.5</span><span class=p>,</span> <span class=mf>159.1</span><span class=p>,</span> <span class=mf>160.2</span><span class=p>,</span> <span class=mf>161.5</span><span class=p>,</span> <span class=mf>162.8</span><span class=p>,</span> <span class=mf>161.9</span><span class=p>,</span> <span class=mf>163.5</span><span class=p>,</span> <span class=mf>164.2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;成交量_平安银行&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>125000</span><span class=p>,</span> <span class=mi>132000</span><span class=p>,</span> <span class=mi>118000</span><span class=p>,</span> <span class=mi>145000</span><span class=p>,</span> <span class=mi>156000</span><span class=p>,</span> <span class=mi>167000</span><span class=p>,</span> <span class=mi>142000</span><span class=p>,</span> <span class=mi>158000</span><span class=p>,</span> <span class=mi>172000</span><span class=p>,</span> <span class=mi>165000</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=n>index</span><span class=o>=</span><span class=n>dates</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n\n</span><span class=s2>股票数据DataFrame:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>stock_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>DataFrame形状: </span><span class=si>{</span><span class=n>stock_data</span><span class=o>.</span><span class=n>shape</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;DataFrame列名: </span><span class=si>{</span><span class=n>stock_data</span><span class=o>.</span><span class=n>columns</span><span class=o>.</span><span class=n>tolist</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;DataFrame索引: </span><span class=si>{</span><span class=n>stock_data</span><span class=o>.</span><span class=n>index</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># DataFrame基本信息</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>DataFrame基本信息:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>stock_data</span><span class=o>.</span><span class=n>info</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>描述性统计:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>stock_data</span><span class=o>.</span><span class=n>describe</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=数据类型和索引操作>数据类型和索引操作</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建更复杂的金融数据</span>
</span></span><span class=line><span class=cl><span class=n>market_data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;股票代码&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;000001.SZ&#39;</span><span class=p>,</span> <span class=s1>&#39;000002.SZ&#39;</span><span class=p>,</span> <span class=s1>&#39;600519.SH&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;交易日期&#39;</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>date_range</span><span class=p>(</span><span class=s1>&#39;2025-09-01&#39;</span><span class=p>,</span> <span class=n>periods</span><span class=o>=</span><span class=mi>15</span><span class=p>,</span> <span class=n>freq</span><span class=o>=</span><span class=s1>&#39;D&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;开盘价&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mi>45</span><span class=p>,</span> <span class=mi>165</span><span class=p>,</span> <span class=mi>15</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;最高价&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mi>46</span><span class=p>,</span> <span class=mi>166</span><span class=p>,</span> <span class=mi>15</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;最低价&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mi>44</span><span class=p>,</span> <span class=mi>164</span><span class=p>,</span> <span class=mi>15</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;收盘价&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mi>45</span><span class=p>,</span> <span class=mi>165</span><span class=p>,</span> <span class=mi>15</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;成交量&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>100000</span><span class=p>,</span> <span class=mi>200000</span><span class=p>,</span> <span class=mi>15</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;涨跌幅&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=o>-</span><span class=mf>0.05</span><span class=p>,</span> <span class=mf>0.05</span><span class=p>,</span> <span class=mi>15</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;市场数据前5行:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>market_data</span><span class=o>.</span><span class=n>head</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 设置多层索引</span>
</span></span><span class=line><span class=cl><span class=n>market_data</span><span class=o>.</span><span class=n>set_index</span><span class=p>([</span><span class=s1>&#39;股票代码&#39;</span><span class=p>,</span> <span class=s1>&#39;交易日期&#39;</span><span class=p>],</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>设置多层索引后的数据:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>market_data</span><span class=o>.</span><span class=n>head</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 索引操作</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>索引层级: </span><span class=si>{</span><span class=n>market_data</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>names</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;索引级别数: </span><span class=si>{</span><span class=n>market_data</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>nlevels</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 按股票代码分组查看</span>
</span></span><span class=line><span class=cl><span class=n>grouped</span> <span class=o>=</span> <span class=n>market_data</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=n>level</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>按股票分组数量: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>grouped</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 重置索引</span>
</span></span><span class=line><span class=cl><span class=n>market_data_reset</span> <span class=o>=</span> <span class=n>market_data</span><span class=o>.</span><span class=n>reset_index</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>重置索引后形状: </span><span class=si>{</span><span class=n>market_data_reset</span><span class=o>.</span><span class=n>shape</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=数据读取与写入>数据读取与写入</h2><h3 id=读取csv文件>读取CSV文件</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 模拟从CSV文件读取股票数据</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建示例CSV数据</span>
</span></span><span class=line><span class=cl><span class=n>csv_data</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;股票代码,交易日期,开盘价,最高价,最低价,收盘价,成交量,涨跌幅
</span></span></span><span class=line><span class=cl><span class=s2>000001.SZ,2025-09-01,45.2,46.1,44.8,46.8,125000,0.035
</span></span></span><span class=line><span class=cl><span class=s2>000001.SZ,2025-09-02,46.8,47.2,46.5,47.5,132000,0.015
</span></span></span><span class=line><span class=cl><span class=s2>000001.SZ,2025-09-03,47.5,48.1,47.3,48.1,118000,0.013
</span></span></span><span class=line><span class=cl><span class=s2>000002.SZ,2025-09-01,23.5,24.0,23.2,23.8,98000,0.017
</span></span></span><span class=line><span class=cl><span class=s2>000002.SZ,2025-09-02,23.8,24.2,23.6,24.1,105000,0.013
</span></span></span><span class=line><span class=cl><span class=s2>000002.SZ,2025-09-03,24.1,24.5,23.9,24.3,112000,0.008
</span></span></span><span class=line><span class=cl><span class=s2>600519.SH,2025-09-01,156.8,158.2,155.5,157.5,45000,0.004
</span></span></span><span class=line><span class=cl><span class=s2>600519.SH,2025-09-02,157.5,159.1,156.8,158.2,48000,0.004
</span></span></span><span class=line><span class=cl><span class=s2>600519.SH,2025-09-03,158.2,160.2,157.8,159.8,52000,0.010&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 将CSV数据写入文件（模拟实际场景）</span>
</span></span><span class=line><span class=cl><span class=n>csv_file</span> <span class=o>=</span> <span class=s1>&#39;/tmp/stock_data.csv&#39;</span>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>csv_file</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>csv_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 读取CSV文件</span>
</span></span><span class=line><span class=cl><span class=n>stock_data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=n>csv_file</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;从CSV文件读取的数据:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>stock_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 更专业的读取方式</span>
</span></span><span class=line><span class=cl><span class=n>stock_data_pro</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>csv_file</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>parse_dates</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;交易日期&#39;</span><span class=p>],</span>      <span class=c1># 解析日期列</span>
</span></span><span class=line><span class=cl>    <span class=n>index_col</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;股票代码&#39;</span><span class=p>,</span> <span class=s1>&#39;交易日期&#39;</span><span class=p>],</span>  <span class=c1># 设置索引</span>
</span></span><span class=line><span class=cl>    <span class=n>dtype</span><span class=o>=</span><span class=p>{</span>                      <span class=c1># 指定数据类型</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;股票代码&#39;</span><span class=p>:</span> <span class=s1>&#39;category&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;成交量&#39;</span><span class=p>:</span> <span class=s1>&#39;int64&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;涨跌幅&#39;</span><span class=p>:</span> <span class=s1>&#39;float64&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>专业方式读取的数据:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>stock_data_pro</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;数据类型:</span><span class=se>\n</span><span class=si>{</span><span class=n>stock_data_pro</span><span class=o>.</span><span class=n>dtypes</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 数据写入</span>
</span></span><span class=line><span class=cl><span class=n>cleaned_file</span> <span class=o>=</span> <span class=s1>&#39;/tmp/cleaned_stock_data.csv&#39;</span>
</span></span><span class=line><span class=cl><span class=n>stock_data_pro</span><span class=o>.</span><span class=n>to_csv</span><span class=p>(</span><span class=n>cleaned_file</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>清洗后的数据已保存到: </span><span class=si>{</span><span class=n>cleaned_file</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=读取excel文件>读取Excel文件</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建Excel文件（需要安装openpyxl库）</span>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 创建多个工作表的数据</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>pd</span><span class=o>.</span><span class=n>ExcelWriter</span><span class=p>(</span><span class=s1>&#39;/tmp/financial_data.xlsx&#39;</span><span class=p>,</span> <span class=n>engine</span><span class=o>=</span><span class=s1>&#39;openpyxl&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>writer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 股票数据工作表</span>
</span></span><span class=line><span class=cl>        <span class=n>stock_data</span><span class=o>.</span><span class=n>to_excel</span><span class=p>(</span><span class=n>writer</span><span class=p>,</span> <span class=n>sheet_name</span><span class=o>=</span><span class=s1>&#39;股票数据&#39;</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 财务指标工作表</span>
</span></span><span class=line><span class=cl>        <span class=n>financial_ratios</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;股票代码&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;000001.SZ&#39;</span><span class=p>,</span> <span class=s1>&#39;000002.SZ&#39;</span><span class=p>,</span> <span class=s1>&#39;600519.SH&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;市盈率&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>8.5</span><span class=p>,</span> <span class=mf>12.3</span><span class=p>,</span> <span class=mf>35.2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;市净率&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>1.2</span><span class=p>,</span> <span class=mf>1.8</span><span class=p>,</span> <span class=mf>8.5</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;ROE&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>0.15</span><span class=p>,</span> <span class=mf>0.12</span><span class=p>,</span> <span class=mf>0.25</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;负债率&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>0.45</span><span class=p>,</span> <span class=mf>0.62</span><span class=p>,</span> <span class=mf>0.18</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=n>financial_ratios</span><span class=o>.</span><span class=n>to_excel</span><span class=p>(</span><span class=n>writer</span><span class=p>,</span> <span class=n>sheet_name</span><span class=o>=</span><span class=s1>&#39;财务指标&#39;</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 宏观经济数据工作表</span>
</span></span><span class=line><span class=cl>        <span class=n>macro_data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;日期&#39;</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>date_range</span><span class=p>(</span><span class=s1>&#39;2025-01-01&#39;</span><span class=p>,</span> <span class=n>periods</span><span class=o>=</span><span class=mi>12</span><span class=p>,</span> <span class=n>freq</span><span class=o>=</span><span class=s1>&#39;M&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;GDP增长率&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mf>0.05</span><span class=p>,</span> <span class=mf>0.08</span><span class=p>,</span> <span class=mi>12</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;CPI&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mf>0.02</span><span class=p>,</span> <span class=mf>0.04</span><span class=p>,</span> <span class=mi>12</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;M2增速&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mf>0.08</span><span class=p>,</span> <span class=mf>0.12</span><span class=p>,</span> <span class=mi>12</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=n>macro_data</span><span class=o>.</span><span class=n>to_excel</span><span class=p>(</span><span class=n>writer</span><span class=p>,</span> <span class=n>sheet_name</span><span class=o>=</span><span class=s1>&#39;宏观经济&#39;</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Excel文件创建成功!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 读取Excel文件</span>
</span></span><span class=line><span class=cl>    <span class=c1># 读取所有工作表</span>
</span></span><span class=line><span class=cl>    <span class=n>all_sheets</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_excel</span><span class=p>(</span><span class=s1>&#39;/tmp/financial_data.xlsx&#39;</span><span class=p>,</span> <span class=n>sheet_name</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;工作表列表: </span><span class=si>{</span><span class=nb>list</span><span class=p>(</span><span class=n>all_sheets</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 读取特定工作表</span>
</span></span><span class=line><span class=cl>    <span class=n>stock_sheet</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_excel</span><span class=p>(</span><span class=s1>&#39;/tmp/financial_data.xlsx&#39;</span><span class=p>,</span> <span class=n>sheet_name</span><span class=o>=</span><span class=s1>&#39;股票数据&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>股票数据工作表:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>stock_sheet</span><span class=o>.</span><span class=n>head</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 读取财务指标工作表</span>
</span></span><span class=line><span class=cl>    <span class=n>financial_sheet</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_excel</span><span class=p>(</span><span class=s1>&#39;/tmp/financial_data.xlsx&#39;</span><span class=p>,</span> <span class=n>sheet_name</span><span class=o>=</span><span class=s1>&#39;财务指标&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>财务指标工作表:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>financial_sheet</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;需要安装openpyxl库才能处理Excel文件&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;运行: pip install openpyxl&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=数据清洗与预处理>数据清洗与预处理</h2><h3 id=处理缺失值>处理缺失值</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建包含缺失值的数据</span>
</span></span><span class=line><span class=cl><span class=n>price_data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;日期&#39;</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>date_range</span><span class=p>(</span><span class=s1>&#39;2025-09-01&#39;</span><span class=p>,</span> <span class=n>periods</span><span class=o>=</span><span class=mi>10</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;平安银行&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>45.2</span><span class=p>,</span> <span class=mf>46.8</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span> <span class=mf>48.1</span><span class=p>,</span> <span class=mf>47.9</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span> <span class=mf>49.2</span><span class=p>,</span> <span class=mf>48.8</span><span class=p>,</span> <span class=mf>49.5</span><span class=p>,</span> <span class=mf>50.1</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;万科A&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>23.5</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span> <span class=mf>23.8</span><span class=p>,</span> <span class=mf>24.5</span><span class=p>,</span> <span class=mf>24.3</span><span class=p>,</span> <span class=mf>24.8</span><span class=p>,</span> <span class=mf>25.1</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span> <span class=mf>25.3</span><span class=p>,</span> <span class=mf>25.7</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;贵州茅台&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>156.8</span><span class=p>,</span> <span class=mf>158.2</span><span class=p>,</span> <span class=mf>157.5</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span> <span class=mf>160.2</span><span class=p>,</span> <span class=mf>161.5</span><span class=p>,</span> <span class=mf>162.8</span><span class=p>,</span> <span class=mf>161.9</span><span class=p>,</span> <span class=mf>163.5</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>price_data</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;日期&#39;</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;原始数据（含缺失值）:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>price_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查缺失值</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>缺失值统计:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>price_data</span><span class=o>.</span><span class=n>isnull</span><span class=p>()</span><span class=o>.</span><span class=n>sum</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>缺失值比例:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>price_data</span><span class=o>.</span><span class=n>isnull</span><span class=p>()</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>price_data</span><span class=p>)</span> <span class=o>*</span> <span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 处理缺失值的方法</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 缺失值处理方法 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 方法1: 删除包含缺失值的行</span>
</span></span><span class=line><span class=cl><span class=n>dropped_data</span> <span class=o>=</span> <span class=n>price_data</span><span class=o>.</span><span class=n>dropna</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;删除缺失值后形状: </span><span class=si>{</span><span class=n>dropped_data</span><span class=o>.</span><span class=n>shape</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 方法2: 向前填充</span>
</span></span><span class=line><span class=cl><span class=n>forward_filled</span> <span class=o>=</span> <span class=n>price_data</span><span class=o>.</span><span class=n>fillna</span><span class=p>(</span><span class=n>method</span><span class=o>=</span><span class=s1>&#39;ffill&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>向前填充后的数据:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>forward_filled</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 方法3: 向后填充</span>
</span></span><span class=line><span class=cl><span class=n>backward_filled</span> <span class=o>=</span> <span class=n>price_data</span><span class=o>.</span><span class=n>fillna</span><span class=p>(</span><span class=n>method</span><span class=o>=</span><span class=s1>&#39;bfill&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>向后填充后的数据:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>backward_filled</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 方法4: 线性插值</span>
</span></span><span class=line><span class=cl><span class=n>interpolated</span> <span class=o>=</span> <span class=n>price_data</span><span class=o>.</span><span class=n>interpolate</span><span class=p>(</span><span class=n>method</span><span class=o>=</span><span class=s1>&#39;linear&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>线性插值后的数据:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>interpolated</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 方法5: 使用均值填充</span>
</span></span><span class=line><span class=cl><span class=n>mean_filled</span> <span class=o>=</span> <span class=n>price_data</span><span class=o>.</span><span class=n>fillna</span><span class=p>(</span><span class=n>price_data</span><span class=o>.</span><span class=n>mean</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>均值填充后的数据:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>mean_filled</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 方法6: 按列使用不同方法填充</span>
</span></span><span class=line><span class=cl><span class=n>custom_filled</span> <span class=o>=</span> <span class=n>price_data</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>custom_filled</span><span class=p>[</span><span class=s1>&#39;平安银行&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>custom_filled</span><span class=p>[</span><span class=s1>&#39;平安银行&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>fillna</span><span class=p>(</span><span class=n>method</span><span class=o>=</span><span class=s1>&#39;ffill&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>custom_filled</span><span class=p>[</span><span class=s1>&#39;万科A&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>custom_filled</span><span class=p>[</span><span class=s1>&#39;万科A&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>fillna</span><span class=p>(</span><span class=n>method</span><span class=o>=</span><span class=s1>&#39;bfill&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>custom_filled</span><span class=p>[</span><span class=s1>&#39;贵州茅台&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>custom_filled</span><span class=p>[</span><span class=s1>&#39;贵州茅台&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>interpolate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>自定义填充后的数据:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>custom_filled</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=数据类型转换和格式化>数据类型转换和格式化</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建需要清洗的数据</span>
</span></span><span class=line><span class=cl><span class=n>raw_data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;股票代码&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;000001&#39;</span><span class=p>,</span> <span class=s1>&#39;000002&#39;</span><span class=p>,</span> <span class=s1>&#39;600519&#39;</span><span class=p>,</span> <span class=s1>&#39;000001&#39;</span><span class=p>,</span> <span class=s1>&#39;000002&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;交易日期&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;2025-09-01&#39;</span><span class=p>,</span> <span class=s1>&#39;2025-09-01&#39;</span><span class=p>,</span> <span class=s1>&#39;2025-09-01&#39;</span><span class=p>,</span> <span class=s1>&#39;2025-09-02&#39;</span><span class=p>,</span> <span class=s1>&#39;2025-09-02&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;收盘价&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;45.2&#39;</span><span class=p>,</span> <span class=s1>&#39;23.5&#39;</span><span class=p>,</span> <span class=s1>&#39;156.8&#39;</span><span class=p>,</span> <span class=s1>&#39;46.8&#39;</span><span class=p>,</span> <span class=s1>&#39;24.1&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;成交量&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;125,000&#39;</span><span class=p>,</span> <span class=s1>&#39;98,000&#39;</span><span class=p>,</span> <span class=s1>&#39;45,000&#39;</span><span class=p>,</span> <span class=s1>&#39;132,000&#39;</span><span class=p>,</span> <span class=s1>&#39;105,000&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;涨跌幅&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;3.5%&#39;</span><span class=p>,</span> <span class=s1>&#39;1.7%&#39;</span><span class=p>,</span> <span class=s1>&#39;0.4%&#39;</span><span class=p>,</span> <span class=s1>&#39;3.6%&#39;</span><span class=p>,</span> <span class=s1>&#39;2.5%&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;原始数据:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>raw_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>数据类型:</span><span class=se>\n</span><span class=si>{</span><span class=n>raw_data</span><span class=o>.</span><span class=n>dtypes</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 数据清洗和转换</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 数据清洗过程 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 1. 股票代码格式化</span>
</span></span><span class=line><span class=cl><span class=n>cleaned_data</span> <span class=o>=</span> <span class=n>raw_data</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>cleaned_data</span><span class=p>[</span><span class=s1>&#39;股票代码&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>cleaned_data</span><span class=p>[</span><span class=s1>&#39;股票代码&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>x</span><span class=si>}</span><span class=s2>.SZ&#34;</span> <span class=k>if</span> <span class=n>x</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;000&#39;</span><span class=p>)</span> <span class=k>else</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>x</span><span class=si>}</span><span class=s2>.SH&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 日期转换</span>
</span></span><span class=line><span class=cl><span class=n>cleaned_data</span><span class=p>[</span><span class=s1>&#39;交易日期&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>to_datetime</span><span class=p>(</span><span class=n>cleaned_data</span><span class=p>[</span><span class=s1>&#39;交易日期&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 价格转换为数值</span>
</span></span><span class=line><span class=cl><span class=n>cleaned_data</span><span class=p>[</span><span class=s1>&#39;收盘价&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>to_numeric</span><span class=p>(</span><span class=n>cleaned_data</span><span class=p>[</span><span class=s1>&#39;收盘价&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. 成交量清洗（去除逗号）</span>
</span></span><span class=line><span class=cl><span class=n>cleaned_data</span><span class=p>[</span><span class=s1>&#39;成交量&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>cleaned_data</span><span class=p>[</span><span class=s1>&#39;成交量&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 5. 涨跌幅转换为小数</span>
</span></span><span class=line><span class=cl><span class=n>cleaned_data</span><span class=p>[</span><span class=s1>&#39;涨跌幅&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>cleaned_data</span><span class=p>[</span><span class=s1>&#39;涨跌幅&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;%&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>float</span><span class=p>)</span> <span class=o>/</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 6. 设置合适的索引</span>
</span></span><span class=line><span class=cl><span class=n>cleaned_data</span><span class=o>.</span><span class=n>set_index</span><span class=p>([</span><span class=s1>&#39;股票代码&#39;</span><span class=p>,</span> <span class=s1>&#39;交易日期&#39;</span><span class=p>],</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;清洗后的数据:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>cleaned_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>清洗后的数据类型:</span><span class=se>\n</span><span class=si>{</span><span class=n>cleaned_data</span><span class=o>.</span><span class=n>dtypes</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 验证数据清洗结果</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>数据完整性检查:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;缺失值数量: </span><span class=si>{</span><span class=n>cleaned_data</span><span class=o>.</span><span class=n>isnull</span><span class=p>()</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;数据形状: </span><span class=si>{</span><span class=n>cleaned_data</span><span class=o>.</span><span class=n>shape</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;唯一股票代码: </span><span class=si>{</span><span class=n>cleaned_data</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>get_level_values</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>.</span><span class=n>nunique</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=时间序列分析>时间序列分析</h2><h3 id=日期时间处理>日期时间处理</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建时间序列数据</span>
</span></span><span class=line><span class=cl><span class=n>start_date</span> <span class=o>=</span> <span class=s1>&#39;2025-01-01&#39;</span>
</span></span><span class=line><span class=cl><span class=n>end_date</span> <span class=o>=</span> <span class=s1>&#39;2025-09-30&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生成交易日历（排除周末）</span>
</span></span><span class=line><span class=cl><span class=n>trading_dates</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>bdate_range</span><span class=p>(</span><span class=n>start</span><span class=o>=</span><span class=n>start_date</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=n>end_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;交易日数量: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>trading_dates</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;交易日期范围: </span><span class=si>{</span><span class=n>trading_dates</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2> 到 </span><span class=si>{</span><span class=n>trading_dates</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建股票价格时间序列</span>
</span></span><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>42</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>initial_price</span> <span class=o>=</span> <span class=mf>50.0</span>
</span></span><span class=line><span class=cl><span class=n>returns</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>normal</span><span class=p>(</span><span class=mf>0.001</span><span class=p>,</span> <span class=mf>0.02</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>trading_dates</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>prices</span> <span class=o>=</span> <span class=n>initial_price</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>exp</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>cumsum</span><span class=p>(</span><span class=n>returns</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建时间序列DataFrame</span>
</span></span><span class=line><span class=cl><span class=n>ts_data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;收盘价&#39;</span><span class=p>:</span> <span class=n>prices</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;成交量&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>100000</span><span class=p>,</span> <span class=mi>200000</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>trading_dates</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;涨跌幅&#39;</span><span class=p>:</span> <span class=n>returns</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=n>index</span><span class=o>=</span><span class=n>trading_dates</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>时间序列数据前5行:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>ts_data</span><span class=o>.</span><span class=n>head</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 时间索引操作</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 时间索引操作 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 按日期筛选</span>
</span></span><span class=line><span class=cl><span class=n>date_range_data</span> <span class=o>=</span> <span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;2025-07&#39;</span><span class=p>:</span><span class=s1>&#39;2025-08&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;7-8月数据形状: </span><span class=si>{</span><span class=n>date_range_data</span><span class=o>.</span><span class=n>shape</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 按年份筛选</span>
</span></span><span class=line><span class=cl><span class=n>year_2025</span> <span class=o>=</span> <span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;2025&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;2025年数据形状: </span><span class=si>{</span><span class=n>year_2025</span><span class=o>.</span><span class=n>shape</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 按月份分组</span>
</span></span><span class=line><span class=cl><span class=n>monthly_data</span> <span class=o>=</span> <span class=n>ts_data</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=n>ts_data</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>to_period</span><span class=p>(</span><span class=s1>&#39;M&#39;</span><span class=p>))</span><span class=o>.</span><span class=n>agg</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;收盘价&#39;</span><span class=p>:</span> <span class=s1>&#39;last&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;成交量&#39;</span><span class=p>:</span> <span class=s1>&#39;mean&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;涨跌幅&#39;</span><span class=p>:</span> <span class=s1>&#39;sum&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>月度统计数据:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>monthly_data</span><span class=o>.</span><span class=n>head</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 重新采样</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 重新采样 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 按周重新采样</span>
</span></span><span class=line><span class=cl><span class=n>weekly_data</span> <span class=o>=</span> <span class=n>ts_data</span><span class=o>.</span><span class=n>resample</span><span class=p>(</span><span class=s1>&#39;W&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>agg</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;收盘价&#39;</span><span class=p>:</span> <span class=s1>&#39;last&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;成交量&#39;</span><span class=p>:</span> <span class=s1>&#39;sum&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;涨跌幅&#39;</span><span class=p>:</span> <span class=s1>&#39;sum&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>周度数据前5行:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>weekly_data</span><span class=o>.</span><span class=n>head</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 按月重新采样</span>
</span></span><span class=line><span class=cl><span class=n>monthly_resampled</span> <span class=o>=</span> <span class=n>ts_data</span><span class=o>.</span><span class=n>resample</span><span class=p>(</span><span class=s1>&#39;M&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>agg</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;收盘价&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;first&#39;</span><span class=p>,</span> <span class=s1>&#39;last&#39;</span><span class=p>,</span> <span class=s1>&#39;min&#39;</span><span class=p>,</span> <span class=s1>&#39;max&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;成交量&#39;</span><span class=p>:</span> <span class=s1>&#39;mean&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;涨跌幅&#39;</span><span class=p>:</span> <span class=s1>&#39;sum&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>月度重采样数据:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>monthly_resampled</span><span class=o>.</span><span class=n>head</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=移动窗口计算>移动窗口计算</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用移动窗口计算技术指标</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=== 移动窗口技术指标 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 简单移动平均</span>
</span></span><span class=line><span class=cl><span class=n>window_short</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=n>window_long</span> <span class=o>=</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ts_data</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;MA_</span><span class=si>{</span><span class=n>window_short</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;收盘价&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=n>window</span><span class=o>=</span><span class=n>window_short</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>ts_data</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;MA_</span><span class=si>{</span><span class=n>window_long</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;收盘价&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=n>window</span><span class=o>=</span><span class=n>window_long</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 移动标准差</span>
</span></span><span class=line><span class=cl><span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;STD_20&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;收盘价&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=n>window</span><span class=o>=</span><span class=mi>20</span><span class=p>)</span><span class=o>.</span><span class=n>std</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 布林带</span>
</span></span><span class=line><span class=cl><span class=n>num_std</span> <span class=o>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;BB_Upper&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>ts_data</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;MA_</span><span class=si>{</span><span class=n>window_long</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=n>num_std</span> <span class=o>*</span> <span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;STD_20&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;BB_Lower&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>ts_data</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;MA_</span><span class=si>{</span><span class=n>window_long</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=n>num_std</span> <span class=o>*</span> <span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;STD_20&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 移动收益率</span>
</span></span><span class=line><span class=cl><span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;Return_5d&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;收盘价&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>pct_change</span><span class=p>(</span><span class=n>periods</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;Return_20d&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;收盘价&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>pct_change</span><span class=p>(</span><span class=n>periods</span><span class=o>=</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 指数移动平均</span>
</span></span><span class=line><span class=cl><span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;EMA_12&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;收盘价&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>ewm</span><span class=p>(</span><span class=n>span</span><span class=o>=</span><span class=mi>12</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;EMA_26&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;收盘价&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>ewm</span><span class=p>(</span><span class=n>span</span><span class=o>=</span><span class=mi>26</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># MACD</span>
</span></span><span class=line><span class=cl><span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;MACD&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;EMA_12&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;EMA_26&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;MACD_Signal&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;MACD&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>ewm</span><span class=p>(</span><span class=n>span</span><span class=o>=</span><span class=mi>9</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;MACD_Histogram&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;MACD&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;MACD_Signal&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;技术指标数据（最近10天）:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>ts_data</span><span class=p>[[</span><span class=s1>&#39;收盘价&#39;</span><span class=p>,</span> <span class=s1>&#39;MA_5&#39;</span><span class=p>,</span> <span class=s1>&#39;MA_20&#39;</span><span class=p>,</span> <span class=s1>&#39;BB_Upper&#39;</span><span class=p>,</span> <span class=s1>&#39;BB_Lower&#39;</span><span class=p>,</span> <span class=s1>&#39;MACD&#39;</span><span class=p>,</span> <span class=s1>&#39;MACD_Signal&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>tail</span><span class=p>(</span><span class=mi>10</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 计算技术指标的统计特性</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 技术指标统计 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 移动平均的交叉信号</span>
</span></span><span class=line><span class=cl><span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;MA_Cross&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>ts_data</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;MA_</span><span class=si>{</span><span class=n>window_short</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>ts_data</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;MA_</span><span class=si>{</span><span class=n>window_long</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>],</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;MA_Cross_Signal&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;MA_Cross&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>diff</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 布林带突破信号</span>
</span></span><span class=line><span class=cl><span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;BB_Break&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;收盘价&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;BB_Upper&#39;</span><span class=p>],</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;收盘价&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;BB_Lower&#39;</span><span class=p>],</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 统计信号频率</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;移动平均交叉信号统计:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>cross_signals</span> <span class=o>=</span> <span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;MA_Cross_Signal&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>value_counts</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>cross_signals</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>布林带突破信号统计:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>bb_signals</span> <span class=o>=</span> <span class=n>ts_data</span><span class=p>[</span><span class=s1>&#39;BB_Break&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>value_counts</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>bb_signals</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=数据分组与聚合>数据分组与聚合</h2><h3 id=groupby操作>GroupBy操作</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建多股票数据</span>
</span></span><span class=line><span class=cl><span class=n>multi_stock_data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;股票代码&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;000001.SZ&#39;</span><span class=p>,</span> <span class=s1>&#39;000001.SZ&#39;</span><span class=p>,</span> <span class=s1>&#39;000001.SZ&#39;</span><span class=p>,</span> <span class=s1>&#39;000002.SZ&#39;</span><span class=p>,</span> <span class=s1>&#39;000002.SZ&#39;</span><span class=p>,</span> <span class=s1>&#39;000002.SZ&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                 <span class=s1>&#39;600519.SH&#39;</span><span class=p>,</span> <span class=s1>&#39;600519.SH&#39;</span><span class=p>,</span> <span class=s1>&#39;600519.SH&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;交易日期&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;2025-09-01&#39;</span><span class=p>,</span> <span class=s1>&#39;2025-09-02&#39;</span><span class=p>,</span> <span class=s1>&#39;2025-09-03&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;收盘价&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>45.2</span><span class=p>,</span> <span class=mf>46.8</span><span class=p>,</span> <span class=mf>47.5</span><span class=p>,</span> <span class=mf>23.5</span><span class=p>,</span> <span class=mf>24.1</span><span class=p>,</span> <span class=mf>23.8</span><span class=p>,</span> <span class=mf>156.8</span><span class=p>,</span> <span class=mf>158.2</span><span class=p>,</span> <span class=mf>157.5</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;成交量&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>125000</span><span class=p>,</span> <span class=mi>132000</span><span class=p>,</span> <span class=mi>118000</span><span class=p>,</span> <span class=mi>98000</span><span class=p>,</span> <span class=mi>105000</span><span class=p>,</span> <span class=mi>112000</span><span class=p>,</span> <span class=mi>45000</span><span class=p>,</span> <span class=mi>48000</span><span class=p>,</span> <span class=mi>52000</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;涨跌幅&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>0.035</span><span class=p>,</span> <span class=mf>0.035</span><span class=p>,</span> <span class=mf>0.015</span><span class=p>,</span> <span class=mf>0.017</span><span class=p>,</span> <span class=mf>0.025</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.012</span><span class=p>,</span> <span class=mf>0.004</span><span class=p>,</span> <span class=mf>0.009</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.004</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;行业&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;银行&#39;</span><span class=p>,</span> <span class=s1>&#39;银行&#39;</span><span class=p>,</span> <span class=s1>&#39;银行&#39;</span><span class=p>,</span> <span class=s1>&#39;房地产&#39;</span><span class=p>,</span> <span class=s1>&#39;房地产&#39;</span><span class=p>,</span> <span class=s1>&#39;房地产&#39;</span><span class=p>,</span> <span class=s1>&#39;食品饮料&#39;</span><span class=p>,</span> <span class=s1>&#39;食品饮料&#39;</span><span class=p>,</span> <span class=s1>&#39;食品饮料&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>multi_stock_data</span><span class=p>[</span><span class=s1>&#39;交易日期&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>to_datetime</span><span class=p>(</span><span class=n>multi_stock_data</span><span class=p>[</span><span class=s1>&#39;交易日期&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;多股票数据:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>multi_stock_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 按股票代码分组</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 按股票分组 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>grouped_by_stock</span> <span class=o>=</span> <span class=n>multi_stock_data</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;股票代码&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 计算每只股票的基本统计</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;每只股票的基本统计:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>stock_stats</span> <span class=o>=</span> <span class=n>grouped_by_stock</span><span class=o>.</span><span class=n>agg</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;收盘价&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;mean&#39;</span><span class=p>,</span> <span class=s1>&#39;std&#39;</span><span class=p>,</span> <span class=s1>&#39;min&#39;</span><span class=p>,</span> <span class=s1>&#39;max&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;成交量&#39;</span><span class=p>:</span> <span class=s1>&#39;mean&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;涨跌幅&#39;</span><span class=p>:</span> <span class=s1>&#39;sum&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>stock_stats</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 按行业分组</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 按行业分组 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>grouped_by_industry</span> <span class=o>=</span> <span class=n>multi_stock_data</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;行业&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 行业统计</span>
</span></span><span class=line><span class=cl><span class=n>industry_stats</span> <span class=o>=</span> <span class=n>grouped_by_industry</span><span class=o>.</span><span class=n>agg</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;收盘价&#39;</span><span class=p>:</span> <span class=s1>&#39;mean&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;成交量&#39;</span><span class=p>:</span> <span class=s1>&#39;mean&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;涨跌幅&#39;</span><span class=p>:</span> <span class=s1>&#39;mean&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;行业统计:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>industry_stats</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 复杂的分组操作</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 复杂分组操作 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建更复杂的数据集</span>
</span></span><span class=line><span class=cl><span class=n>complex_data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;股票代码&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>([</span><span class=s1>&#39;000001.SZ&#39;</span><span class=p>,</span> <span class=s1>&#39;000002.SZ&#39;</span><span class=p>,</span> <span class=s1>&#39;600519.SH&#39;</span><span class=p>],</span> <span class=mi>100</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;交易日期&#39;</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>date_range</span><span class=p>(</span><span class=s1>&#39;2025-01-01&#39;</span><span class=p>,</span> <span class=n>periods</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span> <span class=n>freq</span><span class=o>=</span><span class=s1>&#39;D&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;收盘价&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=mi>200</span><span class=p>,</span> <span class=mi>100</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;成交量&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>50000</span><span class=p>,</span> <span class=mi>200000</span><span class=p>,</span> <span class=mi>100</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;市值&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>([</span><span class=s1>&#39;大盘股&#39;</span><span class=p>,</span> <span class=s1>&#39;中盘股&#39;</span><span class=p>,</span> <span class=s1>&#39;小盘股&#39;</span><span class=p>],</span> <span class=mi>100</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PE&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 按多个列分组</span>
</span></span><span class=line><span class=cl><span class=n>grouped_complex</span> <span class=o>=</span> <span class=n>complex_data</span><span class=o>.</span><span class=n>groupby</span><span class=p>([</span><span class=s1>&#39;股票代码&#39;</span><span class=p>,</span> <span class=s1>&#39;市值&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 计算复杂的聚合统计</span>
</span></span><span class=line><span class=cl><span class=n>complex_stats</span> <span class=o>=</span> <span class=n>grouped_complex</span><span class=o>.</span><span class=n>agg</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;收盘价&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;mean&#39;</span><span class=p>,</span> <span class=s1>&#39;std&#39;</span><span class=p>,</span> <span class=s1>&#39;count&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;成交量&#39;</span><span class=p>:</span> <span class=s1>&#39;mean&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PE&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;mean&#39;</span><span class=p>,</span> <span class=s1>&#39;min&#39;</span><span class=p>,</span> <span class=s1>&#39;max&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;复杂分组统计（前10行）:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>complex_stats</span><span class=o>.</span><span class=n>head</span><span class=p>(</span><span class=mi>10</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 自定义聚合函数</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>custom_metric</span><span class=p>(</span><span class=n>group</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;自定义聚合函数&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;平均收盘价&#39;</span><span class=p>:</span> <span class=n>group</span><span class=p>[</span><span class=s1>&#39;收盘价&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>mean</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;价格稳定性&#39;</span><span class=p>:</span> <span class=n>group</span><span class=p>[</span><span class=s1>&#39;收盘价&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>std</span><span class=p>()</span> <span class=o>/</span> <span class=n>group</span><span class=p>[</span><span class=s1>&#39;收盘价&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>mean</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;高成交量占比&#39;</span><span class=p>:</span> <span class=p>(</span><span class=n>group</span><span class=p>[</span><span class=s1>&#39;成交量&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>group</span><span class=p>[</span><span class=s1>&#39;成交量&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>median</span><span class=p>())</span><span class=o>.</span><span class=n>mean</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;低PE股票数量&#39;</span><span class=p>:</span> <span class=p>(</span><span class=n>group</span><span class=p>[</span><span class=s1>&#39;PE&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mi>15</span><span class=p>)</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 应用自定义函数</span>
</span></span><span class=line><span class=cl><span class=n>custom_stats</span> <span class=o>=</span> <span class=n>complex_data</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;股票代码&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>custom_metric</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>自定义聚合函数结果:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>custom_stats</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=数据透视表>数据透视表</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建适合透视表的数据</span>
</span></span><span class=line><span class=cl><span class=n>pivot_data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;股票代码&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;000001.SZ&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>12</span> <span class=o>+</span> <span class=p>[</span><span class=s1>&#39;000002.SZ&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>12</span> <span class=o>+</span> <span class=p>[</span><span class=s1>&#39;600519.SH&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>12</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;月份&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;2025-01&#39;</span><span class=p>,</span> <span class=s1>&#39;2025-02&#39;</span><span class=p>,</span> <span class=s1>&#39;2025-03&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>12</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;行业&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;银行&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>12</span> <span class=o>+</span> <span class=p>[</span><span class=s1>&#39;房地产&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>12</span> <span class=o>+</span> <span class=p>[</span><span class=s1>&#39;食品饮料&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>12</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;平均收盘价&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mi>40</span><span class=p>,</span> <span class=mi>160</span><span class=p>,</span> <span class=mi>36</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;月收益率&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=o>-</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.15</span><span class=p>,</span> <span class=mi>36</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;成交量&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>1000000</span><span class=p>,</span> <span class=mi>5000000</span><span class=p>,</span> <span class=mi>36</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;波动率&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mf>0.02</span><span class=p>,</span> <span class=mf>0.08</span><span class=p>,</span> <span class=mi>36</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;透视表原始数据（前10行）:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>pivot_data</span><span class=o>.</span><span class=n>head</span><span class=p>(</span><span class=mi>10</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建数据透视表</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 数据透视表 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 基本透视表：股票vs月份，值为平均收盘价</span>
</span></span><span class=line><span class=cl><span class=n>pivot_basic</span> <span class=o>=</span> <span class=n>pivot_data</span><span class=o>.</span><span class=n>pivot_table</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>values</span><span class=o>=</span><span class=s1>&#39;平均收盘价&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>index</span><span class=o>=</span><span class=s1>&#39;股票代码&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>columns</span><span class=o>=</span><span class=s1>&#39;月份&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>aggfunc</span><span class=o>=</span><span class=s1>&#39;mean&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;基本透视表（股票vs月份，平均收盘价）:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>pivot_basic</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 多值透视表</span>
</span></span><span class=line><span class=cl><span class=n>pivot_multi</span> <span class=o>=</span> <span class=n>pivot_data</span><span class=o>.</span><span class=n>pivot_table</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>values</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;平均收盘价&#39;</span><span class=p>,</span> <span class=s1>&#39;月收益率&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>index</span><span class=o>=</span><span class=s1>&#39;股票代码&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>columns</span><span class=o>=</span><span class=s1>&#39;月份&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>aggfunc</span><span class=o>=</span><span class=s1>&#39;mean&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>多值透视表:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>pivot_multi</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 多层索引透视表</span>
</span></span><span class=line><span class=cl><span class=n>pivot_multi_index</span> <span class=o>=</span> <span class=n>pivot_data</span><span class=o>.</span><span class=n>pivot_table</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>values</span><span class=o>=</span><span class=s1>&#39;月收益率&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>index</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;行业&#39;</span><span class=p>,</span> <span class=s1>&#39;股票代码&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>columns</span><span class=o>=</span><span class=s1>&#39;月份&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>aggfunc</span><span class=o>=</span><span class=s1>&#39;mean&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>多层索引透视表:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>pivot_multi_index</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 自定义聚合函数的透视表</span>
</span></span><span class=line><span class=cl><span class=n>pivot_custom</span> <span class=o>=</span> <span class=n>pivot_data</span><span class=o>.</span><span class=n>pivot_table</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>values</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;月收益率&#39;</span><span class=p>,</span> <span class=s1>&#39;成交量&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>index</span><span class=o>=</span><span class=s1>&#39;行业&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>columns</span><span class=o>=</span><span class=s1>&#39;月份&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>aggfunc</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;月收益率&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;mean&#39;</span><span class=p>,</span> <span class=s1>&#39;std&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;成交量&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;mean&#39;</span><span class=p>,</span> <span class=s1>&#39;sum&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>自定义聚合透视表:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>pivot_custom</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 透视表与分组统计对比</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 透视表vs分组统计 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用groupby实现类似功能</span>
</span></span><span class=line><span class=cl><span class=n>grouped_comparison</span> <span class=o>=</span> <span class=n>pivot_data</span><span class=o>.</span><span class=n>groupby</span><span class=p>([</span><span class=s1>&#39;股票代码&#39;</span><span class=p>,</span> <span class=s1>&#39;月份&#39;</span><span class=p>])[</span><span class=s1>&#39;平均收盘价&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span><span class=o>.</span><span class=n>unstack</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;使用groupby实现透视表效果:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>grouped_comparison</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查两种方法结果是否一致</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>透视表和分组统计结果一致: </span><span class=si>{</span><span class=n>pivot_basic</span><span class=o>.</span><span class=n>equals</span><span class=p>(</span><span class=n>grouped_comparison</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=数据合并与连接>数据合并与连接</h2><h3 id=不同类型的数据连接>不同类型的数据连接</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建多个数据集用于演示合并操作</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 股票基本信息</span>
</span></span><span class=line><span class=cl><span class=n>stock_info</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;股票代码&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;000001.SZ&#39;</span><span class=p>,</span> <span class=s1>&#39;000002.SZ&#39;</span><span class=p>,</span> <span class=s1>&#39;600519.SH&#39;</span><span class=p>,</span> <span class=s1>&#39;000858.SZ&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;股票名称&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;平安银行&#39;</span><span class=p>,</span> <span class=s1>&#39;万科A&#39;</span><span class=p>,</span> <span class=s1>&#39;贵州茅台&#39;</span><span class=p>,</span> <span class=s1>&#39;五粮液&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;行业&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;银行&#39;</span><span class=p>,</span> <span class=s1>&#39;房地产&#39;</span><span class=p>,</span> <span class=s1>&#39;食品饮料&#39;</span><span class=p>,</span> <span class=s1>&#39;食品饮料&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;上市日期&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;1991-04-03&#39;</span><span class=p>,</span> <span class=s1>&#39;1991-01-29&#39;</span><span class=p>,</span> <span class=s1>&#39;2001-08-27&#39;</span><span class=p>,</span> <span class=s1>&#39;1998-04-27&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 股票价格数据</span>
</span></span><span class=line><span class=cl><span class=n>price_info</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;股票代码&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;000001.SZ&#39;</span><span class=p>,</span> <span class=s1>&#39;000002.SZ&#39;</span><span class=p>,</span> <span class=s1>&#39;600519.SH&#39;</span><span class=p>,</span> <span class=s1>&#39;000858.SZ&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;当前价格&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>45.2</span><span class=p>,</span> <span class=mf>24.1</span><span class=p>,</span> <span class=mf>159.8</span><span class=p>,</span> <span class=mf>132.5</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;52周最高&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>52.8</span><span class=p>,</span> <span class=mf>28.3</span><span class=p>,</span> <span class=mf>188.5</span><span class=p>,</span> <span class=mf>156.2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;52周最低&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>38.5</span><span class=p>,</span> <span class=mf>19.8</span><span class=p>,</span> <span class=mf>142.3</span><span class=p>,</span> <span class=mf>98.7</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 财务数据（部分股票）</span>
</span></span><span class=line><span class=cl><span class=n>financial_info</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;股票代码&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;000001.SZ&#39;</span><span class=p>,</span> <span class=s1>&#39;600519.SH&#39;</span><span class=p>,</span> <span class=s1>&#39;000858.SZ&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;市盈率&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>8.5</span><span class=p>,</span> <span class=mf>35.2</span><span class=p>,</span> <span class=mf>28.7</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;市净率&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>1.2</span><span class=p>,</span> <span class=mf>8.5</span><span class=p>,</span> <span class=mf>5.8</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;ROE&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>0.15</span><span class=p>,</span> <span class=mf>0.25</span><span class=p>,</span> <span class=mf>0.22</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 交易数据（不同时间范围）</span>
</span></span><span class=line><span class=cl><span class=n>trading_info</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;股票代码&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;000001.SZ&#39;</span><span class=p>,</span> <span class=s1>&#39;000001.SZ&#39;</span><span class=p>,</span> <span class=s1>&#39;000002.SZ&#39;</span><span class=p>,</span> <span class=s1>&#39;000002.SZ&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;交易日期&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;2025-09-01&#39;</span><span class=p>,</span> <span class=s1>&#39;2025-09-02&#39;</span><span class=p>,</span> <span class=s1>&#39;2025-09-01&#39;</span><span class=p>,</span> <span class=s1>&#39;2025-09-02&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;收盘价&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>45.2</span><span class=p>,</span> <span class=mf>46.8</span><span class=p>,</span> <span class=mf>24.1</span><span class=p>,</span> <span class=mf>24.5</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;成交量&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>125000</span><span class=p>,</span> <span class=mi>132000</span><span class=p>,</span> <span class=mi>105000</span><span class=p>,</span> <span class=mi>112000</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=== 数据合并操作 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 1. 内连接（只保留匹配的行）</span>
</span></span><span class=line><span class=cl><span class=n>inner_join</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span><span class=n>stock_info</span><span class=p>,</span> <span class=n>price_info</span><span class=p>,</span> <span class=n>on</span><span class=o>=</span><span class=s1>&#39;股票代码&#39;</span><span class=p>,</span> <span class=n>how</span><span class=o>=</span><span class=s1>&#39;inner&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;内连接结果:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>inner_join</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 左连接（保留左表所有行）</span>
</span></span><span class=line><span class=cl><span class=n>left_join</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span><span class=n>stock_info</span><span class=p>,</span> <span class=n>financial_info</span><span class=p>,</span> <span class=n>on</span><span class=o>=</span><span class=s1>&#39;股票代码&#39;</span><span class=p>,</span> <span class=n>how</span><span class=o>=</span><span class=s1>&#39;left&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>左连接结果:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>left_join</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 右连接（保留右表所有行）</span>
</span></span><span class=line><span class=cl><span class=n>right_join</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span><span class=n>stock_info</span><span class=p>,</span> <span class=n>financial_info</span><span class=p>,</span> <span class=n>on</span><span class=o>=</span><span class=s1>&#39;股票代码&#39;</span><span class=p>,</span> <span class=n>how</span><span class=o>=</span><span class=s1>&#39;right&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>右连接结果:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>right_join</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. 外连接（保留所有行）</span>
</span></span><span class=line><span class=cl><span class=n>outer_join</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span><span class=n>stock_info</span><span class=p>,</span> <span class=n>financial_info</span><span class=p>,</span> <span class=n>on</span><span class=o>=</span><span class=s1>&#39;股票代码&#39;</span><span class=p>,</span> <span class=n>how</span><span class=o>=</span><span class=s1>&#39;outer&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>外连接结果:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>outer_join</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 5. 多键合并</span>
</span></span><span class=line><span class=cl><span class=c1># 创建包含日期的时间序列数据</span>
</span></span><span class=line><span class=cl><span class=n>dates</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>date_range</span><span class=p>(</span><span class=s1>&#39;2025-09-01&#39;</span><span class=p>,</span> <span class=n>periods</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 股票价格时间序列</span>
</span></span><span class=line><span class=cl><span class=n>price_ts</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;股票代码&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;000001.SZ&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>3</span> <span class=o>+</span> <span class=p>[</span><span class=s1>&#39;000002.SZ&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;交易日期&#39;</span><span class=p>:</span> <span class=nb>list</span><span class=p>(</span><span class=n>dates</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;收盘价&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>45.2</span><span class=p>,</span> <span class=mf>46.8</span><span class=p>,</span> <span class=mf>47.5</span><span class=p>,</span> <span class=mf>24.1</span><span class=p>,</span> <span class=mf>24.5</span><span class=p>,</span> <span class=mf>23.8</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 成交量时间序列</span>
</span></span><span class=line><span class=cl><span class=n>volume_ts</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;股票代码&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;000001.SZ&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>3</span> <span class=o>+</span> <span class=p>[</span><span class=s1>&#39;000002.SZ&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;交易日期&#39;</span><span class=p>:</span> <span class=nb>list</span><span class=p>(</span><span class=n>dates</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;成交量&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>125000</span><span class=p>,</span> <span class=mi>132000</span><span class=p>,</span> <span class=mi>118000</span><span class=p>,</span> <span class=mi>105000</span><span class=p>,</span> <span class=mi>112000</span><span class=p>,</span> <span class=mi>98000</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 多键合并</span>
</span></span><span class=line><span class=cl><span class=n>multi_key_merge</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span><span class=n>price_ts</span><span class=p>,</span> <span class=n>volume_ts</span><span class=p>,</span> <span class=n>on</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;股票代码&#39;</span><span class=p>,</span> <span class=s1>&#39;交易日期&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>多键合并结果:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>multi_key_merge</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 6. 连接（concat）操作</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 连接操作 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 垂直连接（按行）</span>
</span></span><span class=line><span class=cl><span class=c1># 创建不同时间段的数据</span>
</span></span><span class=line><span class=cl><span class=n>period1</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;股票代码&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;000001.SZ&#39;</span><span class=p>,</span> <span class=s1>&#39;000002.SZ&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;日期&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;2025-09-01&#39;</span><span class=p>,</span> <span class=s1>&#39;2025-09-01&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;收盘价&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>45.2</span><span class=p>,</span> <span class=mf>24.1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>period2</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;股票代码&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;000001.SZ&#39;</span><span class=p>,</span> <span class=s1>&#39;000002.SZ&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;日期&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;2025-09-02&#39;</span><span class=p>,</span> <span class=s1>&#39;2025-09-02&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;收盘价&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>46.8</span><span class=p>,</span> <span class=mf>24.5</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 垂直连接</span>
</span></span><span class=line><span class=cl><span class=n>vertical_concat</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>([</span><span class=n>period1</span><span class=p>,</span> <span class=n>period2</span><span class=p>],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>ignore_index</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;垂直连接结果:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>vertical_concat</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 水平连接（按列）</span>
</span></span><span class=line><span class=cl><span class=c1># 创建不同类型的指标</span>
</span></span><span class=line><span class=cl><span class=n>price_data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;股票代码&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;000001.SZ&#39;</span><span class=p>,</span> <span class=s1>&#39;000002.SZ&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;收盘价&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>45.2</span><span class=p>,</span> <span class=mf>24.1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>financial_ratios</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;股票代码&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;000001.SZ&#39;</span><span class=p>,</span> <span class=s1>&#39;000002.SZ&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;市盈率&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>8.5</span><span class=p>,</span> <span class=mf>12.3</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;市净率&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>1.2</span><span class=p>,</span> <span class=mf>1.8</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 水平连接</span>
</span></span><span class=line><span class=cl><span class=n>horizontal_concat</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>([</span><span class=n>price_data</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;股票代码&#39;</span><span class=p>),</span> <span class=n>financial_ratios</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;股票代码&#39;</span><span class=p>)],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;水平连接结果:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>horizontal_concat</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div></div></article><aside class="lg:w-80 xl:w-96"><div class=space-y-8></div></aside></div><nav class="border-t border-gray-200 mt-12 pt-8"><div class="flex justify-between items-center"><a href=/blog/%E6%8A%95%E8%B5%84%E7%90%86%E8%AE%BA/%E5%AE%8F%E8%A7%82%E5%88%86%E6%9E%90/06-%E5%88%A9%E7%8E%87%E5%AF%B9%E8%82%A1%E5%B8%82%E7%9A%84%E5%BD%B1%E5%93%8D/ class="group flex items-center"><svg class="w-5 h-5 mr-2 text-gray-600 group-hover:text-primary-600" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0 7-7m-7 7h18"/></svg><div><div class="text-sm text-gray-600">上一篇</div><div class="font-medium group-hover:text-primary-600">宏观分析第6讲：利率对股市的影响机制</div></div></a><a href=/blog/%E6%8A%95%E8%B5%84%E7%90%86%E8%AE%BA/%E5%AE%8F%E8%A7%82%E5%88%86%E6%9E%90/07-%E7%BB%8F%E6%B5%8E%E5%91%A8%E6%9C%9F%E5%AF%B9%E8%82%A1%E5%B8%82%E7%9A%84%E5%BD%B1%E5%93%8D/ class="group flex items-center text-right"><div><div class="text-sm text-gray-600">Next Post</div><div class="font-medium group-hover:text-primary-600">宏观分析第7讲：经济周期对股市的影响</div></div><svg class="w-5 h-5 ml-2 text-gray-600 group-hover:text-primary-600" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0-7 7m7-7H3"/></svg></a></div></nav></div></div><footer class="bg-gray-50 py-12 border-t border-gray-200"><div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl"><div class="flex flex-col md:flex-row justify-between space-y-4 md:space-y-0"><div class=flex-1><div class="flex items-center space-x-3 mb-4"><a href=https://sk-quant.github.io/ class=inline-block><img src=/images/logo.svg alt=烧烤量化 class=h-6>
</a><span class="text-xl font-bold text-gray-900">烧烤量化</span></div><div class="flex space-x-3 p-2"><a href=https://linkedin.com/in/yourusername class="text-gray-600 hover:text-gray-900" target=_blank rel="noopener noreferrer"><span class=sr-only>LinkedIn</span>
<img src=/images/social/linkedin.svg alt=LinkedIn class="h-5 w-5">
</a><a href=https://bsky.app/profile/yourblueskyhandle class="text-gray-600 hover:text-gray-900" target=_blank rel="noopener noreferrer"><span class=sr-only>Bluesky</span>
<img src=/images/social/bluesky.svg alt=Bluesky class="h-5 w-5">
</a><a href=https://twitter.com/yourusername class="text-gray-600 hover:text-gray-900" target=_blank rel="noopener noreferrer"><span class=sr-only>Twitter (X)</span>
<img src=/images/social/twitter.svg alt=Twitter class="h-5 w-5">
</a><a href=https://github.com/yourusername class="text-gray-600 hover:text-gray-900" target=_blank rel="noopener noreferrer"><span class=sr-only>GitHub</span>
<img src=/images/social/github.svg alt=GitHub class="h-5 w-5"></a></div></div><div class=flex-1><h3 class="text-sm font-semibold uppercase tracking-wider text-gray-900 mb-4"></h3><ul class=space-y-2></ul></div><div class=flex-1><h3 class="text-sm font-semibold uppercase tracking-wider text-gray-900 mb-4"></h3><ul class=space-y-2></ul></div><div class=flex-1><h3 class="text-sm font-semibold uppercase tracking-wider text-gray-900 mb-4"></h3><ul class=space-y-2></ul></div></div><div class="mt-12 pt-8 border-t border-gray-200"><div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0"><p class="text-gray-600 text-sm">© 2025 烧烤量化. All rights reserved.</p><a href=https://chaoming.li class="text-sm text-gray-600 hover:text-primary-600" target=_blank rel="noopener noreferrer">Powered by sk-quant</a></div></div></div></footer><script>const mobileMenuButton=document.getElementById("mobile-menu-button");mobileMenuButton&&mobileMenuButton.addEventListener("click",function(){const e=document.getElementById("mobile-menu");e&&e.classList.toggle("hidden")})</script></body></html>