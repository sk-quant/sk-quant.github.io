<!doctype html><html lang=zh-cn class=h-full><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-XXXXXXX")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XXXXXXXXXX")</script><title>技术指标第8讲：SAR抛物线转向指标 | 烧烤量化</title>
<meta name=description content="全面解析SAR抛物线转向指标的时间-价格止损机制，通过抛物线轨迹构建动态止损与反转信号体系，打造基于时间维度的精准出场时机捕捉系统"><meta name=author content="Ryan"><meta name=robots content="index, follow"><meta property="og:title" content="技术指标第8讲：SAR抛物线转向指标 | 烧烤量化"><meta property="og:description" content="全面解析SAR抛物线转向指标的时间-价格止损机制，通过抛物线轨迹构建动态止损与反转信号体系，打造基于时间维度的精准出场时机捕捉系统"><meta property="og:type" content="article"><meta property="og:url" content="https://sk-quant.github.io/blog/%E6%8A%80%E6%9C%AF%E6%8C%87%E6%A0%87/08-sar%E6%8A%9B%E7%89%A9%E7%BA%BF%E8%BD%AC%E5%90%91%E6%8C%87%E6%A0%87/"><meta property="og:site_name" content="烧烤量化"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="技术指标第8讲：SAR抛物线转向指标 | 烧烤量化"><meta name=twitter:description content="全面解析SAR抛物线转向指标的时间-价格止损机制，通过抛物线轨迹构建动态止损与反转信号体系，打造基于时间维度的精准出场时机捕捉系统"><link rel=icon type=image/x-icon href=/images/favicon.ico><link rel=canonical href=https://sk-quant.github.io/blog/%E6%8A%80%E6%9C%AF%E6%8C%87%E6%A0%87/08-sar%E6%8A%9B%E7%89%A9%E7%BA%BF%E8%BD%AC%E5%90%91%E6%8C%87%E6%A0%87/><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@600;700;800&display=swap" rel=stylesheet><link rel=stylesheet href="/css/main.min.0ec21c03b9f63a8c5e37663a4d2dc1608de61fd749fcfef42ffda7dc5bf34cc4.css"></head><body class="min-h-screen flex flex-col"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-XXXXXXX" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><div class="fixed top-0 left-0 right-0 z-50"><div class=mobile-menu-wrapper><input type=checkbox id=nav-toggle class=nav-toggle><header class="fixed w-full top-0 z-50 bg-white/80 backdrop-blur-sm border-b border-gray-100"><div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl"><nav class="flex items-center justify-between h-20"><a href=https://sk-quant.github.io/ class="flex items-center space-x-4"><img src=/images/logo.svg alt=烧烤量化 class=h-12>
<span class="text-3xl font-semibold text-gray-800">烧烤量化</span></a><div class="hidden md:flex items-center space-x-8"><a href=/path class="text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">学习路线</a><div class="relative group"><button class="flex items-center text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">
量化基础<svg class="ml-2 w-4 h-4" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></button><div class="absolute left-0 mt-2 w-72 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 ease-in-out"><div class="py-6 bg-white border border-gray-100 shadow-xl rounded-lg"><a href=/categories/%e6%8a%95%e8%b5%84%e7%90%86%e8%ae%ba/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">投资理论</a>
<a href=/categories/%e4%bb%a3%e7%a0%81%e5%9f%ba%e7%a1%80/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">代码基础</a>
<a href=/categories/%e6%8a%80%e6%9c%af%e6%8c%87%e6%a0%87/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">技术指标</a>
<a href=/categories/%e5%9b%9e%e6%b5%8b%e5%b9%b3%e5%8f%b0/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">回测平台</a></div></div></div><div class="relative group"><button class="flex items-center text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">
量化进阶<svg class="ml-2 w-4 h-4" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></button><div class="absolute left-0 mt-2 w-72 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 ease-in-out"><div class="py-6 bg-white border border-gray-100 shadow-xl rounded-lg"><a href=/categories/%e7%ad%96%e7%95%a5%e5%88%86%e4%ba%ab/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">策略分享</a>
<a href=/categories/%e5%ae%9e%e7%9b%98%e5%b7%a5%e5%85%b7/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">实盘工具</a>
<a href=/categories/%e7%83%ad%e7%82%b9%e9%a3%8e%e5%8f%a3/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">热点风口</a>
<a href=/categories/%e7%bb%bc%e5%90%88%e5%ae%9e%e6%88%98/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">综合实战</a></div></div></div><div class="relative group"><button class="flex items-center text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">
量化高手<svg class="ml-2 w-4 h-4" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></button><div class="absolute left-0 mt-2 w-72 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 ease-in-out"><div class="py-6 bg-white border border-gray-100 shadow-xl rounded-lg"><a href=/categories/%e5%8f%af%e8%bd%ac%e5%80%ba/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">可转债</a>
<a href=/categories/%e8%9e%8d%e8%b5%84%e8%9e%8d%e5%88%b8/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">融资融券</a>
<a href=/categories/%e8%82%a1%e7%a5%a8%e6%9c%9f%e6%9d%83/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">股票期权</a>
<a href=/categories/%e8%82%a1%e6%8c%87%e6%9c%9f%e8%b4%a7/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">股指期货</a></div></div></div><a href=/pricing class="text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">服务套餐</a></div><div class="hidden md:flex items-center space-x-4"><a href=/contact class="inline-flex items-center justify-center px-6 py-3 rounded-lg font-bold transition duration-200 ease-in-out bg-primary-600 text-white hover:bg-primary-700 hover:scale-105">现在加入</a></div><div class=md:hidden><label for=nav-toggle class="p-2 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:ring-offset-2 transition-colors cursor-pointer"><svg class="w-6 h-6" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></label></div></nav></div><div class="nav-content md:hidden w-full fixed left-0 right-0 top-20 bg-white border-t border-gray-100 shadow-lg"><div class="w-full px-6 py-4"><a href=/path class="block text-xl text-gray-900 hover:text-primary-600 font-bold transition duration-200 py-2">学习路线</a><div class=py-2><div class="text-xl text-gray-900 font-bold mb-2">量化基础</div><div class=pl-4><a href=/categories/%e6%8a%95%e8%b5%84%e7%90%86%e8%ae%ba/ class="block text-gray-700 hover:text-primary-600 py-2">投资理论</a>
<a href=/categories/%e4%bb%a3%e7%a0%81%e5%9f%ba%e7%a1%80/ class="block text-gray-700 hover:text-primary-600 py-2">代码基础</a>
<a href=/categories/%e6%8a%80%e6%9c%af%e6%8c%87%e6%a0%87/ class="block text-gray-700 hover:text-primary-600 py-2">技术指标</a>
<a href=/categories/%e5%9b%9e%e6%b5%8b%e5%b9%b3%e5%8f%b0/ class="block text-gray-700 hover:text-primary-600 py-2">回测平台</a></div></div><div class=py-2><div class="text-xl text-gray-900 font-bold mb-2">量化进阶</div><div class=pl-4><a href=/categories/%e7%ad%96%e7%95%a5%e5%88%86%e4%ba%ab/ class="block text-gray-700 hover:text-primary-600 py-2">策略分享</a>
<a href=/categories/%e5%ae%9e%e7%9b%98%e5%b7%a5%e5%85%b7/ class="block text-gray-700 hover:text-primary-600 py-2">实盘工具</a>
<a href=/categories/%e7%83%ad%e7%82%b9%e9%a3%8e%e5%8f%a3/ class="block text-gray-700 hover:text-primary-600 py-2">热点风口</a>
<a href=/categories/%e7%bb%bc%e5%90%88%e5%ae%9e%e6%88%98/ class="block text-gray-700 hover:text-primary-600 py-2">综合实战</a></div></div><div class=py-2><div class="text-xl text-gray-900 font-bold mb-2">量化高手</div><div class=pl-4><a href=/categories/%e5%8f%af%e8%bd%ac%e5%80%ba/ class="block text-gray-700 hover:text-primary-600 py-2">可转债</a>
<a href=/categories/%e8%9e%8d%e8%b5%84%e8%9e%8d%e5%88%b8/ class="block text-gray-700 hover:text-primary-600 py-2">融资融券</a>
<a href=/categories/%e8%82%a1%e7%a5%a8%e6%9c%9f%e6%9d%83/ class="block text-gray-700 hover:text-primary-600 py-2">股票期权</a>
<a href=/categories/%e8%82%a1%e6%8c%87%e6%9c%9f%e8%b4%a7/ class="block text-gray-700 hover:text-primary-600 py-2">股指期货</a></div></div><a href=/pricing class="block text-xl text-gray-900 hover:text-primary-600 font-bold transition duration-200 py-2">服务套餐</a><div class="pt-4 space-y-4"><a href=/contact class="block text-center px-6 py-3 rounded-lg font-bold transition duration-200 ease-in-out bg-primary-600 text-white hover:bg-primary-700 hover:scale-105">现在加入</a></div></div></div></header><style>.mobile-menu-wrapper{position:relative}.nav-toggle{display:none}.nav-content{display:none}.nav-toggle:checked~header .nav-content{display:block}</style></div></div><div class=pt-20><div class="container mx-auto px-4 py-12"><div class="flex flex-col lg:flex-row gap-8 mb-12"><article class=flex-1><header class=mb-8><div class=mb-4><a href=/categories/%E6%8A%80%E6%9C%AF%E6%8C%87%E6%A0%87 class="inline-block px-3 py-1 text-sm font-medium text-primary-600 bg-primary-50 rounded-full hover:bg-primary-100 mr-2">技术指标</a></div><h1 class="text-4xl font-bold mb-4">技术指标第8讲：SAR抛物线转向指标</h1><div class="flex flex-col space-y-4"><div class="flex items-center justify-between text-sm text-gray-500"><div class="flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7A4 4 0 118 7a4 4 0 018 0zm-4 7a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
<span>Ryan</span></div><div class="flex items-center space-x-6"><div class="flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747.0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746.0-3.332.477-4.5 1.253"/></svg>
<span>14 分钟</span></div><div class="flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5A2 2 0 003 7v12a2 2 0 002 2z"/></svg>
<time datetime=2025-09-18>September 18, 2025</time></div></div></div><div class="flex items-center flex-wrap gap-2"><a href=/tags/2025 class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 transition-colors duration-200">#2025</a></div></div></header><div class=mb-8><img src=/images/blog/%e6%8a%80%e6%9c%af%e6%8c%87%e6%a0%87.jpg alt=技术指标第8讲：SAR抛物线转向指标 class="w-full h-auto rounded-lg" loading=lazy></div><div class="prose prose-lg max-w-none"><div class="bg-gray-50 p-6 rounded-lg mb-8"><h2 class="text-xl font-semibold mb-4">目录</h2><nav id=TableOfContents><ul><li><a href=#sar抛物线转向指标时间-价格止损的数学艺术>SAR抛物线转向指标：时间-价格止损的数学艺术</a></li><li><a href=#sar计算原理抛物线轨迹的数学建模>SAR计算原理：抛物线轨迹的数学建模</a><ul><li><a href=#加速因子机制>加速因子机制</a></li><li><a href=#sar递推计算公式>SAR递推计算公式</a></li><li><a href=#极值点更新机制>极值点更新机制</a></li><li><a href=#sar边界条件>SAR边界条件</a></li></ul></li><li><a href=#sar信号识别动态止损与反转预警>SAR信号识别：动态止损与反转预警</a><ul><li><a href=#sar趋势跟踪信号>SAR趋势跟踪信号</a></li><li><a href=#sar反转信号系统>SAR反转信号系统</a></li><li><a href=#sar加速因子分析>SAR加速因子分析</a></li><li><a href=#sar时间维度分析>SAR时间维度分析</a></li></ul></li><li><a href=#基于talib的sar指标python实现>基于talib的SAR指标Python实现</a><ul><li><a href=#环境配置与数据准备>环境配置与数据准备</a></li><li><a href=#sar指标计算与信号识别>SAR指标计算与信号识别</a></li><li><a href=#sar多周期分析与趋势确认>SAR多周期分析与趋势确认</a></li><li><a href=#sar可视化与综合策略>SAR可视化与综合策略</a></li></ul></li><li><a href=#sar指标高级应用与实战技巧>SAR指标高级应用与实战技巧</a><ul><li><a href=#多时间框架sar分析>多时间框架SAR分析</a></li><li><a href=#sar与其他技术指标的组合应用>SAR与其他技术指标的组合应用</a></li><li><a href=#sar参数动态优化>SAR参数动态优化</a></li><li><a href=#sar风险管理策略>SAR风险管理策略</a></li></ul></li><li><a href=#sar指标优势与局限性分析>SAR指标优势与局限性分析</a><ul><li><a href=#sar指标核心优势>SAR指标核心优势</a></li><li><a href=#sar指标主要局限>SAR指标主要局限</a></li><li><a href=#sar指标优化改进方向>SAR指标优化改进方向</a></li></ul></li><li><a href=#sar指标实战应用要点>SAR指标实战应用要点</a><ul><li><a href=#策略选择与环境判断>策略选择与环境判断</a></li><li><a href=#风险控制与资金管理>风险控制与资金管理</a></li><li><a href=#持续优化与策略改进>持续优化与策略改进</a></li></ul></li></ul></nav></div><h2 id=sar抛物线转向指标时间-价格止损的数学艺术>SAR抛物线转向指标：时间-价格止损的数学艺术</h2><p>SAR抛物线转向指标（Parabolic Stop and Reverse）由威尔斯·威尔德（Welles Wilder）于1978年在其经典著作《技术交易系统新概念》中提出，是技术分析领域最具创新性的趋势跟踪工具之一。该指标通过构建一条抛物线轨迹，为投资者提供动态的止损价位和趋势反转信号，有效解决了传统止损方法中静态化、滞后性等核心问题。</p><p>SAR指标的理论基础建立在"时间-价格"二维分析框架之上。威尔德认为，随着时间的推移，价格趋势的可持续性会逐渐降低，因此止损价位应该按照时间函数进行动态调整。SAR指标通过数学建模这种时间衰减效应，构建出一条加速上升的抛物线轨迹，使得止损价位能够紧密跟随价格趋势，在保护利润的同时最大化趋势跟踪效果。</p><p>SAR指标的独特价值在于其"自适应性"特征。与固定百分比止损或移动平均线止损不同，SAR指标能够根据市场波动性和趋势强度自动调整止损速度。在强势趋势中，SAR轨迹会加速追赶价格，确保利润最大化；在弱势趋势中，SAR轨迹会减速运行，避免过早出场。这种智能化设计使得SAR指标在趋势跟踪和风险控制方面具有显著优势。</p><h2 id=sar计算原理抛物线轨迹的数学建模>SAR计算原理：抛物线轨迹的数学建模</h2><h3 id=加速因子机制>加速因子机制</h3><p>SAR指标的核心是加速因子（AF）机制，该机制决定了抛物线轨迹的追赶速度：</p><p><strong>初始加速因子</strong>：通常设为0.02，表示抛物线的初始追赶速度。</p><p><strong>加速因子递增</strong>：每当价格创出新的极值时，加速因子增加0.02，最高不超过0.2。</p><p><strong>加速因子重置</strong>：当趋势发生反转时，加速因子重置为初始值0.02。</p><h3 id=sar递推计算公式>SAR递推计算公式</h3><p><strong>上升趋势中的SAR计算</strong>：
SAR(t+1) = SAR(t) + AF × [EP - SAR(t)]</p><p><strong>下降趋势中的SAR计算</strong>：
SAR(t+1) = SAR(t) - AF × [SAR(t) - EP]</p><p>其中：</p><ul><li>SAR(t)：当前周期的SAR值</li><li>AF：加速因子</li><li>EP：极值点（上升趋势中的最高价，下降趋势中的最低价）</li></ul><h3 id=极值点更新机制>极值点更新机制</h3><p><strong>上升趋势EP更新</strong>：当当前周期的最高价高于前一EP时，更新EP值，并增加加速因子。</p><p><strong>下降趋势EP更新</strong>：当当前周期的最低价低于前一EP时，更新EP值，并增加加速因子。</p><p><strong>EP保护机制</strong>：EP值不能超出前两个周期的价格范围，以防止过度激进的止损调整。</p><h3 id=sar边界条件>SAR边界条件</h3><p><strong>价格边界</strong>：SAR值不能超出当前周期的价格范围，确保止损价位的合理性。</p><p><strong>时间边界</strong>：SAR值的时间递推不能跨越多个周期，保证计算的稳定性。</p><p><strong>极值边界</strong>：EP值的更新必须满足价格极值的连续性要求。</p><h2 id=sar信号识别动态止损与反转预警>SAR信号识别：动态止损与反转预警</h2><h3 id=sar趋势跟踪信号>SAR趋势跟踪信号</h3><p><strong>上升趋势确认</strong>：当SAR点位于价格下方时，表明市场处于上升趋势，SAR轨迹为投资者提供动态的多头止损价位。</p><p><strong>下降趋势确认</strong>：当SAR点位于价格上方时，表明市场处于下降趋势，SAR轨迹为投资者提供动态的空头止损价位。</p><p><strong>趋势强度评估</strong>：SAR轨迹的斜率反映了趋势的强弱程度，斜率越大表明趋势越强，斜率越小表明趋势越弱。</p><h3 id=sar反转信号系统>SAR反转信号系统</h3><p><strong>多头止损反转</strong>：当价格向下突破SAR值时，表明上升趋势可能结束，触发多头止损并建立空头头寸。</p><p><strong>空头止损反转</strong>：当价格向上突破SAR值时，表明下降趋势可能结束，触发空头止损并建立多头头寸。</p><p><strong>反转确认机制</strong>：SAR反转需要价格实体突破SAR值，而非仅仅影线突破，以提高信号的可靠性。</p><h3 id=sar加速因子分析>SAR加速因子分析</h3><p><strong>AF递增信号</strong>：当加速因子持续增加时，表明趋势正在加强，价格不断创出新的极值。</p><p><strong>AF递减信号</strong>：当加速因子达到最大值并开始持平时，表明趋势可能进入尾声，需要警惕反转风险。</p><p><strong>AF重置信号</strong>：当加速因子从高位重置为初始值时，表明趋势已经发生反转，新的趋势周期开始。</p><h3 id=sar时间维度分析>SAR时间维度分析</h3><p><strong>时间止损机制</strong>：SAR指标的时间衰减特性使得止损价位会随着时间推移而加速调整，形成时间止损效应。</p><p><strong>时间周期识别</strong>：通过分析SAR轨迹的时间跨度，可以识别不同级别的趋势周期。</p><p><strong>时间预警系统</strong>：SAR轨迹的加速阶段往往预示着趋势即将进入尾声，为投资者提供时间预警。</p><h2 id=基于talib的sar指标python实现>基于talib的SAR指标Python实现</h2><h3 id=环境配置与数据准备>环境配置与数据准备</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span><span class=lnt>94
</span><span class=lnt>95
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>talib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>yfinance</span> <span class=k>as</span> <span class=nn>yf</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span><span class=p>,</span> <span class=n>timedelta</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>warnings</span>
</span></span><span class=line><span class=cl><span class=n>warnings</span><span class=o>.</span><span class=n>filterwarnings</span><span class=p>(</span><span class=s1>&#39;ignore&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 获取股票数据</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_stock_data</span><span class=p>(</span><span class=n>symbol</span><span class=p>,</span> <span class=n>period</span><span class=o>=</span><span class=s2>&#34;2y&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;获取股票历史数据&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>stock</span> <span class=o>=</span> <span class=n>yf</span><span class=o>.</span><span class=n>download</span><span class=p>(</span><span class=n>symbol</span><span class=p>,</span> <span class=n>period</span><span class=o>=</span><span class=n>period</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>stock</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;获取数据失败: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 获取沪深300指数数据</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>get_stock_data</span><span class=p>(</span><span class=s2>&#34;000300.SS&#34;</span><span class=p>,</span> <span class=n>period</span><span class=o>=</span><span class=s2>&#34;2y&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>high_prices</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;High&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
</span></span><span class=line><span class=cl><span class=n>low_prices</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;Low&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
</span></span><span class=line><span class=cl><span class=n>close_prices</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建日期索引</span>
</span></span><span class=line><span class=cl><span class=n>dates</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>index</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;数据获取完成，共</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=si>}</span><span class=s2>个交易日&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;数据时间范围: </span><span class=si>{</span><span class=n>dates</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%Y-%m-</span><span class=si>%d</span><span class=s1>&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2> 至 </span><span class=si>{</span><span class=n>dates</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%Y-%m-</span><span class=si>%d</span><span class=s1>&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;价格区间: </span><span class=si>{</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>min</span><span class=p>()</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2> - </span><span class=si>{</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>max</span><span class=p>()</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 基础价格统计分析</span>
</span></span><span class=line><span class=cl><span class=n>price_range</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;High&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;Low&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>price_change</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>pct_change</span><span class=p>()</span> <span class=o>*</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 基础价格统计 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;平均日波动幅度: </span><span class=si>{</span><span class=n>price_range</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>点&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;最大日波动幅度: </span><span class=si>{</span><span class=n>price_range</span><span class=o>.</span><span class=n>max</span><span class=p>()</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>点&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;最小日波动幅度: </span><span class=si>{</span><span class=n>price_range</span><span class=o>.</span><span class=n>min</span><span class=p>()</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>点&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;平均日涨跌幅: </span><span class=si>{</span><span class=n>price_change</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;日涨跌幅标准差: </span><span class=si>{</span><span class=n>price_change</span><span class=o>.</span><span class=n>std</span><span class=p>()</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 价格趋势分析</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_price_trend</span><span class=p>(</span><span class=n>prices</span><span class=p>,</span> <span class=n>ma_period</span><span class=o>=</span><span class=mi>20</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;分析价格趋势&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>ma</span> <span class=o>=</span> <span class=n>talib</span><span class=o>.</span><span class=n>SMA</span><span class=p>(</span><span class=n>prices</span><span class=p>,</span> <span class=n>timeperiod</span><span class=o>=</span><span class=n>ma_period</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>current_price</span> <span class=o>=</span> <span class=n>prices</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>current_ma</span> <span class=o>=</span> <span class=n>ma</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 相对位置</span>
</span></span><span class=line><span class=cl>    <span class=n>relative_position</span> <span class=o>=</span> <span class=p>(</span><span class=n>current_price</span> <span class=o>-</span> <span class=n>current_ma</span><span class=p>)</span> <span class=o>/</span> <span class=n>current_ma</span> <span class=o>*</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 趋势方向</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>current_price</span> <span class=o>&gt;</span> <span class=n>current_ma</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>trend_direction</span> <span class=o>=</span> <span class=s2>&#34;上升趋势&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>trend_direction</span> <span class=o>=</span> <span class=s2>&#34;下降趋势&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;current_price&#39;</span><span class=p>:</span> <span class=n>current_price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;ma&#39;</span><span class=p>:</span> <span class=n>current_ma</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;relative_position&#39;</span><span class=p>:</span> <span class=n>relative_position</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;trend_direction&#39;</span><span class=p>:</span> <span class=n>trend_direction</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>price_trend</span> <span class=o>=</span> <span class=n>analyze_price_trend</span><span class=p>(</span><span class=n>close_prices</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 价格趋势分析 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;当前价格: </span><span class=si>{</span><span class=n>price_trend</span><span class=p>[</span><span class=s1>&#39;current_price&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;20日均线: </span><span class=si>{</span><span class=n>price_trend</span><span class=p>[</span><span class=s1>&#39;ma&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;相对均线位置: </span><span class=si>{</span><span class=n>price_trend</span><span class=p>[</span><span class=s1>&#39;relative_position&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;趋势方向: </span><span class=si>{</span><span class=n>price_trend</span><span class=p>[</span><span class=s1>&#39;trend_direction&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 价格波动率分析</span>
</span></span><span class=line><span class=cl><span class=n>volatility_20d</span> <span class=o>=</span> <span class=n>price_change</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=o>.</span><span class=n>std</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>current_volatility</span> <span class=o>=</span> <span class=n>volatility_20d</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>avg_volatility</span> <span class=o>=</span> <span class=n>volatility_20d</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 价格波动率分析 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;当前20日波动率: </span><span class=si>{</span><span class=n>current_volatility</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;平均20日波动率: </span><span class=si>{</span><span class=n>avg_volatility</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;波动率相对水平: </span><span class=si>{</span><span class=s1>&#39;高&#39;</span> <span class=k>if</span> <span class=n>current_volatility</span> <span class=o>&gt;</span> <span class=n>avg_volatility</span> <span class=k>else</span> <span class=s1>&#39;低&#39;</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 价格极值分析</span>
</span></span><span class=line><span class=cl><span class=n>recent_high</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;High&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>tail</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=o>.</span><span class=n>max</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>recent_low</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;Low&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>tail</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=o>.</span><span class=n>min</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>current_price</span> <span class=o>=</span> <span class=n>close_prices</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 近期价格极值分析 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;当前价格: </span><span class=si>{</span><span class=n>current_price</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;近20日最高价: </span><span class=si>{</span><span class=n>recent_high</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;近20日最低价: </span><span class=si>{</span><span class=n>recent_low</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;相对近期高位: </span><span class=si>{</span><span class=p>(</span><span class=n>current_price</span> <span class=o>-</span> <span class=n>recent_high</span><span class=p>)</span> <span class=o>/</span> <span class=n>recent_high</span> <span class=o>*</span> <span class=mi>100</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;相对近期低位: </span><span class=si>{</span><span class=p>(</span><span class=n>current_price</span> <span class=o>-</span> <span class=n>recent_low</span><span class=p>)</span> <span class=o>/</span> <span class=n>recent_low</span> <span class=o>*</span> <span class=mi>100</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=sar指标计算与信号识别>SAR指标计算与信号识别</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># SAR指标计算</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_sar_signals</span><span class=p>(</span><span class=n>high_prices</span><span class=p>,</span> <span class=n>low_prices</span><span class=p>,</span> <span class=n>close_prices</span><span class=p>,</span> <span class=n>acceleration</span><span class=o>=</span><span class=mf>0.02</span><span class=p>,</span> <span class=n>maximum</span><span class=o>=</span><span class=mf>0.2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;计算SAR指标和信号&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 使用talib计算SAR</span>
</span></span><span class=line><span class=cl>    <span class=n>sar</span> <span class=o>=</span> <span class=n>talib</span><span class=o>.</span><span class=n>SAR</span><span class=p>(</span><span class=n>high_prices</span><span class=p>,</span> <span class=n>low_prices</span><span class=p>,</span> <span class=n>acceleration</span><span class=o>=</span><span class=n>acceleration</span><span class=p>,</span> <span class=n>maximum</span><span class=o>=</span><span class=n>maximum</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 获取价格数据</span>
</span></span><span class=line><span class=cl>    <span class=n>dates</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>to_datetime</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 创建DataFrame</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;Date&#39;</span><span class=p>:</span> <span class=n>dates</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;Close&#39;</span><span class=p>:</span> <span class=n>close_prices</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;High&#39;</span><span class=p>:</span> <span class=n>high_prices</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;Low&#39;</span><span class=p>:</span> <span class=n>low_prices</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;SAR&#39;</span><span class=p>:</span> <span class=n>sar</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 计算SAR信号</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=p>[</span><span class=s1>&#39;SAR_Position&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;SAR&#39;</span><span class=p>],</span> <span class=s1>&#39;Below&#39;</span><span class=p>,</span> <span class=s1>&#39;Above&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=p>[</span><span class=s1>&#39;Trend_Direction&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;SAR&#39;</span><span class=p>],</span> <span class=s1>&#39;Bullish&#39;</span><span class=p>,</span> <span class=s1>&#39;Bearish&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 识别SAR反转信号</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=p>[</span><span class=s1>&#39;SAR_Reversal&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>df</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 从多头转为空头</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=s1>&#39;SAR&#39;</span><span class=p>]</span> <span class=ow>and</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=s1>&#39;SAR&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>df</span><span class=o>.</span><span class=n>columns</span><span class=o>.</span><span class=n>get_loc</span><span class=p>(</span><span class=s1>&#39;SAR_Reversal&#39;</span><span class=p>)]</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=c1># 从空头转为多头</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=s1>&#39;SAR&#39;</span><span class=p>]</span> <span class=ow>and</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=s1>&#39;SAR&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>df</span><span class=o>.</span><span class=n>columns</span><span class=o>.</span><span class=n>get_loc</span><span class=p>(</span><span class=s1>&#39;SAR_Reversal&#39;</span><span class=p>)]</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 计算SAR与价格的距离</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=p>[</span><span class=s1>&#39;SAR_Distance&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;SAR&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=p>[</span><span class=s1>&#39;SAR_Distance_Pct&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;SAR_Distance&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>])</span> <span class=o>*</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 计算趋势持续时间</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=p>[</span><span class=s1>&#39;Trend_Duration&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>current_trend</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;Trend_Direction&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>duration</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>df</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=s1>&#39;Trend_Direction&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=n>current_trend</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>duration</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>current_trend</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=s1>&#39;Trend_Direction&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>duration</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>df</span><span class=o>.</span><span class=n>columns</span><span class=o>.</span><span class=n>get_loc</span><span class=p>(</span><span class=s1>&#39;Trend_Duration&#39;</span><span class=p>)]</span> <span class=o>=</span> <span class=n>duration</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>df</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 计算SAR指标</span>
</span></span><span class=line><span class=cl><span class=n>sar_df</span> <span class=o>=</span> <span class=n>calculate_sar_signals</span><span class=p>(</span><span class=n>high_prices</span><span class=p>,</span> <span class=n>low_prices</span><span class=p>,</span> <span class=n>close_prices</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># SAR信号统计分析</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=== SAR信号统计分析 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 当前SAR状态</span>
</span></span><span class=line><span class=cl><span class=n>current_sar</span> <span class=o>=</span> <span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;SAR&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>current_close</span> <span class=o>=</span> <span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>current_position</span> <span class=o>=</span> <span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;SAR_Position&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>current_trend</span> <span class=o>=</span> <span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;Trend_Direction&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>current_distance</span> <span class=o>=</span> <span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;SAR_Distance_Pct&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;当前SAR值: </span><span class=si>{</span><span class=n>current_sar</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;当前收盘价: </span><span class=si>{</span><span class=n>current_close</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;SAR相对位置: </span><span class=si>{</span><span class=n>current_position</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;趋势方向: </span><span class=si>{</span><span class=n>current_trend</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;SAR距离百分比: </span><span class=si>{</span><span class=n>current_distance</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 反转信号统计</span>
</span></span><span class=line><span class=cl><span class=n>reversal_signals</span> <span class=o>=</span> <span class=n>sar_df</span><span class=p>[</span><span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;SAR_Reversal&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=kc>True</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== SAR反转信号统计 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;总反转次数: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>reversal_signals</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;最近反转日期: </span><span class=si>{</span><span class=n>reversal_signals</span><span class=p>[</span><span class=s1>&#39;Date&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%Y-%m-</span><span class=si>%d</span><span class=s1>&#39;</span><span class=p>)</span> <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>reversal_signals</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=s1>&#39;无&#39;</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 趋势持续时间统计</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>sar_df</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>bullish_duration</span> <span class=o>=</span> <span class=n>sar_df</span><span class=p>[</span><span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;Trend_Direction&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;Bullish&#39;</span><span class=p>][</span><span class=s1>&#39;Trend_Duration&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>max</span><span class=p>()</span> <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>sar_df</span><span class=p>[</span><span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;Trend_Direction&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;Bullish&#39;</span><span class=p>])</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>bearish_duration</span> <span class=o>=</span> <span class=n>sar_df</span><span class=p>[</span><span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;Trend_Direction&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;Bearish&#39;</span><span class=p>][</span><span class=s1>&#39;Trend_Duration&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>max</span><span class=p>()</span> <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>sar_df</span><span class=p>[</span><span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;Trend_Direction&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;Bearish&#39;</span><span class=p>])</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;最长上升趋势持续: </span><span class=si>{</span><span class=n>bullish_duration</span><span class=si>}</span><span class=s2>个交易日&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;最长下降趋势持续: </span><span class=si>{</span><span class=n>bearish_duration</span><span class=si>}</span><span class=s2>个交易日&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># SAR距离分析</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== SAR距离分析 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;平均SAR距离: </span><span class=si>{</span><span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;SAR_Distance_Pct&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;最大SAR距离: </span><span class=si>{</span><span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;SAR_Distance_Pct&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>max</span><span class=p>()</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;最小SAR距离: </span><span class=si>{</span><span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;SAR_Distance_Pct&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>min</span><span class=p>()</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 不同趋势下的SAR距离</span>
</span></span><span class=line><span class=cl><span class=n>bullish_distances</span> <span class=o>=</span> <span class=n>sar_df</span><span class=p>[</span><span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;Trend_Direction&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;Bullish&#39;</span><span class=p>][</span><span class=s1>&#39;SAR_Distance_Pct&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>bearish_distances</span> <span class=o>=</span> <span class=n>sar_df</span><span class=p>[</span><span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;Trend_Direction&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;Bearish&#39;</span><span class=p>][</span><span class=s1>&#39;SAR_Distance_Pct&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>bullish_distances</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;上升趋势平均SAR距离: </span><span class=si>{</span><span class=n>bullish_distances</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>bearish_distances</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;下降趋势平均SAR距离: </span><span class=si>{</span><span class=n>bearish_distances</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># SAR反转信号详细分析</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== SAR反转信号详细分析 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>signal</span> <span class=ow>in</span> <span class=n>reversal_signals</span><span class=o>.</span><span class=n>tail</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>signal_type</span> <span class=o>=</span> <span class=s2>&#34;多头转空头&#34;</span> <span class=k>if</span> <span class=n>signal</span><span class=p>[</span><span class=s1>&#39;Trend_Direction&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;Bearish&#39;</span> <span class=k>else</span> <span class=s2>&#34;空头转多头&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>signal</span><span class=p>[</span><span class=s1>&#39;Date&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%Y-%m-</span><span class=si>%d</span><span class=s1>&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>signal_type</span><span class=si>}</span><span class=s2>, 收盘价: </span><span class=si>{</span><span class=n>signal</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>, SAR: </span><span class=si>{</span><span class=n>signal</span><span class=p>[</span><span class=s1>&#39;SAR&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># SAR趋势强度分析</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_sar_trend_strength</span><span class=p>(</span><span class=n>sar_df</span><span class=p>,</span> <span class=n>window</span><span class=o>=</span><span class=mi>20</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;分析SAR趋势强度&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 计算SAR斜率</span>
</span></span><span class=line><span class=cl>    <span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;SAR_Slope&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;SAR&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>diff</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 计算趋势强度指标</span>
</span></span><span class=line><span class=cl>    <span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;Trend_Strength&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>sar_df</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>sar_df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=s1>&#39;Trend_Direction&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;Bullish&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 上升趋势中，SAR上升越快，趋势越强</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>i</span> <span class=o>&gt;=</span> <span class=n>window</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>slope_std</span> <span class=o>=</span> <span class=n>sar_df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=n>window</span><span class=p>:</span><span class=n>i</span><span class=p>][</span><span class=s1>&#39;SAR_Slope&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>std</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>slope_std</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>strength</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=nb>abs</span><span class=p>(</span><span class=n>sar_df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=s1>&#39;SAR_Slope&#39;</span><span class=p>])</span> <span class=o>/</span> <span class=n>slope_std</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>sar_df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>sar_df</span><span class=o>.</span><span class=n>columns</span><span class=o>.</span><span class=n>get_loc</span><span class=p>(</span><span class=s1>&#39;Trend_Strength&#39;</span><span class=p>)]</span> <span class=o>=</span> <span class=n>strength</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 下降趋势中，SAR下降越快，趋势越强</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>i</span> <span class=o>&gt;=</span> <span class=n>window</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>slope_std</span> <span class=o>=</span> <span class=n>sar_df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=n>window</span><span class=p>:</span><span class=n>i</span><span class=p>][</span><span class=s1>&#39;SAR_Slope&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>std</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>slope_std</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>strength</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=nb>abs</span><span class=p>(</span><span class=n>sar_df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=s1>&#39;SAR_Slope&#39;</span><span class=p>])</span> <span class=o>/</span> <span class=n>slope_std</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>sar_df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>sar_df</span><span class=o>.</span><span class=n>columns</span><span class=o>.</span><span class=n>get_loc</span><span class=p>(</span><span class=s1>&#39;Trend_Strength&#39;</span><span class=p>)]</span> <span class=o>=</span> <span class=n>strength</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>sar_df</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 分析SAR趋势强度</span>
</span></span><span class=line><span class=cl><span class=n>sar_df</span> <span class=o>=</span> <span class=n>analyze_sar_trend_strength</span><span class=p>(</span><span class=n>sar_df</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== SAR趋势强度分析 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>current_strength</span> <span class=o>=</span> <span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;Trend_Strength&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;当前趋势强度: </span><span class=si>{</span><span class=n>current_strength</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;趋势强度等级: </span><span class=si>{</span><span class=s1>&#39;强&#39;</span> <span class=k>if</span> <span class=n>current_strength</span> <span class=o>&gt;</span> <span class=mf>1.5</span> <span class=k>else</span> <span class=s1>&#39;中&#39;</span> <span class=k>if</span> <span class=n>current_strength</span> <span class=o>&gt;</span> <span class=mf>0.5</span> <span class=k>else</span> <span class=s1>&#39;弱&#39;</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 趋势强度分布</span>
</span></span><span class=line><span class=cl><span class=n>strength_stats</span> <span class=o>=</span> <span class=n>sar_df</span><span class=p>[</span><span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;Trend_Strength&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>][</span><span class=s1>&#39;Trend_Strength&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>describe</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;趋势强度统计:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;平均强度: </span><span class=si>{</span><span class=n>strength_stats</span><span class=p>[</span><span class=s1>&#39;mean&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;强度标准差: </span><span class=si>{</span><span class=n>strength_stats</span><span class=p>[</span><span class=s1>&#39;std&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;最大强度: </span><span class=si>{</span><span class=n>strength_stats</span><span class=p>[</span><span class=s1>&#39;max&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;最小强度: </span><span class=si>{</span><span class=n>strength_stats</span><span class=p>[</span><span class=s1>&#39;min&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=sar多周期分析与趋势确认>SAR多周期分析与趋势确认</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># SAR多周期分析</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_sar_multiple_periods</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>periods</span><span class=o>=</span><span class=p>[</span><span class=mi>5</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>60</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;多周期SAR分析&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>high_prices</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;High&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
</span></span><span class=line><span class=cl>    <span class=n>low_prices</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;Low&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
</span></span><span class=line><span class=cl>    <span class=n>close_prices</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>period</span> <span class=ow>in</span> <span class=n>periods</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 根据周期调整SAR参数</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>period</span> <span class=o>&lt;=</span> <span class=mi>10</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>acceleration</span><span class=p>,</span> <span class=n>maximum</span> <span class=o>=</span> <span class=mf>0.01</span><span class=p>,</span> <span class=mf>0.1</span>  <span class=c1># 短周期使用保守参数</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>period</span> <span class=o>&lt;=</span> <span class=mi>30</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>acceleration</span><span class=p>,</span> <span class=n>maximum</span> <span class=o>=</span> <span class=mf>0.02</span><span class=p>,</span> <span class=mf>0.2</span>  <span class=c1># 中周期使用标准参数</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>acceleration</span><span class=p>,</span> <span class=n>maximum</span> <span class=o>=</span> <span class=mf>0.03</span><span class=p>,</span> <span class=mf>0.3</span>  <span class=c1># 长周期使用激进参数</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 计算SAR</span>
</span></span><span class=line><span class=cl>        <span class=n>sar</span> <span class=o>=</span> <span class=n>talib</span><span class=o>.</span><span class=n>SAR</span><span class=p>(</span><span class=n>high_prices</span><span class=p>,</span> <span class=n>low_prices</span><span class=p>,</span> <span class=n>acceleration</span><span class=o>=</span><span class=n>acceleration</span><span class=p>,</span> <span class=n>maximum</span><span class=o>=</span><span class=n>maximum</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 创建分析结果</span>
</span></span><span class=line><span class=cl>        <span class=n>df_period</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;Date&#39;</span><span class=p>:</span> <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;Close&#39;</span><span class=p>:</span> <span class=n>close_prices</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;SAR&#39;</span><span class=p>:</span> <span class=n>sar</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;Position&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>close_prices</span> <span class=o>&gt;</span> <span class=n>sar</span><span class=p>,</span> <span class=s1>&#39;Below&#39;</span><span class=p>,</span> <span class=s1>&#39;Above&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;Trend&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>close_prices</span> <span class=o>&gt;</span> <span class=n>sar</span><span class=p>,</span> <span class=s1>&#39;Bullish&#39;</span><span class=p>,</span> <span class=s1>&#39;Bearish&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 计算信号</span>
</span></span><span class=line><span class=cl>        <span class=n>df_period</span><span class=p>[</span><span class=s1>&#39;Distance&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>close_prices</span> <span class=o>-</span> <span class=n>sar</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>df_period</span><span class=p>[</span><span class=s1>&#39;Distance_Pct&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>df_period</span><span class=p>[</span><span class=s1>&#39;Distance&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=n>close_prices</span><span class=p>)</span> <span class=o>*</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>period</span><span class=si>}</span><span class=s1>日&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;data&#39;</span><span class=p>:</span> <span class=n>df_period</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;acceleration&#39;</span><span class=p>:</span> <span class=n>acceleration</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;maximum&#39;</span><span class=p>:</span> <span class=n>maximum</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;bullish_pct&#39;</span><span class=p>:</span> <span class=p>(</span><span class=n>df_period</span><span class=p>[</span><span class=s1>&#39;Trend&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;Bullish&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span> <span class=o>*</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;avg_distance&#39;</span><span class=p>:</span> <span class=n>df_period</span><span class=p>[</span><span class=s1>&#39;Distance_Pct&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 执行多周期分析</span>
</span></span><span class=line><span class=cl><span class=n>sar_multi_results</span> <span class=o>=</span> <span class=n>analyze_sar_multiple_periods</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=== SAR多周期分析 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>period</span><span class=p>,</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>sar_multi_results</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=si>{</span><span class=n>period</span><span class=si>}</span><span class=s2>SAR分析:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  加速因子: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;acceleration&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>, 最大值: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;maximum&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  多头时间占比: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;bullish_pct&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  平均SAR距离: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;avg_distance&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 多周期趋势一致性分析</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_multi_period_consistency</span><span class=p>(</span><span class=n>results</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;分析多周期趋势一致性&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 获取最新数据</span>
</span></span><span class=line><span class=cl>    <span class=n>latest_data</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>period</span><span class=p>,</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>results</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>latest_data</span><span class=p>[</span><span class=n>period</span><span class=p>]</span> <span class=o>=</span> <span class=n>result</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 统计趋势方向</span>
</span></span><span class=line><span class=cl>    <span class=n>trend_counts</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>period</span><span class=p>,</span> <span class=n>data</span> <span class=ow>in</span> <span class=n>latest_data</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>trend</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;Trend&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>trend_counts</span><span class=p>[</span><span class=n>trend</span><span class=p>]</span> <span class=o>=</span> <span class=n>trend_counts</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>trend</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 计算一致性指标</span>
</span></span><span class=line><span class=cl>    <span class=n>total_periods</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>latest_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>bullish_count</span> <span class=o>=</span> <span class=n>trend_counts</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;Bullish&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>bearish_count</span> <span class=o>=</span> <span class=n>trend_counts</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;Bearish&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>consistency_pct</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>bullish_count</span><span class=p>,</span> <span class=n>bearish_count</span><span class=p>)</span> <span class=o>/</span> <span class=n>total_periods</span> <span class=o>*</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>    <span class=n>dominant_trend</span> <span class=o>=</span> <span class=s1>&#39;Bullish&#39;</span> <span class=k>if</span> <span class=n>bullish_count</span> <span class=o>&gt;</span> <span class=n>bearish_count</span> <span class=k>else</span> <span class=s1>&#39;Bearish&#39;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;consistency_pct&#39;</span><span class=p>:</span> <span class=n>consistency_pct</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;dominant_trend&#39;</span><span class=p>:</span> <span class=n>dominant_trend</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;bullish_count&#39;</span><span class=p>:</span> <span class=n>bullish_count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;bearish_count&#39;</span><span class=p>:</span> <span class=n>bearish_count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;latest_data&#39;</span><span class=p>:</span> <span class=n>latest_data</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>consistency_analysis</span> <span class=o>=</span> <span class=n>analyze_multi_period_consistency</span><span class=p>(</span><span class=n>sar_multi_results</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 多周期趋势一致性分析 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;趋势一致性: </span><span class=si>{</span><span class=n>consistency_analysis</span><span class=p>[</span><span class=s1>&#39;consistency_pct&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;主导趋势: </span><span class=si>{</span><span class=n>consistency_analysis</span><span class=p>[</span><span class=s1>&#39;dominant_trend&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;多头周期数: </span><span class=si>{</span><span class=n>consistency_analysis</span><span class=p>[</span><span class=s1>&#39;bullish_count&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;空头周期数: </span><span class=si>{</span><span class=n>consistency_analysis</span><span class=p>[</span><span class=s1>&#39;bearish_count&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># SAR与价格关系深度分析</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_sar_price_relationship</span><span class=p>(</span><span class=n>sar_df</span><span class=p>,</span> <span class=n>price_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;分析SAR与价格的深度关系&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 计算价格动量</span>
</span></span><span class=line><span class=cl>    <span class=n>price_returns</span> <span class=o>=</span> <span class=n>price_data</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>pct_change</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>price_momentum</span> <span class=o>=</span> <span class=n>price_returns</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 合并数据</span>
</span></span><span class=line><span class=cl>    <span class=n>analysis_df</span> <span class=o>=</span> <span class=n>sar_df</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>analysis_df</span><span class=p>[</span><span class=s1>&#39;Price_Return&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>price_returns</span>
</span></span><span class=line><span class=cl>    <span class=n>analysis_df</span><span class=p>[</span><span class=s1>&#39;Price_Momentum&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>price_momentum</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 按趋势分组分析</span>
</span></span><span class=line><span class=cl>    <span class=n>bullish_data</span> <span class=o>=</span> <span class=n>analysis_df</span><span class=p>[</span><span class=n>analysis_df</span><span class=p>[</span><span class=s1>&#39;Trend_Direction&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;Bullish&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>bearish_data</span> <span class=o>=</span> <span class=n>analysis_df</span><span class=p>[</span><span class=n>analysis_df</span><span class=p>[</span><span class=s1>&#39;Trend_Direction&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;Bearish&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 计算相关性</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>bullish_data</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>10</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>bullish_corr</span> <span class=o>=</span> <span class=n>bullish_data</span><span class=p>[</span><span class=s1>&#39;SAR_Distance_Pct&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>corr</span><span class=p>(</span><span class=n>bullish_data</span><span class=p>[</span><span class=s1>&#39;Price_Momentum&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>bullish_corr</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>bearish_data</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>10</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>bearish_corr</span> <span class=o>=</span> <span class=n>bearish_data</span><span class=p>[</span><span class=s1>&#39;SAR_Distance_Pct&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>corr</span><span class=p>(</span><span class=n>bearish_data</span><span class=p>[</span><span class=s1>&#39;Price_Momentum&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>bearish_corr</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 分析SAR突破效果</span>
</span></span><span class=line><span class=cl>    <span class=n>reversal_signals</span> <span class=o>=</span> <span class=n>analysis_df</span><span class=p>[</span><span class=n>analysis_df</span><span class=p>[</span><span class=s1>&#39;SAR_Reversal&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=kc>True</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>post_reversal_returns</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>idx</span> <span class=ow>in</span> <span class=n>reversal_signals</span><span class=o>.</span><span class=n>index</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>idx</span> <span class=o>+</span> <span class=mi>5</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>analysis_df</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>future_return</span> <span class=o>=</span> <span class=p>(</span><span class=n>analysis_df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>5</span><span class=p>][</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=n>analysis_df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>idx</span><span class=p>][</span><span class=s1>&#39;Close&#39;</span><span class=p>])</span> <span class=o>/</span> <span class=n>analysis_df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>idx</span><span class=p>][</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>post_reversal_returns</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>future_return</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;bullish_momentum_corr&#39;</span><span class=p>:</span> <span class=n>bullish_corr</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;bearish_momentum_corr&#39;</span><span class=p>:</span> <span class=n>bearish_corr</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;avg_post_reversal_return&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>post_reversal_returns</span><span class=p>)</span> <span class=k>if</span> <span class=n>post_reversal_returns</span> <span class=k>else</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;post_reversal_success_rate&#39;</span><span class=p>:</span> <span class=nb>len</span><span class=p>([</span><span class=n>r</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>post_reversal_returns</span> <span class=k>if</span> <span class=n>r</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>])</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>post_reversal_returns</span><span class=p>)</span> <span class=k>if</span> <span class=n>post_reversal_returns</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>price_relationship</span> <span class=o>=</span> <span class=n>analyze_sar_price_relationship</span><span class=p>(</span><span class=n>sar_df</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== SAR与价格关系分析 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;上升趋势中SAR距离与动量相关性: </span><span class=si>{</span><span class=n>price_relationship</span><span class=p>[</span><span class=s1>&#39;bullish_momentum_corr&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.3f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;下降趋势中SAR距离与动量相关性: </span><span class=si>{</span><span class=n>price_relationship</span><span class=p>[</span><span class=s1>&#39;bearish_momentum_corr&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.3f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;SAR反转后5日平均收益: </span><span class=si>{</span><span class=n>price_relationship</span><span class=p>[</span><span class=s1>&#39;avg_post_reversal_return&#39;</span><span class=p>]</span><span class=o>*</span><span class=mi>100</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;SAR反转后5日成功率: </span><span class=si>{</span><span class=n>price_relationship</span><span class=p>[</span><span class=s1>&#39;post_reversal_success_rate&#39;</span><span class=p>]</span><span class=o>*</span><span class=mi>100</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># SAR参数敏感性分析</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_sar_parameter_sensitivity</span><span class=p>(</span><span class=n>high_prices</span><span class=p>,</span> <span class=n>low_prices</span><span class=p>,</span> <span class=n>close_prices</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                                   <span class=n>acceleration_range</span><span class=o>=</span><span class=p>[</span><span class=mf>0.01</span><span class=p>,</span> <span class=mf>0.02</span><span class=p>,</span> <span class=mf>0.03</span><span class=p>,</span> <span class=mf>0.04</span><span class=p>,</span> <span class=mf>0.05</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                                   <span class=n>maximum_range</span><span class=o>=</span><span class=p>[</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>,</span> <span class=mf>0.3</span><span class=p>,</span> <span class=mf>0.4</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;分析SAR参数敏感性&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>acc</span> <span class=ow>in</span> <span class=n>acceleration_range</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>max_val</span> <span class=ow>in</span> <span class=n>maximum_range</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 计算SAR</span>
</span></span><span class=line><span class=cl>            <span class=n>sar</span> <span class=o>=</span> <span class=n>talib</span><span class=o>.</span><span class=n>SAR</span><span class=p>(</span><span class=n>high_prices</span><span class=p>,</span> <span class=n>low_prices</span><span class=p>,</span> <span class=n>acceleration</span><span class=o>=</span><span class=n>acc</span><span class=p>,</span> <span class=n>maximum</span><span class=o>=</span><span class=n>max_val</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 计算信号</span>
</span></span><span class=line><span class=cl>            <span class=n>signals</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>close_prices</span> <span class=o>&gt;</span> <span class=n>sar</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>signal_changes</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>diff</span><span class=p>(</span><span class=n>signals</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>reversal_count</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>signal_changes</span><span class=p>))</span> <span class=o>/</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 计算平均持仓时间</span>
</span></span><span class=line><span class=cl>            <span class=n>holding_periods</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>            <span class=n>current_signal</span> <span class=o>=</span> <span class=n>signals</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>start_idx</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>signals</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>signals</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>!=</span> <span class=n>current_signal</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>holding_periods</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>i</span> <span class=o>-</span> <span class=n>start_idx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>current_signal</span> <span class=o>=</span> <span class=n>signals</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=n>start_idx</span> <span class=o>=</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>avg_holding_period</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>holding_periods</span><span class=p>)</span> <span class=k>if</span> <span class=n>holding_periods</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 计算趋势跟踪效果</span>
</span></span><span class=line><span class=cl>            <span class=n>trend_following_score</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>close_prices</span> <span class=o>-</span> <span class=n>sar</span><span class=p>))</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>close_prices</span><span class=p>)</span> <span class=o>*</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;acceleration&#39;</span><span class=p>:</span> <span class=n>acc</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;maximum&#39;</span><span class=p>:</span> <span class=n>max_val</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;reversal_count&#39;</span><span class=p>:</span> <span class=n>reversal_count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;avg_holding_period&#39;</span><span class=p>:</span> <span class=n>avg_holding_period</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;trend_following_score&#39;</span><span class=p>:</span> <span class=n>trend_following_score</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>results</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 执行参数敏感性分析</span>
</span></span><span class=line><span class=cl><span class=n>parameter_sensitivity</span> <span class=o>=</span> <span class=n>analyze_sar_parameter_sensitivity</span><span class=p>(</span><span class=n>high_prices</span><span class=p>,</span> <span class=n>low_prices</span><span class=p>,</span> <span class=n>close_prices</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== SAR参数敏感性分析 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;加速因子 | 最大值 | 反转次数 | 平均持仓 | 趋势跟踪得分&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;-&#34;</span> <span class=o>*</span> <span class=mi>55</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>parameter_sensitivity</span><span class=o>.</span><span class=n>head</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>row</span><span class=p>[</span><span class=s1>&#39;acceleration&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>8.2f</span><span class=si>}</span><span class=s2> | </span><span class=si>{</span><span class=n>row</span><span class=p>[</span><span class=s1>&#39;maximum&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>6.1f</span><span class=si>}</span><span class=s2> | </span><span class=si>{</span><span class=n>row</span><span class=p>[</span><span class=s1>&#39;reversal_count&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>9.0f</span><span class=si>}</span><span class=s2> | </span><span class=si>{</span><span class=n>row</span><span class=p>[</span><span class=s1>&#39;avg_holding_period&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>9.1f</span><span class=si>}</span><span class=s2> | </span><span class=si>{</span><span class=n>row</span><span class=p>[</span><span class=s1>&#39;trend_following_score&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>13.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 最优参数选择</span>
</span></span><span class=line><span class=cl><span class=n>best_params</span> <span class=o>=</span> <span class=n>parameter_sensitivity</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>parameter_sensitivity</span><span class=p>[</span><span class=s1>&#39;trend_following_score&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>idxmax</span><span class=p>()]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>最优参数组合:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;加速因子: </span><span class=si>{</span><span class=n>best_params</span><span class=p>[</span><span class=s1>&#39;acceleration&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>, 最大值: </span><span class=si>{</span><span class=n>best_params</span><span class=p>[</span><span class=s1>&#39;maximum&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;趋势跟踪得分: </span><span class=si>{</span><span class=n>best_params</span><span class=p>[</span><span class=s1>&#39;trend_following_score&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;预期反转次数: </span><span class=si>{</span><span class=n>best_params</span><span class=p>[</span><span class=s1>&#39;reversal_count&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.0f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;平均持仓周期: </span><span class=si>{</span><span class=n>best_params</span><span class=p>[</span><span class=s1>&#39;avg_holding_period&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>个交易日&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=sar可视化与综合策略>SAR可视化与综合策略</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span><span class=lnt>324
</span><span class=lnt>325
</span><span class=lnt>326
</span><span class=lnt>327
</span><span class=lnt>328
</span><span class=lnt>329
</span><span class=lnt>330
</span><span class=lnt>331
</span><span class=lnt>332
</span><span class=lnt>333
</span><span class=lnt>334
</span><span class=lnt>335
</span><span class=lnt>336
</span><span class=lnt>337
</span><span class=lnt>338
</span><span class=lnt>339
</span><span class=lnt>340
</span><span class=lnt>341
</span><span class=lnt>342
</span><span class=lnt>343
</span><span class=lnt>344
</span><span class=lnt>345
</span><span class=lnt>346
</span><span class=lnt>347
</span><span class=lnt>348
</span><span class=lnt>349
</span><span class=lnt>350
</span><span class=lnt>351
</span><span class=lnt>352
</span><span class=lnt>353
</span><span class=lnt>354
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># SAR可视化函数</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_sar_comprehensive_chart</span><span class=p>(</span><span class=n>sar_df</span><span class=p>,</span> <span class=n>title</span><span class=o>=</span><span class=s2>&#34;SAR抛物线转向指标综合分析&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;创建SAR综合分析图表&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>fig</span><span class=p>,</span> <span class=n>axes</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>15</span><span class=p>,</span> <span class=mi>12</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>fig</span><span class=o>.</span><span class=n>suptitle</span><span class=p>(</span><span class=n>title</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>16</span><span class=p>,</span> <span class=n>fontweight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 主图：价格与SAR</span>
</span></span><span class=line><span class=cl>    <span class=n>ax1</span> <span class=o>=</span> <span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>ax1</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;Date&#39;</span><span class=p>],</span> <span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>],</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;收盘价&#39;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;black&#39;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mf>1.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ax1</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;Date&#39;</span><span class=p>],</span> <span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;SAR&#39;</span><span class=p>],</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;SAR&#39;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;red&#39;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 标记反转信号</span>
</span></span><span class=line><span class=cl>    <span class=n>reversals</span> <span class=o>=</span> <span class=n>sar_df</span><span class=p>[</span><span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;SAR_Reversal&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=kc>True</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>reversals</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>ax1</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>reversals</span><span class=p>[</span><span class=s1>&#39;Date&#39;</span><span class=p>],</span> <span class=n>reversals</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>                   <span class=n>color</span><span class=o>=</span><span class=s1>&#39;blue&#39;</span><span class=p>,</span> <span class=n>marker</span><span class=o>=</span><span class=s1>&#39;o&#39;</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mi>50</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;SAR反转&#39;</span><span class=p>,</span> <span class=n>zorder</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 趋势区域着色</span>
</span></span><span class=line><span class=cl>    <span class=n>bullish_periods</span> <span class=o>=</span> <span class=n>sar_df</span><span class=p>[</span><span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;Trend_Direction&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;Bullish&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>bullish_periods</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>ax1</span><span class=o>.</span><span class=n>fill_between</span><span class=p>(</span><span class=n>bullish_periods</span><span class=p>[</span><span class=s1>&#39;Date&#39;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>                        <span class=n>bullish_periods</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>min</span><span class=p>()</span> <span class=o>*</span> <span class=mf>0.95</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                        <span class=n>bullish_periods</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>max</span><span class=p>()</span> <span class=o>*</span> <span class=mf>1.05</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>alpha</span><span class=o>=</span><span class=mf>0.1</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;green&#39;</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;上升趋势&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>bearish_periods</span> <span class=o>=</span> <span class=n>sar_df</span><span class=p>[</span><span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;Trend_Direction&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;Bearish&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>bearish_periods</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>ax1</span><span class=o>.</span><span class=n>fill_between</span><span class=p>(</span><span class=n>bearish_periods</span><span class=p>[</span><span class=s1>&#39;Date&#39;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>                        <span class=n>bearish_periods</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>min</span><span class=p>()</span> <span class=o>*</span> <span class=mf>0.95</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                        <span class=n>bearish_periods</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>max</span><span class=p>()</span> <span class=o>*</span> <span class=mf>1.05</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>alpha</span><span class=o>=</span><span class=mf>0.1</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;red&#39;</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;下降趋势&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>ax1</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;价格走势与SAR信号&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ax1</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=s1>&#39;价格&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ax1</span><span class=o>.</span><span class=n>legend</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>ax1</span><span class=o>.</span><span class=n>grid</span><span class=p>(</span><span class=kc>True</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 副图1：SAR距离分析</span>
</span></span><span class=line><span class=cl>    <span class=n>ax2</span> <span class=o>=</span> <span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>ax2</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;Date&#39;</span><span class=p>],</span> <span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;SAR_Distance_Pct&#39;</span><span class=p>],</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;purple&#39;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ax2</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span><span class=n>y</span><span class=o>=</span><span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;SAR_Distance_Pct&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>mean</span><span class=p>(),</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;red&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.7</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;平均距离&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ax2</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span><span class=n>y</span><span class=o>=</span><span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;SAR_Distance_Pct&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span> <span class=o>+</span> <span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;SAR_Distance_Pct&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>std</span><span class=p>(),</span> 
</span></span><span class=line><span class=cl>                <span class=n>color</span><span class=o>=</span><span class=s1>&#39;orange&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.7</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;+1标准差&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ax2</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span><span class=n>y</span><span class=o>=</span><span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;SAR_Distance_Pct&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span> <span class=o>-</span> <span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;SAR_Distance_Pct&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>std</span><span class=p>(),</span> 
</span></span><span class=line><span class=cl>                <span class=n>color</span><span class=o>=</span><span class=s1>&#39;orange&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.7</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;-1标准差&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>ax2</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;SAR距离百分比&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ax2</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=s1>&#39;距离 (%)&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ax2</span><span class=o>.</span><span class=n>legend</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>ax2</span><span class=o>.</span><span class=n>grid</span><span class=p>(</span><span class=kc>True</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 副图2：趋势强度</span>
</span></span><span class=line><span class=cl>    <span class=n>ax3</span> <span class=o>=</span> <span class=n>axes</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>strength_data</span> <span class=o>=</span> <span class=n>sar_df</span><span class=p>[</span><span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;Trend_Strength&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>strength_data</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>ax3</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>strength_data</span><span class=p>[</span><span class=s1>&#39;Date&#39;</span><span class=p>],</span> <span class=n>strength_data</span><span class=p>[</span><span class=s1>&#39;Trend_Strength&#39;</span><span class=p>],</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;blue&#39;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ax3</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span><span class=n>y</span><span class=o>=</span><span class=mf>1.0</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;red&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.7</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;强趋势阈值&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ax3</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span><span class=n>y</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;orange&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.7</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;中趋势阈值&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ax3</span><span class=o>.</span><span class=n>fill_between</span><span class=p>(</span><span class=n>strength_data</span><span class=p>[</span><span class=s1>&#39;Date&#39;</span><span class=p>],</span> <span class=mi>0</span><span class=p>,</span> <span class=n>strength_data</span><span class=p>[</span><span class=s1>&#39;Trend_Strength&#39;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>                        <span class=n>alpha</span><span class=o>=</span><span class=mf>0.3</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;blue&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>ax3</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;SAR趋势强度&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ax3</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=s1>&#39;强度值&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ax3</span><span class=o>.</span><span class=n>set_xlabel</span><span class=p>(</span><span class=s1>&#39;日期&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ax3</span><span class=o>.</span><span class=n>legend</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>ax3</span><span class=o>.</span><span class=n>grid</span><span class=p>(</span><span class=kc>True</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>tight_layout</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>fig</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建SAR综合分析图表</span>
</span></span><span class=line><span class=cl><span class=n>fig</span> <span class=o>=</span> <span class=n>create_sar_comprehensive_chart</span><span class=p>(</span><span class=n>sar_df</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># SAR交易策略回测</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>backtest_sar_strategy</span><span class=p>(</span><span class=n>sar_df</span><span class=p>,</span> <span class=n>initial_capital</span><span class=o>=</span><span class=mi>100000</span><span class=p>,</span> <span class=n>transaction_cost</span><span class=o>=</span><span class=mf>0.001</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;SAR交易策略回测&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span> <span class=o>=</span> <span class=n>sar_df</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>capital</span> <span class=o>=</span> <span class=n>initial_capital</span>
</span></span><span class=line><span class=cl>    <span class=n>position</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>trades</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>portfolio_values</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>df</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=n>current_price</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>current_sar</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=s1>&#39;SAR&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>prev_price</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>prev_sar</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=s1>&#39;SAR&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># SAR信号</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>prev_price</span> <span class=o>&gt;</span> <span class=n>prev_sar</span> <span class=ow>and</span> <span class=n>current_price</span> <span class=o>&lt;</span> <span class=n>current_sar</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 多头转空头，卖出</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>position</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>sell_amount</span> <span class=o>=</span> <span class=n>position</span> <span class=o>*</span> <span class=n>current_price</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>transaction_cost</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>capital</span> <span class=o>+=</span> <span class=n>sell_amount</span>
</span></span><span class=line><span class=cl>                <span class=n>trades</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;date&#39;</span><span class=p>:</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=s1>&#39;Date&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;action&#39;</span><span class=p>:</span> <span class=s1>&#39;SELL&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;price&#39;</span><span class=p>:</span> <span class=n>current_price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;shares&#39;</span><span class=p>:</span> <span class=n>position</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;value&#39;</span><span class=p>:</span> <span class=n>sell_amount</span>
</span></span><span class=line><span class=cl>                <span class=p>})</span>
</span></span><span class=line><span class=cl>                <span class=n>position</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>prev_price</span> <span class=o>&lt;</span> <span class=n>prev_sar</span> <span class=ow>and</span> <span class=n>current_price</span> <span class=o>&gt;</span> <span class=n>current_sar</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 空头转多头，买入</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>position</span> <span class=o>==</span> <span class=mi>0</span> <span class=ow>and</span> <span class=n>capital</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>shares_to_buy</span> <span class=o>=</span> <span class=n>capital</span> <span class=o>/</span> <span class=p>(</span><span class=n>current_price</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>+</span> <span class=n>transaction_cost</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=n>position</span> <span class=o>=</span> <span class=n>shares_to_buy</span>
</span></span><span class=line><span class=cl>                <span class=n>cost</span> <span class=o>=</span> <span class=n>shares_to_buy</span> <span class=o>*</span> <span class=n>current_price</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>+</span> <span class=n>transaction_cost</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>capital</span> <span class=o>-=</span> <span class=n>cost</span>
</span></span><span class=line><span class=cl>                <span class=n>trades</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;date&#39;</span><span class=p>:</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=s1>&#39;Date&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;action&#39;</span><span class=p>:</span> <span class=s1>&#39;BUY&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;price&#39;</span><span class=p>:</span> <span class=n>current_price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;shares&#39;</span><span class=p>:</span> <span class=n>shares_to_buy</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;value&#39;</span><span class=p>:</span> <span class=n>cost</span>
</span></span><span class=line><span class=cl>                <span class=p>})</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 计算组合价值</span>
</span></span><span class=line><span class=cl>        <span class=n>portfolio_value</span> <span class=o>=</span> <span class=n>capital</span> <span class=o>+</span> <span class=n>position</span> <span class=o>*</span> <span class=n>current_price</span>
</span></span><span class=line><span class=cl>        <span class=n>portfolio_values</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;date&#39;</span><span class=p>:</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=s1>&#39;Date&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;portfolio_value&#39;</span><span class=p>:</span> <span class=n>portfolio_value</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;position&#39;</span><span class=p>:</span> <span class=n>position</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;price&#39;</span><span class=p>:</span> <span class=n>current_price</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 最后平仓</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>position</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>final_price</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>sell_amount</span> <span class=o>=</span> <span class=n>position</span> <span class=o>*</span> <span class=n>final_price</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>transaction_cost</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>capital</span> <span class=o>+=</span> <span class=n>sell_amount</span>
</span></span><span class=line><span class=cl>        <span class=n>trades</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;date&#39;</span><span class=p>:</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=s1>&#39;Date&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;action&#39;</span><span class=p>:</span> <span class=s1>&#39;SELL&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;price&#39;</span><span class=p>:</span> <span class=n>final_price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;shares&#39;</span><span class=p>:</span> <span class=n>position</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;value&#39;</span><span class=p>:</span> <span class=n>sell_amount</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=n>position</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>final_value</span> <span class=o>=</span> <span class=n>capital</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 计算收益率</span>
</span></span><span class=line><span class=cl>    <span class=n>total_return</span> <span class=o>=</span> <span class=p>(</span><span class=n>final_value</span> <span class=o>-</span> <span class=n>initial_capital</span><span class=p>)</span> <span class=o>/</span> <span class=n>initial_capital</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 计算年化收益率</span>
</span></span><span class=line><span class=cl>    <span class=n>days</span> <span class=o>=</span> <span class=p>(</span><span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=s1>&#39;Date&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;Date&#39;</span><span class=p>])</span><span class=o>.</span><span class=n>days</span>
</span></span><span class=line><span class=cl>    <span class=n>years</span> <span class=o>=</span> <span class=n>days</span> <span class=o>/</span> <span class=mf>365.25</span>
</span></span><span class=line><span class=cl>    <span class=n>annual_return</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span> <span class=o>+</span> <span class=n>total_return</span><span class=p>)</span> <span class=o>**</span> <span class=p>(</span><span class=mi>1</span><span class=o>/</span><span class=n>years</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span> <span class=k>if</span> <span class=n>years</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 计算最大回撤</span>
</span></span><span class=line><span class=cl>    <span class=n>portfolio_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>portfolio_values</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>portfolio_df</span><span class=p>[</span><span class=s1>&#39;cummax&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>portfolio_df</span><span class=p>[</span><span class=s1>&#39;portfolio_value&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>cummax</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>portfolio_df</span><span class=p>[</span><span class=s1>&#39;drawdown&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>portfolio_df</span><span class=p>[</span><span class=s1>&#39;portfolio_value&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=n>portfolio_df</span><span class=p>[</span><span class=s1>&#39;cummax&#39;</span><span class=p>])</span> <span class=o>/</span> <span class=n>portfolio_df</span><span class=p>[</span><span class=s1>&#39;cummax&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>max_drawdown</span> <span class=o>=</span> <span class=n>portfolio_df</span><span class=p>[</span><span class=s1>&#39;drawdown&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>min</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 计算胜率</span>
</span></span><span class=line><span class=cl>    <span class=n>winning_trades</span> <span class=o>=</span> <span class=nb>len</span><span class=p>([</span><span class=n>t</span> <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>trades</span> <span class=k>if</span> <span class=n>t</span><span class=p>[</span><span class=s1>&#39;action&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;SELL&#39;</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>trades</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>total_trades</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>trades</span><span class=p>)</span> <span class=o>//</span> <span class=mi>2</span>  <span class=c1># 买入卖出算一次完整交易</span>
</span></span><span class=line><span class=cl>    <span class=n>win_rate</span> <span class=o>=</span> <span class=n>winning_trades</span> <span class=o>/</span> <span class=n>total_trades</span> <span class=k>if</span> <span class=n>total_trades</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;total_return&#39;</span><span class=p>:</span> <span class=n>total_return</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;annual_return&#39;</span><span class=p>:</span> <span class=n>annual_return</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;max_drawdown&#39;</span><span class=p>:</span> <span class=n>max_drawdown</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;win_rate&#39;</span><span class=p>:</span> <span class=n>win_rate</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;total_trades&#39;</span><span class=p>:</span> <span class=n>total_trades</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;final_value&#39;</span><span class=p>:</span> <span class=n>final_value</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;trades&#39;</span><span class=p>:</span> <span class=n>trades</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;portfolio_values&#39;</span><span class=p>:</span> <span class=n>portfolio_values</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 执行SAR策略回测</span>
</span></span><span class=line><span class=cl><span class=n>backtest_results</span> <span class=o>=</span> <span class=n>backtest_sar_strategy</span><span class=p>(</span><span class=n>sar_df</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=== SAR交易策略回测结果 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;总收益率: </span><span class=si>{</span><span class=n>backtest_results</span><span class=p>[</span><span class=s1>&#39;total_return&#39;</span><span class=p>]</span><span class=o>*</span><span class=mi>100</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;年化收益率: </span><span class=si>{</span><span class=n>backtest_results</span><span class=p>[</span><span class=s1>&#39;annual_return&#39;</span><span class=p>]</span><span class=o>*</span><span class=mi>100</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;最大回撤: </span><span class=si>{</span><span class=n>backtest_results</span><span class=p>[</span><span class=s1>&#39;max_drawdown&#39;</span><span class=p>]</span><span class=o>*</span><span class=mi>100</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;胜率: </span><span class=si>{</span><span class=n>backtest_results</span><span class=p>[</span><span class=s1>&#39;win_rate&#39;</span><span class=p>]</span><span class=o>*</span><span class=mi>100</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;总交易次数: </span><span class=si>{</span><span class=n>backtest_results</span><span class=p>[</span><span class=s1>&#39;total_trades&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;最终资产价值: ¥</span><span class=si>{</span><span class=n>backtest_results</span><span class=p>[</span><span class=s1>&#39;final_value&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>,.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 与买入持有策略对比</span>
</span></span><span class=line><span class=cl><span class=n>buy_hold_return</span> <span class=o>=</span> <span class=p>(</span><span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>/</span> <span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>days</span> <span class=o>=</span> <span class=p>(</span><span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;Date&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=n>sar_df</span><span class=p>[</span><span class=s1>&#39;Date&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=o>.</span><span class=n>days</span>
</span></span><span class=line><span class=cl><span class=n>years</span> <span class=o>=</span> <span class=n>days</span> <span class=o>/</span> <span class=mf>365.25</span>
</span></span><span class=line><span class=cl><span class=n>buy_hold_annual</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span> <span class=o>+</span> <span class=n>buy_hold_return</span><span class=p>)</span> <span class=o>**</span> <span class=p>(</span><span class=mi>1</span><span class=o>/</span><span class=n>years</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span> <span class=k>if</span> <span class=n>years</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 与买入持有策略对比 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;买入持有总收益: </span><span class=si>{</span><span class=n>buy_hold_return</span><span class=o>*</span><span class=mi>100</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;买入持有年化收益: </span><span class=si>{</span><span class=n>buy_hold_annual</span><span class=o>*</span><span class=mi>100</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;SAR策略超额收益: </span><span class=si>{</span><span class=p>(</span><span class=n>backtest_results</span><span class=p>[</span><span class=s1>&#39;total_return&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=n>buy_hold_return</span><span class=p>)</span><span class=o>*</span><span class=mi>100</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># SAR与趋势指标组合策略</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_sar_trend_strategy</span><span class=p>(</span><span class=n>sar_df</span><span class=p>,</span> <span class=n>ma_period</span><span class=o>=</span><span class=mi>20</span><span class=p>,</span> <span class=n>adx_period</span><span class=o>=</span><span class=mi>14</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;SAR与趋势指标组合策略&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span> <span class=o>=</span> <span class=n>sar_df</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 计算辅助指标</span>
</span></span><span class=line><span class=cl>    <span class=n>close_prices</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
</span></span><span class=line><span class=cl>    <span class=n>high_prices</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;High&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
</span></span><span class=line><span class=cl>    <span class=n>low_prices</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;Low&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 移动平均线</span>
</span></span><span class=line><span class=cl>    <span class=n>ma</span> <span class=o>=</span> <span class=n>talib</span><span class=o>.</span><span class=n>SMA</span><span class=p>(</span><span class=n>close_prices</span><span class=p>,</span> <span class=n>timeperiod</span><span class=o>=</span><span class=n>ma_period</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ADX趋势强度</span>
</span></span><span class=line><span class=cl>    <span class=n>adx</span> <span class=o>=</span> <span class=n>talib</span><span class=o>.</span><span class=n>ADX</span><span class=p>(</span><span class=n>high_prices</span><span class=p>,</span> <span class=n>low_prices</span><span class=p>,</span> <span class=n>close_prices</span><span class=p>,</span> <span class=n>timeperiod</span><span class=o>=</span><span class=n>adx_period</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 添加到数据框</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=p>[</span><span class=s1>&#39;MA&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>ma</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=p>[</span><span class=s1>&#39;ADX&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>adx</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=p>[</span><span class=s1>&#39;MA_Signal&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>close_prices</span> <span class=o>&gt;</span> <span class=n>ma</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=p>[</span><span class=s1>&#39;ADX_Signal&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>adx</span> <span class=o>&gt;</span> <span class=mi>25</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>  <span class=c1># ADX &gt; 25认为趋势强劲</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 组合信号</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=p>[</span><span class=s1>&#39;Combined_Signal&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>df</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=n>sar_signal</span> <span class=o>=</span> <span class=mi>1</span> <span class=k>if</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=s1>&#39;SAR&#39;</span><span class=p>]</span> <span class=k>else</span> <span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=n>ma_signal</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=s1>&#39;MA_Signal&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>adx_signal</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=s1>&#39;ADX_Signal&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># SAR信号 + MA确认 + ADX趋势强度过滤</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>sar_signal</span> <span class=o>==</span> <span class=mi>1</span> <span class=ow>and</span> <span class=n>ma_signal</span> <span class=o>==</span> <span class=mi>1</span> <span class=ow>and</span> <span class=n>adx_signal</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>df</span><span class=o>.</span><span class=n>columns</span><span class=o>.</span><span class=n>get_loc</span><span class=p>(</span><span class=s1>&#39;Combined_Signal&#39;</span><span class=p>)]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>sar_signal</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span> <span class=ow>and</span> <span class=n>ma_signal</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span> <span class=ow>and</span> <span class=n>adx_signal</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>df</span><span class=o>.</span><span class=n>columns</span><span class=o>.</span><span class=n>get_loc</span><span class=p>(</span><span class=s1>&#39;Combined_Signal&#39;</span><span class=p>)]</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>df</span><span class=o>.</span><span class=n>columns</span><span class=o>.</span><span class=n>get_loc</span><span class=p>(</span><span class=s1>&#39;Combined_Signal&#39;</span><span class=p>)]</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>df</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建组合策略</span>
</span></span><span class=line><span class=cl><span class=n>combined_strategy_df</span> <span class=o>=</span> <span class=n>create_sar_trend_strategy</span><span class=p>(</span><span class=n>sar_df</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 分析组合策略信号</span>
</span></span><span class=line><span class=cl><span class=n>combined_signals</span> <span class=o>=</span> <span class=n>combined_strategy_df</span><span class=p>[</span><span class=n>combined_strategy_df</span><span class=p>[</span><span class=s1>&#39;Combined_Signal&#39;</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== SAR组合策略分析 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;总信号数量: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>combined_signals</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;多头信号: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>combined_signals</span><span class=p>[</span><span class=n>combined_signals</span><span class=p>[</span><span class=s1>&#39;Combined_Signal&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=mi>1</span><span class=p>])</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;空头信号: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>combined_signals</span><span class=p>[</span><span class=n>combined_signals</span><span class=p>[</span><span class=s1>&#39;Combined_Signal&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>])</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>combined_signals</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;最近信号日期: </span><span class=si>{</span><span class=n>combined_signals</span><span class=p>[</span><span class=s1>&#39;Date&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%Y-%m-</span><span class=si>%d</span><span class=s1>&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;最近信号类型: </span><span class=si>{</span><span class=s1>&#39;多头&#39;</span> <span class=k>if</span> <span class=n>combined_signals</span><span class=p>[</span><span class=s1>&#39;Combined_Signal&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=mi>1</span> <span class=k>else</span> <span class=s1>&#39;空头&#39;</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># SAR策略风险评估</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>assess_sar_risk</span><span class=p>(</span><span class=n>sar_df</span><span class=p>,</span> <span class=n>window</span><span class=o>=</span><span class=mi>20</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;评估SAR策略风险&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span> <span class=o>=</span> <span class=n>sar_df</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 计算收益波动率</span>
</span></span><span class=line><span class=cl>    <span class=n>returns</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>pct_change</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>volatility</span> <span class=o>=</span> <span class=n>returns</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=n>window</span><span class=p>)</span><span class=o>.</span><span class=n>std</span><span class=p>()</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=mi>252</span><span class=p>)</span>  <span class=c1># 年化波动率</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 计算SAR信号频率</span>
</span></span><span class=line><span class=cl>    <span class=n>signal_changes</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;Trend_Direction&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>ne</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;Trend_Direction&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>shift</span><span class=p>())</span><span class=o>.</span><span class=n>cumsum</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>signal_frequency</span> <span class=o>=</span> <span class=n>signal_changes</span><span class=o>.</span><span class=n>diff</span><span class=p>()</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=n>window</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 计算趋势稳定性</span>
</span></span><span class=line><span class=cl>    <span class=n>trend_duration</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;Trend_Duration&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>trend_stability</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>/</span> <span class=p>(</span><span class=n>trend_duration</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=n>window</span><span class=p>)</span><span class=o>.</span><span class=n>std</span><span class=p>()</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 计算价格-SAR偏离度</span>
</span></span><span class=line><span class=cl>    <span class=n>price_sar_deviation</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;SAR_Distance_Pct&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>extreme_deviation</span> <span class=o>=</span> <span class=n>price_sar_deviation</span> <span class=o>&gt;</span> <span class=p>(</span><span class=n>price_sar_deviation</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span> <span class=o>+</span> <span class=mi>2</span> <span class=o>*</span> <span class=n>price_sar_deviation</span><span class=o>.</span><span class=n>std</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;current_volatility&#39;</span><span class=p>:</span> <span class=n>volatility</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>volatility</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;avg_volatility&#39;</span><span class=p>:</span> <span class=n>volatility</span><span class=o>.</span><span class=n>mean</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;signal_frequency&#39;</span><span class=p>:</span> <span class=n>signal_frequency</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>signal_frequency</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;trend_stability&#39;</span><span class=p>:</span> <span class=n>trend_stability</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>trend_stability</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;extreme_deviation_pct&#39;</span><span class=p>:</span> <span class=n>extreme_deviation</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span> <span class=o>*</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;max_deviation&#39;</span><span class=p>:</span> <span class=n>price_sar_deviation</span><span class=o>.</span><span class=n>max</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;avg_deviation&#39;</span><span class=p>:</span> <span class=n>price_sar_deviation</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>risk_assessment</span> <span class=o>=</span> <span class=n>assess_sar_risk</span><span class=p>(</span><span class=n>sar_df</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== SAR策略风险评估 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;当前波动率: </span><span class=si>{</span><span class=n>risk_assessment</span><span class=p>[</span><span class=s1>&#39;current_volatility&#39;</span><span class=p>]</span><span class=o>*</span><span class=mi>100</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;平均波动率: </span><span class=si>{</span><span class=n>risk_assessment</span><span class=p>[</span><span class=s1>&#39;avg_volatility&#39;</span><span class=p>]</span><span class=o>*</span><span class=mi>100</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;信号频率: </span><span class=si>{</span><span class=n>risk_assessment</span><span class=p>[</span><span class=s1>&#39;signal_frequency&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>次/日&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;趋势稳定性: </span><span class=si>{</span><span class=n>risk_assessment</span><span class=p>[</span><span class=s1>&#39;trend_stability&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.3f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;极端偏离频率: </span><span class=si>{</span><span class=n>risk_assessment</span><span class=p>[</span><span class=s1>&#39;extreme_deviation_pct&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;最大偏离度: </span><span class=si>{</span><span class=n>risk_assessment</span><span class=p>[</span><span class=s1>&#39;max_deviation&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;平均偏离度: </span><span class=si>{</span><span class=n>risk_assessment</span><span class=p>[</span><span class=s1>&#39;avg_deviation&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 风险等级评估</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_risk_level</span><span class=p>(</span><span class=n>risk_metrics</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;计算综合风险等级&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>score</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 波动率风险 (0-30分)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>risk_metrics</span><span class=p>[</span><span class=s1>&#39;current_volatility&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mf>0.3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>score</span> <span class=o>+=</span> <span class=mi>30</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>risk_metrics</span><span class=p>[</span><span class=s1>&#39;current_volatility&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mf>0.2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>score</span> <span class=o>+=</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>risk_metrics</span><span class=p>[</span><span class=s1>&#39;current_volatility&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mf>0.1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>score</span> <span class=o>+=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 信号频率风险 (0-25分)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>risk_metrics</span><span class=p>[</span><span class=s1>&#39;signal_frequency&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mf>0.1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>score</span> <span class=o>+=</span> <span class=mi>25</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>risk_metrics</span><span class=p>[</span><span class=s1>&#39;signal_frequency&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mf>0.05</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>score</span> <span class=o>+=</span> <span class=mi>15</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>risk_metrics</span><span class=p>[</span><span class=s1>&#39;signal_frequency&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mf>0.02</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>score</span> <span class=o>+=</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 偏离度风险 (0-25分)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>risk_metrics</span><span class=p>[</span><span class=s1>&#39;max_deviation&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>10</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>score</span> <span class=o>+=</span> <span class=mi>25</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>risk_metrics</span><span class=p>[</span><span class=s1>&#39;max_deviation&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>5</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>score</span> <span class=o>+=</span> <span class=mi>15</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>risk_metrics</span><span class=p>[</span><span class=s1>&#39;max_deviation&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>score</span> <span class=o>+=</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 趋势稳定性风险 (0-20分)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>risk_metrics</span><span class=p>[</span><span class=s1>&#39;trend_stability&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mf>0.3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>score</span> <span class=o>+=</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>risk_metrics</span><span class=p>[</span><span class=s1>&#39;trend_stability&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mf>0.5</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>score</span> <span class=o>+=</span> <span class=mi>12</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>risk_metrics</span><span class=p>[</span><span class=s1>&#39;trend_stability&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mf>0.7</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>score</span> <span class=o>+=</span> <span class=mi>6</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 风险等级</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>score</span> <span class=o>&gt;=</span> <span class=mi>70</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;高风险&#34;</span><span class=p>,</span> <span class=n>score</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>score</span> <span class=o>&gt;=</span> <span class=mi>40</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;中风险&#34;</span><span class=p>,</span> <span class=n>score</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;低风险&#34;</span><span class=p>,</span> <span class=n>score</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>risk_level</span><span class=p>,</span> <span class=n>risk_score</span> <span class=o>=</span> <span class=n>calculate_risk_level</span><span class=p>(</span><span class=n>risk_assessment</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>综合风险等级: </span><span class=si>{</span><span class=n>risk_level</span><span class=si>}</span><span class=s2> (评分: </span><span class=si>{</span><span class=n>risk_score</span><span class=si>}</span><span class=s2>/100)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 投资建议</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== SAR策略投资建议 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>risk_level</span> <span class=o>==</span> <span class=s2>&#34;低风险&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;✓ 当前市场环境适合使用SAR策略&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;✓ 建议采用标准参数设置&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;✓ 可适当增加仓位配置&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=n>risk_level</span> <span class=o>==</span> <span class=s2>&#34;中风险&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;⚠ 当前市场环境存在一定不确定性&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;⚠ 建议采用保守参数设置&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;⚠ 建议降低仓位配置并加强风险控制&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;⚠ 当前市场环境风险较高&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;⚠ 建议暂停使用SAR策略或采用非常保守的参数&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;⚠ 建议严格控制仓位并设置更严格的止损&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=sar指标高级应用与实战技巧>SAR指标高级应用与实战技巧</h2><h3 id=多时间框架sar分析>多时间框架SAR分析</h3><p>SAR指标在不同时间框架下展现出独特的分析价值。短期SAR（5-15分钟）适合日内交易，能够捕捉短期价格波动；中期SAR（日线级别）适合波段操作，能够识别中期趋势转折；长期SAR（周线级别）适合趋势投资，能够把握主要市场方向。</p><p><strong>时间框架协同策略</strong>：当多个时间框架的SAR信号出现共振时，交易信号的可靠性显著提升。例如，当日线SAR和周线SAR同时发出多头信号时，上涨概率大幅增加；当短周期SAR与长周期SAR出现背离时，需要警惕趋势反转风险。</p><p><strong>时间框架过滤机制</strong>：使用长周期SAR确定主要趋势方向，用短周期SAR寻找具体入场时机。这种"大周期定向，小周期择时"的策略能够有效提高交易胜率，降低假信号干扰。</p><h3 id=sar与其他技术指标的组合应用>SAR与其他技术指标的组合应用</h3><p><strong>SAR+均线系统</strong>：将SAR与移动平均线结合使用，SAR提供动态止损，均线提供趋势确认。当价格位于均线上方且SAR位于价格下方时，形成强势多头信号；当价格跌破均线且SAR位于价格上方时，确认趋势反转。</p><p><strong>SAR+动量指标</strong>：结合RSI、MACD等动量指标，可以过滤SAR的假信号。当SAR发出反转信号但动量指标未确认时，需要谨慎对待；当SAR信号与动量指标出现背离时，往往预示着重要转折点。</p><p><strong>SAR+成交量分析</strong>：成交量能够验证SAR信号的有效性。SAR反转信号配合成交量放大，信号可靠性更高；SAR信号出现但成交量萎缩，可能是假突破。</p><h3 id=sar参数动态优化>SAR参数动态优化</h3><p><strong>市场环境适应性调整</strong>：在趋势明显的市场中，可以适当提高加速因子，使SAR更紧密地跟踪价格；在震荡市场中，应该降低加速因子，减少假信号产生。</p><p><strong>品种特性参数优化</strong>：不同交易品种具有不同的波动特性。高波动品种需要更大的加速因子最大值，低波动品种适合较小的参数设置。通过历史回测可以找到最适合特定品种的最优参数组合。</p><p><strong>动态参数调整机制</strong>：根据市场波动率、趋势强度等指标动态调整SAR参数。当市场波动率上升时，适当降低加速因子；当趋势强度增加时，适度提高加速因子。</p><h3 id=sar风险管理策略>SAR风险管理策略</h3><p><strong>分级止损机制</strong>：设置多重SAR止损线，包括保守止损、标准止损和激进止损。根据市场环境和持仓盈亏状况选择合适的止损线，实现风险的分级管理。</p><p><strong>时间止损策略</strong>：结合SAR的时间特性设置时间止损。当持仓时间超过预期但价格仍未达到目标时，考虑主动平仓；当SAR长时间未触发但趋势明显减弱时，提前止盈。</p><p><strong>资金管理优化</strong>：根据SAR信号的可靠性调整仓位大小。高可靠性信号可以适当加大仓位，低可靠性信号应该减小仓位；连续亏损后降低仓位，连续盈利后谨慎加仓。</p><h2 id=sar指标优势与局限性分析>SAR指标优势与局限性分析</h2><h3 id=sar指标核心优势>SAR指标核心优势</h3><p><strong>时间-价格双重保护</strong>：SAR指标独创性地将时间因素纳入止损机制，通过抛物线轨迹实现时间衰减效应。这种设计使得止损价位能够随时间推移而加速调整，为投资者提供时间维度的风险保护，有效避免传统止损方法的时间滞后问题。</p><p><strong>自适应趋势跟踪</strong>：SAR指标具备智能化的自适应特性，能够根据市场趋势强度自动调整跟踪速度。在强势趋势中，SAR轨迹加速追赶价格，确保利润最大化；在弱势趋势中，SAR轨迹减速运行，避免过早出场，体现了"让利润奔跑，让亏损止步"的交易理念。</p><p><strong>清晰直观的信号系统</strong>：SAR指标提供二元化的信号输出，价格与SAR的相对位置明确指示市场状态，不存在模糊地带。这种简单明了的信号机制降低了交易决策的复杂度，特别适合趋势跟踪和系统化交易策略。</p><p><strong>多周期通用性</strong>：SAR指标在不同时间框架下都具有良好的适用性，从分钟级别到月线级别都能提供有效的分析价值。这种多周期通用性使得SAR指标能够满足不同交易风格和投资周期的需求。</p><h3 id=sar指标主要局限>SAR指标主要局限</h3><p><strong>震荡市场表现不佳</strong>：SAR指标的设计初衷是趋势跟踪，在震荡市场中会产生大量假信号。价格频繁穿越SAR轨迹导致信号频繁反转，容易造成连续亏损，这是SAR指标最主要的局限性。</p><p><strong>参数敏感性较高</strong>：SAR指标对加速因子和最大值参数较为敏感，不同市场环境下需要调整参数设置。参数选择不当可能导致信号过于敏感或过于滞后，影响交易效果。</p><p><strong>缺乏前瞻性</strong>：SAR指标是基于历史价格数据计算的滞后指标，无法预测未来价格走势。在趋势转折初期，SAR指标往往需要一定时间才能确认反转信号，存在天然的滞后性。</p><p><strong>忽略基本面因素</strong>：SAR指标纯粹基于价格数据计算，完全忽略基本面因素的影响。在重要经济数据发布、政策变化等基本面事件发生时，SAR指标可能给出与市场基本面相悖的信号。</p><h3 id=sar指标优化改进方向>SAR指标优化改进方向</h3><p><strong>结合波动率调整</strong>：引入市场波动率指标动态调整SAR参数，在高波动环境中降低加速因子，在低波动环境中提高加速因子，增强指标的适应性。</p><p><strong>多指标过滤机制</strong>：通过与其他技术指标组合使用，建立多重过滤机制，减少假信号产生。特别是结合趋势类指标和动量类指标，可以显著提高信号质量。</p><p><strong>机器学习优化</strong>：运用机器学习算法对SAR参数进行优化，根据历史数据训练最优参数组合，实现参数的智能化调整。</p><p><strong>基本面融合策略</strong>：将基本面分析融入SAR交易体系，在重要基本面事件发生时调整SAR策略，避免纯粹技术分析的局限性。</p><h2 id=sar指标实战应用要点>SAR指标实战应用要点</h2><h3 id=策略选择与环境判断>策略选择与环境判断</h3><p><strong>趋势确认优先原则</strong>：在使用SAR指标前，必须先确认市场处于趋势状态。可以通过ADX指标、均线排列、价格通道等方法判断趋势强度，只有在趋势明确的市场环境中才使用SAR策略。</p><p><strong>市场环境适应性</strong>：根据市场波动性调整SAR策略。低波动市场适合标准参数，高波动市场需要降低加速因子；趋势明显的市场可以延长持仓时间，震荡加剧的市场应该缩短持仓周期。</p><p><strong>品种选择策略</strong>：选择趋势性较强、波动性适中的交易品种。避免在极度震荡或趋势性极弱的品种上使用SAR策略，优先考虑具有明显趋势特征的股票、商品或货币对。</p><h3 id=风险控制与资金管理>风险控制与资金管理</h3><p><strong>严格止损纪律</strong>：SAR策略的核心是趋势跟踪，必须严格执行SAR止损信号。不能因为短期浮亏而违背止损纪律，也不能因为主观判断而忽略SAR反转信号。</p><p><strong>仓位管理优化</strong>：根据SAR信号的可靠性调整仓位大小。可以通过历史回测确定不同市场环境下的最优仓位配置，实现风险调整后的收益最大化。</p><p><strong>组合风险控制</strong>：将SAR策略作为投资组合的一部分，通过多策略组合降低整体风险。避免过度依赖单一指标，建立多层次的风险控制体系。</p><h3 id=持续优化与策略改进>持续优化与策略改进</h3><p><strong>定期策略评估</strong>：定期对SAR策略的表现进行评估，分析胜率、盈亏比、最大回撤等关键指标，及时发现策略失效的迹象。</p><p><strong>参数动态调整</strong>：根据市场环境变化动态调整SAR参数，避免固定参数导致的策略失效。建立参数优化的制度化流程。</p><p><strong>交易心理管理</strong>：SAR策略需要良好的交易心理素质，特别是在连续亏损期间保持纪律性。建立完善的交易心理管理体系，确保策略执行的稳定性。</p><p>SAR抛物线转向指标作为技术分析领域的经典工具，通过其独特的抛物线轨迹为投资者提供了动态止损和趋势跟踪的有效方法。深入理解SAR指标的计算原理、信号识别和应用技巧，结合严格的风险管理措施，能够在趋势市场中获得稳定的投资收益。然而，投资者也必须清醒认识到SAR指标的局限性，在震荡市场中谨慎使用，并通过多指标组合和参数优化不断提升策略的有效性。</p></div></article><aside class="lg:w-80 xl:w-96"><div class=space-y-8></div></aside></div><nav class="border-t border-gray-200 mt-12 pt-8"><div class="flex justify-between items-center"><a href=/blog/%E6%8A%80%E6%9C%AF%E6%8C%87%E6%A0%87/07-adx%E5%B9%B3%E5%9D%87%E8%B6%8B%E5%90%91%E6%8C%87%E6%95%B0/ class="group flex items-center"><svg class="w-5 h-5 mr-2 text-gray-600 group-hover:text-primary-600" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0 7-7m-7 7h18"/></svg><div><div class="text-sm text-gray-600">上一篇</div><div class="font-medium group-hover:text-primary-600">技术指标第7讲：ADX平均趋向指数</div></div></a><a href=/blog/%E6%8A%80%E6%9C%AF%E6%8C%87%E6%A0%87/09-%E5%A4%9A%E6%8C%87%E6%A0%87%E7%BB%BC%E5%90%88%E5%88%86%E6%9E%90%E7%AD%96%E7%95%A5/ class="group flex items-center text-right"><div><div class="text-sm text-gray-600">Next Post</div><div class="font-medium group-hover:text-primary-600">技术指标第9讲：多指标综合分析策略</div></div><svg class="w-5 h-5 ml-2 text-gray-600 group-hover:text-primary-600" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0-7 7m7-7H3"/></svg></a></div></nav></div></div><footer class="bg-gray-50 py-12 border-t border-gray-200"><div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl"><div class="flex flex-col md:flex-row justify-between space-y-4 md:space-y-0"><div class=flex-1><div class="flex items-center space-x-3 mb-4"><a href=https://sk-quant.github.io/ class=inline-block><img src=/images/logo.svg alt=烧烤量化 class=h-6>
</a><span class="text-xl font-bold text-gray-900">烧烤量化</span></div><div class="flex space-x-3 p-2"><a href=https://linkedin.com/in/yourusername class="text-gray-600 hover:text-gray-900" target=_blank rel="noopener noreferrer"><span class=sr-only>LinkedIn</span>
<img src=/images/social/linkedin.svg alt=LinkedIn class="h-5 w-5">
</a><a href=https://bsky.app/profile/yourblueskyhandle class="text-gray-600 hover:text-gray-900" target=_blank rel="noopener noreferrer"><span class=sr-only>Bluesky</span>
<img src=/images/social/bluesky.svg alt=Bluesky class="h-5 w-5">
</a><a href=https://twitter.com/yourusername class="text-gray-600 hover:text-gray-900" target=_blank rel="noopener noreferrer"><span class=sr-only>Twitter (X)</span>
<img src=/images/social/twitter.svg alt=Twitter class="h-5 w-5">
</a><a href=https://github.com/yourusername class="text-gray-600 hover:text-gray-900" target=_blank rel="noopener noreferrer"><span class=sr-only>GitHub</span>
<img src=/images/social/github.svg alt=GitHub class="h-5 w-5"></a></div></div><div class=flex-1><h3 class="text-sm font-semibold uppercase tracking-wider text-gray-900 mb-4"></h3><ul class=space-y-2></ul></div><div class=flex-1><h3 class="text-sm font-semibold uppercase tracking-wider text-gray-900 mb-4"></h3><ul class=space-y-2></ul></div><div class=flex-1><h3 class="text-sm font-semibold uppercase tracking-wider text-gray-900 mb-4"></h3><ul class=space-y-2></ul></div></div><div class="mt-12 pt-8 border-t border-gray-200"><div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0"><p class="text-gray-600 text-sm">© 2025 烧烤量化. All rights reserved.</p><a href=https://chaoming.li class="text-sm text-gray-600 hover:text-primary-600" target=_blank rel="noopener noreferrer">Powered by sk-quant</a></div></div></div></footer><script>const mobileMenuButton=document.getElementById("mobile-menu-button");mobileMenuButton&&mobileMenuButton.addEventListener("click",function(){const e=document.getElementById("mobile-menu");e&&e.classList.toggle("hidden")})</script></body></html>