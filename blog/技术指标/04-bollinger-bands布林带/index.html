<!doctype html><html lang=zh-cn class=h-full><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-XXXXXXX")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XXXXXXXXXX")</script><title>技术指标第4讲：Bollinger Bands布林带 | 烧烤量化</title>
<meta name=description content="深度解析布林带指标的波动率通道原理，从标准差计算到带宽分析，构建基于价格通道突破与波动率扩张收缩的动态交易体系"><meta name=author content="Ryan"><meta name=robots content="index, follow"><meta property="og:title" content="技术指标第4讲：Bollinger Bands布林带 | 烧烤量化"><meta property="og:description" content="深度解析布林带指标的波动率通道原理，从标准差计算到带宽分析，构建基于价格通道突破与波动率扩张收缩的动态交易体系"><meta property="og:type" content="article"><meta property="og:url" content="https://sk-quant.github.io/blog/%E6%8A%80%E6%9C%AF%E6%8C%87%E6%A0%87/04-bollinger-bands%E5%B8%83%E6%9E%97%E5%B8%A6/"><meta property="og:site_name" content="烧烤量化"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="技术指标第4讲：Bollinger Bands布林带 | 烧烤量化"><meta name=twitter:description content="深度解析布林带指标的波动率通道原理，从标准差计算到带宽分析，构建基于价格通道突破与波动率扩张收缩的动态交易体系"><link rel=icon type=image/x-icon href=/images/favicon.ico><link rel=canonical href=https://sk-quant.github.io/blog/%E6%8A%80%E6%9C%AF%E6%8C%87%E6%A0%87/04-bollinger-bands%E5%B8%83%E6%9E%97%E5%B8%A6/><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@600;700;800&display=swap" rel=stylesheet><link rel=stylesheet href="/css/main.min.9a3c970d7feebe1317992d10ced98f226635b831a963ee601e5901734ff0da21.css"></head><body class="min-h-screen flex flex-col"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-XXXXXXX" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><div class="fixed top-0 left-0 right-0 z-50"><div class=mobile-menu-wrapper><input type=checkbox id=nav-toggle class=nav-toggle><header class="fixed w-full top-0 z-50 bg-white/80 backdrop-blur-sm border-b border-gray-100"><div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl"><nav class="flex items-center justify-between h-20"><a href=https://sk-quant.github.io/ class="flex items-center space-x-4"><img src=/images/logo.svg alt=烧烤量化 class=h-12>
<span class="text-3xl font-semibold text-gray-800">烧烤量化</span></a><div class="hidden md:flex items-center space-x-8"><a href=/path class="text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">学习路线</a><div class="relative group"><button class="flex items-center text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">
量化基础<svg class="ml-2 w-4 h-4" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></button><div class="absolute left-0 mt-2 w-72 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 ease-in-out"><div class="py-6 bg-white border border-gray-100 shadow-xl rounded-lg"><a href=/categories/%e6%8a%95%e8%b5%84%e7%90%86%e8%ae%ba/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">投资理论</a>
<a href=/categories/%e4%bb%a3%e7%a0%81%e5%9f%ba%e7%a1%80/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">代码基础</a>
<a href=/categories/%e6%8a%80%e6%9c%af%e6%8c%87%e6%a0%87/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">技术指标</a>
<a href=/categories/%e5%9b%9e%e6%b5%8b%e5%b9%b3%e5%8f%b0/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">回测平台</a></div></div></div><div class="relative group"><button class="flex items-center text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">
量化进阶<svg class="ml-2 w-4 h-4" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></button><div class="absolute left-0 mt-2 w-72 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 ease-in-out"><div class="py-6 bg-white border border-gray-100 shadow-xl rounded-lg"><a href=/categories/%e7%ad%96%e7%95%a5%e5%88%86%e4%ba%ab/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">策略分享</a>
<a href=/categories/%e5%ae%9e%e7%9b%98%e5%b7%a5%e5%85%b7/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">实盘工具</a>
<a href=/categories/%e7%83%ad%e7%82%b9%e9%a3%8e%e5%8f%a3/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">热点风口</a>
<a href=/categories/%e7%bb%bc%e5%90%88%e5%ae%9e%e6%88%98/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">综合实战</a></div></div></div><div class="relative group"><button class="flex items-center text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">
量化高手<svg class="ml-2 w-4 h-4" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></button><div class="absolute left-0 mt-2 w-72 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 ease-in-out"><div class="py-6 bg-white border border-gray-100 shadow-xl rounded-lg"><a href=/categories/%e5%8f%af%e8%bd%ac%e5%80%ba/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">可转债</a>
<a href=/categories/%e8%9e%8d%e8%b5%84%e8%9e%8d%e5%88%b8/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">融资融券</a>
<a href=/categories/%e8%82%a1%e7%a5%a8%e6%9c%9f%e6%9d%83/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">股票期权</a>
<a href=/categories/%e8%82%a1%e6%8c%87%e6%9c%9f%e8%b4%a7/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">股指期货</a></div></div></div><a href=/pricing class="text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">服务套餐</a></div><div class="hidden md:flex items-center space-x-4"><a href=/contact class="inline-flex items-center justify-center px-6 py-3 rounded-lg font-bold transition duration-200 ease-in-out bg-primary-600 text-white hover:bg-primary-700 hover:scale-105">现在加入</a></div><div class=md:hidden><label for=nav-toggle class="p-2 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:ring-offset-2 transition-colors cursor-pointer"><svg class="w-6 h-6" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></label></div></nav></div><div class="nav-content md:hidden w-full fixed left-0 right-0 top-20 bg-white border-t border-gray-100 shadow-lg"><div class="w-full px-6 py-4"><a href=/path class="block text-xl text-gray-900 hover:text-primary-600 font-bold transition duration-200 py-2">学习路线</a><div class=py-2><div class="text-xl text-gray-900 font-bold mb-2">量化基础</div><div class=pl-4><a href=/categories/%e6%8a%95%e8%b5%84%e7%90%86%e8%ae%ba/ class="block text-gray-700 hover:text-primary-600 py-2">投资理论</a>
<a href=/categories/%e4%bb%a3%e7%a0%81%e5%9f%ba%e7%a1%80/ class="block text-gray-700 hover:text-primary-600 py-2">代码基础</a>
<a href=/categories/%e6%8a%80%e6%9c%af%e6%8c%87%e6%a0%87/ class="block text-gray-700 hover:text-primary-600 py-2">技术指标</a>
<a href=/categories/%e5%9b%9e%e6%b5%8b%e5%b9%b3%e5%8f%b0/ class="block text-gray-700 hover:text-primary-600 py-2">回测平台</a></div></div><div class=py-2><div class="text-xl text-gray-900 font-bold mb-2">量化进阶</div><div class=pl-4><a href=/categories/%e7%ad%96%e7%95%a5%e5%88%86%e4%ba%ab/ class="block text-gray-700 hover:text-primary-600 py-2">策略分享</a>
<a href=/categories/%e5%ae%9e%e7%9b%98%e5%b7%a5%e5%85%b7/ class="block text-gray-700 hover:text-primary-600 py-2">实盘工具</a>
<a href=/categories/%e7%83%ad%e7%82%b9%e9%a3%8e%e5%8f%a3/ class="block text-gray-700 hover:text-primary-600 py-2">热点风口</a>
<a href=/categories/%e7%bb%bc%e5%90%88%e5%ae%9e%e6%88%98/ class="block text-gray-700 hover:text-primary-600 py-2">综合实战</a></div></div><div class=py-2><div class="text-xl text-gray-900 font-bold mb-2">量化高手</div><div class=pl-4><a href=/categories/%e5%8f%af%e8%bd%ac%e5%80%ba/ class="block text-gray-700 hover:text-primary-600 py-2">可转债</a>
<a href=/categories/%e8%9e%8d%e8%b5%84%e8%9e%8d%e5%88%b8/ class="block text-gray-700 hover:text-primary-600 py-2">融资融券</a>
<a href=/categories/%e8%82%a1%e7%a5%a8%e6%9c%9f%e6%9d%83/ class="block text-gray-700 hover:text-primary-600 py-2">股票期权</a>
<a href=/categories/%e8%82%a1%e6%8c%87%e6%9c%9f%e8%b4%a7/ class="block text-gray-700 hover:text-primary-600 py-2">股指期货</a></div></div><a href=/pricing class="block text-xl text-gray-900 hover:text-primary-600 font-bold transition duration-200 py-2">服务套餐</a><div class="pt-4 space-y-4"><a href=/contact class="block text-center px-6 py-3 rounded-lg font-bold transition duration-200 ease-in-out bg-primary-600 text-white hover:bg-primary-700 hover:scale-105">现在加入</a></div></div></div></header><style>.mobile-menu-wrapper{position:relative}.nav-toggle{display:none}.nav-content{display:none}.nav-toggle:checked~header .nav-content{display:block}</style></div></div><div class=pt-20><div class="container mx-auto px-4 py-12"><div class="flex flex-col lg:flex-row gap-8 mb-12"><article class=flex-1><header class=mb-8><div class=mb-4><a href=/categories/%E6%8A%80%E6%9C%AF%E6%8C%87%E6%A0%87 class="inline-block px-3 py-1 text-sm font-medium text-primary-600 bg-primary-50 rounded-full hover:bg-primary-100 mr-2">技术指标</a></div><h1 class="text-4xl font-bold mb-4">技术指标第4讲：Bollinger Bands布林带</h1><div class="flex flex-col space-y-4"><div class="flex items-center justify-between text-sm text-gray-500"><div class="flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7A4 4 0 118 7a4 4 0 018 0zm-4 7a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
<span>Ryan</span></div><div class="flex items-center space-x-6"><div class="flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747.0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746.0-3.332.477-4.5 1.253"/></svg>
<span>15 分钟</span></div><div class="flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5A2 2 0 003 7v12a2 2 0 002 2z"/></svg>
<time datetime=2025-09-14>September 14, 2025</time></div></div></div><div class="flex items-center flex-wrap gap-2"><a href=/tags/2025 class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 transition-colors duration-200">#2025</a></div></div></header><div class=mb-8><img src=/images/blog/%e6%8a%80%e6%9c%af%e6%8c%87%e6%a0%87.jpg alt="技术指标第4讲：Bollinger Bands布林带" class="w-full h-auto rounded-lg" loading=lazy></div><div class="prose prose-lg max-w-none"><div class="bg-gray-50 p-6 rounded-lg mb-8"><h2 class="text-xl font-semibold mb-4">目录</h2><nav id=TableOfContents><ul><li><a href=#布林带指标波动率通道的价格边界>布林带指标：波动率通道的价格边界</a></li><li><a href=#布林带计算原理从移动平均到标准差通道>布林带计算原理：从移动平均到标准差通道</a><ul><li><a href=#布林带的基本构成>布林带的基本构成</a></li><li><a href=#标准差的数学基础>标准差的数学基础</a></li><li><a href=#布林带参数优化>布林带参数优化</a></li></ul></li><li><a href=#布林带信号识别从通道突破到带宽分析>布林带信号识别：从通道突破到带宽分析</a><ul><li><a href=#布林带突破信号系统>布林带突破信号系统</a></li><li><a href=#b指标的位置分析>%b指标的位置分析</a></li><li><a href=#带宽分析技术>带宽分析技术</a></li><li><a href=#布林带形态分析>布林带形态分析</a></li></ul></li><li><a href=#基于talib的布林带指标python实现>基于talib的布林带指标Python实现</a><ul><li><a href=#环境配置与数据准备>环境配置与数据准备</a></li><li><a href=#布林带指标计算与基础分析>布林带指标计算与基础分析</a></li><li><a href=#布林带挤压突破识别>布林带挤压突破识别</a></li><li><a href=#布林带交易策略回测>布林带交易策略回测</a></li><li><a href=#布林带指标可视化分析>布林带指标可视化分析</a></li></ul></li></ul></nav></div><h2 id=布林带指标波动率通道的价格边界>布林带指标：波动率通道的价格边界</h2><p>布林带（Bollinger Bands）由著名技术分析师约翰·布林格（John Bollinger）于1980年代初期开发，是基于统计学标准差原理构建的通道类技术指标。该指标通过计算价格的标准差来衡量市场波动性，并围绕移动平均线构建动态的价格通道，为投资者提供价格波动范围的可视化参考。</p><p>布林带指标的核心价值在于其"自适应性"特征。与传统的固定百分比通道不同，布林带能够根据市场波动率的变化自动调整通道宽度。在高波动环境中，布林带自动扩张以容纳更大的价格波动；在低波动环境中，布林带收缩以反映价格的窄幅震荡。这种动态调整机制使得布林带指标能够适应不同的市场环境，为交易决策提供更加精准的参考依据。</p><p>布林带不仅是一个趋势跟踪工具，更是一个波动率分析框架。通过观察布林带带宽的变化，投资者可以洞察市场波动率的演变规律，从而制定相应的交易策略。当布林带极度收缩时，往往预示着市场即将出现方向性突破；当布林带过度扩张时，则可能意味着趋势即将进入调整阶段。</p><h2 id=布林带计算原理从移动平均到标准差通道>布林带计算原理：从移动平均到标准差通道</h2><h3 id=布林带的基本构成>布林带的基本构成</h3><p>布林带由三条线组成，形成一个动态的价格通道：</p><p><strong>中轨（MB，Middle Band）</strong>：通常采用20日简单移动平均线（SMA）作为基准线，代表价格的中期趋势方向。</p><p><strong>上轨（UB，Upper Band）</strong>：中轨加上一定倍数的标准差，计算公式为 UB = MB + k × σ，其中k通常取2。</p><p><strong>下轨（LB，Lower Band）</strong>：中轨减去一定倍数的标准差，计算公式为 LB = MB - k × σ。</p><p><strong>带宽（Bandwidth）</strong>：衡量布林带宽度的指标，计算公式为 Bandwidth = (UB - LB) / MB × 100%。</p><p><strong>%b指标</strong>：衡量价格在布林带中相对位置的指标，计算公式为 %b = (价格 - LB) / (UB - LB)。</p><h3 id=标准差的数学基础>标准差的数学基础</h3><p>标准差是衡量数据离散程度的重要统计指标，其计算过程包括：</p><ol><li><strong>计算均值</strong>：计算选定周期内的价格平均值</li><li><strong>计算偏差</strong>：每个价格与均值的差值</li><li><strong>平方偏差</strong>：将偏差值平方以消除负值影响</li><li><strong>计算方差</strong>：求平方偏差的平均值</li><li><strong>开方得标准差</strong>：方差的平方根即为标准差</li></ol><p>在布林带应用中，通常使用收盘价作为计算基础，但也可以根据分析需要使用最高价、最低价或其他价格数据。</p><h3 id=布林带参数优化>布林带参数优化</h3><p><strong>周期参数选择</strong>：标准布林带采用20日周期，这一参数适用于大多数市场环境。短期交易者可以使用10-15日周期，长期投资者可以使用30-50日周期。</p><p><strong>标准差倍数优化</strong>：标准倍数2适用于大多数情况，但在高波动品种中可以适当增加（如2.5），在低波动品种中可以适当减少（如1.5）。</p><p><strong>多重布林带系统</strong>：可以同时使用不同参数的多组布林带，如（20,2）和（20,1）组合，形成更加精细的分析框架。</p><h2 id=布林带信号识别从通道突破到带宽分析>布林带信号识别：从通道突破到带宽分析</h2><h3 id=布林带突破信号系统>布林带突破信号系统</h3><p><strong>上轨突破</strong>：当价格突破布林带上轨时，通常被视为强势信号，表明市场可能进入加速上涨阶段。但需要注意的是，这种突破也可能是短期的超买信号，需要结合其他指标进行确认。</p><p><strong>下轨突破</strong>：当价格跌破布林带下轨时，通常被视为弱势信号，表明市场可能进入加速下跌阶段。同样，这种突破也可能是短期的超卖信号，需要谨慎对待。</p><p><strong>中轨突破</strong>：价格对布林带中轨的突破具有重要的趋势意义。向上突破中轨可能预示着上升趋势的开始，向下突破中轨可能预示着下降趋势的形成。</p><h3 id=b指标的位置分析>%b指标的位置分析</h3><p>%b指标将价格在布林带中的位置标准化为0-1的区间，提供了更加直观的位置参考：</p><p><strong>%b > 1</strong>：价格位于布林带上轨之上，表明市场处于强势状态
<strong>%b = 1</strong>：价格触及布林带上轨，需要关注是否形成有效突破
<strong>0.5 &lt; %b &lt; 1</strong>：价格位于布林带中上轨之间，表明市场偏向强势
<strong>%b = 0.5</strong>：价格位于布林带中轨，表明市场处于平衡状态
<strong>0 &lt; %b &lt; 0.5</strong>：价格位于布林带中下轨之间，表明市场偏向弱势
<strong>%b = 0</strong>：价格触及布林带下轨，需要关注是否形成有效跌破
<strong>%b &lt; 0</strong>：价格位于布林带下轨之下，表明市场处于弱势状态</p><h3 id=带宽分析技术>带宽分析技术</h3><p>带宽指标反映了市场波动率的变化，具有重要的分析价值：</p><p><strong>带宽收缩</strong>：当布林带带宽收缩至历史低位时，通常预示着市场即将出现方向性突破。这种"挤压"现象往往出现在重要趋势形成之前。</p><p><strong>带宽扩张</strong>：当布林带带宽从低位开始扩张时，表明市场波动率正在增加，趋势可能正在加速。</p><p><strong>带宽极值</strong>：带宽的历史极值具有重要的参考意义。极度收缩的带宽往往预示着重要的突破机会，过度扩张的带宽则可能意味着趋势即将进入调整。</p><h3 id=布林带形态分析>布林带形态分析</h3><p><strong>布林带挤压</strong>：带宽持续收缩，价格窄幅震荡，预示着即将出现方向性突破。这种形态通常持续6-8个周期，突破后的趋势往往具有较强的持续性。</p><p><strong>布林带扩张</strong>：带宽持续扩张，价格沿布林带单边运行，表明趋势正在加速。这种形态往往出现在趋势的中间阶段。</p><p><strong>布林带收敛</strong>：带宽从扩张状态开始收敛，价格开始回归中轨，表明趋势可能进入调整阶段。</p><h2 id=基于talib的布林带指标python实现>基于talib的布林带指标Python实现</h2><h3 id=环境配置与数据准备>环境配置与数据准备</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>talib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>yfinance</span> <span class=k>as</span> <span class=nn>yf</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span><span class=p>,</span> <span class=n>timedelta</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 获取股票数据</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_stock_data</span><span class=p>(</span><span class=n>symbol</span><span class=p>,</span> <span class=n>period</span><span class=o>=</span><span class=s2>&#34;2y&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;获取股票历史数据&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>stock</span> <span class=o>=</span> <span class=n>yf</span><span class=o>.</span><span class=n>download</span><span class=p>(</span><span class=n>symbol</span><span class=p>,</span> <span class=n>period</span><span class=o>=</span><span class=n>period</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>stock</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 获取沪深300指数数据</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>get_stock_data</span><span class=p>(</span><span class=s2>&#34;000300.SS&#34;</span><span class=p>,</span> <span class=n>period</span><span class=o>=</span><span class=s2>&#34;2y&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>close_prices</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
</span></span><span class=line><span class=cl><span class=n>high_prices</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;High&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
</span></span><span class=line><span class=cl><span class=n>low_prices</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;Low&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
</span></span><span class=line><span class=cl><span class=n>open_prices</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;Open&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;数据获取完成，共</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=si>}</span><span class=s2>个交易日&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;价格区间: </span><span class=si>{</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>min</span><span class=p>()</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2> - </span><span class=si>{</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>max</span><span class=p>()</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建日期索引</span>
</span></span><span class=line><span class=cl><span class=n>dates</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>index</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;数据时间范围: </span><span class=si>{</span><span class=n>dates</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%Y-%m-</span><span class=si>%d</span><span class=s1>&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2> 至 </span><span class=si>{</span><span class=n>dates</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%Y-%m-</span><span class=si>%d</span><span class=s1>&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 基础统计分析</span>
</span></span><span class=line><span class=cl><span class=n>price_returns</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>pct_change</span><span class=p>()</span><span class=o>.</span><span class=n>dropna</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>价格收益率统计:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;平均日收益率: </span><span class=si>{</span><span class=n>price_returns</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;日波动率(标准差): </span><span class=si>{</span><span class=n>price_returns</span><span class=o>.</span><span class=n>std</span><span class=p>()</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;年化波动率: </span><span class=si>{</span><span class=n>price_returns</span><span class=o>.</span><span class=n>std</span><span class=p>()</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=mi>252</span><span class=p>)</span><span class=si>:</span><span class=s2>.2%</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=布林带指标计算与基础分析>布林带指标计算与基础分析</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用talib计算布林带指标</span>
</span></span><span class=line><span class=cl><span class=n>upper_band</span><span class=p>,</span> <span class=n>middle_band</span><span class=p>,</span> <span class=n>lower_band</span> <span class=o>=</span> <span class=n>talib</span><span class=o>.</span><span class=n>BBANDS</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>close_prices</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=n>timeperiod</span><span class=o>=</span><span class=mi>20</span><span class=p>,</span>  <span class=c1># 20日周期</span>
</span></span><span class=line><span class=cl>    <span class=n>nbdevup</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>      <span class=c1># 上轨标准差倍数</span>
</span></span><span class=line><span class=cl>    <span class=n>nbdevdn</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>      <span class=c1># 下轨标准差倍数</span>
</span></span><span class=line><span class=cl>    <span class=n>matype</span><span class=o>=</span><span class=mi>0</span>        <span class=c1># 简单移动平均</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 计算布林带衍生指标</span>
</span></span><span class=line><span class=cl><span class=n>bandwidth</span> <span class=o>=</span> <span class=p>(</span><span class=n>upper_band</span> <span class=o>-</span> <span class=n>lower_band</span><span class=p>)</span> <span class=o>/</span> <span class=n>middle_band</span> <span class=o>*</span> <span class=mi>100</span>  <span class=c1># 带宽指标</span>
</span></span><span class=line><span class=cl><span class=n>percent_b</span> <span class=o>=</span> <span class=p>(</span><span class=n>close_prices</span> <span class=o>-</span> <span class=n>lower_band</span><span class=p>)</span> <span class=o>/</span> <span class=p>(</span><span class=n>upper_band</span> <span class=o>-</span> <span class=n>lower_band</span><span class=p>)</span>  <span class=c1># %b指标</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建布林带分析DataFrame</span>
</span></span><span class=line><span class=cl><span class=n>bb_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Close&#39;</span><span class=p>:</span> <span class=n>close_prices</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Upper_Band&#39;</span><span class=p>:</span> <span class=n>upper_band</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Middle_Band&#39;</span><span class=p>:</span> <span class=n>middle_band</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Lower_Band&#39;</span><span class=p>:</span> <span class=n>lower_band</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Bandwidth&#39;</span><span class=p>:</span> <span class=n>bandwidth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Percent_B&#39;</span><span class=p>:</span> <span class=n>percent_b</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=n>index</span><span class=o>=</span><span class=n>dates</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 显示最近10个交易日的布林带数据</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;最近10个交易日布林带指标值:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>bb_df</span><span class=o>.</span><span class=n>tail</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span><span class=o>.</span><span class=n>round</span><span class=p>(</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 布林带信号识别函数</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>identify_bb_signals</span><span class=p>(</span><span class=n>prices</span><span class=p>,</span> <span class=n>upper_band</span><span class=p>,</span> <span class=n>lower_band</span><span class=p>,</span> <span class=n>middle_band</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;识别布林带交易信号&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>signals</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 价格相对于布林带的位置</span>
</span></span><span class=line><span class=cl>    <span class=n>signals</span><span class=p>[</span><span class=s1>&#39;above_upper&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>prices</span> <span class=o>&gt;</span> <span class=n>upper_band</span>
</span></span><span class=line><span class=cl>    <span class=n>signals</span><span class=p>[</span><span class=s1>&#39;below_lower&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>prices</span> <span class=o>&lt;</span> <span class=n>lower_band</span>
</span></span><span class=line><span class=cl>    <span class=n>signals</span><span class=p>[</span><span class=s1>&#39;above_middle&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>prices</span> <span class=o>&gt;</span> <span class=n>middle_band</span>
</span></span><span class=line><span class=cl>    <span class=n>signals</span><span class=p>[</span><span class=s1>&#39;below_middle&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>prices</span> <span class=o>&lt;</span> <span class=n>middle_band</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 突破信号</span>
</span></span><span class=line><span class=cl>    <span class=n>signals</span><span class=p>[</span><span class=s1>&#39;break_upper&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>prices</span> <span class=o>&gt;</span> <span class=n>upper_band</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>prices</span><span class=o>.</span><span class=n>shift</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=n>upper_band</span><span class=o>.</span><span class=n>shift</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>signals</span><span class=p>[</span><span class=s1>&#39;break_lower&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>prices</span> <span class=o>&lt;</span> <span class=n>lower_band</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>prices</span><span class=o>.</span><span class=n>shift</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=n>lower_band</span><span class=o>.</span><span class=n>shift</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 回归信号</span>
</span></span><span class=line><span class=cl>    <span class=n>signals</span><span class=p>[</span><span class=s1>&#39;return_middle_up&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>((</span><span class=n>prices</span><span class=o>.</span><span class=n>shift</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=o>&gt;</span> <span class=n>upper_band</span><span class=o>.</span><span class=n>shift</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span> <span class=o>&amp;</span> 
</span></span><span class=line><span class=cl>                                  <span class=p>(</span><span class=n>prices</span> <span class=o>&lt;=</span> <span class=n>upper_band</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>signals</span><span class=p>[</span><span class=s1>&#39;return_middle_down&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>((</span><span class=n>prices</span><span class=o>.</span><span class=n>shift</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=o>&lt;</span> <span class=n>lower_band</span><span class=o>.</span><span class=n>shift</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span> <span class=o>&amp;</span> 
</span></span><span class=line><span class=cl>                                    <span class=p>(</span><span class=n>prices</span> <span class=o>&gt;=</span> <span class=n>lower_band</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>signals</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 分析布林带信号</span>
</span></span><span class=line><span class=cl><span class=n>bb_signals</span> <span class=o>=</span> <span class=n>identify_bb_signals</span><span class=p>(</span><span class=n>close_prices</span><span class=p>,</span> <span class=n>upper_band</span><span class=p>,</span> <span class=n>lower_band</span><span class=p>,</span> <span class=n>middle_band</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 布林带信号统计 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;价格触及上轨次数: </span><span class=si>{</span><span class=n>bb_signals</span><span class=p>[</span><span class=s1>&#39;above_upper&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;价格触及下轨次数: </span><span class=si>{</span><span class=n>bb_signals</span><span class=p>[</span><span class=s1>&#39;below_lower&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;向上突破上轨次数: </span><span class=si>{</span><span class=n>bb_signals</span><span class=p>[</span><span class=s1>&#39;break_upper&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;向下突破下轨次数: </span><span class=si>{</span><span class=n>bb_signals</span><span class=p>[</span><span class=s1>&#39;break_lower&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;从上轨回归次数: </span><span class=si>{</span><span class=n>bb_signals</span><span class=p>[</span><span class=s1>&#39;return_middle_up&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;从下轨回归次数: </span><span class=si>{</span><span class=n>bb_signals</span><span class=p>[</span><span class=s1>&#39;return_middle_down&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 当前布林带状态分析</span>
</span></span><span class=line><span class=cl><span class=n>current_price</span> <span class=o>=</span> <span class=n>close_prices</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>current_upper</span> <span class=o>=</span> <span class=n>upper_band</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>current_lower</span> <span class=o>=</span> <span class=n>lower_band</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>current_middle</span> <span class=o>=</span> <span class=n>middle_band</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>current_bandwidth</span> <span class=o>=</span> <span class=n>bandwidth</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>current_percent_b</span> <span class=o>=</span> <span class=n>percent_b</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 当前布林带状态 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;当前价格: </span><span class=si>{</span><span class=n>current_price</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;布林带上轨: </span><span class=si>{</span><span class=n>current_upper</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;布林带中轨: </span><span class=si>{</span><span class=n>current_middle</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;布林带下轨: </span><span class=si>{</span><span class=n>current_lower</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;带宽指标: </span><span class=si>{</span><span class=n>current_bandwidth</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;%b指标: </span><span class=si>{</span><span class=n>current_percent_b</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 当前位置分析</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>current_percent_b</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>position_status</span> <span class=o>=</span> <span class=s2>&#34;价格突破上轨 - 强势信号&#34;</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=n>current_percent_b</span> <span class=o>&gt;</span> <span class=mf>0.8</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>position_status</span> <span class=o>=</span> <span class=s2>&#34;价格接近上轨 - 强势区域&#34;</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=n>current_percent_b</span> <span class=o>&gt;</span> <span class=mf>0.5</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>position_status</span> <span class=o>=</span> <span class=s2>&#34;价格中上轨间 - 偏强态势&#34;</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=n>current_percent_b</span> <span class=o>&gt;</span> <span class=mf>0.2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>position_status</span> <span class=o>=</span> <span class=s2>&#34;价格中下轨间 - 偏弱态势&#34;</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=n>current_percent_b</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>position_status</span> <span class=o>=</span> <span class=s2>&#34;价格接近下轨 - 弱势区域&#34;</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>position_status</span> <span class=o>=</span> <span class=s2>&#34;价格跌破下轨 - 弱势信号&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;位置状态: </span><span class=si>{</span><span class=n>position_status</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 带宽分析函数</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_bandwidth</span><span class=p>(</span><span class=n>bandwidth_values</span><span class=p>,</span> <span class=n>window</span><span class=o>=</span><span class=mi>20</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;分析布林带带宽变化&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 计算带宽的移动平均和标准差</span>
</span></span><span class=line><span class=cl>    <span class=n>bandwidth_ma</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>bandwidth_values</span><span class=p>)</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=n>window</span><span class=o>=</span><span class=n>window</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>bandwidth_std</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>bandwidth_values</span><span class=p>)</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=n>window</span><span class=o>=</span><span class=n>window</span><span class=p>)</span><span class=o>.</span><span class=n>std</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 计算带宽的相对位置（标准化）</span>
</span></span><span class=line><span class=cl>    <span class=n>bandwidth_zscore</span> <span class=o>=</span> <span class=p>(</span><span class=n>bandwidth_values</span> <span class=o>-</span> <span class=n>bandwidth_ma</span><span class=p>)</span> <span class=o>/</span> <span class=n>bandwidth_std</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 识别带宽极值</span>
</span></span><span class=line><span class=cl>    <span class=n>bandwidth_high</span> <span class=o>=</span> <span class=n>bandwidth_values</span> <span class=o>&gt;</span> <span class=p>(</span><span class=n>bandwidth_ma</span> <span class=o>+</span> <span class=mi>2</span> <span class=o>*</span> <span class=n>bandwidth_std</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>bandwidth_low</span> <span class=o>=</span> <span class=n>bandwidth_values</span> <span class=o>&lt;</span> <span class=p>(</span><span class=n>bandwidth_ma</span> <span class=o>-</span> <span class=mi>2</span> <span class=o>*</span> <span class=n>bandwidth_std</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;ma&#39;</span><span class=p>:</span> <span class=n>bandwidth_ma</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;std&#39;</span><span class=p>:</span> <span class=n>bandwidth_std</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;zscore&#39;</span><span class=p>:</span> <span class=n>bandwidth_zscore</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;high&#39;</span><span class=p>:</span> <span class=n>bandwidth_high</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;low&#39;</span><span class=p>:</span> <span class=n>bandwidth_low</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 分析带宽状态</span>
</span></span><span class=line><span class=cl><span class=n>bw_analysis</span> <span class=o>=</span> <span class=n>analyze_bandwidth</span><span class=p>(</span><span class=n>bandwidth</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 带宽分析 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;当前带宽: </span><span class=si>{</span><span class=n>current_bandwidth</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;带宽20日均值: </span><span class=si>{</span><span class=n>bw_analysis</span><span class=p>[</span><span class=s1>&#39;ma&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;带宽Z值: </span><span class=si>{</span><span class=n>bw_analysis</span><span class=p>[</span><span class=s1>&#39;zscore&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 带宽状态判断</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>bw_analysis</span><span class=p>[</span><span class=s1>&#39;zscore&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>bandwidth_status</span> <span class=o>=</span> <span class=s2>&#34;带宽过高 - 波动率扩张&#34;</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=n>bw_analysis</span><span class=p>[</span><span class=s1>&#39;zscore&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>&lt;</span> <span class=o>-</span><span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>bandwidth_status</span> <span class=o>=</span> <span class=s2>&#34;带宽过低 - 波动率收缩&#34;</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=n>bw_analysis</span><span class=p>[</span><span class=s1>&#39;zscore&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>bandwidth_status</span> <span class=o>=</span> <span class=s2>&#34;带宽偏高 - 波动率较高&#34;</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=n>bw_analysis</span><span class=p>[</span><span class=s1>&#39;zscore&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>&lt;</span> <span class=o>-</span><span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>bandwidth_status</span> <span class=o>=</span> <span class=s2>&#34;带宽偏低 - 波动率较低&#34;</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>bandwidth_status</span> <span class=o>=</span> <span class=s2>&#34;带宽正常 - 波动率适中&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;带宽状态: </span><span class=si>{</span><span class=n>bandwidth_status</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=布林带挤压突破识别>布林带挤压突破识别</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 布林带挤压识别函数</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>identify_bb_squeeze</span><span class=p>(</span><span class=n>bandwidth_values</span><span class=p>,</span> <span class=n>window</span><span class=o>=</span><span class=mi>20</span><span class=p>,</span> <span class=n>threshold</span><span class=o>=</span><span class=mf>1.5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;识别布林带挤压状态&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 计算带宽的移动平均和标准差</span>
</span></span><span class=line><span class=cl>    <span class=n>bandwidth_ma</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>bandwidth_values</span><span class=p>)</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=n>window</span><span class=o>=</span><span class=n>window</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>bandwidth_std</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>bandwidth_values</span><span class=p>)</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=n>window</span><span class=o>=</span><span class=n>window</span><span class=p>)</span><span class=o>.</span><span class=n>std</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 识别挤压状态（带宽低于均值-1.5倍标准差）</span>
</span></span><span class=line><span class=cl>    <span class=n>squeeze_condition</span> <span class=o>=</span> <span class=n>bandwidth_values</span> <span class=o>&lt;</span> <span class=p>(</span><span class=n>bandwidth_ma</span> <span class=o>-</span> <span class=n>threshold</span> <span class=o>*</span> <span class=n>bandwidth_std</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 识别挤压突破（从挤压状态中恢复）</span>
</span></span><span class=line><span class=cl>    <span class=n>squeeze_breakout</span> <span class=o>=</span> <span class=n>squeeze_condition</span><span class=o>.</span><span class=n>shift</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=o>~</span><span class=n>squeeze_condition</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 计算挤压持续时间</span>
</span></span><span class=line><span class=cl>    <span class=n>squeeze_duration</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>current_duration</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>is_squeeze</span> <span class=ow>in</span> <span class=n>squeeze_condition</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>is_squeeze</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>current_duration</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>current_duration</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>squeeze_duration</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>current_duration</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>current_duration</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>squeeze_condition</span><span class=p>,</span> <span class=n>squeeze_breakout</span><span class=p>,</span> <span class=n>squeeze_duration</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 识别布林带挤压</span>
</span></span><span class=line><span class=cl><span class=n>squeeze_condition</span><span class=p>,</span> <span class=n>squeeze_breakout</span><span class=p>,</span> <span class=n>squeeze_durations</span> <span class=o>=</span> <span class=n>identify_bb_squeeze</span><span class=p>(</span><span class=n>bandwidth</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 布林带挤压分析 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;挤压状态天数: </span><span class=si>{</span><span class=n>squeeze_condition</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;挤压突破次数: </span><span class=si>{</span><span class=n>squeeze_breakout</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 分析挤压持续时间</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>squeeze_durations</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>avg_squeeze_duration</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>squeeze_durations</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>max_squeeze_duration</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>squeeze_durations</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>min_squeeze_duration</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>squeeze_durations</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;平均挤压持续时间: </span><span class=si>{</span><span class=n>avg_squeeze_duration</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>天&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;最长挤压持续时间: </span><span class=si>{</span><span class=n>max_squeeze_duration</span><span class=si>}</span><span class=s2>天&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;最短挤压持续时间: </span><span class=si>{</span><span class=n>min_squeeze_duration</span><span class=si>}</span><span class=s2>天&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;未识别到明显的挤压状态&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 当前挤压状态</span>
</span></span><span class=line><span class=cl><span class=n>current_squeeze</span> <span class=o>=</span> <span class=n>squeeze_condition</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>recent_squeeze_breakout</span> <span class=o>=</span> <span class=n>squeeze_breakout</span><span class=p>[</span><span class=o>-</span><span class=mi>5</span><span class=p>:]</span><span class=o>.</span><span class=n>any</span><span class=p>()</span>  <span class=c1># 最近5天是否有挤压突破</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>current_squeeze</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>squeeze_status</span> <span class=o>=</span> <span class=s2>&#34;当前处于挤压状态 - 关注突破机会&#34;</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=n>recent_squeeze_breakout</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>squeeze_status</span> <span class=o>=</span> <span class=s2>&#34;近期出现挤压突破 - 趋势可能启动&#34;</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>squeeze_status</span> <span class=o>=</span> <span class=s2>&#34;当前非挤压状态 - 正常波动&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;挤压状态: </span><span class=si>{</span><span class=n>squeeze_status</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 布林带趋势分析函数</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_bb_trend</span><span class=p>(</span><span class=n>prices</span><span class=p>,</span> <span class=n>middle_band</span><span class=p>,</span> <span class=n>window</span><span class=o>=</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;分析布林带趋势&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 价格相对于中轨的位置</span>
</span></span><span class=line><span class=cl>    <span class=n>price_vs_middle</span> <span class=o>=</span> <span class=n>prices</span> <span class=o>-</span> <span class=n>middle_band</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 中轨的斜率（趋势）</span>
</span></span><span class=line><span class=cl>    <span class=n>middle_slope</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>middle_band</span><span class=p>)</span><span class=o>.</span><span class=n>diff</span><span class=p>(</span><span class=n>window</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 价格趋势强度</span>
</span></span><span class=line><span class=cl>    <span class=n>trend_strength</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>price_vs_middle</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 趋势一致性</span>
</span></span><span class=line><span class=cl>    <span class=n>trend_consistency</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>trend_strength</span><span class=p>)</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=n>window</span><span class=o>=</span><span class=n>window</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>price_vs_middle</span><span class=p>,</span> <span class=n>middle_slope</span><span class=p>,</span> <span class=n>trend_strength</span><span class=p>,</span> <span class=n>trend_consistency</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 分析布林带趋势</span>
</span></span><span class=line><span class=cl><span class=n>price_vs_mid</span><span class=p>,</span> <span class=n>mid_slope</span><span class=p>,</span> <span class=n>trend_strength</span><span class=p>,</span> <span class=n>trend_consistency</span> <span class=o>=</span> <span class=n>analyze_bb_trend</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>close_prices</span><span class=p>,</span> <span class=n>middle_band</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 布林带趋势分析 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;当前价格相对中轨: </span><span class=si>{</span><span class=n>price_vs_mid</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;中轨斜率(20日): </span><span class=si>{</span><span class=n>mid_slope</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;趋势强度: </span><span class=si>{</span><span class=n>trend_strength</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=si>}</span><span class=s2> (</span><span class=si>{</span><span class=s1>&#39;上涨&#39;</span> <span class=k>if</span> <span class=n>trend_strength</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=s1>&#39;下跌&#39;</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;趋势一致性: </span><span class=si>{</span><span class=n>trend_consistency</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=si>:</span><span class=s2>.3f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 趋势状态判断</span>
</span></span><span class=line><span class=cl><span class=n>current_trend_consistency</span> <span class=o>=</span> <span class=n>trend_consistency</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>current_trend_consistency</span> <span class=o>&gt;</span> <span class=mf>0.7</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>trend_status</span> <span class=o>=</span> <span class=s2>&#34;强上升趋势&#34;</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=n>current_trend_consistency</span> <span class=o>&gt;</span> <span class=mf>0.3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>trend_status</span> <span class=o>=</span> <span class=s2>&#34;温和上升趋势&#34;</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=n>current_trend_consistency</span> <span class=o>&lt;</span> <span class=o>-</span><span class=mf>0.7</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>trend_status</span> <span class=o>=</span> <span class=s2>&#34;强下降趋势&#34;</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=n>current_trend_consistency</span> <span class=o>&lt;</span> <span class=o>-</span><span class=mf>0.3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>trend_status</span> <span class=o>=</span> <span class=s2>&#34;温和下降趋势&#34;</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>trend_status</span> <span class=o>=</span> <span class=s2>&#34;震荡整理&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;趋势状态: </span><span class=si>{</span><span class=n>trend_status</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 布林带多重信号组合</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>bb_multi_signal_analysis</span><span class=p>(</span><span class=n>prices</span><span class=p>,</span> <span class=n>upper_band</span><span class=p>,</span> <span class=n>lower_band</span><span class=p>,</span> <span class=n>middle_band</span><span class=p>,</span> <span class=n>bandwidth</span><span class=p>,</span> <span class=n>percent_b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;布林带多重信号组合分析&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>signals</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 价格位置信号</span>
</span></span><span class=line><span class=cl>    <span class=n>signals</span><span class=p>[</span><span class=s1>&#39;position_signal&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>percent_b</span> <span class=o>&gt;</span> <span class=mf>0.8</span><span class=p>,</span> <span class=s1>&#39;强势&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>percent_b</span> <span class=o>&lt;</span> <span class=mf>0.2</span><span class=p>,</span> <span class=s1>&#39;弱势&#39;</span><span class=p>,</span> <span class=s1>&#39;中性&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 带宽信号</span>
</span></span><span class=line><span class=cl>    <span class=n>bandwidth_ma</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>bandwidth</span><span class=p>)</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>bandwidth_std</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>bandwidth</span><span class=p>)</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=o>.</span><span class=n>std</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>bandwidth_zscore</span> <span class=o>=</span> <span class=p>(</span><span class=n>bandwidth</span> <span class=o>-</span> <span class=n>bandwidth_ma</span><span class=p>)</span> <span class=o>/</span> <span class=n>bandwidth_std</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>signals</span><span class=p>[</span><span class=s1>&#39;bandwidth_signal&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>bandwidth_zscore</span> <span class=o>&gt;</span> <span class=mf>1.5</span><span class=p>,</span> <span class=s1>&#39;高波动&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>bandwidth_zscore</span> <span class=o>&lt;</span> <span class=o>-</span><span class=mf>1.5</span><span class=p>,</span> <span class=s1>&#39;低波动&#39;</span><span class=p>,</span> <span class=s1>&#39;正常波动&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 趋势信号</span>
</span></span><span class=line><span class=cl>    <span class=n>price_vs_middle</span> <span class=o>=</span> <span class=n>prices</span> <span class=o>-</span> <span class=n>middle_band</span>
</span></span><span class=line><span class=cl>    <span class=n>mid_slope</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>middle_band</span><span class=p>)</span><span class=o>.</span><span class=n>diff</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>signals</span><span class=p>[</span><span class=s1>&#39;trend_signal&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=n>price_vs_middle</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>mid_slope</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>),</span> <span class=s1>&#39;上升趋势&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>((</span><span class=n>price_vs_middle</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>mid_slope</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>),</span> <span class=s1>&#39;下降趋势&#39;</span><span class=p>,</span> <span class=s1>&#39;震荡&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>signals</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 执行多重信号分析</span>
</span></span><span class=line><span class=cl><span class=n>multi_signals</span> <span class=o>=</span> <span class=n>bb_multi_signal_analysis</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>close_prices</span><span class=p>,</span> <span class=n>upper_band</span><span class=p>,</span> <span class=n>lower_band</span><span class=p>,</span> <span class=n>middle_band</span><span class=p>,</span> <span class=n>bandwidth</span><span class=p>,</span> <span class=n>percent_b</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 布林带多重信号分析 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;价格位置信号: </span><span class=si>{</span><span class=n>multi_signals</span><span class=p>[</span><span class=s1>&#39;position_signal&#39;</span><span class=p>][</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;带宽波动信号: </span><span class=si>{</span><span class=n>multi_signals</span><span class=p>[</span><span class=s1>&#39;bandwidth_signal&#39;</span><span class=p>][</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;趋势方向信号: </span><span class=si>{</span><span class=n>multi_signals</span><span class=p>[</span><span class=s1>&#39;trend_signal&#39;</span><span class=p>][</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 综合信号评分</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_bb_score</span><span class=p>(</span><span class=n>position_signal</span><span class=p>,</span> <span class=n>bandwidth_signal</span><span class=p>,</span> <span class=n>trend_signal</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;计算布林带综合评分&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>score</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 位置评分</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>position_signal</span> <span class=o>==</span> <span class=s1>&#39;强势&#39;</span><span class=p>:</span> <span class=n>score</span> <span class=o>+=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>position_signal</span> <span class=o>==</span> <span class=s1>&#39;弱势&#39;</span><span class=p>:</span> <span class=n>score</span> <span class=o>-=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 带宽评分</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>bandwidth_signal</span> <span class=o>==</span> <span class=s1>&#39;低波动&#39;</span><span class=p>:</span> <span class=n>score</span> <span class=o>+=</span> <span class=mi>1</span>  <span class=c1># 挤压状态，关注突破</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>bandwidth_signal</span> <span class=o>==</span> <span class=s1>&#39;高波动&#39;</span><span class=p>:</span> <span class=n>score</span> <span class=o>-=</span> <span class=mi>1</span>  <span class=c1># 波动过高，谨慎操作</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 趋势评分</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>trend_signal</span> <span class=o>==</span> <span class=s1>&#39;上升趋势&#39;</span><span class=p>:</span> <span class=n>score</span> <span class=o>+=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>trend_signal</span> <span class=o>==</span> <span class=s1>&#39;下降趋势&#39;</span><span class=p>:</span> <span class=n>score</span> <span class=o>-=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>score</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>current_score</span> <span class=o>=</span> <span class=n>calculate_bb_score</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>multi_signals</span><span class=p>[</span><span class=s1>&#39;position_signal&#39;</span><span class=p>][</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>multi_signals</span><span class=p>[</span><span class=s1>&#39;bandwidth_signal&#39;</span><span class=p>][</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>multi_signals</span><span class=p>[</span><span class=s1>&#39;trend_signal&#39;</span><span class=p>][</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>布林带综合评分: </span><span class=si>{</span><span class=n>current_score</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>current_score</span> <span class=o>&gt;=</span> <span class=mi>3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>bb_recommendation</span> <span class=o>=</span> <span class=s2>&#34;强烈看涨&#34;</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=n>current_score</span> <span class=o>&gt;=</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>bb_recommendation</span> <span class=o>=</span> <span class=s2>&#34;温和看涨&#34;</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=n>current_score</span> <span class=o>&lt;=</span> <span class=o>-</span><span class=mi>3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>bb_recommendation</span> <span class=o>=</span> <span class=s2>&#34;强烈看跌&#34;</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=n>current_score</span> <span class=o>&lt;=</span> <span class=o>-</span><span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>bb_recommendation</span> <span class=o>=</span> <span class=s2>&#34;温和看跌&#34;</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>bb_recommendation</span> <span class=o>=</span> <span class=s2>&#34;中性观望&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;布林带建议: </span><span class=si>{</span><span class=n>bb_recommendation</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=布林带交易策略回测>布林带交易策略回测</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span><span class=lnt>324
</span><span class=lnt>325
</span><span class=lnt>326
</span><span class=lnt>327
</span><span class=lnt>328
</span><span class=lnt>329
</span><span class=lnt>330
</span><span class=lnt>331
</span><span class=lnt>332
</span><span class=lnt>333
</span><span class=lnt>334
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 布林带突破交易策略</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>bb_breakout_strategy</span><span class=p>(</span><span class=n>prices</span><span class=p>,</span> <span class=n>upper_band</span><span class=p>,</span> <span class=n>lower_band</span><span class=p>,</span> <span class=n>middle_band</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                        <span class=n>holding_period</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>stop_loss_pct</span><span class=o>=</span><span class=mf>0.05</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;布林带突破交易策略回测&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>positions</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>trades</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>current_position</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>entry_price</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>entry_date</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>prices</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=n>current_price</span> <span class=o>=</span> <span class=n>prices</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 向上突破上轨，开多仓</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>current_price</span> <span class=o>&gt;</span> <span class=n>upper_band</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=ow>and</span> 
</span></span><span class=line><span class=cl>            <span class=n>prices</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=n>upper_band</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=ow>and</span> 
</span></span><span class=line><span class=cl>            <span class=n>current_position</span> <span class=o>==</span> <span class=mi>0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>current_position</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=n>entry_price</span> <span class=o>=</span> <span class=n>current_price</span>
</span></span><span class=line><span class=cl>            <span class=n>entry_date</span> <span class=o>=</span> <span class=n>dates</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>positions</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;date&#39;</span><span class=p>:</span> <span class=n>dates</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;action&#39;</span><span class=p>:</span> <span class=s1>&#39;买入&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;price&#39;</span><span class=p>:</span> <span class=n>current_price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;position&#39;</span><span class=p>:</span> <span class=n>current_position</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;upper_band&#39;</span><span class=p>:</span> <span class=n>upper_band</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;middle_band&#39;</span><span class=p>:</span> <span class=n>middle_band</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;lower_band&#39;</span><span class=p>:</span> <span class=n>lower_band</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 向下突破下轨，开空仓（或平多仓）</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=p>(</span><span class=n>current_price</span> <span class=o>&lt;</span> <span class=n>lower_band</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=ow>and</span> 
</span></span><span class=line><span class=cl>              <span class=n>prices</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>&gt;=</span> <span class=n>lower_band</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=ow>and</span> 
</span></span><span class=line><span class=cl>              <span class=n>current_position</span> <span class=o>==</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 平多仓</span>
</span></span><span class=line><span class=cl>            <span class=n>exit_price</span> <span class=o>=</span> <span class=n>current_price</span>
</span></span><span class=line><span class=cl>            <span class=n>return_pct</span> <span class=o>=</span> <span class=p>(</span><span class=n>exit_price</span> <span class=o>-</span> <span class=n>entry_price</span><span class=p>)</span> <span class=o>/</span> <span class=n>entry_price</span> <span class=o>*</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>            <span class=n>holding_days</span> <span class=o>=</span> <span class=p>(</span><span class=n>dates</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=n>entry_date</span><span class=p>)</span><span class=o>.</span><span class=n>days</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>trades</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;entry_date&#39;</span><span class=p>:</span> <span class=n>entry_date</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;exit_date&#39;</span><span class=p>:</span> <span class=n>dates</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;entry_price&#39;</span><span class=p>:</span> <span class=n>entry_price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;exit_price&#39;</span><span class=p>:</span> <span class=n>exit_price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;return_pct&#39;</span><span class=p>:</span> <span class=n>return_pct</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;holding_days&#39;</span><span class=p>:</span> <span class=n>holding_days</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;strategy&#39;</span><span class=p>:</span> <span class=s1>&#39;上轨突破&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>current_position</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>positions</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;date&#39;</span><span class=p>:</span> <span class=n>dates</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;action&#39;</span><span class=p>:</span> <span class=s1>&#39;卖出&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;price&#39;</span><span class=p>:</span> <span class=n>current_price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;position&#39;</span><span class=p>:</span> <span class=n>current_position</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;upper_band&#39;</span><span class=p>:</span> <span class=n>upper_band</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;middle_band&#39;</span><span class=p>:</span> <span class=n>middle_band</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;lower_band&#39;</span><span class=p>:</span> <span class=n>lower_band</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 时间止损或价格止损</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>current_position</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 价格止损</span>
</span></span><span class=line><span class=cl>            <span class=n>stop_loss_price</span> <span class=o>=</span> <span class=n>entry_price</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>stop_loss_pct</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>current_price</span> <span class=o>&lt;=</span> <span class=n>stop_loss_price</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>exit_price</span> <span class=o>=</span> <span class=n>current_price</span>
</span></span><span class=line><span class=cl>                <span class=n>return_pct</span> <span class=o>=</span> <span class=p>(</span><span class=n>exit_price</span> <span class=o>-</span> <span class=n>entry_price</span><span class=p>)</span> <span class=o>/</span> <span class=n>entry_price</span> <span class=o>*</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>                <span class=n>holding_days</span> <span class=o>=</span> <span class=p>(</span><span class=n>dates</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=n>entry_date</span><span class=p>)</span><span class=o>.</span><span class=n>days</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>trades</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;entry_date&#39;</span><span class=p>:</span> <span class=n>entry_date</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;exit_date&#39;</span><span class=p>:</span> <span class=n>dates</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;entry_price&#39;</span><span class=p>:</span> <span class=n>entry_price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;exit_price&#39;</span><span class=p>:</span> <span class=n>exit_price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;return_pct&#39;</span><span class=p>:</span> <span class=n>return_pct</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;holding_days&#39;</span><span class=p>:</span> <span class=n>holding_days</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;strategy&#39;</span><span class=p>:</span> <span class=s1>&#39;止损出场&#39;</span>
</span></span><span class=line><span class=cl>                <span class=p>})</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>current_position</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>positions</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;date&#39;</span><span class=p>:</span> <span class=n>dates</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;action&#39;</span><span class=p>:</span> <span class=s1>&#39;止损&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;price&#39;</span><span class=p>:</span> <span class=n>current_price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;position&#39;</span><span class=p>:</span> <span class=n>current_position</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;upper_band&#39;</span><span class=p>:</span> <span class=n>upper_band</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;middle_band&#39;</span><span class=p>:</span> <span class=n>middle_band</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;lower_band&#39;</span><span class=p>:</span> <span class=n>lower_band</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=p>})</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 时间止损</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=p>(</span><span class=n>dates</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=n>entry_date</span><span class=p>)</span><span class=o>.</span><span class=n>days</span> <span class=o>&gt;=</span> <span class=n>holding_period</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>exit_price</span> <span class=o>=</span> <span class=n>current_price</span>
</span></span><span class=line><span class=cl>                <span class=n>return_pct</span> <span class=o>=</span> <span class=p>(</span><span class=n>exit_price</span> <span class=o>-</span> <span class=n>entry_price</span><span class=p>)</span> <span class=o>/</span> <span class=n>entry_price</span> <span class=o>*</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>                <span class=n>holding_days</span> <span class=o>=</span> <span class=p>(</span><span class=n>dates</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=n>entry_date</span><span class=p>)</span><span class=o>.</span><span class=n>days</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>trades</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;entry_date&#39;</span><span class=p>:</span> <span class=n>entry_date</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;exit_date&#39;</span><span class=p>:</span> <span class=n>dates</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;entry_price&#39;</span><span class=p>:</span> <span class=n>entry_price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;exit_price&#39;</span><span class=p>:</span> <span class=n>exit_price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;return_pct&#39;</span><span class=p>:</span> <span class=n>return_pct</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;holding_days&#39;</span><span class=p>:</span> <span class=n>holding_days</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;strategy&#39;</span><span class=p>:</span> <span class=s1>&#39;时间止损&#39;</span>
</span></span><span class=line><span class=cl>                <span class=p>})</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>current_position</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>positions</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;date&#39;</span><span class=p>:</span> <span class=n>dates</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;action&#39;</span><span class=p>:</span> <span class=s1>&#39;时间出场&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;price&#39;</span><span class=p>:</span> <span class=n>current_price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;position&#39;</span><span class=p>:</span> <span class=n>current_position</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;upper_band&#39;</span><span class=p>:</span> <span class=n>upper_band</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;middle_band&#39;</span><span class=p>:</span> <span class=n>middle_band</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;lower_band&#39;</span><span class=p>:</span> <span class=n>lower_band</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=p>})</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>trades</span><span class=p>,</span> <span class=n>positions</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 执行布林带突破策略回测</span>
</span></span><span class=line><span class=cl><span class=n>bb_trades</span><span class=p>,</span> <span class=n>bb_positions</span> <span class=o>=</span> <span class=n>bb_breakout_strategy</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>close_prices</span><span class=p>,</span> <span class=n>upper_band</span><span class=p>,</span> <span class=n>lower_band</span><span class=p>,</span> <span class=n>middle_band</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 布林带突破策略回测结果 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;总交易次数: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>bb_trades</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>bb_trades</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 计算策略表现指标</span>
</span></span><span class=line><span class=cl>    <span class=n>returns</span> <span class=o>=</span> <span class=p>[</span><span class=n>trade</span><span class=p>[</span><span class=s1>&#39;return_pct&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>trade</span> <span class=ow>in</span> <span class=n>bb_trades</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>winning_trades</span> <span class=o>=</span> <span class=p>[</span><span class=n>r</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>returns</span> <span class=k>if</span> <span class=n>r</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>losing_trades</span> <span class=o>=</span> <span class=p>[</span><span class=n>r</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>returns</span> <span class=k>if</span> <span class=n>r</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>win_rate</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>winning_trades</span><span class=p>)</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>returns</span><span class=p>)</span> <span class=o>*</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>    <span class=n>avg_return</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>returns</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>max_return</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>returns</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>min_return</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>returns</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>avg_holding_days</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>([</span><span class=n>trade</span><span class=p>[</span><span class=s1>&#39;holding_days&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>trade</span> <span class=ow>in</span> <span class=n>bb_trades</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;胜率: </span><span class=si>{</span><span class=n>win_rate</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;平均收益率: </span><span class=si>{</span><span class=n>avg_return</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;最大单笔收益: </span><span class=si>{</span><span class=n>max_return</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;最大单笔亏损: </span><span class=si>{</span><span class=n>min_return</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;平均持仓天数: </span><span class=si>{</span><span class=n>avg_holding_days</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>天&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 按策略类型分析</span>
</span></span><span class=line><span class=cl>    <span class=n>breakout_trades</span> <span class=o>=</span> <span class=p>[</span><span class=n>t</span> <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>bb_trades</span> <span class=k>if</span> <span class=n>t</span><span class=p>[</span><span class=s1>&#39;strategy&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;上轨突破&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>stop_loss_trades</span> <span class=o>=</span> <span class=p>[</span><span class=n>t</span> <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>bb_trades</span> <span class=k>if</span> <span class=n>t</span><span class=p>[</span><span class=s1>&#39;strategy&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;止损出场&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>time_exit_trades</span> <span class=o>=</span> <span class=p>[</span><span class=n>t</span> <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>bb_trades</span> <span class=k>if</span> <span class=n>t</span><span class=p>[</span><span class=s1>&#39;strategy&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;时间止损&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>按策略类型分析:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;突破交易次数: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>breakout_trades</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>breakout_trades</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>breakout_returns</span> <span class=o>=</span> <span class=p>[</span><span class=n>t</span><span class=p>[</span><span class=s1>&#39;return_pct&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>breakout_trades</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;突破交易平均收益: </span><span class=si>{</span><span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>breakout_returns</span><span class=p>)</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;止损交易次数: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>stop_loss_trades</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;时间止损次数: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>time_exit_trades</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 显示最近5次交易</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>最近5次交易:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>trade</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>bb_trades</span><span class=p>[</span><span class=o>-</span><span class=mi>5</span><span class=p>:],</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>. </span><span class=si>{</span><span class=n>trade</span><span class=p>[</span><span class=s1>&#39;entry_date&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%Y-%m-</span><span class=si>%d</span><span class=s1>&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2> 买入 - &#34;</span>
</span></span><span class=line><span class=cl>              <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>trade</span><span class=p>[</span><span class=s1>&#39;exit_date&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%Y-%m-</span><span class=si>%d</span><span class=s1>&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2> 卖出 - &#34;</span>
</span></span><span class=line><span class=cl>              <span class=sa>f</span><span class=s2>&#34;收益: </span><span class=si>{</span><span class=n>trade</span><span class=p>[</span><span class=s1>&#39;return_pct&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>% - 持仓: </span><span class=si>{</span><span class=n>trade</span><span class=p>[</span><span class=s1>&#39;holding_days&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>天 - &#34;</span>
</span></span><span class=line><span class=cl>              <span class=sa>f</span><span class=s2>&#34;策略: </span><span class=si>{</span><span class=n>trade</span><span class=p>[</span><span class=s1>&#39;strategy&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;策略未产生任何交易信号&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 布林带挤压突破策略</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>bb_squeeze_breakout_strategy</span><span class=p>(</span><span class=n>prices</span><span class=p>,</span> <span class=n>upper_band</span><span class=p>,</span> <span class=n>lower_band</span><span class=p>,</span> <span class=n>bandwidth</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                                <span class=n>squeeze_threshold</span><span class=o>=-</span><span class=mf>1.5</span><span class=p>,</span> <span class=n>holding_period</span><span class=o>=</span><span class=mi>15</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;布林带挤压突破策略&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>trades</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>positions</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>current_position</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>entry_price</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>entry_date</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 计算带宽Z值</span>
</span></span><span class=line><span class=cl>    <span class=n>bandwidth_ma</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>bandwidth</span><span class=p>)</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>bandwidth_std</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>bandwidth</span><span class=p>)</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=o>.</span><span class=n>std</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>bandwidth_zscore</span> <span class=o>=</span> <span class=p>(</span><span class=n>bandwidth</span> <span class=o>-</span> <span class=n>bandwidth_ma</span><span class=p>)</span> <span class=o>/</span> <span class=n>bandwidth_std</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>21</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>prices</span><span class=p>)):</span>  <span class=c1># 从第21天开始，确保有足够的带宽数据</span>
</span></span><span class=line><span class=cl>        <span class=n>current_price</span> <span class=o>=</span> <span class=n>prices</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 识别挤压状态</span>
</span></span><span class=line><span class=cl>        <span class=n>is_squeeze</span> <span class=o>=</span> <span class=n>bandwidth_zscore</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>squeeze_threshold</span>
</span></span><span class=line><span class=cl>        <span class=n>was_squeeze</span> <span class=o>=</span> <span class=n>bandwidth_zscore</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>squeeze_threshold</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 挤压突破 - 向上突破</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=ow>not</span> <span class=n>is_squeeze</span> <span class=ow>and</span> <span class=n>was_squeeze</span> <span class=ow>and</span> 
</span></span><span class=line><span class=cl>            <span class=n>current_price</span> <span class=o>&gt;</span> <span class=n>upper_band</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=ow>and</span> 
</span></span><span class=line><span class=cl>            <span class=n>current_position</span> <span class=o>==</span> <span class=mi>0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>current_position</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=n>entry_price</span> <span class=o>=</span> <span class=n>current_price</span>
</span></span><span class=line><span class=cl>            <span class=n>entry_date</span> <span class=o>=</span> <span class=n>dates</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>positions</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;date&#39;</span><span class=p>:</span> <span class=n>dates</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;action&#39;</span><span class=p>:</span> <span class=s1>&#39;买入&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;price&#39;</span><span class=p>:</span> <span class=n>current_price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;position&#39;</span><span class=p>:</span> <span class=n>current_position</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;bandwidth&#39;</span><span class=p>:</span> <span class=n>bandwidth</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;bandwidth_zscore&#39;</span><span class=p>:</span> <span class=n>bandwidth_zscore</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 挤压突破 - 向下突破</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=p>(</span><span class=ow>not</span> <span class=n>is_squeeze</span> <span class=ow>and</span> <span class=n>was_squeeze</span> <span class=ow>and</span> 
</span></span><span class=line><span class=cl>              <span class=n>current_price</span> <span class=o>&lt;</span> <span class=n>lower_band</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=ow>and</span> 
</span></span><span class=line><span class=cl>              <span class=n>current_position</span> <span class=o>==</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>exit_price</span> <span class=o>=</span> <span class=n>current_price</span>
</span></span><span class=line><span class=cl>            <span class=n>return_pct</span> <span class=o>=</span> <span class=p>(</span><span class=n>exit_price</span> <span class=o>-</span> <span class=n>entry_price</span><span class=p>)</span> <span class=o>/</span> <span class=n>entry_price</span> <span class=o>*</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>            <span class=n>holding_days</span> <span class=o>=</span> <span class=p>(</span><span class=n>dates</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=n>entry_date</span><span class=p>)</span><span class=o>.</span><span class=n>days</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>trades</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;entry_date&#39;</span><span class=p>:</span> <span class=n>entry_date</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;exit_date&#39;</span><span class=p>:</span> <span class=n>dates</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;entry_price&#39;</span><span class=p>:</span> <span class=n>entry_price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;exit_price&#39;</span><span class=p>:</span> <span class=n>exit_price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;return_pct&#39;</span><span class=p>:</span> <span class=n>return_pct</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;holding_days&#39;</span><span class=p>:</span> <span class=n>holding_days</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;strategy&#39;</span><span class=p>:</span> <span class=s1>&#39;挤压突破&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>current_position</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>positions</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;date&#39;</span><span class=p>:</span> <span class=n>dates</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;action&#39;</span><span class=p>:</span> <span class=s1>&#39;卖出&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;price&#39;</span><span class=p>:</span> <span class=n>current_price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;position&#39;</span><span class=p>:</span> <span class=n>current_position</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;bandwidth&#39;</span><span class=p>:</span> <span class=n>bandwidth</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;bandwidth_zscore&#39;</span><span class=p>:</span> <span class=n>bandwidth_zscore</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 时间出场</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>current_position</span> <span class=o>==</span> <span class=mi>1</span> <span class=ow>and</span> <span class=p>(</span><span class=n>dates</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=n>entry_date</span><span class=p>)</span><span class=o>.</span><span class=n>days</span> <span class=o>&gt;=</span> <span class=n>holding_period</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>exit_price</span> <span class=o>=</span> <span class=n>current_price</span>
</span></span><span class=line><span class=cl>            <span class=n>return_pct</span> <span class=o>=</span> <span class=p>(</span><span class=n>exit_price</span> <span class=o>-</span> <span class=n>entry_price</span><span class=p>)</span> <span class=o>/</span> <span class=n>entry_price</span> <span class=o>*</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>            <span class=n>holding_days</span> <span class=o>=</span> <span class=p>(</span><span class=n>dates</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=n>entry_date</span><span class=p>)</span><span class=o>.</span><span class=n>days</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>trades</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;entry_date&#39;</span><span class=p>:</span> <span class=n>entry_date</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;exit_date&#39;</span><span class=p>:</span> <span class=n>dates</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;entry_price&#39;</span><span class=p>:</span> <span class=n>entry_price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;exit_price&#39;</span><span class=p>:</span> <span class=n>exit_price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;return_pct&#39;</span><span class=p>:</span> <span class=n>return_pct</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;holding_days&#39;</span><span class=p>:</span> <span class=n>holding_days</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;strategy&#39;</span><span class=p>:</span> <span class=s1>&#39;时间出场&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>current_position</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>positions</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;date&#39;</span><span class=p>:</span> <span class=n>dates</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;action&#39;</span><span class=p>:</span> <span class=s1>&#39;时间出场&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;price&#39;</span><span class=p>:</span> <span class=n>current_price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;position&#39;</span><span class=p>:</span> <span class=n>current_position</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;bandwidth&#39;</span><span class=p>:</span> <span class=n>bandwidth</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;bandwidth_zscore&#39;</span><span class=p>:</span> <span class=n>bandwidth_zscore</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>trades</span><span class=p>,</span> <span class=n>positions</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 执行挤压突破策略回测</span>
</span></span><span class=line><span class=cl><span class=n>squeeze_trades</span><span class=p>,</span> <span class=n>squeeze_positions</span> <span class=o>=</span> <span class=n>bb_squeeze_breakout_strategy</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>close_prices</span><span class=p>,</span> <span class=n>upper_band</span><span class=p>,</span> <span class=n>lower_band</span><span class=p>,</span> <span class=n>bandwidth</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 布林带挤压突破策略回测结果 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;总交易次数: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>squeeze_trades</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>squeeze_trades</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>squeeze_returns</span> <span class=o>=</span> <span class=p>[</span><span class=n>trade</span><span class=p>[</span><span class=s1>&#39;return_pct&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>trade</span> <span class=ow>in</span> <span class=n>squeeze_trades</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>squeeze_win_rate</span> <span class=o>=</span> <span class=nb>len</span><span class=p>([</span><span class=n>r</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>squeeze_returns</span> <span class=k>if</span> <span class=n>r</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>])</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>squeeze_returns</span><span class=p>)</span> <span class=o>*</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>    <span class=n>squeeze_avg_return</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>squeeze_returns</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;胜率: </span><span class=si>{</span><span class=n>squeeze_win_rate</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;平均收益率: </span><span class=si>{</span><span class=n>squeeze_avg_return</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;策略对比: </span><span class=si>{</span><span class=s1>&#39;挤压突破策略表现更好&#39;</span> <span class=k>if</span> <span class=n>squeeze_avg_return</span> <span class=o>&gt;</span> <span class=n>avg_return</span> <span class=k>else</span> <span class=s1>&#39;突破策略表现更好&#39;</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;挤压突破策略未产生交易信号&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 布林带与RSI组合策略</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>bb_rsi_combination</span><span class=p>(</span><span class=n>prices</span><span class=p>,</span> <span class=n>upper_band</span><span class=p>,</span> <span class=n>lower_band</span><span class=p>,</span> <span class=n>rsi_values</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                     <span class=n>rsi_oversold</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span> <span class=n>rsi_overbought</span><span class=o>=</span><span class=mi>70</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;布林带与RSI组合策略&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 布林带信号</span>
</span></span><span class=line><span class=cl>    <span class=n>bb_bullish</span> <span class=o>=</span> <span class=p>(</span><span class=n>prices</span> <span class=o>&gt;</span> <span class=n>lower_band</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>prices</span><span class=o>.</span><span class=n>shift</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=n>lower_band</span><span class=o>.</span><span class=n>shift</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>bb_bearish</span> <span class=o>=</span> <span class=p>(</span><span class=n>prices</span> <span class=o>&lt;</span> <span class=n>upper_band</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>prices</span><span class=o>.</span><span class=n>shift</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=n>upper_band</span><span class=o>.</span><span class=n>shift</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># RSI信号</span>
</span></span><span class=line><span class=cl>    <span class=n>rsi_bullish</span> <span class=o>=</span> <span class=p>(</span><span class=n>rsi_values</span> <span class=o>&gt;</span> <span class=n>rsi_oversold</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>rsi_values</span><span class=o>.</span><span class=n>shift</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=n>rsi_oversold</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>rsi_bearish</span> <span class=o>=</span> <span class=p>(</span><span class=n>rsi_values</span> <span class=o>&lt;</span> <span class=n>rsi_overbought</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>rsi_values</span><span class=o>.</span><span class=n>shift</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=n>rsi_overbought</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 组合信号</span>
</span></span><span class=line><span class=cl>    <span class=n>combined_bullish</span> <span class=o>=</span> <span class=n>bb_bullish</span> <span class=o>&amp;</span> <span class=n>rsi_bullish</span>
</span></span><span class=line><span class=cl>    <span class=n>combined_bearish</span> <span class=o>=</span> <span class=n>bb_bearish</span> <span class=o>&amp;</span> <span class=n>rsi_bearish</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>combined_bullish</span><span class=p>,</span> <span class=n>combined_bearish</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 执行组合策略分析</span>
</span></span><span class=line><span class=cl><span class=n>rsi_14</span> <span class=o>=</span> <span class=n>talib</span><span class=o>.</span><span class=n>RSI</span><span class=p>(</span><span class=n>close_prices</span><span class=p>,</span> <span class=n>timeperiod</span><span class=o>=</span><span class=mi>14</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>combined_bullish</span><span class=p>,</span> <span class=n>combined_bearish</span> <span class=o>=</span> <span class=n>bb_rsi_combination</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>close_prices</span><span class=p>,</span> <span class=n>upper_band</span><span class=p>,</span> <span class=n>lower_band</span><span class=p>,</span> <span class=n>rsi_14</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 布林带+RSI组合信号分析 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;看涨组合信号次数: </span><span class=si>{</span><span class=n>combined_bullish</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;看跌组合信号次数: </span><span class=si>{</span><span class=n>combined_bearish</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 当前组合状态</span>
</span></span><span class=line><span class=cl><span class=n>current_combined_bullish</span> <span class=o>=</span> <span class=n>combined_bullish</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>current_combined_bearish</span> <span class=o>=</span> <span class=n>combined_bearish</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>current_combined_bullish</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>combined_signal</span> <span class=o>=</span> <span class=s2>&#34;强烈看涨 - 布林带下轨反弹+RSI超卖回升&#34;</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=n>current_combined_bearish</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>combined_signal</span> <span class=o>=</span> <span class=s2>&#34;强烈看跌 - 布林带上轨受阻+RSI超买回落&#34;</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>combined_signal</span> <span class=o>=</span> <span class=s2>&#34;中性观望 - 指标信号不一致&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;当前组合状态: </span><span class=si>{</span><span class=n>combined_signal</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=布林带指标可视化分析>布林带指标可视化分析</h3><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建布林带综合分析图表</span>
</span></span><span class=line><span class=cl><span class=n>fig</span><span class=p>,</span> <span class=n>axes</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>16</span><span class=p>,</span> <span class=mi>14</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 主图：价格与布林带</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>dates</span><span class=p>,</span> <span class=n>close_prices</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;收盘价&#39;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;black&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>dates</span><span class=p>,</span> <span class=n>upper_band</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;布林带上轨&#39;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mf>1.5</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;red&#39;</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.8</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>dates</span><span class=p>,</span> <span class=n>middle_band</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;布林带中轨&#39;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mf>1.5</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;blue&#39;</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.8</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>dates</span><span class=p>,</span> <span class=n>lower_band</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;布林带下轨&#39;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mf>1.5</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;green&#39;</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 填充布林带区域</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>fill_between</span><span class=p>(</span><span class=n>dates</span><span class=p>,</span> <span class=n>upper_band</span><span class=p>,</span> <span class=n>lower_band</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.1</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;gray&#39;</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;布林带通道&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 标记突破信号</span>
</span></span><span class=line><span class=cl><span class=n>breakout_up_dates</span> <span class=o>=</span> <span class=n>dates</span><span class=p>[</span><span class=n>bb_signals</span><span class=p>[</span><span class=s1>&#39;break_upper&#39;</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=n>breakout_down_dates</span> <span class=o>=</span> <span class=n>dates</span><span class=p>[</span><span class=n>bb_signals</span><span class=p>[</span><span class=s1>&#39;break_lower&#39;</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>breakout_up_dates</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>breakout_up_prices</span> <span class=o>=</span> <span class=n>close_prices</span><span class=p>[</span><span class=n>bb_signals</span><span class=p>[</span><span class=s1>&#39;break_upper&#39;</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>    <span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>breakout_up_dates</span><span class=p>,</span> <span class=n>breakout_up_prices</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;red&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                   <span class=n>marker</span><span class=o>=</span><span class=s1>&#39;^&#39;</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;向上突破&#39;</span><span class=p>,</span> <span class=n>zorder</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>breakout_down_dates</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>breakout_down_prices</span> <span class=o>=</span> <span class=n>close_prices</span><span class=p>[</span><span class=n>bb_signals</span><span class=p>[</span><span class=s1>&#39;break_lower&#39;</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>    <span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>breakout_down_dates</span><span class=p>,</span> <span class=n>breakout_down_prices</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;green&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                   <span class=n>marker</span><span class=o>=</span><span class=s1>&#39;v&#39;</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;向下突破&#39;</span><span class=p>,</span> <span class=n>zorder</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;布林带价格通道分析&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>14</span><span class=p>,</span> <span class=n>fontweight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=s1>&#39;价格&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>legend</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>grid</span><span class=p>(</span><span class=kc>True</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 副图1：%b指标</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>dates</span><span class=p>,</span> <span class=n>percent_b</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;%b指标&#39;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;purple&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span><span class=n>y</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;red&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.7</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;上轨线&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span><span class=n>y</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;blue&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;-&#39;</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;中轨线&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span><span class=n>y</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;green&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.7</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;下轨线&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span><span class=n>y</span><span class=o>=</span><span class=mf>0.8</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;orange&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;:&#39;</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.6</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;强势线&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span><span class=n>y</span><span class=o>=</span><span class=mf>0.2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;orange&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;:&#39;</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.6</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;弱势线&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 填充区域</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>fill_between</span><span class=p>(</span><span class=n>dates</span><span class=p>,</span> <span class=mf>0.8</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;red&#39;</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;强势区域&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>fill_between</span><span class=p>(</span><span class=n>dates</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;green&#39;</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;弱势区域&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;%b指标 - 价格在布林带中的相对位置&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>14</span><span class=p>,</span> <span class=n>fontweight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=s1>&#39;%b值&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>set_ylim</span><span class=p>(</span><span class=o>-</span><span class=mf>0.2</span><span class=p>,</span> <span class=mf>1.2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>legend</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>grid</span><span class=p>(</span><span class=kc>True</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 副图2：带宽指标</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>dates</span><span class=p>,</span> <span class=n>bandwidth</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;带宽指标&#39;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;brown&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>bw_ma_line</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>bandwidth</span><span class=p>)</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>dates</span><span class=p>,</span> <span class=n>bw_ma_line</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;20日均值&#39;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mf>1.5</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;blue&#39;</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 标记挤压状态</span>
</span></span><span class=line><span class=cl><span class=n>squeeze_dates</span> <span class=o>=</span> <span class=n>dates</span><span class=p>[</span><span class=n>squeeze_condition</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>squeeze_dates</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>squeeze_bandwidth</span> <span class=o>=</span> <span class=n>bandwidth</span><span class=p>[</span><span class=n>squeeze_condition</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>axes</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>squeeze_dates</span><span class=p>,</span> <span class=n>squeeze_bandwidth</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;red&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                   <span class=n>marker</span><span class=o>=</span><span class=s1>&#39;o&#39;</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mi>50</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;挤压状态&#39;</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.7</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;布林带带宽 - 市场波动率分析&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>14</span><span class=p>,</span> <span class=n>fontweight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=s1>&#39;带宽(%)&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span><span class=n>legend</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span><span class=n>grid</span><span class=p>(</span><span class=kc>True</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 副图3：RSI与布林带组合</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>dates</span><span class=p>,</span> <span class=n>rsi_14</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;RSI 14&#39;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;purple&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span><span class=n>y</span><span class=o>=</span><span class=mi>70</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;red&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.7</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;超买线&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span><span class=n>y</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;green&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.7</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;超卖线&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 标记组合信号</span>
</span></span><span class=line><span class=cl><span class=n>combined_bullish_dates</span> <span class=o>=</span> <span class=n>dates</span><span class=p>[</span><span class=n>combined_bullish</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>combined_bearish_dates</span> <span class=o>=</span> <span class=n>dates</span><span class=p>[</span><span class=n>combined_bearish</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>combined_bullish_dates</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>combined_bullish_rsi</span> <span class=o>=</span> <span class=n>rsi_14</span><span class=p>[</span><span class=n>combined_bullish</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>axes</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>combined_bullish_dates</span><span class=p>,</span> <span class=n>combined_bullish_rsi</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                     <span class=n>color</span><span class=o>=</span><span class=s1>&#39;green&#39;</span><span class=p>,</span> <span class=n>marker</span><span class=o>=</span><span class=s1>&#39;^&#39;</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mi>80</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;看涨组合&#39;</span><span class=p>,</span> <span class=n>zorder</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>combined_bearish_dates</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>combined_bearish_rsi</span> <span class=o>=</span> <span class=n>rsi_14</span><span class=p>[</span><span class=n>combined_bearish</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>axes</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>combined_bearish_dates</span><span class=p>,</span> <span class=n>combined_bearish_rsi</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                     <span class=n>color</span><span class=o>=</span><span class=s1>&#39;red&#39;</span><span class=p>,</span> <span class=n>marker</span><span class=o>=</span><span class=s1>&#39;v&#39;</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mi>80</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;看跌组合&#39;</span><span class=p>,</span> <span class=n>zorder</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;RSI与布林带组合信号&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>14</span><span class=p>,</span> <span class=n>fontweight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=s1>&#39;RSI值&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>.</span><span class=n>set_xlabel</span><span class=p>(</span><span class=s1>&#39;日期&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>.</span><span class=n>set_ylim</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>.</span><span class=n>legend</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>.</span><span class=n>grid</span><span class=p>(</span><span class=kc>True</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>tight_layout</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生成综合交易建议</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 布林带综合分析与交易建议 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;当前价格: </span><span class=si>{</span><span class=n>current_price</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;布林带位置: </span><span class=si>{</span><span class=n>position_status</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;带宽状态: </span><span class=si>{</span><span class=n>bandwidth_status</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;趋势状态: </span><span class=si>{</span><span class=n>trend_status</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;布林带评分: </span><span class=si>{</span><span class=n>current_score</span><span class=si>}</span><span class=s2> - </span><span class=si>{</span><span class=n>bb_recommendation</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 具体操作建议</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>current_score</span> <span class=o>&gt;=</span> <span class=mi>3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>action</span> <span class=o>=</span> <span class=s2>&#34;积极做多 - 布林带多重信号看涨&#34;</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=n>current_score</span> <span class=o>&gt;=</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>action</span> <span class=o>=</span> <span class=s2>&#34;谨慎做多 - 布林带信号偏向看涨&#34;</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=n>current_score</span> <span class=o>&lt;=</span> <span class=o>-</span><span class=mi>3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>action</span> <span class=o>=</span> <span class=s2>&#34;积极做空 - 布林带多重信号看跌&#34;</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=n>current_score</span> <span class=o>&lt;=</span> <span class=o>-</span><span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>action</span> <span class=o>=</span> <span class=s2>&#34;谨慎做空 - 布林带信号偏向看跌&#34;</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>action</span> <span class=o>=</span> <span class=s2>&#34;观望等待 - 等待更明确的信号&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>操作建议: </span><span class=si>{</span><span class=n>action</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;风险提示: 布林带指标在趋势行情中可能持续处于极端位置&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;建议: 结合其他技术指标和基本面分析进行综合判断&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 策略表现对比</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>bb_trades</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>squeeze_trades</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 策略表现对比 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;突破策略: 胜率</span><span class=si>{</span><span class=n>win_rate</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>%, 平均收益</span><span class=si>{</span><span class=n>avg_return</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;挤压策略: 胜率</span><span class=si>{</span><span class=n>squeeze_win_rate</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>%, 平均收益</span><span class=si>{</span><span class=n>squeeze_avg_return</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;推荐策略: </span><span class=si>{</span><span class=s1>&#39;挤压突破策略&#39;</span> <span class=k>if</span> <span class=n>squeeze_avg_return</span> <span class=o>&gt;</span> <span class=n>avg_return</span> <span class=k>else</span> <span class=s1>&#39;上轨突破策略&#39;</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 策略分析 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;建议结合多种策略，根据市场环境选择合适的布林带策略&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;挤压突破策略适合震荡后的突破行情&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;上轨突破策略适合趋势延续行情&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div></div></article><aside class="lg:w-80 xl:w-96"><div class=space-y-8></div></aside></div><nav class="border-t border-gray-200 mt-12 pt-8"><div class="flex justify-between items-center"><a href=/blog/%E6%8A%80%E6%9C%AF%E6%8C%87%E6%A0%87/03-rsi%E7%9B%B8%E5%AF%B9%E5%BC%BA%E5%BC%B1%E6%8C%87%E6%A0%87/ class="group flex items-center"><svg class="w-5 h-5 mr-2 text-gray-600 group-hover:text-primary-600" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0 7-7m-7 7h18"/></svg><div><div class="text-sm text-gray-600">上一篇</div><div class="font-medium group-hover:text-primary-600">技术指标第3讲：RSI相对强弱指标</div></div></a><a href=/blog/%E6%8A%80%E6%9C%AF%E6%8C%87%E6%A0%87/05-kdj%E9%9A%8F%E6%9C%BA%E6%8C%87%E6%A0%87/ class="group flex items-center text-right"><div><div class="text-sm text-gray-600">Next Post</div><div class="font-medium group-hover:text-primary-600">技术指标第5讲：KDJ随机指标</div></div><svg class="w-5 h-5 ml-2 text-gray-600 group-hover:text-primary-600" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0-7 7m7-7H3"/></svg></a></div></nav></div></div><footer class="bg-gray-50 py-12 border-t border-gray-200"><div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl"><div class="flex flex-col md:flex-row justify-between space-y-4 md:space-y-0"><div class=flex-1><div class="flex items-center space-x-3 mb-4"><a href=https://sk-quant.github.io/ class=inline-block><img src=/images/logo.svg alt=烧烤量化 class=h-6>
</a><span class="text-xl font-bold text-gray-900">烧烤量化</span></div><div class="flex space-x-3 p-2"></div></div><div class=flex-1><h3 class="text-sm font-semibold uppercase tracking-wider text-gray-900 mb-4"></h3><ul class=space-y-2></ul></div><div class=flex-1><h3 class="text-sm font-semibold uppercase tracking-wider text-gray-900 mb-4"></h3><ul class=space-y-2></ul></div><div class=flex-1><h3 class="text-sm font-semibold uppercase tracking-wider text-gray-900 mb-4"></h3><ul class=space-y-2></ul></div></div><div class="mt-12 pt-8 border-t border-gray-200"><div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0"><p class="text-gray-600 text-sm">© 2025 烧烤量化. All rights reserved.</p><a href=https://chaoming.li class="text-sm text-gray-600 hover:text-primary-600" target=_blank rel="noopener noreferrer">Powered by sk-quant</a></div></div></div></footer><script>const mobileMenuButton=document.getElementById("mobile-menu-button");mobileMenuButton&&mobileMenuButton.addEventListener("click",function(){const e=document.getElementById("mobile-menu");e&&e.classList.toggle("hidden")})</script></body></html>