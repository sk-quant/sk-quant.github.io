<!doctype html><html lang=zh-cn class=h-full><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-XXXXXXX")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XXXXXXXXXX")</script><title>SuperMind第6讲：事件驱动策略开发 | 烧烤量化</title>
<meta name=description content="学习在SuperMind平台上开发基于事件驱动的量化交易策略"><meta name=author content="Ryan"><meta name=robots content="index, follow"><meta property="og:title" content="SuperMind第6讲：事件驱动策略开发 | 烧烤量化"><meta property="og:description" content="学习在SuperMind平台上开发基于事件驱动的量化交易策略"><meta property="og:type" content="article"><meta property="og:url" content="https://sk-quant.github.io/blog/%E5%9B%9E%E6%B5%8B%E5%B9%B3%E5%8F%B0/06-%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8%E7%AD%96%E7%95%A5%E5%BC%80%E5%8F%91/"><meta property="og:site_name" content="烧烤量化"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="SuperMind第6讲：事件驱动策略开发 | 烧烤量化"><meta name=twitter:description content="学习在SuperMind平台上开发基于事件驱动的量化交易策略"><link rel=icon type=image/x-icon href=/images/favicon.ico><link rel=canonical href=https://sk-quant.github.io/blog/%E5%9B%9E%E6%B5%8B%E5%B9%B3%E5%8F%B0/06-%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8%E7%AD%96%E7%95%A5%E5%BC%80%E5%8F%91/><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@600;700;800&display=swap" rel=stylesheet><link rel=stylesheet href="/css/main.min.9a3c970d7feebe1317992d10ced98f226635b831a963ee601e5901734ff0da21.css"></head><body class="min-h-screen flex flex-col"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-XXXXXXX" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><div class="fixed top-0 left-0 right-0 z-50"><div class=mobile-menu-wrapper><input type=checkbox id=nav-toggle class=nav-toggle><header class="fixed w-full top-0 z-50 bg-white/80 backdrop-blur-sm border-b border-gray-100"><div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl"><nav class="flex items-center justify-between h-20"><a href=https://sk-quant.github.io/ class="flex items-center space-x-4"><img src=/images/logo.svg alt=烧烤量化 class=h-12>
<span class="text-3xl font-semibold text-gray-800">烧烤量化</span></a><div class="hidden md:flex items-center space-x-8"><a href=/path class="text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">学习路线</a><div class="relative group"><button class="flex items-center text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">
量化基础<svg class="ml-2 w-4 h-4" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></button><div class="absolute left-0 mt-2 w-72 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 ease-in-out"><div class="py-6 bg-white border border-gray-100 shadow-xl rounded-lg"><a href=/categories/%e6%8a%95%e8%b5%84%e7%90%86%e8%ae%ba/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">投资理论</a>
<a href=/categories/%e4%bb%a3%e7%a0%81%e5%9f%ba%e7%a1%80/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">代码基础</a>
<a href=/categories/%e6%8a%80%e6%9c%af%e6%8c%87%e6%a0%87/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">技术指标</a>
<a href=/categories/%e5%9b%9e%e6%b5%8b%e5%b9%b3%e5%8f%b0/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">回测平台</a></div></div></div><div class="relative group"><button class="flex items-center text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">
量化进阶<svg class="ml-2 w-4 h-4" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></button><div class="absolute left-0 mt-2 w-72 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 ease-in-out"><div class="py-6 bg-white border border-gray-100 shadow-xl rounded-lg"><a href=/categories/%e7%ad%96%e7%95%a5%e5%88%86%e4%ba%ab/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">策略分享</a>
<a href=/categories/%e5%ae%9e%e7%9b%98%e5%b7%a5%e5%85%b7/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">实盘工具</a>
<a href=/categories/%e7%83%ad%e7%82%b9%e9%a3%8e%e5%8f%a3/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">热点风口</a>
<a href=/categories/%e7%bb%bc%e5%90%88%e5%ae%9e%e6%88%98/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">综合实战</a></div></div></div><div class="relative group"><button class="flex items-center text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">
量化高手<svg class="ml-2 w-4 h-4" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></button><div class="absolute left-0 mt-2 w-72 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 ease-in-out"><div class="py-6 bg-white border border-gray-100 shadow-xl rounded-lg"><a href=/categories/%e5%8f%af%e8%bd%ac%e5%80%ba/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">可转债</a>
<a href=/categories/%e8%9e%8d%e8%b5%84%e8%9e%8d%e5%88%b8/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">融资融券</a>
<a href=/categories/%e8%82%a1%e7%a5%a8%e6%9c%9f%e6%9d%83/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">股票期权</a>
<a href=/categories/%e8%82%a1%e6%8c%87%e6%9c%9f%e8%b4%a7/ class="block px-8 py-3 text-sm text-gray-700 hover:bg-gray-50">股指期货</a></div></div></div><a href=/pricing class="text-base text-gray-900 hover:text-primary-600 font-bold transition duration-200">服务套餐</a></div><div class="hidden md:flex items-center space-x-4"><a href=/contact class="inline-flex items-center justify-center px-6 py-3 rounded-lg font-bold transition duration-200 ease-in-out bg-primary-600 text-white hover:bg-primary-700 hover:scale-105">现在加入</a></div><div class=md:hidden><label for=nav-toggle class="p-2 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:ring-offset-2 transition-colors cursor-pointer"><svg class="w-6 h-6" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></label></div></nav></div><div class="nav-content md:hidden w-full fixed left-0 right-0 top-20 bg-white border-t border-gray-100 shadow-lg"><div class="w-full px-6 py-4"><a href=/path class="block text-xl text-gray-900 hover:text-primary-600 font-bold transition duration-200 py-2">学习路线</a><div class=py-2><div class="text-xl text-gray-900 font-bold mb-2">量化基础</div><div class=pl-4><a href=/categories/%e6%8a%95%e8%b5%84%e7%90%86%e8%ae%ba/ class="block text-gray-700 hover:text-primary-600 py-2">投资理论</a>
<a href=/categories/%e4%bb%a3%e7%a0%81%e5%9f%ba%e7%a1%80/ class="block text-gray-700 hover:text-primary-600 py-2">代码基础</a>
<a href=/categories/%e6%8a%80%e6%9c%af%e6%8c%87%e6%a0%87/ class="block text-gray-700 hover:text-primary-600 py-2">技术指标</a>
<a href=/categories/%e5%9b%9e%e6%b5%8b%e5%b9%b3%e5%8f%b0/ class="block text-gray-700 hover:text-primary-600 py-2">回测平台</a></div></div><div class=py-2><div class="text-xl text-gray-900 font-bold mb-2">量化进阶</div><div class=pl-4><a href=/categories/%e7%ad%96%e7%95%a5%e5%88%86%e4%ba%ab/ class="block text-gray-700 hover:text-primary-600 py-2">策略分享</a>
<a href=/categories/%e5%ae%9e%e7%9b%98%e5%b7%a5%e5%85%b7/ class="block text-gray-700 hover:text-primary-600 py-2">实盘工具</a>
<a href=/categories/%e7%83%ad%e7%82%b9%e9%a3%8e%e5%8f%a3/ class="block text-gray-700 hover:text-primary-600 py-2">热点风口</a>
<a href=/categories/%e7%bb%bc%e5%90%88%e5%ae%9e%e6%88%98/ class="block text-gray-700 hover:text-primary-600 py-2">综合实战</a></div></div><div class=py-2><div class="text-xl text-gray-900 font-bold mb-2">量化高手</div><div class=pl-4><a href=/categories/%e5%8f%af%e8%bd%ac%e5%80%ba/ class="block text-gray-700 hover:text-primary-600 py-2">可转债</a>
<a href=/categories/%e8%9e%8d%e8%b5%84%e8%9e%8d%e5%88%b8/ class="block text-gray-700 hover:text-primary-600 py-2">融资融券</a>
<a href=/categories/%e8%82%a1%e7%a5%a8%e6%9c%9f%e6%9d%83/ class="block text-gray-700 hover:text-primary-600 py-2">股票期权</a>
<a href=/categories/%e8%82%a1%e6%8c%87%e6%9c%9f%e8%b4%a7/ class="block text-gray-700 hover:text-primary-600 py-2">股指期货</a></div></div><a href=/pricing class="block text-xl text-gray-900 hover:text-primary-600 font-bold transition duration-200 py-2">服务套餐</a><div class="pt-4 space-y-4"><a href=/contact class="block text-center px-6 py-3 rounded-lg font-bold transition duration-200 ease-in-out bg-primary-600 text-white hover:bg-primary-700 hover:scale-105">现在加入</a></div></div></div></header><style>.mobile-menu-wrapper{position:relative}.nav-toggle{display:none}.nav-content{display:none}.nav-toggle:checked~header .nav-content{display:block}</style></div></div><div class=pt-20><div class="container mx-auto px-4 py-12"><div class="flex flex-col lg:flex-row gap-8 mb-12"><article class=flex-1><header class=mb-8><div class=mb-4><a href=/categories/%E5%9B%9E%E6%B5%8B%E5%B9%B3%E5%8F%B0 class="inline-block px-3 py-1 text-sm font-medium text-primary-600 bg-primary-50 rounded-full hover:bg-primary-100 mr-2">回测平台</a></div><h1 class="text-4xl font-bold mb-4">SuperMind第6讲：事件驱动策略开发</h1><div class="flex flex-col space-y-4"><div class="flex items-center justify-between text-sm text-gray-500"><div class="flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7A4 4 0 118 7a4 4 0 018 0zm-4 7a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
<span>Ryan</span></div><div class="flex items-center space-x-6"><div class="flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747.0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746.0-3.332.477-4.5 1.253"/></svg>
<span>18 分钟</span></div><div class="flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5A2 2 0 003 7v12a2 2 0 002 2z"/></svg>
<time datetime=2025-09-26>September 26, 2025</time></div></div></div><div class="flex items-center flex-wrap gap-2"><a href=/tags/2025 class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 transition-colors duration-200">#2025
</a><a href=/tags/supermind class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 transition-colors duration-200">#SuperMind</a></div></div></header><div class=mb-8><img src=/images/blog/%e5%9b%9e%e6%b5%8b%e5%b9%b3%e5%8f%b0.jpg alt=SuperMind第6讲：事件驱动策略开发 class="w-full h-auto rounded-lg" loading=lazy></div><div class="prose prose-lg max-w-none"><h2 id=学习目标>学习目标</h2><ul><li>理解事件驱动策略的基本概念和分类</li><li>掌握SuperMind平台事件数据的获取和处理</li><li>学会构建不同类型的事件驱动策略</li><li>掌握事件效应分析和策略优化方法</li></ul><div class="bg-gray-50 p-6 rounded-lg mb-8"><h2 class="text-xl font-semibold mb-4">目录</h2><nav id=TableOfContents><ul><li><a href=#学习目标>学习目标</a></li><li><a href=#事件驱动策略基础>事件驱动策略基础</a><ul><li><a href=#事件类型分类>事件类型分类</a></li><li><a href=#事件效应分析>事件效应分析</a></li></ul></li><li><a href=#具体事件驱动策略>具体事件驱动策略</a><ul><li><a href=#业绩超预期策略>业绩超预期策略</a></li><li><a href=#分红事件策略>分红事件策略</a></li><li><a href=#并购重组策略>并购重组策略</a></li></ul></li><li><a href=#完整事件驱动策略实现>完整事件驱动策略实现</a></li><li><a href=#总结>总结</a></li></ul></nav></div><h2 id=事件驱动策略基础>事件驱动策略基础</h2><h3 id=事件类型分类>事件类型分类</h3><p>事件驱动策略是基于特定公司事件或市场事件进行交易的投资策略：</p><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>event_driven_overview</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    事件驱动策略概览
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>events</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;公司事件&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;业绩公告&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;年报&#39;</span><span class=p>:</span> <span class=s1>&#39;年度财务报告&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;中报&#39;</span><span class=p>:</span> <span class=s1>&#39;半年度财务报告&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=s1>&#39;季报&#39;</span><span class=p>:</span> <span class=s1>&#39;季度财务报告&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;业绩预告&#39;</span><span class=p>:</span> <span class=s1>&#39;业绩预增预减公告&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;分红送配&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;分红预案&#39;</span><span class=p>:</span> <span class=s1>&#39;利润分配预案&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;除权除息&#39;</span><span class=p>:</span> <span class=s1>&#39;分红实施公告&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;送股&#39;</span><span class=p>:</span> <span class=s1>&#39;送股公告&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;转增&#39;</span><span class=p>:</span> <span class=s1>&#39;转增股本公告&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;股权变动&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;增持&#39;</span><span class=p>:</span> <span class=s1>&#39;大股东增持&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;减持&#39;</span><span class=p>:</span> <span class=s1>&#39;大股东减持&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;回购&#39;</span><span class=p>:</span> <span class=s1>&#39;股份回购&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;股权激励&#39;</span><span class=p>:</span> <span class=s1>&#39;股权激励计划&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;再融资&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;定向增发&#39;</span><span class=p>:</span> <span class=s1>&#39;非公开发行&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;公开增发&#39;</span><span class=p>:</span> <span class=s1>&#39;公开发行&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;配股&#39;</span><span class=p>:</span> <span class=s1>&#39;配股公告&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;可转债&#39;</span><span class=p>:</span> <span class=s1>&#39;可转债发行&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;并购重组&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;重大资产重组&#39;</span><span class=p>:</span> <span class=s1>&#39;资产重组公告&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;收购&#39;</span><span class=p>:</span> <span class=s1>&#39;收购公告&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;兼并&#39;</span><span class=p>:</span> <span class=s1>&#39;兼并公告&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;分立&#39;</span><span class=p>:</span> <span class=s1>&#39;分立公告&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;市场事件&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;指数调整&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;成分股调整&#39;</span><span class=p>:</span> <span class=s1>&#39;指数成分股变更&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;权重调整&#39;</span><span class=p>:</span> <span class=s1>&#39;指数权重调整&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;政策事件&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;货币政策&#39;</span><span class=p>:</span> <span class=s1>&#39;央行货币政策&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;财政政策&#39;</span><span class=p>:</span> <span class=s1>&#39;政府财政政策&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;监管政策&#39;</span><span class=p>:</span> <span class=s1>&#39;行业监管政策&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;突发事件&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;自然灾害&#39;</span><span class=p>:</span> <span class=s1>&#39;地震、洪水等&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;政治事件&#39;</span><span class=p>:</span> <span class=s1>&#39;选举、战争等&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;经济危机&#39;</span><span class=p>:</span> <span class=s1>&#39;金融危机等&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;技术事件&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;停复牌&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;停牌&#39;</span><span class=p>:</span> <span class=s1>&#39;股票停牌&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;复牌&#39;</span><span class=p>:</span> <span class=s1>&#39;股票复牌&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;涨跌停&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;涨停&#39;</span><span class=p>:</span> <span class=s1>&#39;股票涨停&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;跌停&#39;</span><span class=p>:</span> <span class=s1>&#39;股票跌停&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;异常波动&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;连续涨停&#39;</span><span class=p>:</span> <span class=s1>&#39;连续涨停&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;连续跌停&#39;</span><span class=p>:</span> <span class=s1>&#39;连续跌停&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>events</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_event_data</span><span class=p>(</span><span class=n>event_type</span><span class=p>,</span> <span class=n>start_date</span><span class=p>,</span> <span class=n>end_date</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    获取事件数据
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 使用SuperMind的事件数据接口</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;earnings&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 业绩公告事件</span>
</span></span><span class=line><span class=cl>        <span class=n>events</span> <span class=o>=</span> <span class=n>get_earnings_announcements</span><span class=p>(</span><span class=n>start_date</span><span class=p>,</span> <span class=n>end_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;dividend&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 分红事件</span>
</span></span><span class=line><span class=cl>        <span class=n>events</span> <span class=o>=</span> <span class=n>get_dividend_events</span><span class=p>(</span><span class=n>start_date</span><span class=p>,</span> <span class=n>end_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;restructure&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 重组事件</span>
</span></span><span class=line><span class=cl>        <span class=n>events</span> <span class=o>=</span> <span class=n>get_restructure_events</span><span class=p>(</span><span class=n>start_date</span><span class=p>,</span> <span class=n>end_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;trading_halt&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 停复牌事件</span>
</span></span><span class=line><span class=cl>        <span class=n>events</span> <span class=o>=</span> <span class=n>get_trading_halt_events</span><span class=p>(</span><span class=n>start_date</span><span class=p>,</span> <span class=n>end_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>events</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>events</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_earnings_announcements</span><span class=p>(</span><span class=n>start_date</span><span class=p>,</span> <span class=n>end_date</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    获取业绩公告事件
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 获取业绩公告数据</span>
</span></span><span class=line><span class=cl>    <span class=n>earnings_df</span> <span class=o>=</span> <span class=n>get_financial_announcements</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>start_date</span><span class=o>=</span><span class=n>start_date</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>end_date</span><span class=o>=</span><span class=n>end_date</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>announcement_type</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;年报&#39;</span><span class=p>,</span> <span class=s1>&#39;中报&#39;</span><span class=p>,</span> <span class=s1>&#39;一季报&#39;</span><span class=p>,</span> <span class=s1>&#39;三季报&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 处理业绩超预期事件</span>
</span></span><span class=line><span class=cl>    <span class=n>earnings_df</span><span class=p>[</span><span class=s1>&#39;earnings_surprise&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>earnings_df</span><span class=p>[</span><span class=s1>&#39;actual_eps&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=n>earnings_df</span><span class=p>[</span><span class=s1>&#39;expected_eps&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span> <span class=o>/</span> <span class=nb>abs</span><span class=p>(</span><span class=n>earnings_df</span><span class=p>[</span><span class=s1>&#39;expected_eps&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 标记业绩超预期事件</span>
</span></span><span class=line><span class=cl>    <span class=n>earnings_df</span><span class=p>[</span><span class=s1>&#39;positive_surprise&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>earnings_df</span><span class=p>[</span><span class=s1>&#39;earnings_surprise&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mf>0.1</span>
</span></span><span class=line><span class=cl>    <span class=n>earnings_df</span><span class=p>[</span><span class=s1>&#39;negative_surprise&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>earnings_df</span><span class=p>[</span><span class=s1>&#39;earnings_surprise&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=o>-</span><span class=mf>0.1</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>earnings_df</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=事件效应分析>事件效应分析</h3><p>在构建策略前需要分析事件的市场效应：</p><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_event_impact</span><span class=p>(</span><span class=n>event_df</span><span class=p>,</span> <span class=n>stock_list</span><span class=p>,</span> <span class=n>event_window</span><span class=o>=</span><span class=p>(</span><span class=o>-</span><span class=mi>20</span><span class=p>,</span> <span class=mi>20</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    分析事件对股票价格的影响
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>stock</span> <span class=ow>in</span> <span class=n>stock_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 获取股票的事件数据</span>
</span></span><span class=line><span class=cl>        <span class=n>stock_events</span> <span class=o>=</span> <span class=n>event_df</span><span class=p>[</span><span class=n>event_df</span><span class=p>[</span><span class=s1>&#39;symbol&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=n>stock</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>stock_events</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 计算事件窗口期的收益率</span>
</span></span><span class=line><span class=cl>        <span class=n>event_returns</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>stock_events</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=n>event_date</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;announcement_date&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 获取事件窗口期的价格数据</span>
</span></span><span class=line><span class=cl>            <span class=n>start_date</span> <span class=o>=</span> <span class=n>event_date</span> <span class=o>+</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=n>event_window</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=n>end_date</span> <span class=o>=</span> <span class=n>event_date</span> <span class=o>+</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=n>event_window</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>price_data</span> <span class=o>=</span> <span class=n>get_price</span><span class=p>(</span><span class=n>stock</span><span class=p>,</span> <span class=n>start_date</span><span class=o>=</span><span class=n>start_date</span><span class=p>,</span> <span class=n>end_date</span><span class=o>=</span><span class=n>end_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>price_data</span><span class=p>)</span> <span class=o>&lt;</span> <span class=nb>abs</span><span class=p>(</span><span class=n>event_window</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>+</span> <span class=n>event_window</span><span class=p>[</span><span class=mi>1</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 计算累计收益率</span>
</span></span><span class=line><span class=cl>            <span class=n>event_return</span> <span class=o>=</span> <span class=p>(</span><span class=n>price_data</span><span class=p>[</span><span class=s1>&#39;close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>/</span> <span class=n>price_data</span><span class=p>[</span><span class=s1>&#39;close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=nb>abs</span><span class=p>(</span><span class=n>event_window</span><span class=p>[</span><span class=mi>0</span><span class=p>])])</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=n>event_returns</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event_return</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>event_returns</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>[</span><span class=n>stock</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;mean_return&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>event_returns</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;median_return&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>median</span><span class=p>(</span><span class=n>event_returns</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;std_return&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>std</span><span class=p>(</span><span class=n>event_returns</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;event_count&#39;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>event_returns</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;positive_rate&#39;</span><span class=p>:</span> <span class=nb>sum</span><span class=p>(</span><span class=n>r</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>event_returns</span><span class=p>)</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>event_returns</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_cumulative_abnormal_returns</span><span class=p>(</span><span class=n>event_df</span><span class=p>,</span> <span class=n>market_return</span><span class=p>,</span> <span class=n>event_window</span><span class=o>=</span><span class=p>(</span><span class=o>-</span><span class=mi>20</span><span class=p>,</span> <span class=mi>20</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    计算累积异常收益率（CAR）
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>car_results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>stock</span> <span class=ow>in</span> <span class=n>event_df</span><span class=p>[</span><span class=s1>&#39;symbol&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>unique</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>stock_events</span> <span class=o>=</span> <span class=n>event_df</span><span class=p>[</span><span class=n>event_df</span><span class=p>[</span><span class=s1>&#39;symbol&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=n>stock</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>stock_events</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>abnormal_returns</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>stock_events</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=n>event_date</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;announcement_date&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 获取事件窗口期的股票和市场收益率</span>
</span></span><span class=line><span class=cl>            <span class=n>start_date</span> <span class=o>=</span> <span class=n>event_date</span> <span class=o>+</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=n>event_window</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=n>end_date</span> <span class=o>=</span> <span class=n>event_date</span> <span class=o>+</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=n>event_window</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>stock_returns</span> <span class=o>=</span> <span class=n>get_returns</span><span class=p>(</span><span class=n>stock</span><span class=p>,</span> <span class=n>start_date</span><span class=p>,</span> <span class=n>end_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>market_returns</span> <span class=o>=</span> <span class=n>get_returns</span><span class=p>(</span><span class=s1>&#39;000300.XSHG&#39;</span><span class=p>,</span> <span class=n>start_date</span><span class=p>,</span> <span class=n>end_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 计算异常收益率</span>
</span></span><span class=line><span class=cl>            <span class=n>abnormal_return</span> <span class=o>=</span> <span class=n>stock_returns</span> <span class=o>-</span> <span class=n>market_returns</span>
</span></span><span class=line><span class=cl>            <span class=n>cumulative_abnormal_return</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span> <span class=o>+</span> <span class=n>abnormal_return</span><span class=p>)</span><span class=o>.</span><span class=n>prod</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>abnormal_returns</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>cumulative_abnormal_return</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>abnormal_returns</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>car_results</span><span class=p>[</span><span class=n>stock</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;mean_car&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>abnormal_returns</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;median_car&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>median</span><span class=p>(</span><span class=n>abnormal_returns</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;car_std&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>std</span><span class=p>(</span><span class=n>abnormal_returns</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>car_results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>event_study_analysis</span><span class=p>(</span><span class=n>events_df</span><span class=p>,</span> <span class=n>estimation_window</span><span class=o>=</span><span class=p>(</span><span class=o>-</span><span class=mi>120</span><span class=p>,</span> <span class=o>-</span><span class=mi>21</span><span class=p>),</span> <span class=n>event_window</span><span class=o>=</span><span class=p>(</span><span class=o>-</span><span class=mi>5</span><span class=p>,</span> <span class=mi>5</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    事件研究分析
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events_df</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>stock</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;symbol&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>event_date</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;announcement_date&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 估计期（用于计算正常收益率）</span>
</span></span><span class=line><span class=cl>        <span class=n>estimation_start</span> <span class=o>=</span> <span class=n>event_date</span> <span class=o>+</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=n>estimation_window</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>estimation_end</span> <span class=o>=</span> <span class=n>event_date</span> <span class=o>+</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=n>estimation_window</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 事件期</span>
</span></span><span class=line><span class=cl>        <span class=n>event_start</span> <span class=o>=</span> <span class=n>event_date</span> <span class=o>+</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=n>event_window</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>event_end</span> <span class=o>=</span> <span class=n>event_date</span> <span class=o>+</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=n>event_window</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 获取估计期数据</span>
</span></span><span class=line><span class=cl>        <span class=n>estimation_data</span> <span class=o>=</span> <span class=n>get_price</span><span class=p>(</span><span class=n>stock</span><span class=p>,</span> <span class=n>start_date</span><span class=o>=</span><span class=n>estimation_start</span><span class=p>,</span> <span class=n>end_date</span><span class=o>=</span><span class=n>estimation_end</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>market_data</span> <span class=o>=</span> <span class=n>get_price</span><span class=p>(</span><span class=s1>&#39;000300.XSHG&#39;</span><span class=p>,</span> <span class=n>start_date</span><span class=o>=</span><span class=n>estimation_start</span><span class=p>,</span> <span class=n>end_date</span><span class=o>=</span><span class=n>estimation_end</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 计算市场模型参数</span>
</span></span><span class=line><span class=cl>        <span class=n>stock_returns</span> <span class=o>=</span> <span class=n>estimation_data</span><span class=p>[</span><span class=s1>&#39;close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>pct_change</span><span class=p>()</span><span class=o>.</span><span class=n>dropna</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>market_returns</span> <span class=o>=</span> <span class=n>market_data</span><span class=p>[</span><span class=s1>&#39;close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>pct_change</span><span class=p>()</span><span class=o>.</span><span class=n>dropna</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 线性回归：R_i = alpha + beta * R_m + epsilon</span>
</span></span><span class=line><span class=cl>        <span class=n>X</span> <span class=o>=</span> <span class=n>sm</span><span class=o>.</span><span class=n>add_constant</span><span class=p>(</span><span class=n>market_returns</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>model</span> <span class=o>=</span> <span class=n>sm</span><span class=o>.</span><span class=n>OLS</span><span class=p>(</span><span class=n>stock_returns</span><span class=p>,</span> <span class=n>X</span><span class=p>)</span><span class=o>.</span><span class=n>fit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>alpha</span><span class=p>,</span> <span class=n>beta</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>params</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 获取事件期数据</span>
</span></span><span class=line><span class=cl>        <span class=n>event_data</span> <span class=o>=</span> <span class=n>get_price</span><span class=p>(</span><span class=n>stock</span><span class=p>,</span> <span class=n>start_date</span><span class=o>=</span><span class=n>event_start</span><span class=p>,</span> <span class=n>end_date</span><span class=o>=</span><span class=n>event_end</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>event_market_data</span> <span class=o>=</span> <span class=n>get_price</span><span class=p>(</span><span class=s1>&#39;000300.XSHG&#39;</span><span class=p>,</span> <span class=n>start_date</span><span class=o>=</span><span class=n>event_start</span><span class=p>,</span> <span class=n>end_date</span><span class=o>=</span><span class=n>event_end</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 计算事件期异常收益率</span>
</span></span><span class=line><span class=cl>        <span class=n>event_stock_returns</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>pct_change</span><span class=p>()</span><span class=o>.</span><span class=n>dropna</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>event_market_returns</span> <span class=o>=</span> <span class=n>event_market_data</span><span class=p>[</span><span class=s1>&#39;close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>pct_change</span><span class=p>()</span><span class=o>.</span><span class=n>dropna</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 预测正常收益率</span>
</span></span><span class=line><span class=cl>        <span class=n>normal_returns</span> <span class=o>=</span> <span class=n>alpha</span> <span class=o>+</span> <span class=n>beta</span> <span class=o>*</span> <span class=n>event_market_returns</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 计算异常收益率</span>
</span></span><span class=line><span class=cl>        <span class=n>abnormal_returns</span> <span class=o>=</span> <span class=n>event_stock_returns</span> <span class=o>-</span> <span class=n>normal_returns</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 计算累积异常收益率</span>
</span></span><span class=line><span class=cl>        <span class=n>cumulative_abnormal_returns</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span> <span class=o>+</span> <span class=n>abnormal_returns</span><span class=p>)</span><span class=o>.</span><span class=n>cumprod</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;symbol&#39;</span><span class=p>:</span> <span class=n>stock</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;event_date&#39;</span><span class=p>:</span> <span class=n>event_date</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;alpha&#39;</span><span class=p>:</span> <span class=n>alpha</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;beta&#39;</span><span class=p>:</span> <span class=n>beta</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;abnormal_returns&#39;</span><span class=p>:</span> <span class=n>abnormal_returns</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;cumulative_abnormal_returns&#39;</span><span class=p>:</span> <span class=n>cumulative_abnormal_returns</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;total_car&#39;</span><span class=p>:</span> <span class=n>cumulative_abnormal_returns</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=具体事件驱动策略>具体事件驱动策略</h2><h3 id=业绩超预期策略>业绩超预期策略</h3><p>业绩超预期是最常见的事件驱动策略之一：</p><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>earnings_surprise_strategy</span><span class=p>(</span><span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    业绩超预期策略
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 获取最新的业绩公告</span>
</span></span><span class=line><span class=cl>    <span class=n>current_date</span> <span class=o>=</span> <span class=n>get_datetime</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 获取最近3天的业绩公告</span>
</span></span><span class=line><span class=cl>    <span class=n>start_date</span> <span class=o>=</span> <span class=n>current_date</span> <span class=o>-</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>earnings_df</span> <span class=o>=</span> <span class=n>get_earnings_announcements</span><span class=p>(</span><span class=n>start_date</span><span class=p>,</span> <span class=n>current_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 筛选业绩超预期股票</span>
</span></span><span class=line><span class=cl>    <span class=n>surprise_threshold</span> <span class=o>=</span> <span class=mf>0.1</span>  <span class=c1># 业绩超预期10%</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>surprise_stocks</span> <span class=o>=</span> <span class=n>earnings_df</span><span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=n>earnings_df</span><span class=p>[</span><span class=s1>&#39;earnings_surprise&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>surprise_threshold</span><span class=p>)</span> <span class=o>&amp;</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=n>earnings_df</span><span class=p>[</span><span class=s1>&#39;actual_eps&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&amp;</span>  <span class=c1># 实际盈利为正</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=n>earnings_df</span><span class=p>[</span><span class=s1>&#39;announcement_date&#39;</span><span class=p>]</span> <span class=o>&gt;=</span> <span class=n>start_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 进一步筛选</span>
</span></span><span class=line><span class=cl>    <span class=n>selected_stocks</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>stock_data</span> <span class=ow>in</span> <span class=n>surprise_stocks</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>stock</span> <span class=o>=</span> <span class=n>stock_data</span><span class=p>[</span><span class=s1>&#39;symbol&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 检查基本面</span>
</span></span><span class=line><span class=cl>        <span class=n>fundamentals</span> <span class=o>=</span> <span class=n>get_fundamentals</span><span class=p>(</span><span class=n>stock</span><span class=p>,</span> <span class=n>current_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>fundamentals</span><span class=p>[</span><span class=s1>&#39;pe&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=ow>and</span> <span class=n>fundamentals</span><span class=p>[</span><span class=s1>&#39;pe&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mi>50</span> <span class=ow>and</span>
</span></span><span class=line><span class=cl>            <span class=n>fundamentals</span><span class=p>[</span><span class=s1>&#39;market_cap&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>50</span> <span class=ow>and</span>
</span></span><span class=line><span class=cl>            <span class=n>fundamentals</span><span class=p>[</span><span class=s1>&#39;roa&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mf>0.05</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>selected_stocks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>stock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>selected_stocks</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>post_earnings_announcement_drift</span><span class=p>(</span><span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    业绩公告后漂移策略（PEAD）
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>current_date</span> <span class=o>=</span> <span class=n>get_datetime</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 获取最近公告的股票</span>
</span></span><span class=line><span class=cl>    <span class=n>lookback_days</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>    <span class=n>start_date</span> <span class=o>=</span> <span class=n>current_date</span> <span class=o>-</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=n>lookback_days</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>earnings_df</span> <span class=o>=</span> <span class=n>get_earnings_announcements</span><span class=p>(</span><span class=n>start_date</span><span class=p>,</span> <span class=n>current_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 筛选条件</span>
</span></span><span class=line><span class=cl>    <span class=n>selected_stocks</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>earnings_df</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>stock</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;symbol&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>announcement_date</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;announcement_date&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 计算公告后的表现</span>
</span></span><span class=line><span class=cl>        <span class=n>days_since_announcement</span> <span class=o>=</span> <span class=p>(</span><span class=n>current_date</span> <span class=o>-</span> <span class=n>announcement_date</span><span class=p>)</span><span class=o>.</span><span class=n>days</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>days_since_announcement</span> <span class=o>&lt;=</span> <span class=n>lookback_days</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 获取公告后的价格表现</span>
</span></span><span class=line><span class=cl>            <span class=n>post_announcement_return</span> <span class=o>=</span> <span class=n>get_return_since_date</span><span class=p>(</span><span class=n>stock</span><span class=p>,</span> <span class=n>announcement_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 业绩超预期的股票，如果公告后涨幅不大，可能存在漂移</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;earnings_surprise&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mf>0.1</span> <span class=ow>and</span> 
</span></span><span class=line><span class=cl>                <span class=n>post_announcement_return</span> <span class=o>&lt;</span> <span class=mf>0.05</span><span class=p>):</span>  <span class=c1># 公告后涨幅小于5%</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 检查技术面</span>
</span></span><span class=line><span class=cl>                <span class=n>technical_data</span> <span class=o>=</span> <span class=n>get_technical_data</span><span class=p>(</span><span class=n>stock</span><span class=p>,</span> <span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>technical_data</span><span class=p>[</span><span class=s1>&#39;rsi&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mi>70</span><span class=p>:</span>  <span class=c1># 不过度超买</span>
</span></span><span class=line><span class=cl>                    <span class=n>selected_stocks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>stock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>selected_stocks</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>earnings_revision_strategy</span><span class=p>(</span><span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    业绩修正策略
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>current_date</span> <span class=o>=</span> <span class=n>get_datetime</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 获取业绩修正公告</span>
</span></span><span class=line><span class=cl>    <span class=n>revision_df</span> <span class=o>=</span> <span class=n>get_earnings_revisions</span><span class=p>(</span><span class=n>current_date</span> <span class=o>-</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>7</span><span class=p>),</span> <span class=n>current_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>selected_stocks</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>revision</span> <span class=ow>in</span> <span class=n>revision_df</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>stock</span> <span class=o>=</span> <span class=n>revision</span><span class=p>[</span><span class=s1>&#39;symbol&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 上调业绩预期</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>revision</span><span class=p>[</span><span class=s1>&#39;revision_type&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;upward&#39;</span> <span class=ow>and</span> <span class=n>revision</span><span class=p>[</span><span class=s1>&#39;revision_magnitude&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mf>0.2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 检查是否有分析师覆盖</span>
</span></span><span class=line><span class=cl>            <span class=n>analyst_coverage</span> <span class=o>=</span> <span class=n>get_analyst_coverage</span><span class=p>(</span><span class=n>stock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>analyst_coverage</span><span class=p>[</span><span class=s1>&#39;num_analysts&#39;</span><span class=p>]</span> <span class=o>&gt;=</span> <span class=mi>3</span><span class=p>:</span>  <span class=c1># 至少有3个分析师覆盖</span>
</span></span><span class=line><span class=cl>                <span class=c1># 检查一致性</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>analyst_coverage</span><span class=p>[</span><span class=s1>&#39;consensus_direction&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;upward&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>selected_stocks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>stock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>selected_stocks</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=分红事件策略>分红事件策略</h3><p>分红事件包括分红预案、除权除息等：</p><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>dividend_strategy</span><span class=p>(</span><span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    分红策略 - 高股息策略
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>current_date</span> <span class=o>=</span> <span class=n>get_datetime</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 获取分红预案</span>
</span></span><span class=line><span class=cl>    <span class=n>dividend_df</span> <span class=o>=</span> <span class=n>get_dividend_announcements</span><span class=p>(</span><span class=n>current_date</span> <span class=o>-</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>30</span><span class=p>),</span> <span class=n>current_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>selected_stocks</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>dividend</span> <span class=ow>in</span> <span class=n>dividend_df</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>stock</span> <span class=o>=</span> <span class=n>dividend</span><span class=p>[</span><span class=s1>&#39;symbol&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 筛选高股息股票</span>
</span></span><span class=line><span class=cl>        <span class=n>dividend_yield</span> <span class=o>=</span> <span class=n>dividend</span><span class=p>[</span><span class=s1>&#39;dividend_per_share&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=n>dividend</span><span class=p>[</span><span class=s1>&#39;current_price&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>dividend_yield</span> <span class=o>&gt;</span> <span class=mf>0.04</span><span class=p>:</span>  <span class=c1># 股息率大于4%</span>
</span></span><span class=line><span class=cl>            <span class=c1># 检查分红持续性</span>
</span></span><span class=line><span class=cl>            <span class=n>dividend_history</span> <span class=o>=</span> <span class=n>get_dividend_history</span><span class=p>(</span><span class=n>stock</span><span class=p>,</span> <span class=n>years</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 计算分红稳定性</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>dividend_history</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>3</span><span class=p>:</span>  <span class=c1># 至少有3年分红历史</span>
</span></span><span class=line><span class=cl>                <span class=n>avg_dividend_yield</span> <span class=o>=</span> <span class=n>dividend_history</span><span class=p>[</span><span class=s1>&#39;dividend_yield&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>dividend_std</span> <span class=o>=</span> <span class=n>dividend_history</span><span class=p>[</span><span class=s1>&#39;dividend_yield&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>std</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 分红稳定且当前股息率高于历史平均</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>dividend_std</span> <span class=o>/</span> <span class=n>avg_dividend_yield</span> <span class=o>&lt;</span> <span class=mf>0.5</span> <span class=ow>and</span>
</span></span><span class=line><span class=cl>                    <span class=n>dividend_yield</span> <span class=o>&gt;</span> <span class=n>avg_dividend_yield</span> <span class=o>*</span> <span class=mf>1.1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 检查基本面</span>
</span></span><span class=line><span class=cl>                    <span class=n>fundamentals</span> <span class=o>=</span> <span class=n>get_fundamentals</span><span class=p>(</span><span class=n>stock</span><span class=p>,</span> <span class=n>current_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=n>fundamentals</span><span class=p>[</span><span class=s1>&#39;payout_ratio&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mf>0.8</span> <span class=ow>and</span>  <span class=c1># 分红率合理</span>
</span></span><span class=line><span class=cl>                        <span class=n>fundamentals</span><span class=p>[</span><span class=s1>&#39;debt_to_equity&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mf>0.5</span> <span class=ow>and</span>   <span class=c1># 负债率不高</span>
</span></span><span class=line><span class=cl>                        <span class=n>fundamentals</span><span class=p>[</span><span class=s1>&#39;free_cash_flow&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>):</span>     <span class=c1># 自由现金流为正</span>
</span></span><span class=line><span class=cl>                        
</span></span><span class=line><span class=cl>                        <span class=n>selected_stocks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>stock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>selected_stocks</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>ex_dividend_date_strategy</span><span class=p>(</span><span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    除权除息日策略
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>current_date</span> <span class=o>=</span> <span class=n>get_datetime</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 获取即将除权的股票</span>
</span></span><span class=line><span class=cl>    <span class=n>upcoming_ex_dates</span> <span class=o>=</span> <span class=n>get_upcoming_ex_dividend_dates</span><span class=p>(</span><span class=n>current_date</span><span class=p>,</span> <span class=n>current_date</span> <span class=o>+</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>7</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>selected_stocks</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>ex_div</span> <span class=ow>in</span> <span class=n>upcoming_ex_dates</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>stock</span> <span class=o>=</span> <span class=n>ex_div</span><span class=p>[</span><span class=s1>&#39;symbol&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>ex_date</span> <span class=o>=</span> <span class=n>ex_div</span><span class=p>[</span><span class=s1>&#39;ex_dividend_date&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 检查历史填权情况</span>
</span></span><span class=line><span class=cl>        <span class=n>historical_fill_data</span> <span class=o>=</span> <span class=n>get_historical_fill_performance</span><span class=p>(</span><span class=n>stock</span><span class=p>,</span> <span class=n>years</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 如果历史填权概率高，可能在除权前买入</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>historical_fill_data</span><span class=p>[</span><span class=s1>&#39;fill_probability&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mf>0.7</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 检查当前估值</span>
</span></span><span class=line><span class=cl>            <span class=n>current_valuation</span> <span class=o>=</span> <span class=n>get_valuation_metrics</span><span class=p>(</span><span class=n>stock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>current_valuation</span><span class=p>[</span><span class=s1>&#39;pe&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>historical_fill_data</span><span class=p>[</span><span class=s1>&#39;avg_pe_at_ex&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>selected_stocks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>stock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>selected_stocks</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>dividend_arbitrage_strategy</span><span class=p>(</span><span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    分红套利策略
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>current_date</span> <span class=o>=</span> <span class=n>get_datetime</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 获取即将分红的股票</span>
</span></span><span class=line><span class=cl>    <span class=n>dividend_stocks</span> <span class=o>=</span> <span class=n>get_dividend_implementation</span><span class=p>(</span><span class=n>current_date</span><span class=p>,</span> <span class=n>current_date</span> <span class=o>+</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>14</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>selected_stocks</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>div_stock</span> <span class=ow>in</span> <span class=n>dividend_stocks</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>stock</span> <span class=o>=</span> <span class=n>div_stock</span><span class=p>[</span><span class=s1>&#39;symbol&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>ex_date</span> <span class=o>=</span> <span class=n>div_stock</span><span class=p>[</span><span class=s1>&#39;ex_dividend_date&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>dividend_amount</span> <span class=o>=</span> <span class=n>div_stock</span><span class=p>[</span><span class=s1>&#39;dividend_per_share&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 获取当前价格</span>
</span></span><span class=line><span class=cl>        <span class=n>current_price</span> <span class=o>=</span> <span class=n>get_current_price</span><span class=p>(</span><span class=n>stock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>dividend_yield</span> <span class=o>=</span> <span class=n>dividend_amount</span> <span class=o>/</span> <span class=n>current_price</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 如果股息率较高，考虑套利</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>dividend_yield</span> <span class=o>&gt;</span> <span class=mf>0.03</span><span class=p>:</span>  <span class=c1># 股息率大于3%</span>
</span></span><span class=line><span class=cl>            <span class=c1># 检查交易成本和时间成本</span>
</span></span><span class=line><span class=cl>            <span class=n>holding_days</span> <span class=o>=</span> <span class=p>(</span><span class=n>ex_date</span> <span class=o>-</span> <span class=n>current_date</span><span class=p>)</span><span class=o>.</span><span class=n>days</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 估算年化收益率</span>
</span></span><span class=line><span class=cl>            <span class=n>annualized_return</span> <span class=o>=</span> <span class=n>dividend_yield</span> <span class=o>*</span> <span class=p>(</span><span class=mi>365</span> <span class=o>/</span> <span class=n>holding_days</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 考虑风险调整</span>
</span></span><span class=line><span class=cl>            <span class=n>stock_volatility</span> <span class=o>=</span> <span class=n>get_volatility</span><span class=p>(</span><span class=n>stock</span><span class=p>,</span> <span class=mi>30</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>risk_adjusted_return</span> <span class=o>=</span> <span class=n>annualized_return</span> <span class=o>-</span> <span class=n>stock_volatility</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>risk_adjusted_return</span> <span class=o>&gt;</span> <span class=mf>0.08</span><span class=p>:</span>  <span class=c1># 风险调整后收益大于8%</span>
</span></span><span class=line><span class=cl>                <span class=n>selected_stocks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>stock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>selected_stocks</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=并购重组策略>并购重组策略</h3><p>并购重组是重要的事件驱动机会：</p><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>merger_arbitrage_strategy</span><span class=p>(</span><span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    并购套利策略
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>current_date</span> <span class=o>=</span> <span class=n>get_datetime</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 获取并购公告</span>
</span></span><span class=line><span class=cl>    <span class=n>merger_df</span> <span class=o>=</span> <span class=n>get_merger_announcements</span><span class=p>(</span><span class=n>current_date</span> <span class=o>-</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>30</span><span class=p>),</span> <span class=n>current_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>selected_stocks</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>merger</span> <span class=ow>in</span> <span class=n>merger_df</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>stock</span> <span class=o>=</span> <span class=n>merger</span><span class=p>[</span><span class=s1>&#39;target_company&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 筛选条件</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>merger</span><span class=p>[</span><span class=s1>&#39;deal_status&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;announced&#39;</span> <span class=ow>and</span>  <span class=c1># 已公告但未完成</span>
</span></span><span class=line><span class=cl>            <span class=n>merger</span><span class=p>[</span><span class=s1>&#39;premium&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mf>0.3</span> <span class=ow>and</span>              <span class=c1># 溢价不超过30%</span>
</span></span><span class=line><span class=cl>            <span class=n>merger</span><span class=p>[</span><span class=s1>&#39;deal_probability&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mf>0.7</span><span class=p>):</span>         <span class=c1># 成功概率较高</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 计算套利空间</span>
</span></span><span class=line><span class=cl>            <span class=n>current_price</span> <span class=o>=</span> <span class=n>get_current_price</span><span class=p>(</span><span class=n>stock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>offer_price</span> <span class=o>=</span> <span class=n>merger</span><span class=p>[</span><span class=s1>&#39;offer_price&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>arbitrage_spread</span> <span class=o>=</span> <span class=p>(</span><span class=n>offer_price</span> <span class=o>-</span> <span class=n>current_price</span><span class=p>)</span> <span class=o>/</span> <span class=n>current_price</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>arbitrage_spread</span> <span class=o>&gt;</span> <span class=mf>0.02</span><span class=p>:</span>  <span class=c1># 套利空间大于2%</span>
</span></span><span class=line><span class=cl>                <span class=c1># 检查风险</span>
</span></span><span class=line><span class=cl>                <span class=n>deal_risk</span> <span class=o>=</span> <span class=n>assess_deal_risk</span><span class=p>(</span><span class=n>merger</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>deal_risk</span><span class=p>[</span><span class=s1>&#39;regulatory_risk&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mf>0.3</span> <span class=ow>and</span> <span class=n>deal_risk</span><span class=p>[</span><span class=s1>&#39;financing_risk&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mf>0.3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>selected_stocks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>stock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>selected_stocks</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>restructuring_event_strategy</span><span class=p>(</span><span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    重组事件策略
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>current_date</span> <span class=o>=</span> <span class=n>get_datetime</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 获取重组公告</span>
</span></span><span class=line><span class=cl>    <span class=n>restructure_df</span> <span class=o>=</span> <span class=n>get_restructure_announcements</span><span class=p>(</span><span class=n>current_date</span> <span class=o>-</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>14</span><span class=p>),</span> <span class=n>current_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>selected_stocks</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>restructure</span> <span class=ow>in</span> <span class=n>restructure_df</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>stock</span> <span class=o>=</span> <span class=n>restructure</span><span class=p>[</span><span class=s1>&#39;company&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>restructure_type</span> <span class=o>=</span> <span class=n>restructure</span><span class=p>[</span><span class=s1>&#39;type&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 不同类型的重组策略</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>restructure_type</span> <span class=o>==</span> <span class=s1>&#39;asset_acquisition&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 资产收购 - 关注收购资产的质量</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>evaluate_acquisition_quality</span><span class=p>(</span><span class=n>restructure</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mf>0.7</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>selected_stocks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>stock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>restructure_type</span> <span class=o>==</span> <span class=s1>&#39;asset_sale&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 资产出售 - 关注出售价格是否合理</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>restructure</span><span class=p>[</span><span class=s1>&#39;sale_premium&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mf>0.1</span><span class=p>:</span>  <span class=c1># 出售溢价大于10%</span>
</span></span><span class=line><span class=cl>                <span class=n>selected_stocks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>stock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>restructure_type</span> <span class=o>==</span> <span class=s1>&#39;spin_off&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 分拆上市 - 关注分拆价值</span>
</span></span><span class=line><span class=cl>            <span class=n>spinoff_value</span> <span class=o>=</span> <span class=n>calculate_spinoff_value</span><span class=p>(</span><span class=n>restructure</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>current_price</span> <span class=o>=</span> <span class=n>get_current_price</span><span class=p>(</span><span class=n>stock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>spinoff_value</span> <span class=o>/</span> <span class=n>current_price</span> <span class=o>&gt;</span> <span class=mf>0.2</span><span class=p>:</span>  <span class=c1># 分拆价值大于当前市值20%</span>
</span></span><span class=line><span class=cl>                <span class=n>selected_stocks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>stock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>selected_stocks</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>special_situation_strategy</span><span class=p>(</span><span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    特殊情况策略
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>current_date</span> <span class=o>=</span> <span class=n>get_datetime</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>selected_stocks</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 1. 股权之争</span>
</span></span><span class=line><span class=cl>    <span class=n>proxy_contests</span> <span class=o>=</span> <span class=n>get_proxy_contests</span><span class=p>(</span><span class=n>current_date</span> <span class=o>-</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>30</span><span class=p>),</span> <span class=n>current_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>contest</span> <span class=ow>in</span> <span class=n>proxy_contests</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>stock</span> <span class=o>=</span> <span class=n>contest</span><span class=p>[</span><span class=s1>&#39;company&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 如果认为现任管理层更好，可能做空</span>
</span></span><span class=line><span class=cl>        <span class=c1># 如果认为挑战者能带来改善，可能做多</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>evaluate_management_quality</span><span class=p>(</span><span class=n>contest</span><span class=p>[</span><span class=s1>&#39;challenger&#39;</span><span class=p>])</span> <span class=o>&gt;</span> <span class=n>evaluate_management_quality</span><span class=p>(</span><span class=n>contest</span><span class=p>[</span><span class=s1>&#39;incumbent&#39;</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>            <span class=n>selected_stocks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>stock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 2. 破产重组</span>
</span></span><span class=line><span class=cl>    <span class=n>bankruptcies</span> <span class=o>=</span> <span class=n>get_bankruptcy_announcements</span><span class=p>(</span><span class=n>current_date</span> <span class=o>-</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>90</span><span class=p>),</span> <span class=n>current_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>bankruptcy</span> <span class=ow>in</span> <span class=n>bankruptcies</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>stock</span> <span class=o>=</span> <span class=n>bankruptcy</span><span class=p>[</span><span class=s1>&#39;company&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 评估重组成功的可能性</span>
</span></span><span class=line><span class=cl>        <span class=n>recovery_probability</span> <span class=o>=</span> <span class=n>assess_recovery_probability</span><span class=p>(</span><span class=n>bankruptcy</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>recovery_probability</span> <span class=o>&gt;</span> <span class=mf>0.6</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 评估重组后的价值</span>
</span></span><span class=line><span class=cl>            <span class=n>recovery_value</span> <span class=o>=</span> <span class=n>estimate_recovery_value</span><span class=p>(</span><span class=n>bankruptcy</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>current_price</span> <span class=o>=</span> <span class=n>get_current_price</span><span class=p>(</span><span class=n>stock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>recovery_value</span> <span class=o>/</span> <span class=n>current_price</span> <span class=o>&gt;</span> <span class=mi>2</span><span class=p>:</span>  <span class=c1># 潜在回报大于100%</span>
</span></span><span class=line><span class=cl>                <span class=n>selected_stocks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>stock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>selected_stocks</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>activist_investor_strategy</span><span class=p>(</span><span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    激进投资者策略
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>current_date</span> <span class=o>=</span> <span class=n>get_datetime</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 获取激进投资者持仓变动</span>
</span></span><span class=line><span class=cl>    <span class=n>activist_df</span> <span class=o>=</span> <span class=n>get_activist_positions</span><span class=p>(</span><span class=n>current_date</span> <span class=o>-</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>30</span><span class=p>),</span> <span class=n>current_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>selected_stocks</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>activist</span> <span class=ow>in</span> <span class=n>activist_df</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>stock</span> <span class=o>=</span> <span class=n>activist</span><span class=p>[</span><span class=s1>&#39;company&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>activist_name</span> <span class=o>=</span> <span class=n>activist</span><span class=p>[</span><span class=s1>&#39;activist_name&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 知名激进投资者</span>
</span></span><span class=line><span class=cl>        <span class=n>famous_activists</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;Carl Icahn&#39;</span><span class=p>,</span> <span class=s1>&#39;Bill Ackman&#39;</span><span class=p>,</span> <span class=s1>&#39;Daniel Loeb&#39;</span><span class=p>,</span> <span class=s1>&#39;Nelson Peltz&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>activist_name</span> <span class=ow>in</span> <span class=n>famous_activists</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 检查激进投资者的提案</span>
</span></span><span class=line><span class=cl>            <span class=n>proposals</span> <span class=o>=</span> <span class=n>get_activist_proposals</span><span class=p>(</span><span class=n>activist_name</span><span class=p>,</span> <span class=n>stock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 评估提案的价值创造潜力</span>
</span></span><span class=line><span class=cl>            <span class=n>value_creation_potential</span> <span class=o>=</span> <span class=n>evaluate_value_creation</span><span class=p>(</span><span class=n>proposals</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>value_creation_potential</span> <span class=o>&gt;</span> <span class=mf>0.3</span><span class=p>:</span>  <span class=c1># 价值创造潜力大于30%</span>
</span></span><span class=line><span class=cl>                <span class=n>selected_stocks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>stock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>selected_stocks</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=完整事件驱动策略实现>完整事件驱动策略实现</h2><p>让我们实现一个完整的事件驱动策略：</p><div class="not-prose my-8 overflow-hidden rounded-lg bg-gray-900 shadow-lg"><div class="p-4 overflow-x-auto"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span><span class=lnt>324
</span><span class=lnt>325
</span><span class=lnt>326
</span><span class=lnt>327
</span><span class=lnt>328
</span><span class=lnt>329
</span><span class=lnt>330
</span><span class=lnt>331
</span><span class=lnt>332
</span><span class=lnt>333
</span><span class=lnt>334
</span><span class=lnt>335
</span><span class=lnt>336
</span><span class=lnt>337
</span><span class=lnt>338
</span><span class=lnt>339
</span><span class=lnt>340
</span><span class=lnt>341
</span><span class=lnt>342
</span><span class=lnt>343
</span><span class=lnt>344
</span><span class=lnt>345
</span><span class=lnt>346
</span><span class=lnt>347
</span><span class=lnt>348
</span><span class=lnt>349
</span><span class=lnt>350
</span><span class=lnt>351
</span><span class=lnt>352
</span><span class=lnt>353
</span><span class=lnt>354
</span><span class=lnt>355
</span><span class=lnt>356
</span><span class=lnt>357
</span><span class=lnt>358
</span><span class=lnt>359
</span><span class=lnt>360
</span><span class=lnt>361
</span><span class=lnt>362
</span><span class=lnt>363
</span><span class=lnt>364
</span><span class=lnt>365
</span><span class=lnt>366
</span><span class=lnt>367
</span><span class=lnt>368
</span><span class=lnt>369
</span><span class=lnt>370
</span><span class=lnt>371
</span><span class=lnt>372
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>initialize</span><span class=p>(</span><span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    事件驱动策略初始化
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 策略参数</span>
</span></span><span class=line><span class=cl>    <span class=n>context</span><span class=o>.</span><span class=n>strategy_name</span> <span class=o>=</span> <span class=s2>&#34;事件驱动综合策略&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>context</span><span class=o>.</span><span class=n>benchmark</span> <span class=o>=</span> <span class=s1>&#39;000300.XSHG&#39;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 事件类型配置</span>
</span></span><span class=line><span class=cl>    <span class=n>context</span><span class=o>.</span><span class=n>event_config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;earnings_surprise&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;enabled&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;surprise_threshold&#39;</span><span class=p>:</span> <span class=mf>0.1</span><span class=p>,</span>    <span class=c1># 业绩超预期10%</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;max_stocks&#39;</span><span class=p>:</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;holding_period&#39;</span><span class=p>:</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;dividend&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;enabled&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;min_dividend_yield&#39;</span><span class=p>:</span> <span class=mf>0.04</span><span class=p>,</span>    <span class=c1># 最小股息率4%</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;max_stocks&#39;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;holding_period&#39;</span><span class=p>:</span> <span class=mi>30</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;merger_arbitrage&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;enabled&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;min_arbitrage_spread&#39;</span><span class=p>:</span> <span class=mf>0.02</span><span class=p>,</span>   <span class=c1># 最小套利空间2%</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;max_stocks&#39;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;holding_period&#39;</span><span class=p>:</span> <span class=mi>60</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;restructuring&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;enabled&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;max_stocks&#39;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;holding_period&#39;</span><span class=p>:</span> <span class=mi>40</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 风险控制参数</span>
</span></span><span class=line><span class=cl>    <span class=n>context</span><span class=o>.</span><span class=n>risk_config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;max_position_size&#39;</span><span class=p>:</span> <span class=mf>0.1</span><span class=p>,</span>       <span class=c1># 单只股票最大仓位10%</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;max_sector_exposure&#39;</span><span class=p>:</span> <span class=mf>0.3</span><span class=p>,</span>     <span class=c1># 单个行业最大暴露30%</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;stop_loss&#39;</span><span class=p>:</span> <span class=mf>0.08</span><span class=p>,</span>              <span class=c1># 止损8%</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;take_profit&#39;</span><span class=p>:</span> <span class=mf>0.2</span>              <span class=c1># 止盈20%</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 持仓管理</span>
</span></span><span class=line><span class=cl>    <span class=n>context</span><span class=o>.</span><span class=n>event_holdings</span> <span class=o>=</span> <span class=p>{}</span>       <span class=c1># 按事件类型记录持仓</span>
</span></span><span class=line><span class=cl>    <span class=n>context</span><span class=o>.</span><span class=n>entry_prices</span> <span class=o>=</span> <span class=p>{}</span>           <span class=c1># 入场价格</span>
</span></span><span class=line><span class=cl>    <span class=n>context</span><span class=o>.</span><span class=n>entry_dates</span> <span class=o>=</span> <span class=p>{}</span>            <span class=c1># 入场日期</span>
</span></span><span class=line><span class=cl>    <span class=n>context</span><span class=o>.</span><span class=n>event_types</span> <span class=o>=</span> <span class=p>{}</span>            <span class=c1># 事件类型</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 事件历史记录</span>
</span></span><span class=line><span class=cl>    <span class=n>context</span><span class=o>.</span><span class=n>event_history</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;事件驱动策略初始化完成: </span><span class=si>{</span><span class=n>context</span><span class=o>.</span><span class=n>strategy_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_data</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    事件驱动策略主函数
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>current_date</span> <span class=o>=</span> <span class=n>get_datetime</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 1. 扫描新事件</span>
</span></span><span class=line><span class=cl>    <span class=n>new_events</span> <span class=o>=</span> <span class=n>scan_for_events</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>current_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 2. 处理新事件</span>
</span></span><span class=line><span class=cl>    <span class=n>process_new_events</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>new_events</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 3. 管理现有持仓</span>
</span></span><span class=line><span class=cl>    <span class=n>manage_existing_positions</span><span class=p>(</span><span class=n>context</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 4. 风险控制</span>
</span></span><span class=line><span class=cl>    <span class=n>apply_risk_controls</span><span class=p>(</span><span class=n>context</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>scan_for_events</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>current_date</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    扫描新事件
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>new_events</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 扫描时间窗口</span>
</span></span><span class=line><span class=cl>    <span class=n>scan_window</span> <span class=o>=</span> <span class=mi>3</span>  <span class=c1># 扫描最近3天的事件</span>
</span></span><span class=line><span class=cl>    <span class=n>start_date</span> <span class=o>=</span> <span class=n>current_date</span> <span class=o>-</span> <span class=n>pd</span><span class=o>.</span><span class=n>Timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=n>scan_window</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 1. 业绩超预期事件</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>context</span><span class=o>.</span><span class=n>event_config</span><span class=p>[</span><span class=s1>&#39;earnings_surprise&#39;</span><span class=p>][</span><span class=s1>&#39;enabled&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=n>earnings_events</span> <span class=o>=</span> <span class=n>scan_earnings_surprises</span><span class=p>(</span><span class=n>start_date</span><span class=p>,</span> <span class=n>current_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>earnings_events</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>new_events</span><span class=p>[</span><span class=s1>&#39;earnings_surprise&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>earnings_events</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 2. 分红事件</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>context</span><span class=o>.</span><span class=n>event_config</span><span class=p>[</span><span class=s1>&#39;dividend&#39;</span><span class=p>][</span><span class=s1>&#39;enabled&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=n>dividend_events</span> <span class=o>=</span> <span class=n>scan_dividend_events</span><span class=p>(</span><span class=n>start_date</span><span class=p>,</span> <span class=n>current_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>dividend_events</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>new_events</span><span class=p>[</span><span class=s1>&#39;dividend&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>dividend_events</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 3. 并购套利事件</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>context</span><span class=o>.</span><span class=n>event_config</span><span class=p>[</span><span class=s1>&#39;merger_arbitrage&#39;</span><span class=p>][</span><span class=s1>&#39;enabled&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=n>merger_events</span> <span class=o>=</span> <span class=n>scan_merger_arbitrage</span><span class=p>(</span><span class=n>start_date</span><span class=p>,</span> <span class=n>current_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>merger_events</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>new_events</span><span class=p>[</span><span class=s1>&#39;merger_arbitrage&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>merger_events</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 4. 重组事件</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>context</span><span class=o>.</span><span class=n>event_config</span><span class=p>[</span><span class=s1>&#39;restructuring&#39;</span><span class=p>][</span><span class=s1>&#39;enabled&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=n>restructure_events</span> <span class=o>=</span> <span class=n>scan_restructuring_events</span><span class=p>(</span><span class=n>start_date</span><span class=p>,</span> <span class=n>current_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>restructure_events</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>new_events</span><span class=p>[</span><span class=s1>&#39;restructuring&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>restructure_events</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>new_events</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>scan_earnings_surprises</span><span class=p>(</span><span class=n>start_date</span><span class=p>,</span> <span class=n>end_date</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    扫描业绩超预期事件
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 获取业绩公告</span>
</span></span><span class=line><span class=cl>    <span class=n>earnings_df</span> <span class=o>=</span> <span class=n>get_earnings_announcements</span><span class=p>(</span><span class=n>start_date</span><span class=p>,</span> <span class=n>end_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 筛选超预期事件</span>
</span></span><span class=line><span class=cl>    <span class=n>surprise_threshold</span> <span class=o>=</span> <span class=mf>0.1</span>
</span></span><span class=line><span class=cl>    <span class=n>surprise_events</span> <span class=o>=</span> <span class=n>earnings_df</span><span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=n>earnings_df</span><span class=p>[</span><span class=s1>&#39;earnings_surprise&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>surprise_threshold</span><span class=p>)</span> <span class=o>&amp;</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=n>earnings_df</span><span class=p>[</span><span class=s1>&#39;actual_eps&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&amp;</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=n>earnings_df</span><span class=p>[</span><span class=s1>&#39;announcement_date&#39;</span><span class=p>]</span> <span class=o>&gt;=</span> <span class=n>start_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 进一步筛选</span>
</span></span><span class=line><span class=cl>    <span class=n>selected_events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>surprise_events</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>stock</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;symbol&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 检查基本面</span>
</span></span><span class=line><span class=cl>        <span class=n>fundamentals</span> <span class=o>=</span> <span class=n>get_fundamentals</span><span class=p>(</span><span class=n>stock</span><span class=p>,</span> <span class=n>end_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>fundamentals</span><span class=p>[</span><span class=s1>&#39;pe&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=ow>and</span> <span class=n>fundamentals</span><span class=p>[</span><span class=s1>&#39;pe&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mi>50</span> <span class=ow>and</span>
</span></span><span class=line><span class=cl>            <span class=n>fundamentals</span><span class=p>[</span><span class=s1>&#39;market_cap&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>50</span> <span class=ow>and</span>
</span></span><span class=line><span class=cl>            <span class=n>fundamentals</span><span class=p>[</span><span class=s1>&#39;roa&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mf>0.05</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>selected_events</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;stock&#39;</span><span class=p>:</span> <span class=n>stock</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;event_date&#39;</span><span class=p>:</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;announcement_date&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;surprise_magnitude&#39;</span><span class=p>:</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;earnings_surprise&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;actual_eps&#39;</span><span class=p>:</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;actual_eps&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;expected_eps&#39;</span><span class=p>:</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;expected_eps&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;event_type&#39;</span><span class=p>:</span> <span class=s1>&#39;earnings_surprise&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>selected_events</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>scan_dividend_events</span><span class=p>(</span><span class=n>start_date</span><span class=p>,</span> <span class=n>end_date</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    扫描分红事件
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 获取分红公告</span>
</span></span><span class=line><span class=cl>    <span class=n>dividend_df</span> <span class=o>=</span> <span class=n>get_dividend_announcements</span><span class=p>(</span><span class=n>start_date</span><span class=p>,</span> <span class=n>end_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 筛选高股息事件</span>
</span></span><span class=line><span class=cl>    <span class=n>min_yield</span> <span class=o>=</span> <span class=mf>0.04</span>
</span></span><span class=line><span class=cl>    <span class=n>dividend_events</span> <span class=o>=</span> <span class=n>dividend_df</span><span class=p>[</span><span class=n>dividend_df</span><span class=p>[</span><span class=s1>&#39;dividend_yield&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>min_yield</span><span class=p>]</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>selected_events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>dividend_events</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>stock</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;symbol&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 检查分红持续性</span>
</span></span><span class=line><span class=cl>        <span class=n>dividend_history</span> <span class=o>=</span> <span class=n>get_dividend_history</span><span class=p>(</span><span class=n>stock</span><span class=p>,</span> <span class=n>years</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>dividend_history</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>2</span><span class=p>:</span>  <span class=c1># 至少有2年分红历史</span>
</span></span><span class=line><span class=cl>            <span class=c1># 检查基本面</span>
</span></span><span class=line><span class=cl>            <span class=n>fundamentals</span> <span class=o>=</span> <span class=n>get_fundamentals</span><span class=p>(</span><span class=n>stock</span><span class=p>,</span> <span class=n>end_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>fundamentals</span><span class=p>[</span><span class=s1>&#39;payout_ratio&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mf>0.8</span> <span class=ow>and</span>
</span></span><span class=line><span class=cl>                <span class=n>fundamentals</span><span class=p>[</span><span class=s1>&#39;debt_to_equity&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mf>0.5</span> <span class=ow>and</span>
</span></span><span class=line><span class=cl>                <span class=n>fundamentals</span><span class=p>[</span><span class=s1>&#39;free_cash_flow&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>selected_events</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;stock&#39;</span><span class=p>:</span> <span class=n>stock</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;event_date&#39;</span><span class=p>:</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;announcement_date&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;dividend_yield&#39;</span><span class=p>:</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;dividend_yield&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;dividend_per_share&#39;</span><span class=p>:</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;dividend_per_share&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;event_type&#39;</span><span class=p>:</span> <span class=s1>&#39;dividend&#39;</span>
</span></span><span class=line><span class=cl>                <span class=p>})</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>selected_events</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>process_new_events</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>new_events</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    处理新事件
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>current_date</span> <span class=o>=</span> <span class=n>get_datetime</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>events</span> <span class=ow>in</span> <span class=n>new_events</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>config</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>event_config</span><span class=p>[</span><span class=n>event_type</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>max_stocks</span> <span class=o>=</span> <span class=n>config</span><span class=p>[</span><span class=s1>&#39;max_stocks&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 计算当前该事件类型的持仓数量</span>
</span></span><span class=line><span class=cl>        <span class=n>current_holdings</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=mi>1</span> <span class=k>for</span> <span class=n>stock</span><span class=p>,</span> <span class=n>ev_type</span> <span class=ow>in</span> <span class=n>context</span><span class=o>.</span><span class=n>event_types</span><span class=o>.</span><span class=n>items</span><span class=p>()</span> 
</span></span><span class=line><span class=cl>                              <span class=k>if</span> <span class=n>ev_type</span> <span class=o>==</span> <span class=n>event_type</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 如果还有空间，考虑新事件</span>
</span></span><span class=line><span class=cl>        <span class=n>available_slots</span> <span class=o>=</span> <span class=n>max_stocks</span> <span class=o>-</span> <span class=n>current_holdings</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>available_slots</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>events</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 按事件质量排序，选择最好的</span>
</span></span><span class=line><span class=cl>            <span class=n>sorted_events</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>events</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>score_event_quality</span><span class=p>(</span><span class=n>x</span><span class=p>),</span> <span class=n>reverse</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>sorted_events</span><span class=p>[:</span><span class=n>available_slots</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>stock</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;stock&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 检查是否已持仓</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>stock</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>context</span><span class=o>.</span><span class=n>portfolio</span><span class=o>.</span><span class=n>positions</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 开仓</span>
</span></span><span class=line><span class=cl>                    <span class=n>open_position</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>stock</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>score_event_quality</span><span class=p>(</span><span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    评分事件质量
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>event_type</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;event_type&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;earnings_surprise&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;surprise_magnitude&#39;</span><span class=p>]</span>  <span class=c1># 超预期幅度越大越好</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;dividend&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;dividend_yield&#39;</span><span class=p>]</span>  <span class=c1># 股息率越高越好</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;merger_arbitrage&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>event</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;arbitrage_spread&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>  <span class=c1># 套利空间越大越好</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;restructuring&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>event</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;value_creation_potential&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>open_position</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>stock</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>event_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    开仓
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>current_price</span> <span class=o>=</span> <span class=n>get_current_data</span><span class=p>(</span><span class=n>stock</span><span class=p>)</span><span class=o>.</span><span class=n>day_limit</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 计算目标仓位</span>
</span></span><span class=line><span class=cl>    <span class=n>target_weight</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>context</span><span class=o>.</span><span class=n>risk_config</span><span class=p>[</span><span class=s1>&#39;max_position_size&#39;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>                       <span class=mf>1.0</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>context</span><span class=o>.</span><span class=n>event_config</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 下单</span>
</span></span><span class=line><span class=cl>    <span class=n>order_target_percent</span><span class=p>(</span><span class=n>stock</span><span class=p>,</span> <span class=n>target_weight</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 记录持仓信息</span>
</span></span><span class=line><span class=cl>    <span class=n>context</span><span class=o>.</span><span class=n>entry_prices</span><span class=p>[</span><span class=n>stock</span><span class=p>]</span> <span class=o>=</span> <span class=n>current_price</span>
</span></span><span class=line><span class=cl>    <span class=n>context</span><span class=o>.</span><span class=n>entry_dates</span><span class=p>[</span><span class=n>stock</span><span class=p>]</span> <span class=o>=</span> <span class=n>get_datetime</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>context</span><span class=o>.</span><span class=n>event_types</span><span class=p>[</span><span class=n>stock</span><span class=p>]</span> <span class=o>=</span> <span class=n>event_type</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>get_datetime</span><span class=p>()</span><span class=si>}</span><span class=s2>: 开仓 </span><span class=si>{</span><span class=n>stock</span><span class=si>}</span><span class=s2>, 事件类型: </span><span class=si>{</span><span class=n>event_type</span><span class=si>}</span><span class=s2>, 权重: </span><span class=si>{</span><span class=n>target_weight</span><span class=si>:</span><span class=s2>.2%</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>manage_existing_positions</span><span class=p>(</span><span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    管理现有持仓
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>current_date</span> <span class=o>=</span> <span class=n>get_datetime</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>stock</span> <span class=ow>in</span> <span class=nb>list</span><span class=p>(</span><span class=n>context</span><span class=o>.</span><span class=n>portfolio</span><span class=o>.</span><span class=n>positions</span><span class=o>.</span><span class=n>keys</span><span class=p>()):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>stock</span> <span class=ow>in</span> <span class=n>context</span><span class=o>.</span><span class=n>event_types</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>event_type</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>event_types</span><span class=p>[</span><span class=n>stock</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>config</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>event_config</span><span class=p>[</span><span class=n>event_type</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 检查持仓时间</span>
</span></span><span class=line><span class=cl>            <span class=n>holding_days</span> <span class=o>=</span> <span class=p>(</span><span class=n>current_date</span> <span class=o>-</span> <span class=n>context</span><span class=o>.</span><span class=n>entry_dates</span><span class=p>[</span><span class=n>stock</span><span class=p>])</span><span class=o>.</span><span class=n>days</span>
</span></span><span class=line><span class=cl>            <span class=n>max_holding_period</span> <span class=o>=</span> <span class=n>config</span><span class=p>[</span><span class=s1>&#39;holding_period&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 如果超过最大持仓期，平仓</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>holding_days</span> <span class=o>&gt;</span> <span class=n>max_holding_period</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>close_position</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>stock</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;持仓时间到期 (</span><span class=si>{</span><span class=n>holding_days</span><span class=si>}</span><span class=s2>天)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 检查事件进展</span>
</span></span><span class=line><span class=cl>            <span class=n>event_progress</span> <span class=o>=</span> <span class=n>check_event_progress</span><span class=p>(</span><span class=n>stock</span><span class=p>,</span> <span class=n>event_type</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>event_progress</span><span class=p>[</span><span class=s1>&#39;completed&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>close_position</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>stock</span><span class=p>,</span> <span class=s2>&#34;事件已完成&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>event_progress</span><span class=p>[</span><span class=s1>&#39;failed&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>close_position</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>stock</span><span class=p>,</span> <span class=s2>&#34;事件失败&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>close_position</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>stock</span><span class=p>,</span> <span class=n>reason</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    平仓
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>order_target</span><span class=p>(</span><span class=n>stock</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 清理相关数据</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>stock</span> <span class=ow>in</span> <span class=n>context</span><span class=o>.</span><span class=n>entry_prices</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>del</span> <span class=n>context</span><span class=o>.</span><span class=n>entry_prices</span><span class=p>[</span><span class=n>stock</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>stock</span> <span class=ow>in</span> <span class=n>context</span><span class=o>.</span><span class=n>entry_dates</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>del</span> <span class=n>context</span><span class=o>.</span><span class=n>entry_dates</span><span class=p>[</span><span class=n>stock</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>stock</span> <span class=ow>in</span> <span class=n>context</span><span class=o>.</span><span class=n>event_types</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>del</span> <span class=n>context</span><span class=o>.</span><span class=n>event_types</span><span class=p>[</span><span class=n>stock</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>get_datetime</span><span class=p>()</span><span class=si>}</span><span class=s2>: 平仓 </span><span class=si>{</span><span class=n>stock</span><span class=si>}</span><span class=s2>, 原因: </span><span class=si>{</span><span class=n>reason</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>apply_risk_controls</span><span class=p>(</span><span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    应用风险控制
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 1. 止损止盈</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>stock</span> <span class=ow>in</span> <span class=nb>list</span><span class=p>(</span><span class=n>context</span><span class=o>.</span><span class=n>portfolio</span><span class=o>.</span><span class=n>positions</span><span class=o>.</span><span class=n>keys</span><span class=p>()):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>stock</span> <span class=ow>in</span> <span class=n>context</span><span class=o>.</span><span class=n>entry_prices</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>current_price</span> <span class=o>=</span> <span class=n>get_current_data</span><span class=p>(</span><span class=n>stock</span><span class=p>)</span><span class=o>.</span><span class=n>day_limit</span>
</span></span><span class=line><span class=cl>            <span class=n>entry_price</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>entry_prices</span><span class=p>[</span><span class=n>stock</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>return_pct</span> <span class=o>=</span> <span class=p>(</span><span class=n>current_price</span> <span class=o>-</span> <span class=n>entry_price</span><span class=p>)</span> <span class=o>/</span> <span class=n>entry_price</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 止损</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>return_pct</span> <span class=o>&lt;</span> <span class=o>-</span><span class=n>context</span><span class=o>.</span><span class=n>risk_config</span><span class=p>[</span><span class=s1>&#39;stop_loss&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>close_position</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>stock</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;止损 (</span><span class=si>{</span><span class=n>return_pct</span><span class=si>:</span><span class=s2>.2%</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 止盈</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>return_pct</span> <span class=o>&gt;</span> <span class=n>context</span><span class=o>.</span><span class=n>risk_config</span><span class=p>[</span><span class=s1>&#39;take_profit&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>close_position</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>stock</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;止盈 (</span><span class=si>{</span><span class=n>return_pct</span><span class=si>:</span><span class=s2>.2%</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 2. 行业集中度控制</span>
</span></span><span class=line><span class=cl>    <span class=n>sector_exposure</span> <span class=o>=</span> <span class=n>calculate_sector_exposure</span><span class=p>(</span><span class=n>context</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>sector</span><span class=p>,</span> <span class=n>exposure</span> <span class=ow>in</span> <span class=n>sector_exposure</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>exposure</span> <span class=o>&gt;</span> <span class=n>context</span><span class=o>.</span><span class=n>risk_config</span><span class=p>[</span><span class=s1>&#39;max_sector_exposure&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 需要减仓该行业</span>
</span></span><span class=line><span class=cl>            <span class=n>reduce_sector_exposure</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>sector</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                                 <span class=n>context</span><span class=o>.</span><span class=n>risk_config</span><span class=p>[</span><span class=s1>&#39;max_sector_exposure&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>after_trading_end</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    收盘后处理
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 更新策略统计</span>
</span></span><span class=line><span class=cl>    <span class=n>update_strategy_stats</span><span class=p>(</span><span class=n>context</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 记录事件历史</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>context</span><span class=o>.</span><span class=n>event_history</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>100</span><span class=p>:</span>  <span class=c1># 限制历史记录长度</span>
</span></span><span class=line><span class=cl>        <span class=n>context</span><span class=o>.</span><span class=n>event_history</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>event_history</span><span class=p>[</span><span class=o>-</span><span class=mi>50</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>update_strategy_stats</span><span class=p>(</span><span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    更新策略统计
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>total_value</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>portfolio</span><span class=o>.</span><span class=n>total_value</span>
</span></span><span class=line><span class=cl>    <span class=n>cash</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>portfolio</span><span class=o>.</span><span class=n>cash</span>
</span></span><span class=line><span class=cl>    <span class=n>positions_value</span> <span class=o>=</span> <span class=n>total_value</span> <span class=o>-</span> <span class=n>cash</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;账户总值: </span><span class=si>{</span><span class=n>total_value</span><span class=si>:</span><span class=s2>,.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;现金: </span><span class=si>{</span><span class=n>cash</span><span class=si>:</span><span class=s2>,.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;持仓市值: </span><span class=si>{</span><span class=n>positions_value</span><span class=si>:</span><span class=s2>,.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;持仓比例: </span><span class=si>{</span><span class=n>positions_value</span><span class=o>/</span><span class=n>total_value</span><span class=o>*</span><span class=mi>100</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 按事件类型统计</span>
</span></span><span class=line><span class=cl>    <span class=n>event_stats</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>stock</span><span class=p>,</span> <span class=n>event_type</span> <span class=ow>in</span> <span class=n>context</span><span class=o>.</span><span class=n>event_types</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event_type</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>event_stats</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>event_stats</span><span class=p>[</span><span class=n>event_type</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=n>event_stats</span><span class=p>[</span><span class=n>event_type</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;事件类型分布:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>count</span> <span class=ow>in</span> <span class=n>event_stats</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>event_type</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>count</span><span class=si>}</span><span class=s2>只&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 运行策略示例</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=== 事件驱动策略示例 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 这里可以添加策略运行代码</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;策略框架已建立，需要在SuperMind平台上运行&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=总结>总结</h2><p>本讲详细介绍了SuperMind平台事件驱动策略的开发方法，包括：</p><ol><li><strong>事件驱动基础</strong>：事件分类、效应分析方法</li><li><strong>业绩超预期策略</strong>：PEAD策略、业绩修正策略</li><li><strong>分红事件策略</strong>：高股息策略、除权套利策略</li><li><strong>并购重组策略</strong>：并购套利、重组事件策略</li><li><strong>完整策略实现</strong>：事件扫描、持仓管理、风险控制</li></ol><p>事件驱动策略是量化投资的重要分支，在下一讲中我们将开始学习回测优化技巧。</p></div></article><aside class="lg:w-80 xl:w-96"><div class=space-y-8></div></aside></div><nav class="border-t border-gray-200 mt-12 pt-8"><div class="flex justify-between items-center"><a href=/blog/%E5%9B%9E%E6%B5%8B%E5%B9%B3%E5%8F%B0/05-%E5%9B%A0%E5%AD%90%E9%80%89%E8%82%A1%E7%AD%96%E7%95%A5%E5%BC%80%E5%8F%91/ class="group flex items-center"><svg class="w-5 h-5 mr-2 text-gray-600 group-hover:text-primary-600" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0 7-7m-7 7h18"/></svg><div><div class="text-sm text-gray-600">上一篇</div><div class="font-medium group-hover:text-primary-600">SuperMind第5讲：因子选股策略开发</div></div></a><a href=/blog/%E5%9B%9E%E6%B5%8B%E5%B9%B3%E5%8F%B0/07-%E5%9B%9E%E6%B5%8B%E7%B3%BB%E7%BB%9F%E4%B8%8E%E7%BB%A9%E6%95%88%E8%AF%84%E4%BC%B0/ class="group flex items-center text-right"><div><div class="text-sm text-gray-600">Next Post</div><div class="font-medium group-hover:text-primary-600">SuperMind第7讲：回测系统与绩效评估</div></div><svg class="w-5 h-5 ml-2 text-gray-600 group-hover:text-primary-600" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0-7 7m7-7H3"/></svg></a></div></nav></div></div><footer class="bg-gray-50 py-12 border-t border-gray-200"><div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl"><div class="flex flex-col md:flex-row justify-between space-y-4 md:space-y-0"><div class=flex-1><div class="flex items-center space-x-3 mb-4"><a href=https://sk-quant.github.io/ class=inline-block><img src=/images/logo.svg alt=烧烤量化 class=h-6>
</a><span class="text-xl font-bold text-gray-900">烧烤量化</span></div><div class="flex space-x-3 p-2"></div></div><div class=flex-1><h3 class="text-sm font-semibold uppercase tracking-wider text-gray-900 mb-4"></h3><ul class=space-y-2></ul></div><div class=flex-1><h3 class="text-sm font-semibold uppercase tracking-wider text-gray-900 mb-4"></h3><ul class=space-y-2></ul></div><div class=flex-1><h3 class="text-sm font-semibold uppercase tracking-wider text-gray-900 mb-4"></h3><ul class=space-y-2></ul></div></div><div class="mt-12 pt-8 border-t border-gray-200"><div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0"><p class="text-gray-600 text-sm">© 2025 烧烤量化. All rights reserved.</p><a href=https://chaoming.li class="text-sm text-gray-600 hover:text-primary-600" target=_blank rel="noopener noreferrer">Powered by sk-quant</a></div></div></div></footer><script>const mobileMenuButton=document.getElementById("mobile-menu-button");mobileMenuButton&&mobileMenuButton.addEventListener("click",function(){const e=document.getElementById("mobile-menu");e&&e.classList.toggle("hidden")})</script></body></html>